OSはLinuxのCentOS7です。 端末のコマンド　 show variables like "chara%"; から抜粋です。 | character_set_database | latin1 | | character_set_filesystem | binary | | character_set_results | utf8 | | character_set_server | latin1 | このlatin1をUTF-8にセットしたいのですが、 /etc/my.cnfの中身をどのように書けばいいですか。
MySQLで漢字を登録したい。 insert into personal(id, old, name) values(1, 18, 'Satou'); とやればうまくいくのですが、 insert into personal(id, old, name) values(1, 18, '佐藤'); とやっても????となってしまいます。 どのようにすればいいでしょうか。
MYSQLにアクセスのテーブルをアップサイジングはできますか？
Linux(CentOS7 64bit)搭載サーバーで MariaDBを使って作成したデータベースに Windows7 32bit搭載のパソコンからアクセスするには？ http://dotnsf.blog.jp/archives/1013344582.html を参考にしてアクセスしようとしましたが、接続できませんでした。 IPアドレス、ユーザー名、パスワード等も確認しました。 RedHat用のMySQL,ODBCドライバーが入っていないからでしょうか。 こちらはWindows側に入れればいいのでしょうか。 ご教示お願い致します。
他のサーバのダンプファイルを別サーバにリストアする場合、違いに同じデータベースを持っているのですが、上書きリストアするとてーぶるは、どうなるのでしょうか？ 追加？上書き？される。
mysql order by　のNULLについて テーブル　tb1 memberid 2　 　2 cardid 　1　　 1 name 田中　　井岡 day 2016.4.10　　2016.4.22 new　　New NULL ソース SELECT memberid,cardid,max(name),max(day),max(new) FROM tb1 WHERE memberid=２ GROUP BY cardid ORDER BY max(day) DESC LIMIT '.$limit.' OFFSET '.$offset; すると　max(new)の部分が Newと出てきます。 max(new)なのでNULLが出てくると思っていました。 NULLにしたいのですが 名前も井岡ではなく田中がでてきます max(day)をオーダーしているので新しい日の情報が出てくると思っていましたが。。。。 何か　ＳＱＬの書き方に問題があるのでしょうか　それともこのテーブルの作りでは不可能なのでしょうか？ 無知な私に ご教授お願いいたします。
idの大きい順から並べたいのですがうまくいきません 調べて　サブクエリなどを使い実行しましたがうまくいきませんでした ご教授お願いいたします ソース $sql='SELECT memberid,mailid,max(name),max(day) FROM messageall WHERE mailid=? GROUP BY memberid ORDER BY id DESC LIMIT '.$limit.' OFFSET '.$offset; サブクエリでも試しましたが正直　ソースがめちゃくちゃでデータが表示されませんでした。 ご教授お願いいたします。
$sql_t="INSERT INTO `ken`.`kar` (`imei`,`mei`,`nyu`) SELECT `imei`,`mei`,`nyu` from ken.{'$tbl_nu1'} union SELECT `imei`,`mei`,`nyu` from ken.{'$tbl_nu2'}"; $result = mysql_query($sql_t); 上記の文があります。 SELECTの中のテーブル名を具体的に 入れるとデータが入ります。 しかし、上記の文にすると データが入らなくなります。 なぜでしょうか？ 式の書き方を教えていただけないでしょうか？ SELECTの中のテーブル名は変数で書きたいです。 ご指導のほど、よろしくお願いいたします。
table_1 id name age table_2 id book title city day SELECT * FROM table_1 WHERE id=? SELECT book,title FROM table_2 WHERE city=? このようにまったく別のテーブル　カラム数も違う　WHEREの？も違う これを一つのＳＱＬ文にまとめたいのですが。 UNIONなどを使ってもうまくいきませんでした。 ご教授お願いいたします。
エラーが出ます。どこかおかしな点はありますでしょうか。 エラー文 Call to a member function prepare() on a non-object ソース $page = 1; $limit = 2; $offset = $limit * ($page - 1); $sql='SELECT COUNT(*) FROM message WHERE memberid=? GROUP BY aid'; $stmt=$dbh->prepare($sql); $data[]=$memberid; var_dump($data); $stmt->execute($data); $dbh=null; $total=$stmt->fetchColumn(); $lastpage= ceil($total/$limit); $sql='SELECT aid,max(kaisyamei),max(day) FROM message WHERE memberid=? GROUP BY aid LIMIT '.$limit.' OFFSET '.$offset; $stmt=$dbh->prepare($sql); $stmt->execute($data); $dbh=null; ご教授お願いいたします。
$sql='SELECT id,kaisyamei, max(day),namae FROM message WHERE memberid=? GROUP BY id LIMIT '.$limit.' OFFSET '.$offset; どこか違いますか？
Ｍｙｓｑｌ　 2つのテーブルからデータを取りたいです。 テーブル名　aman id : amemberid : bookid : kakaku : sonota : day テーブル名　bman id : bmemberid : bookid :title : day この二つのテーブル　amanからkakaku,sonota。bmanからtitleを取り出したいのですが どのようなＳＱＬになるのでしょうか。 bookidは２つのテーブルに同じ数字番号が入るようになっています。 ソース $sql='SELECT * FROM aman WHERE bookid=? JOIN message2 ON aman.bookrid=bman.bookrid'; $stmt=$dbh->prepare($sql); $data[]=$carid; これではだめでした。
mysqlのデータにデータを格納したいのですができません。 エラー文も出ません。 phpのpostで受け渡しデータベースに格納する流れです。 データの受け渡しは確認済み。 下記はソースです。　 こちらも var_dump($data)で確認済み すべてにしっかりデータは入っています。 $sql='INSERT INTO zyoho(memberid,city.town,brand,syasyu,syasyumei,nenshiki,kyori, zyotai,sonota,gazou1,gazou2,gazou3,gazou4,gazou5,day)VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)'; $stmt=$dbh->prepare($sql); $data[]=$memberid; $data[]=$city; $data[]=$town; $data[]=$brand; $data[]=$syasyu; $data[]=$syasyumei; $data[]=$nenshiki; $data[]=$kyori; $data[]=$zyotai; $data[]=$sonota; $data[]=$gazou1; $data[]=$gazou2; $data[]=$gazou3; $data[]=$gazou4; $data[]=$gazou5; $data[]=date('Y-m-d H:i:s'); $stmt->execute($data); mysql テーブル名　zyoho id int primary key auto_increment memberid int city varchar(20) town varchar(20) brand varchar(50) syasyu varchar(50) syasyumei varchar(100) nenshiki varchar(20) kyori varchar(20) zyotai text sonota text gazou1 varchar(50)　　 gazou2 varchar(50) gazou3 varchar(50) gazou4 varchar(50),gazou5 varchar(50) day datetime 解決方法ご教授いただければと思います。
検索機能プラスページャー機能を作っているのですが$totalが取れません。 echo $total;にしても数字が出てきません。 検索機能をつけずに元あるデータからはうまくいきました。 ご教授お願いいたします。 ソースは下記です <?php $cityid=$_POST['city']; $brandid=$_POST['brand']; $syasyu=$_POST['ysasyu_sentaku']; $page = 1; $limit = 2; $offset = $limit * ($page - 1); $dsn='mysql:dbname=＊＊＊＊host=mysql1.＊＊＊＊ $user=＊＊＊; $password=＊＊＊＊＊ $dbh=new PDO($dsn,$user,$password); $dbh->query('SET NAMES utf8'); if($brandid=='') { $sql='SELECT COUNT (*)FROM zyoho WHERE cityid=? OR brandid=?'; }else{ $sql='SELECT COUNT (*) FROM zyoho WHERE cityid=? AND brandid=?'; } $stmt=$dbh->prepare($sql); $data[]=$cityid; $data[]=$brandid; $stmt->execute($data); $db=null; $total=$stmt->fetchColumn(); $lastpage= ceil($total/$limit); if($brandid=='') { $sql='SELECT naiyo FROM zyoho WHERE cityid=? OR brandid=? LIMIT '.$limit.' OFFSET '.$offset; }else{ $sql='SELECT naiyo FROM zyoho WHERE cityid=? AND brandid=? LIMIT '.$limit.' OFFSET '.$offset; } $stmt = $dbh->prepare($sql); var_dump($data); $stmt->execute($data); $db = null; while($row = $stmt->fetch(PDO::FETCH_ASSOC)){ echo $row['naiyo']; echo'</br>'; } echo '<ul class="pager">'; ?> <?php if($page > 1){?> <li><a href="pager.php?page=<?php echo $page-1; ?>"> << </a></li> <?php }。 for($i = $page; $page-2 < $i && $i <= $page+4 && $i <= $lastpage; $i++){ ?> <?php if($i == $page){ ?> <li><a href="kensaku_pager.php?page=<?php echo $i; ?>"><?php echo '<font color="#FF4DC4">'.$i.'</font></a></li>'; }else{?> <li><a href="pager.php?page=<?php echo $i; ?>"><?php echo $i.'</a>'; ?> <?php echo '</li>'; } }。 if($page < $lastpage){ ?> <li><a href="pager.php?page=<?php echo $page+1; ?>"> >> </a></li> <?php } ?> </ul>
offsetやlimitをつけると 結果が表示されなくなります。 $sql='SELECT naiyo FROM zyoho WHERE cityid=? OR brandid=? だけのＳＱＬだと結果は表示されるのですが。 解決方法をご教授お願いいたします。 下記はソースです。 $page=1; $limit=2; $offset = $limit * ($page - 1); $lastpage = ceil($total / $limit); if($brandid=='') { $sql='SELECT naiyo FROM zyoho WHERE cityid=? OR brandid=?　ORDER BY `code` DESC LIMIT'.$limit.' OFFSET '.$offset.''; }else{ $sql='SELECT naiyo FROM zyoho WHERE cityid=? AND brandid=?ORDER BY `code` DESC LIMIT'.$limit.' OFFSET '.$offset.''; } $stmt=$dbh->prepare($sql); $data[]=$cityid; $data[]=$brandid; $stmt->execute($data); $dbh = null;
絞り込み検索を実装したいのですがうまくいきません。 ご教授していただければ幸いです。 データは次のとおりです。 テーブル名　「zyoho」 カラム　 cityid ：tenki_id ：kansou １：１：あつい ２：２：乾燥してる １：２：乾燥してる ３：３：寒い 以上をセレクトボックスにて絞り込み 「kansou」のデータをだしたいのいです。 一つ目のセレクトボックス ・東京 ：cityid 1 ・大阪：cityid 2 ・熊本：cityid 3 二つ目のセレクトボックス ・晴れ：tenki_id1 ・雨：tenki_id2 ・雪：tenki_id3 ・何も選択しなかったらすべて表示。 ・例えば東京だけ選ぶと　あつい　乾燥してるの二つのデータ結果。 ・天気だけを選ぶと出てくるいくつかのデータ結果。 ・県、天気を選ぶと絞り込まれたデータ結果。 このように絞り込みたいのですがご教授いただければ幸いです。 お願いいたします。
重複レコードの削除で、重複レコード内の日付が最も新しいのだけを残したいのですが sqlite3のクエリをどう書けるのでしょうか？ 例えば以下のような構造で、keyの重複を削除するのですが、 keyごとにyear, monthのもっとも新しいのだけ残したのです。 よろしくお願いします。 id, key, year, month, value 1 , aaa, 2000,12, 1000 2 , bbb, 2001, 1, 600 3 , bbb, 2001, 4, 500 4 , bbb, 2000, 2, 400 5, ccc, 2001, 3, 300 6, ccc, 2001, 8, 200 クエリ実行の結果こうしたい↓ 1 , aaa, 2000,12, 1000 3 , bbb, 2001, 4, 500 6 , ccc, 2001, 8, 200
カテゴリーがここで合っているのかわかりませんが みなさま何卒よろしくお願いいたします。 下記URLで質問させていただきました者です。 http://okwave.jp/qa/q9109793.html XAMPPは無事インストール出来たみたいです(^_^;) その後の設定を下記URLを参考に進めましたが http://techacademy.jp/magazine/2941 URL欄に「http://localhost」と入力しても 言語選択のページは表示されず 「Apache Friends」のページが表示されます。 色々と調べた結果 XAMPPがMySQLからMariaDBに乗り換えたことが 原因のようですが 解決策がわからず苦戦しています。 解決策を教えて頂けると幸いです。 みなさま、何卒よろしくお願いいたします。 ちなみに、XAMPPでは このように表示されています。 ご参考までに・・・ 18:40:32 [main] Initializing Control Panel 18:40:32 [main] Windows Version: Windows 8.1 64-bit 18:40:32 [main] XAMPP Version: 5.6.15 18:40:32 [main] Control Panel Version: 3.2.2 [ Compiled: Nov 12th 2015 ] 18:40:32 [main] Running with Administrator rights - good! 18:40:32 [main] XAMPP Installation Directory: "c:\xampp\" 18:40:32 [main] Checking for prerequisites 18:40:37 [main] All prerequisites found 18:40:37 [main] Initializing Modules 18:40:37 [Apache] XAMPP Apache Service is already running on port 80 18:40:37 [Apache] XAMPP Apache Service is already running on port 443 18:40:37 [mysql] XAMPP MySQL Service is already running on port 3306 18:40:37 [main] The FileZilla module is disabled 18:40:37 [main] The Mercury module is disabled 18:40:37 [main] The Tomcat module is disabled 18:40:37 [main] Starting Check-Timer 18:40:37 [main] Control Panel Ready 以上です。 みなさま、何卒よろしくお願いいたします。
お世話になります。 データベースにアクセスするperl CGIを造ろうとしています。 １データベース・１テーブルのみの単純なつくりで １レコードはだいたい、intergerが10項目、char[12]程度のtextが10項目、dateが5項目、 全部で10,000レコード程度の小規模なものです。 ユーザ数は特定の約30人程度です。各人、一日に２～３レコードにしか書き込み操作はしないはずです（時刻は重なるかもしれません）。 速度がクリティカルに要求されるわけではありません。 SQLiteとMySQLの比較は、ネット上でも多数見つかり、多数ユーザならMySQL、single userならSQLiteという感想が多いですが、30人というのが「多数」なのか、どうなのかわかりかねましたので、使用実感をお聞かせください。 SQLiteで少し組んでみたのですが、きわめて容易に作れるし、バックアップも簡単なので、30人程度ならSQLiteでも問題なしということであればSQLiteにしたいところです。
開発環境： MySQL　5.0.95 PHP Version 5.3.3 以下のテーブルがあるとします。 id,title,content 1,野菜,野菜について 2,りんご,果物について 3,ニンジン,野菜について 4,野菜,玉ねぎについて 上記のようなテーブルで「野菜」と検索したときの並び順についてです。 結果として 初めに「title」にあったものを表示、次に「content」にあったものを表示させたいです。 【検索結果】 1,野菜,野菜について 4,野菜,玉ねぎについて 3,ニンジン,野菜について SELECT * FROM hoge title LIKE 野菜 UNION SELECT * FROM contents LIKE 野菜 とすると、「1,野菜,野菜について」が重複されてしまします。 参考にしたページ http://q.hatena.ne.jp/1331450527 http://q.hatena.ne.jp/1336143424 最初にtitleで合致したidをとっておき、それ以外をcontentと合致するか検索する という方法も考えたのですが、可能であれば1回のSQLでできたら嬉しいです。 どなたか教えていただけませんでしょうか。 何卒よろしくお願い致します。
mysqlでテーブルにindexを設定しているにもかかわらず、強制的にフルスキャンさせる方法(設定)は ありますか？且つ、強制的にフルスキャンさせる時に、フルスキャンに切り替わる時刻設定とかも 出来ますでしょうか？
ご質問させて頂きます。 表題の通り外部ホストからの接続ができなく、困っております。 質問や色々な方法で試しましたが、一向に接続できない状況です。 皆さま何卒宜しくお願い致します。 【作業環境】（自PCも外部PCも作業環境は一緒です） Windows10 XAMPP5.6.15-1 無線WiFiのネット環境 【現状までの状況】 ・初期rootユーザーへパスワード付与 ・localhost（自PC）ではMySQLログイン可能 ・権限付ユーザー（外部ホスト用）を作成 GRANT ALL PRIVILEGES ON *.* TO 'ユーザー名'@'IPアドレス（WiFiのIP）' IDENTIFIED BY PASSWORD '*F33355756B0A96D6AA66F10FA72D9DAA65A37BB7' WITH GRANT OPTION | ・3306ポート（MySQL）をファイアウォールにて開放。 ・「my.ini」のbind-addressは#ですべてコメントアウト済。 ※一度コメントアウトを外して、 bind-address＝”127.0.0.1” bind-address＝”外部ホストのIP”を設定して試しましたがだめでした。 ・「my.ini」にてskip -name -resolveを追加しましたがMySQLが稼働しなくなりました。 以上を行いましたが、できず仕舞です。 こちら側の設定が悪いのか、外部PC側のPCが悪いのか。。。 果たして今の状況まで行った設定が本当に正しいのか。。。 お手すきの際にでもご指導頂ければと思います。 以上宜しくお願い致します。
phpを勉強中のものですがＤＢエラーに関しての質問をさせていただきます。 「商品情報入力」→「商品情報入力チェック」→「商品情報登録」 「登録商品一覧」→「商品詳細情報」 この商品詳細情報でその商品に対するコメントを入れるのですが 「商品詳細情報のコメント欄にコメント入力」→「コメントチェック」→「コメントをＤＢに登録」 商品情報は登録できるのですが、コメントをＤＢに登録する際エラーが出ます。 ＤＢのパスワードなどに間違いはないはずです。　試しに２つ無料レンタルサーバを貸り試してみましたが2つともやはりコメントを登録するところでエラーが出ます。 解決方法その他アドバイスありましたら教えていただきたいです。 エラーは下記になります Internal Server Error The server encountered an internal error or misconfiguration and was unable to complete your request. Please contact the server administrator at admin@main-hosting.eu to inform them of the time this error occurred, and the actions you performed just before this error. More information about this error may be available in the server error log.
毎月月末に、当月分のtbl_orderのデータを tbl_order_oldに移す作業を手動で行っているのですが、 SQL一回もしくは、二回で出来ないしょうか tbl_order_oldテーブルはtbl_orderテーブルと全く同じ構造になっています。 tbl_order itemname orderday りんご 2015/11/1 みかん 2015/11/2 もも 2015/11/30 かき 2015/12/1 いちご 2015/12/2 (1)tbl_order_oldにorderdayが2015/11/1~2015/11/30までのデータを追加 (2)tbl_orderからorderdayが2015/11/1~2015/11/30までのデータを削除
私の知識ではお手上げのため、ご教授願いたいのですが、 下記のようなテーブルが仮にあったとして、レコードがそれぞれいくつか入っています。 【itemsテーブル】 　　id・・・・・連番 　　cat_id・・・category.id 　　price ・・・価格 　　max_num ・・セット数 　　date・・・・発売日 【categioryテーブル】 　　id・・・・・連番 　　cat_name・・カテゴリ名 【orderテーブル】 　　id・・・・・連番 　　item_id ・・items.id 　　paid_price・支払価格 以下の２つのSQL文を実行させた場合、「total_price」の値に違いは発生しますか？ 【SQL文　Ａ】－－－－－－－－－－－－－－－－－－－－－－－－－－－－－ SELECT items.cat_id, `category`.`cat_name`, SUM(`items`.`price` * `items`.`max_num`) AS `total_price`, SUM(IF(`order`.`paid_price` > 0, `order`.`paid_price`, 0)) AS `total_paid`, SUM(IF(`order`.`paid_price` = 0 , `items`.`price`, 0)) AS `not_payment` FROM `items` INNER JOIN `category` ON (`items`.`cat_id` = `category`.`id`) INNER JOIN `order` ON (`items`.`id` = `order`.`item_id`) WHERE DATE_FORMAT(`items`.`date`, '%Y%m') = 201511 GROUP BY `items`.`cat_id` ORDER BY `items`.`cat_id` ASC －－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－ 【SQL文　Ｂ】－－－－－－－－－－－－－－－－－－－－－－－－－－－－－ SELECT items.cat_id, `category`.`cat_name`, SUM(`items`.`price` * `items`.`max_num`) AS `total_price` FROM `items` INNER JOIN `category` ON (`items`.`cat_id` = `category`.`id`) WHERE AND DATE_FORMAT(`items`.`date`, '%Y%m') = 201511 GROUP BY `items`.`cat_id` ORDER BY `items`.`cat_id` ASC －－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－ こちらで上記と同じようなSQL文を実行すると、Ｂで出てほしい値がＡでは出てこないのです。 Ａの場合は「WHERE DATE_FORMAT(`items`.`date`, '%Y%m') = 201511」が抽出条件として実行されていないような感じです。 すべてのレコードの「SUM(`items`.`price` * `items`.`max_num`) AS `total_price`」が計算されています。 Ｂだけで実行すればちゃんとほしい値が返ってきます。 何か間違っていますか？
趣味でwebサイト制作を考えている初心者です。 SQL、PHPともに初めて扱います。 基礎からのMySQLという書籍を購入し、進めていたのですが、 この書籍ではmysql_queryを扱うと書かれていました。 しかし、mysql_queryが非推奨になったと知って、困っております。 質問内容 1. 書籍の通り、mysql_queryを一通り学んだ方がよいでしょうか？ 2. その他にPDO、mysqliというものがあるそうですが、扱いやすさに違いなどはありますか？ よろしくお願いいたします。
現在プログラミングを学んでいる超初心者です。 現在ＰＨＰを勉強中でレンタルサーバーを使い 動作確認などを行いたいのですがうまくいきません。 レンタルサーバーはウェブクロウと言うところを使っています そしてＦＦＦＴＰでアップロードしても　ＨＴＴＰ403がでたり 「このページは表示されません」になったりしいろいろ調べたりしましたが 現在お手上げ状態です。 サーバー情報に　ドキュメントルートというのがありました これは何か関係があるのでしょうか？ ドキュメントルートは下記のとうりです。 /home/nakahiro7/[ドメイン名]/public_html/ その他何かご指摘、方法があれば教えていただければ幸いです。 目的は　ＰＨＰの動作確認、ＭＹＳＱＬとちゃんと連携できているかなどを確認したいです。（会員登録のような機能などちゃんとできてるか確認したい） 無知な私にどうかお知恵をおかしください。
PDOについての質問です。宜しくお願い致します。 久しぶりに質問させていただきますどうかよろしくお願い致します。 技術評論会社から出版されているPHP+MySQL Webシステム構築という書籍を参考に プログラムを組んでいるのですがコードを見るとかなり古くMySQLに接続するコードに mysql_connectなど非推奨のものが使われています。 そのコードを自分なりにPDOに直しているのですが、errorはなんとか無くなり表示も問題なく されるのですがはたして本当に間違いのないプログラムなのか私には判断がつきませんので どうかご教授いただきたいと思っております。 何卒よろしくお願い致します。 プログラムは以下のようになります。 <?php header("Content-Type: text/html; charset=utf-8"); ?> <?php require_once("photolibini.php"); try { $dsn = 'mysql:dbname=photolibdb;host=localhost'; $user = '******'; $password = '*****'; $dbh = new PDO($dsn, $user, $password); $dbh->query('SET NAMES utf8'); //カテゴリを集計するSQLを組み立てます $sql = "SELECT tblphoto.categoryid, categoryname, Count(photoid) AS cnt FROM tblphoto INNER JOIN tblcategory ON tblphoto.categoryid = tblcategory.categoryid GROUP BY tblphoto.categoryid ORDER BY tblphoto.categoryid"; $stmt = $dbh->prepare($sql); $stmt->execute(); $dbh = null; //ページ本文を組み立てます $body = "現在、次のカテゴリの写真が登録されています。表示したいカテゴリをクリックしてください。 <BR><BR> <UL type='circle'>"; //結果セットからデータをループで読み込みます while ($col = $stmt->fetch(PDO::FETCH_ASSOC)) { $body .= "<LI><A href='search.php?categid=$col[categoryid]'> $col[categoryname]</A> " . "（$col[cnt]件）"; } } catch(Exception $e) { print'ただいま障害により大変ご迷惑をお掛けしております。'; exit(); } ?> <?php $body .= "</UL>"; //ページヘッダを出力します echo htmlheader("カテゴリ別一覧"); //ページ本文を出力します echo $body; //ページフッタを出力します echo htmlfooter(); ?>
下記２つのテーブルを検索して、結果のようなデータを取得したいと考えております。 tableBのitemnoは1~5まで固定ですが、注文がある場合のみテーブルに存在します。 tableA uid name 16 　山田 17 佐藤 tableB uid itemno itemname 16 1 りんご 16 2 みかん 16 3 もも 16 4 かき 16 5 いちご 17 1 りんご 17 3 もも 17 5 いちご 結果 uid name itemname1 itemname2 itemname3 itemname4 itemname5 16 山田　りんご　　みかん　　もも　　　かき　　　いちご 17 佐藤　りんご　　null　　　 もも 　　　null 　　　いちご 宜しくお願い致します。
$sql = "SELECT * FROM profile WHERE (todouhuken='$todouhuken1' OR todouhuken='$todouhuken2' OR todouhuken='$todouhuken3') AND (age between $begin_age and $end_age) AND (photo1 is not null OR photo2 is not null OR photo3 is not null) AND seibetsu=2;"; 画像カラム(photo1, photo2, photo3)のどれかに画像ファイル名が入っていれば、 検索に引っかかるという、このSQL文ですが、データベース上で実際にこの3カラムすべてに 値が入っていないレコードまで引っかかってしまいます。この3カラムすべてに値が入っていないレコードは検索に引っかからないようにしたいのですが、どこが間違っているのか、 ご指導よろしくお願いします。
OracleからMySQLへSQL文を変換するにあたり、 テーブル結合部分が複数ありややこしくて以下で合っているのか、分かる方いましたらご教授ください。 ■Oracle 　SELECT * 　FROM m, h, p, c 　WHERE m.mid = h.mid(+) 　AND m.tcd = '0' 　And h.pid = p.pid(+) 　And m.rcd = c.rcd 　And c.cid = 'aaa' ■MySQL 　SELECT * 　FROM m left outer join h on m.mid = h.mid and m.tcd = '0' 　　　　h left outer join p on h.pid = p.pid 　　　　m left inner join c on m.rcd = c.rcd and c.cid = 'aaa'
MySQL 5.5を使用しています。 以下のテーブルA、B（同じ構造でIDは重複しない）において A ID | ポイント 1 | 10 3 | 20 5 | 5 6 | 5 B ID | ポイント 2 | 20 4 | 20 7 | 5 select ID,hoge from A,B; とすると、 A.ID | B.ID | A.hoge | B.hoge 1 |. | 10 |. . | 2 |. | 20 3 |. | 20 |. . | 4 |. | 20 5 |. | 5 |. 6 |. | 5 |. . | 7 |. | 5 という結果が得られますが、これを ID2| foo 1 | 10 2 | 20 3 | 20 4 | 20 5 | 5 6 | 5 7 | 5 という形に同一の変数にまとめるにはどうすればいいでしょうか。 select A.ID as ID2, B.ID as ID2 from A,B; のようにasを使用して１つの変数を作成しようとしましたが、別の変数として 認識されていまいました。
使用しているのはMySQL5.5です。 以下のようなデータベース（→元データベース）があり、プロジェクト毎の作業時間と作業日数を出すために select プロジェクト, count(*), sum(時間) order by プロジェクト; としたところ、同一日の作業が二重にカウントされて、正確な作業日数が計算できません。 →誤った集計結果1 また、 select プロジェクト, count(*), sum(時間) order by プロジェクト, 作業; とすると、今度はプロジェクト単位で作業時間が計算できませんでした。 →誤った集計結果2 これを、同一日はカウントせず、作業日数と作業時間を集計するには どのようにすればいいでしょうか。 ・元データベース 日付|プロジェクト|作業|時間 2015-10-01|A|DB作成|2 2015-10-01|A|データ入力|1 2015-10-01|B|DB作成|3 2015-10-02|A|データ入力|1 2015-10-02|B|DB作成|4 2015-10-02|B|データ入力|2 ・誤った集計結果1 プロジェクト|作業日数|時間 A|3|4 B|3|9 ・誤った集計結果2 プロジェクト|作業日数|時間 A|1|2（DB作成のrow） A|2|2（データ入力のrow） B|2|7（DB作成のrow） B|1|2（データ入力のrow） ・理想の集計結果 A|2|4 B|2|9
phpからselect文を使用した際、一部データが欠けるので、 もし何かお気づきの点があれば、ご指摘頂ければ幸いです。 使用しているもの。 php 5.6.14 mariadb-10.0.21-with-mroonga-5.08-winx64 ※一つのテーブルに向けてのselect文、エンジンはmroongaです。 cakephp 2.5系 ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー cakePHPのモデルクラスから、 以下の様なプログラムを書いております。 $sql = "sql文です。※(select　………)"; $data = $this->query($sql); ※全文検索を使用するのでsql文直書きです。cakephp的な書き方がわからず。。あるのかな？ あるカラムに例えばですが以下の様に入ってます。 ※emlのccやfromです。 佐藤<********@****.co.jp>,鈴木<********@****.co.jp> これをselectしてviewに表示すると佐藤、鈴木しか残らず、 残りが欠けてしまっております。 workbenchから同じクエリを打っても欠けている様には見えず、 どこで欠けているかわからず頓挫しております。 お気づきの点等あればご指摘を何卒宜しくお願い致します。
mysql> SELECT * FROM users WHERE id=0; +--------+--------+ | id | pwd | +--------+--------+ | tanaka | a2f9hy | | yamada | sn6s3n | +--------+--------+ これを実行した場合に 'tanaka'=0と解釈されます。 文字列と数値の比較の場合、暗黙に文字列を数値に変換してから比較します。 そして、MySQLに限り、数値に変換できない文字列は 0 に変換するからです。 この結果、'tanaka' = 0 は真になります。 と言うことですが、意味が理解出来ないのですが、 何故、tanakaは数値に変換できないのでしょうか。
MySQLにある顧客データを元にしたWordもしくはPDF送付状の自動作成プログラムを作りたいのですが、どういう風につくったらいいでしょうか？ Wordの差し込み印刷で、EXCELのデータを挿入できるというのは知っていたのですが、本屋を梯子したところ、どの本にもEXCELの差し込み印刷の方法しか書いておらず、その場合、一旦Webアプリケーションから顧客データをCSV等でローカルにダウンロードしなければならず、手間がかかります。 参考) http://blog.goo.ne.jp/xmldtp/e/1c399b1733c18760497282c660fbc862 Web上でWordへの差し込みまでを完結できないのでしょうか。Wordでなくても、送付状が生成されればOKです。 宜しくお願い申し上げます。
tanakaさん、matsudaさん、komatsuさんの3人が買い物に行きました。それぞれの所持金は50000円、購入した商品&価格は下記のとおりです。 【g】テーブルg 所持金 userId,g_money tanaka,50000 matsuda,50000 komatsu,50000 【ca】テーブルca 購入したもの userId,goods,price tanaka,watch.13000 matsuda,cardgame,1000 komatsu,bag,22000 matsuda,ballpen,500 tanaka,tablet.15000 tanaka,battery.1000 komatsu,chocolate,100 これをMySQLで、gの所持金から、caの購入リスト通りに引き算していくSQLを組みたいと思っています。 REPLACE INTO g(userId,g_money) SELECT (userId,VV) FROM (SELECT ca.userId,(SELECT g.g_money - ca.price) AS VV FROM ca, g WHERE ca.userId = g.userId) AS CG 下記のエラーが出てしまいます。 #1241 - Operand should contain 1 column(s) どのように修正すればいいかご教示いただけますでしょうか? よろしくお願いいたします。
Windows7 32bit MySQL5.5を使用しています。 テーブルのスペースが崩れてしまっていて見づらいかと思いますが よろしくお願いします。 ・table B +------+------------------+------+ | id | name | id_A | +------+------------------+------+ | 1 | 手順書作成 | 1 | | 2 | レビュー | 1 | | 3 | 開発 | 2 | | 4 | 社内・社外研修 | 3 | +------+------------------+------+ （id=主キー、name=文字列、id_A=テーブルAを参照するための外部キー） ↓ 1回だけ以下のプログラムを実行し、table Cを生成します create table C (SELECT * FROM B); alter table C add flag Boolean default FALSE; ↓ ・table C +------+------------------+------+------+ | id | name | id_A | flag | +------+------------------+------+------+ | 1 | 手順書作成 | 1 | 0 | | 2 | レビュー | 1 | 0 | | 3 | 開発 | 2 | 0 | | 4 | 社内・社外研修 | 3 | 0 | +------+------------------+------+------+ その後、Bが不定期に更新されるため、どこかの タイミングで、同様にCにも更新情報を反映したいのです。 ↓ ・更新されたtable B +------+------------------+------+ | id | name | id_A | +------+------------------+------+ | 1 | 手順書作成 | 1 | | 2 | レビュー | 1 | | 3 | 開発 | 2 | | 4 | 社内研修 | 3 | | 5 | 社外研修 | 3 | +------+------------------+------+ ↓ ・table C +------+------------------+------+------+ | id | name | id_A | flag | +------+------------------+------+------+ | 1 | 手順書作成 | 1 | 1 | | 2 | レビュー | 1 | 0 | | 3 | 開発 | 2 | 0 | | 4 | 社内研修 | 3 | 1 | ←このレコードは更新したい | 5 | 社外研修 | 3 | 0 | ←このレコードは追加したい +------+------------------+------+------+ どのように指定をすればいいでしょうか。 思いつくのは create table temp( select B.id, B.name, B.id, C.flag from B left join C on(C.id=B.id)); drop table c; create table c(select * from temp); drop table temp; という方法ですが、もう少しスマートな処理方法がないか、 そして、default値が反映されたものにしたいのです。 （上記を実行すると以下になります） ・table temp +------+------------------+------+------+ | id | name | id_A | flag | +------+------------------+------+------+ | 1 | 手順書作成 | 1 | 1 | | 2 | レビュー | 1 | 0 | | 3 | 開発 | 2 | 0 | | 4 | 社内研修 | 3 | 1 | | 5 | 社外研修 | 3 | NULL |←NULLではなく、FALSEとしたい +------+------------------+------+------+ どうぞ宜しくお願いします。
こんにちは SQLのLIKEにおいて、LIKEだけだと、頭文字での一致を探すのみで、 _%でやると２文字目以降にも含まれれば検索されるということですか？ 逆にいうと、LIKEのみでは頭文字の一致しか検索できないのですか？
こんにちは MySQLのコマンドプロンプト上ではなく、別ファイルからJavaScriptなどの動的処理によってMySQLのデータを動かす方法はあるのですか？ 例えば、window.promptでのサブウィンドウに入力された値をMySQLのデータに追加させる等々
過去の質問（http://okwave.jp/qa/q8830539.html）ですが、 仕入れテーブルの入荷日2014/1/2分はどこに書けばいいのでしょうか 下記のようにwhereの中に書くとエラーになってしまいます delete 仕入れテーブル where (商品,規格,入荷日='2014/1/2') in (select 商品,規格 from 商品テーブル where 担当 = 'Bさん')
MySQL のJavaです。 パラメータに、iPara_food_idとiPara_kind_idを与え、 １）comment_textが、null か、空っぽで、 ２）limit_date が最大、 ３）のレコードを１件抽出したいのですが、 String strSQL = "SELECT record_id, color_id FROM foods" + " WHERE" + " (food_id = " + 123455/*iPara_food_id*/ + ")" + " AND (kind_id = " + 1545334/*iPara_kind_id*/ + ")" + " AND (comment_text IS NULL) OR (LENGTH(comment_text) = 0)" + " AND (delete_flag = false)" + " ORDER BY limit_date DESC" + " LIMIT 1"; テーブルとソースを何度も見直したり、 値を変更してみたり、 パラメータの値を変更してみたり、 したのですが、 パラメータに、iPara_food_idとiPara_kind_id。 何を与えても、同じレコードを抽出してきます。 それは、３０件ほどのレコードの中で、 日付が途中くらいのもので、comment_text が空の ものです。 comment_textが空のレコードは、 ２件あるのですが、 固定で抽出してくるレコードは、 日付の大きいほうです。 なぜ、パラメータが聞かないのでしょうか？ ※上記、思い切って、むちゃくちゃな、数値を 　指定していますが、それでも、同じレコードを 　抽出してきます。
下記のSQL文は、間違っていると思われます。 MySQLをJAVAでコーディングしています。 やりたいことは、 １）food_textが、NULLか、空っぽの時に、 ２）limit_dateが最大の ３）レコード1件を抽出したいのです。 SELECT Id, food_id FROM foods 　 WHERE 　　　(kind_id = 1) 　AND (food_text IS NULL) AND (DATALENGTH(food_text) <= 0) 　AND (delete_flag = false) 　ORDER BY limit_date DESC 　LIMIT 1;
お世話になります。 win7 SP1 / エクセル2013　 プロセッサ　IntelCore　Duo　CPU　1.2GHz メモリ　１GB の環境です。 ローカルPCで MySQLからエクセルにVBAを使ってSELECT構文にて 書き出ししようとしていますが、 MySQL側で文字列型を　TEXT　にて保存しているカラム（列）が 1行分しかエクセル側に移せません。 MySQLのデータをVARCHAR（510）型に変更した上で データを保存しなおして 同じSELECT構文にて実行すると 問題なく抽出できます。 TEXT型は可変長型なので 問題ないかと思っていたのですが SIZE（65535バイト）は関係しますでしょうか？ 詳しくないのですが TEXT型は可変長バイナリーデータ VARCHAR型は可変長文字列型 と認識してますが、 同じ可変長型でも、データ取り出し時に 何か違いが生じるのでしょうか？ 原因がよくわかりません。 また、そうであるとすると このような作業を行う場合は TEXT型の利用はあまりしない方が良いということでしょうか？ 特に長いURLなどを保存するときは 文字数を推測し難いので TEXT型の方が便利かと思っています。 どうぞよろしくお願いします。
JAVAで、MySQLを書いています。 (理由は不明ですが、たまに、言語がわからないと、SQL文を提示できないという方がいるので、「JAVAで」と書いてあります。MySQLは、言語に依存しないと思っているのですが。) よくここで、どのように、SQL文を書いたらよいか質問しております。 それは、書き方がわからないときもあるし、 わかってはいるが、もっと簡潔、早い、見やすい、メモリの消費が少ない などのSQLを求めているからです。 質問が的を得ていないときもあり、質問が難しいのですが、 テーブル例などを書くようにして、質問しています。 ご回答は、みなさん、それぞれ、色々なSQL文を書いてくれます。 難しいのやパッとみて、ああっ、それ簡単で早そう！！ というのとか、あります。 ところで、１行だけのレコードが欲しいと質問したときに、 SQL文に、LIMIT1 をつける方とつけない方がいます。 LIMIT 1 の有無による、速度や、メモリ使用量など、 メリット、デメリットを教えてください。
MySQLをJAVAで使っています。 指定キーの中で、一番日付の大きなレコード項目全てを 取り出したいのですが、 下記SQLだと、何も抽出されません。 何が間違っているのでしょうか？ さらに、もっと簡単なSQL文はないでしょうか？ SELECT * FROM food WHERE (food_id = 1) AND (food_name = 'みかん') AND (food_id = (SELECT MAX(date) FROM food WHERE (food_id = 1) AND (food_name = 'みかん'))) 与える検索キー項目は、food_id=1, food_name=みかん foodテーブル例 food_id　　food_name　　　date --------------------------------- 1　　　　　みかん　　　　2015-01-01 1　　　　　みかん　　　　2015-02-01 1　　　　　みかん　　　　null 1　　　　　みかん　　　　2015-04-01 2　　　　　きんめだい　　2015-01-01 2　　　　　じんたん　　　2015-02-01 2　　　　　コロッケ　　　2015-02-01
MySQLをJAVAで使っています。 指定キーの中で、一番日付の大きなレコード項目全てを 取り出したいのですが、 下記SQLだと、何も抽出されません。 （今朝、ここで教えて頂いたSQL文です） 何が間違っているのでしょうか？ さらに、もっと簡単なSQL文はないでしょうか？ SELECT * FROM food WHERE (food_id = 1) AND (food_name = 'みかん') AND (karute_id = (SELECT MAX(date) FROM food WHERE (food_id = 1) AND (food_name = 'みかん'))) 与える検索キー項目は、food_id=1, food_name=みかん foodテーブル例 food_id　　food_name　　　date --------------------------------- 1　　　　　みかん　　　　2015-01-01 1　　　　　みかん　　　　2015-02-01 1　　　　　みかん　　　　null 1　　　　　みかん　　　　2015-04-01 2　　　　　きんめだい　　2015-01-01 2　　　　　じんたん　　　2015-02-01 2　　　　　コロッケ　　　2015-02-01
MySQLを使って予約の仕組みを作っていますが、SQLの組み立てがわからず困っています。 下にあるように２つのテーブルがあります。 「table_frame」は時間のワクのテーブルです。「table_reserve」は各ワクにリンクされる予約情報です。 １つのワクに対して複数の予約が入ります。 ２つのテーブルをジョインして「リスト」を出したいと考えています。 ある１日の予約時間（ワク）の一覧を「リスト」の形式で出力したいと考えています。 １日に対してワクは10個の固定です。 【table_frame】 frameId reserveDate reserveTime 【table_reserve】 reserveId frameId customerName number 【リスト　2015-07-15】 ワクID　　　予約タイム　　予約件数 (frameId)　(reserveTime) 1　　　　　　　aa　　　　　　1 2　　　　　　　ab　　　　　　0 3　　　　　　　ac　　　　　　1 4　　　　　　　ad　　　　　　2 ・　　　　　　　・　　　　　　・ ・　　　　　　　・　　　　　　・ 10　　　　　　 aj　　　　　　0 上記の条件で、多分副問い合わせを使うのだと考え、いろいろSQLを組み立ててみましたが、 うまくいきません。 いろいろSQLをいじっていたら訳が分からなくなってしまいました。 以下はその1例です。 【例】 SELECT frameId, reserveTimeZone, rCount FROM tbl_frame, tbl_reserve WHERE reserveDate = '2015-07-15' AND rCount = (SELECT count(*) as rCount FROM tbl_reserve) AND tbl_frame.frameId = tbl_reserve.frameId よろしくご指導ください。お願いします。
MySQLです。JAVAです。 下記に該当するレコード項目全てを抽出するには、 どのようなSQLを書けばよいでしょうか？ 指定日 sitei_date = 2015-07-14 sampleテーブル -------------------- ID　name　date -------------------- 1　商品A　2015-07-07 1　商品A　2015-07-13 1　商品A　2015-07-14 ・・・ これを抽出したい 1　商品A　2015-09-11 2　商品B　2015-09-10 2　商品B　2015-07-15 2　商品B　2015-07-13 3　商品C　2015-07-07 3　商品C　2015-07-11
MySQLで、ON DUPLICATE KEY UPDATE を初めて使っています。 ところが、レコードが更新や作成されなくて困っています。 具体的には、下記のようなSQL文ですが、 どこがわるいのでしょうか？ String strSQL = "INSERT INTO interview_patient_modoule (" + "aaa"　・・・複合キー +",bbb"　・・・複合キー +",ccc" +",ddd" 　・・・複合キー +",eee" + ")" + " VALUES (" + "1" + "2" + "3" + "4" + "5" + ")" + "ON DUPLICATE KEY UPDATE" + "aaa = 1"　・・・複合キー +",bbb = 2"　・・・複合キー +",ddd = 3"; 　・・・複合キー // SQLの実行 dbStatement.execute(strSQL);
MySQLです。 既にレコードがあるか、ないか、不明な状態で、 同じキーのレコードを書き込みたいのですが、 事前にレコードの有無を確認せずに、UPDATE or INSERTする方法は、 ありますか？ レコードをユニークにするキーは、３つあります。
MySQLです。 商品IDと販売先、管理番号が、判明しているとき、 最大商品IDとそのレコードを取得するには、 どのようなSQLを書けば、よろしいでしょうか？ select *, ？ from SYOUHIN WHERE ???? テーブル例） ↓ユニーク 商品ID　販売先　管理番号　 販売日 1　　　A社　　　1　　　　　2015-07-10 2　　　A社　　　2　　　　　2015-07-12 3　　　B社　　　1　　　　　2015-06-30 4　　　B社　　　2　　　　　2015-07-06 5　　　C社　　　1　　　　　2015-04-21
MySQLを使っています。 同じ商品のレコードが複数あります。 その多数のレコード中に、日付項目があります。そこから、 １）指定日に、２）一番近い過去の日の１件の、３）全商品のレコード、を抽出するには、 どのようなSQL文を書けばよいでしょうか？ １．過去に複数ある日付の中から、指定日に、一番近いレコード。 レコードの例） 指定日＝2015-07-01 商品ID 日付 1 2015-10-11 ・・・未来 ⇒ 抽出せず 1 2015-08-02 ・・・未来 ⇒ 抽出せず 1 2015-07-01 ・・・指定日 ⇒ 抽出せず 1 2015-07-01 ・・・指定日 ⇒ 抽出せず 1 2014-01-01 ・・・過去 ⇒ 抽出せず 1 2015-06-03 ・・・過去 ⇒ 抽出したい★★ 2 2015-10-11 ・・・未来 ⇒ 抽出せず 2 2015-08-02 ・・・未来 ⇒ 抽出せず 2 2015-07-01 ・・・指定日 ⇒ 抽出せず 2 2014-01-01 ・・・過去 ⇒ 抽出せず 2 2015-06-03 ・・・過去 ⇒ 抽出したい ★★
添付図のように 黄色群：指定日直近のレコード 赤色群：指定日以降のレコード 二つの群を抽出するSQLは可能なのであろうか？
商品テーブルの中で、 同じ商品のレコードが複数あります。 その多数のレコード中に、日付項目があります。 そこから、 １）指定日に、２）一番近い過去の日の１件、３）指定日を含めて、複数ある指定日及び未来の全レコード、を抽出するには、 どのようなSQL文を書けばよいでしょうか？ １．過去に複数ある日付の中から、指定日に、一番近いレコード。 ２．指定日と未来に複数ある日付の中の、全ての未来の、レコード。 レコードの例） 指定日＝2015-07-01 商品ID 日付 1 　2015-10-11 ・・・未来 ⇒ 抽出したい 1 　2015-08-02 ・・・未来 ⇒ 抽出したい 1 　2015-07-01 ・・・指定日 ⇒ 抽出したい 1 　2015-07-01 ・・・指定日 ⇒ 抽出したい 1 　2014-01-01 ・・・過去 ⇒ 抽出しない★ 1 　2015-06-03 ・・・過去 ⇒ 抽出したい 2 　2015-10-11 ・・・未来 ⇒ 抽出したい 2 　2015-08-02 ・・・未来 ⇒ 抽出したい 2 　2015-07-01 ・・・指定日 ⇒ 抽出したい 2 　2015-07-01 ・・・指定日 ⇒ 抽出したい 2 　2014-01-01 ・・・過去 ⇒ 抽出しない★ 2 　2015-06-03 ・・・過去 ⇒ 抽出したい
Linuxサーバーで、MySQLを使っています。 商品テーブルの中で、 同じ商品のレコードが複数あります。 （例です。本来ならそんなつくりのテーブルは作らないです。） その多数のレコード中に、日付項目があります。 そこから、 １）商品毎に、２）指定日に、３）一番近い過去未来の日の、４）レコードだけを抽出するには、 どのようなSQL文を書けばよいでしょうか？ １．過去に複数ある日付の中から、指定日に、一番近いレコード。 ２．未来に複数ある日付の中から、指定日に、一番近いレコード。 ３．同一商品レコードは、複数抽出されない。
MySQLを使っています。 下記は、 １．テーブルaaaには、存在するidのものが、 ２．テーブルbbbには、存在しない、 ３．テーブルaaaのレコードを抽出したいものです。 "SELECT DISTINCT aaa.*" + " FROM aaa" + " WHERE (aaa.flag = false)" + " AND NOT EXISTS (SELECT * FROM bbb" + " WHERE (aaa.id = bbb.id) AND (bbb.flag = false))" ですが、実行すると、下記エラーがでます。 SQLException:Base table or view not found, message from server: \"Unknown table 'bbb' in where clause" どうすればよいのでしょうか？
Linuxサーバーで、MySQLを使っています。 ユーザーの付属テーブルの中で、 同じユーザーのレコードが複数あります。 その多数のレコード中に、日付項目があります。 そこから、ユーザー毎に、本日に一番近い過去未来の日のレコードだけを抽出するには、 どのようなSQL文を書けばよいでしょうか？ 抽出結果は、下記のようになるように。 ユーザーA、本日に一番近い日付、・・・・ ユーザーB、本日に一番近い日付、・・・・ ユーザーC、本日に一番近い日付、・・・・ ※同一ユーザーは、複数抽出されない。＝ユーザーは、ユニークになる抽出結果。
MySQLを使い始めたばかりものです。 SQLの学習のために下記ページのExample Databasesからworld database(InnoDB)をダウンロードし、インポートしました。 * http://dev.mysql.com/doc/index-other.html * http://dev.mysql.com/doc/world-setup/en/index.html そして、次のようなSQLを実行して countrycode列の値が 'JPN' の行が選択されることにびっくりしました。 mysql> select * from city where countrycode = 'jpn'; (1)Collationというものが関係することはわかったのですが、どうすればいいのかわからない状況です。 world database を PostgreSQL のようにデフォルトで大文字/小文字を区別して比較するようにしたいのですが、具体的にどのように設定したらよいのでしょうか？ (2)要件によるとは思いますが、データベースのデフォルトのCollationはcase-insensitiveで、必要に応じて列を case-sensitive にしたり、select文に collate句を付加したりしているような使われ方が、MySQLでは一般的なのでしょうか？ それとも、Collationにcase-sensitiveなものを指定してデータベースを作成し、必要に応じて列を case-insensitive 扱いするケースの方が圧倒的に多いのでしょうか？ ■環境 * Linux Mint 17 Mate * MySQL 5.5.43 以下の設定を my.cnf に追加 - 文字コード関連をutf8に設定 - lower_case_table_names = 1 よろしくお願いします。
環境はMySQL5.6です。 下記のテーブルccがあります。 【cc】 shisan 　user 500　　tanaka 1000　　mikami 400　　 tanaka 1300　　mikami SELECT Total, user FROM (SELECT SUM( cc.shisan ) AS Total, user FROM cc GROUP BY user) AS t1 とすることによりSQL上にt1テーブルを作ることが出来ます。 【t1】 Total　　user 900　　tanaka 2300　　mikami 次に、このt1テーブルのTotalの数値を下記のmoney_tableにあるcash欄に挿入(UPDATE)したいと考えています。 【money_table】 cash　　user 0　　　tanaka 0　　　mikami そこで下記のSQL文を作ったのですがエラーになります。 UPDATE money_table,cc SET money_table.cash=t1.Total FROM (SELECT Total, user FROM (SELECT SUM( cc.shisan ) AS Total, user FROM cc GROUP BY user) AS t1) WHERE money_table.user=t1.user どこがいけないのかご指導いただけませんでしょうか? よろしくお願いいたします。
MySQLで、ユーザーを作成しGRANT文でＤＢへの権限を 付与したのですが、ＤＢにアクセスできません。 原因がわかりましたら、教えていただけますでしょうか。 まず、rootユーザーでユーザーを作成し、ＤＢへの参照権限を付与。 >GRANT ALL ON TESTDB.* TO USER01@localhost IDENTIFIED BY 'passwd'; rootユーザーで権限を確認。 >SHOW GRANTS FOR USER01@localhost; GRANT USAGE ON *.* TO 'USER01'@'localhost' GRANT ALL PRIVILEGES ON `TESTDB`.* TO 'USER01'@'localhost' ユーザー：USER01 でログインし、ＤＢの参照を確認。 > SHOW DATABASES; information_schema SHOW DATABASES の結果に、TESTDB が出てくるはずと 思うのですが、なぜ表示されないのでしょうか。 よろしくお願いいたします。
MySQLでrootの使用をなるべく避けるため DB作成、ユーザ作成などは違うユーザを作って行いたいですが、 権限を与えることはrootでしかできないと聞きました。 本当にMySQL内でgrant権限を持つユーザを作成するのはできないでしょうか？
NASのアクセスログを、rsyslogを使ってMySQLへ書き込んでます。 その中の[Message]カラムに、下記ログ情報が記載されてますが、わかりやすくする為、下記項目に分けたViewを作成したいと考えております。 ◎Messageカラム内容（例） [User:nobody(192.168.???,???)] File Open(Read) /mnt/array1/share/(ファイル名) ◎VIEWで切出したい項目 ・User:上記例では、”nobody” ・IP:上の例では、”192.168.???.???” ・フォルダ名：上の例の、”/mnt/array1”←すべて同じ"/share/"←取り出したいフォルダ名 User、IPは、substring関数とLocate関数で問題なく切出しできましたが、フォルダ名の切出しがうまくいきません。 具体的には、Messageカラムの３個目の"/"から４個目の"/"の間を切出す方法のお教え頂けましたら幸いです。 ※添付画像の赤枠の部分です。
$sql = "(SELECT * FROM hospytal WHERE shochi LIKE \"%$keyword%\") UNION (SELECT * FROM hospytal order by kuchikomi desc);"; // 口コミ数の降順 このＳＱＬ文は間違っているでしょうか。 やりたいことは、hospytalテーブルのshochiカラムでキーワードを含むものを、 降順にソートしたいのですが。 どうすればちゃんと動作するのか、ご教授お願い致します。
私の質問を見て頂きましてありがとうございます。 以下のような取得結果のSQLを作りたいのですが、構文エラーが出ており困っております。 エイリアスをつけなくてはならない？ようだったので全ての副問い合わせにエイリアスを付けてみたりしたのですが、エラーがとれませんでした。 --元テーブルのデータ key name ------------------------------ 1 AA,AAA,BBB,BBBB,ZZZZZ 2 CCC,DDD,EE,FFFF --期待するSQL実行結果 COL1　　COL2 ------------- AA1 AAA1 BBB1 BBBB1 CCC2 DDD2 EE2 FFFF2 ZZZZZ1 SELECT col1, col2 FROM( SELECT col1, col2, (SELECT @i:=@i+1 FROM (select @i:=0)) AS rnk FROM( SELECT SUBSTR( name, CASE rn WHEN 1 then 1 ELSE INSTR(name, delm, 1, rn - 1) + 1 end ,CASE rn WHEN 1 THEN CASE INSTR(name, delm, 1, rn) WHEN 0 THEN LENGTH(name) ELSE INSTR(name, delm,1,rn)-1 end WHEN IFNULL(LENGTH(translate(name, delm || name, delm)), 0) + 1 then LENGTH(name) ELSE INSTR(name,delm,1,rn)-1-instr(name,delm,1,rn-1) end ) AS col1, key AS col2 FROM T_TEST_4, (SELECT ',' AS delm FROM dual) AS b, (SELECT rownum AS rn FROM all_catalog) AS c WHERE rn <= IFNULL(LENGTH(REPLACE(name,delm || name, delm)),0) + 1 ) ) WHERE rnk = 1 ORDER BY col1; 以上、回答をご存じの方、ご回答を宜しくお願い致します。
お世話になっております。 現在直面している問題に助言を頂けたらと思い質問をさせて頂きました。 もし、ご存じの方がいらっしゃいましたらご回答を宜しくお願い致します。 MySQLにて テーブルA カラム１　　カラム２ 1 AAA,BBB,CCC　　　　　　 2 BBB,DDD 3 CCC,DDD,EEE,FFF のようなレコードが入っているとします。 これをカラム２のカンマをデリミタとして分割した文字列でgroup byをしたような結果が欲しいと思っております。 希望結果 文字列　出現回数 AAA 　　1個 BBB 　　2個 CCC 　　2個 DDD　　1個 EEE　　1個 カンマで分けられている文字列の数に規則性はなく、何が入っているかわからない状態、 また、何個の文字列がカンマによって分割されているかわからない状態です。 AA,BB と２つの文字列がカンマ区切りで入っていることもあれば AA,BBB,CCCC,・・・・　と1000個の文字列がカンマ区切りで入っている状態です。 私が未熟なためか私の調べた限りではこのように取得する方法が見当たりませんした。 DBの構造に関しましては既に動いているサービス内のものですので変更することはできません。 以上、お手隙の際にご回答を宜しくお願い致します。
今回MySQLを5.0から5.1にバージョンアップを計画しています。 そこでMySQLをPHPから利用する場合下記ライブラリの差、もしくは確認方法をご教示ください。 バージョンアップ前 ・libmysqlclient.so.15(mysql-5.0.95-5.el5_9) バージョンアップ後 ・libmysqlclient.so.16(mysql-libs-5.1.73-3.el6_5.x86_64) どうぞよろしくお願いいたします。
　PHPとMySQLでちょっとした掲示板とメールフォームを作って使ってもらってます。 　メールフォームを使ったメッセージをMySQLのデータベースに記録するように作ってるんですが、たまにメッセージだけが記録されてないことがあります。名前とかメールアドレスとかのカラムは記録されてるんですが。 　フォームはUTF8で表示されるようにしていて、特に文字コードの変換をすることなくそのままinsertしてるので、最初は文字コードの関係かなと思ったんですが、Androidだったり、iOSだったりするし、JISでもUTFでもなさそうなのでで、いまいち特定できず。 　そもそも、文字コードが合わなくても、文字化けした状態で記録されますよね？ 　こういった場合、何が原因と考えられるでしょうか？ 　ちなみにMySQLの方は「utf8_general_ci」で設定しています。
現在本番環境でデータベースをPMA上で持っています。 これをテスト環境にコピーしたいのですが、そのままコピーは出来なかったでしょうか？ 新規でデータベースを作成→インポートするしか方法はありませんでしょうか？ 初心者丸出しで申し訳ありません。回答よろしくお願いします。
お世話になります。 サブクエリで返される複数の行を一列で表示する方法がわからなくて投稿させていただきました。 以下のテーブルを仮定として質問させていただきます。 1.employees テーブル * ”employee” を一意に特定するための ”employee_id ” です。 employee_id employee --------------------------- 1　　　　　　赤井 --------------------------- 2　　　　　　工藤 --------------------------- 3　　　　　　鈴木 --------------------------- 4　　　　　　吉田 --------------------------- 2.child テーブル * "child" を ”employee” に 紐付けさせるために ”employee_id ” を持たせました。 employee_id child ---------------------- 1　　　　　　一郎 ---------------------- 1　　　　　　二郎 ---------------------- 2　　　　　　三郎 ---------------------- 2　　　　　　四郎 ---------------------- 3　　　　　　春子 ---------------------- 3　　　　　　夏子 ---------------------- 4　　　　　　秋子 ---------------------- 4　　　　　　冬子 3. family テーブル * ”employee テーブル” と "child テーブル" を結合したあとのイメージです。 employee_id employee child_1 child_2 ----------------------------------------------- 1　　　　　　赤井　　　　一郎　　二郎 ----------------------------------------------- 2　　　　　　工藤　　　　三郎　　四郎 ----------------------------------------------- 3　　　　　　鈴木　　　　春子　　夏子 ----------------------------------------------- 4　　　　　　吉田　　　　秋子　　冬子 ----------------------------------------------- 皆様の知恵をお貸しください。よろしくお願いします。
WordPressを使って、それぞれまったく別の独自ドメインでブログを２つ設置したいと考えています。 レンタルサーバーとして、ロリポップの「ロリポ」を考えていますが、MySQLのデータベースが１つしかありません。 ロリポップのホームページを見ると、MySQLのデータベース１つに複数のWordPressをインストールして使うことが「ロリポ」でもできるとしてマニュアルが載っています。 しかし、ネットでいろんなレンタルサーバーを使っているユーザーの意見をいろいろ調べてみると、ブログを運営している人の中には、「１つのデータベースにWordPressは１個だけの方がいい。複数のWordPressを置くとエラーが出やすい。データベースに負荷をかけ、サーバーが遅くなったり、エラーが起きたりする。だからデータベースの個数も運営したいブログの数だけは欲しいところ」というような感じの記述が複数で見られます。 実際のところはどうなのでしょうか。 設置するブログは、ひとつはすでに別のレンタルサーバーにMovableTypeを置いて運営中のものです。これをロリポップのロリポにWordPressを置いて移築したいと考えていますが、このブログの記事数は現在のところ約1000です。１週間に１回の更新（１つの記事が増える）程度で、１日のアクセス数は普段は40～100程度しかありません。（多いときで年に数回300程度、過去最大で確か600程度が１度だけ） 追加で新しく作るブログは、これよりさらに更新もアクセス数もずっと少ないと思います。 ２つともいわゆる個人ブログです。 この程度のブログなら、データベース１つに、WordPressでブログ２つを置いても負荷とはならず支障はないでしょうか。
こんにちわ。 mysqlを二日前から勉強し始めた超初心者者です。 まったくの初心者なので質問が的外れかもしれませんがよろしくお願い致します。 以下の三つのテーブルがあります。 t_seito ============================= id name comment created_at 11 赤井 あかい 0000-00-00 00:00:00 22 青葉 あおば 0000-00-00 00:00:00 33 白木 しらき 0000-00-00 00:00:00 ============================= m_kyouka ============== kyouka_id ky_name 　　　1　　　　国語 　　　2　　　　数学 　　　3　　　　理科 　　　4　　　　社会 　　　5　　　　英語 ============== t_score ===================== sc_id seito_id sckyouka_id score 　1　　　11　　　　1　　　　50 　2　　　22　　　　1　　　　80 　3　　　33　　　　1　　　　23 　4　　　11　　　　2　　　　94 　5　　　22　　　　2　　　　43 　6　　　33　　　　2　　　　67 　7　　　11　　　　3　　　　13 　8　　　22　　　　3　　　　76 　9　　　33　　　　3　　　　59 　10　　 11　　　　4　　　　78 　11　　 22　　　　4　　　　40 　12 　　33　　　　4　　　　35 　13　　 11　　　　5　　　　64 　14 　　22　　　　5　　　　87 　15 　　33　　　　5　　　　30　　　　 ===================== この三つのテーブルをwhere句で結合させて 社会が５０以上で英語が５０点以下のデータを全て表示する。 という条件で摘出したいのですが・・・ select * from `m_kyouka`,`t_seito`,`t_score` where `kyouka_id`=`sckyouka_id` and `id`=`seito_id` and `kyouka_id`=4 and `score` >=50 and `kyouka_id`=5 and `score` <=50 と入力したところ ”返り値が空でした (行数 0)。 (Query took 0.0000 seconds.)” と表示されました。 いろいろとネットやら参考書などで調べてはいたのですが、 該当する条件がなかなか見つからず今回はじめて質問をさせていただきました。 何卒ご教授のほどよろしくお願い致します。
Aテーブル...ユーザ情報 Bテーブル...商品情報（AテーブルのユーザIDを列として持っています） Cテーブル...アイテム情報（Bテーブルの商品IDを列として持っています） Bテーブルの一覧リスト表示の画面にて、検索項目として、 Aテーブルのユーザ名、Cテーブルのアイテム名があります。 現在は、LEFT JOINを使って、検索、呼び出しを行っておりますが、 多数のカラムを指定して呼び出しを行っているため、SQL文が長くなってしまっており、 もっとすっきりとしたSQL文を記述したいと考えております。 ※Aテーブル,Bテーブルの組み合わせは他の画面でもよく使われております。 viewという機能を使うことによって、これをすっきりと記述できるようになるのではないかと考えておりますが、viewはこのような使い方をしてもいいのでしょうか。 または、もっとすっきりとした記述を行う技術のアドバイスをお願いいたします。 よろしくお願いいたします。
PHPとmysqlを最近勉強し始めました。 PHPでmysqlへデータベースの書き込みをする時に変数からデータを書き込むとエラーが出て、どうしてなのかが色々と検索してみたのですが、解決できずにいます。 どなたかご教示ください。 弁当の注文を把握するために作りました。 mysqlには ソースは以下の通りです。 表示だけなら、全項目表示は出来ます。 データベースに書き込みんで貯めたいのですが、phpmyadminでデータを記入し、SQL実行ならできました。 mysqlには　order　というテーブルに　 orderid int(5) syain varchar(11) syohinmei varchar(11) kingaku int(11) timestamp datetime 上記のカラムが作成してあります。 <?php $gokojo = $_GET['gokojo']; $syain = $_GET['syain']; $bento = $_GET['bento']; $orderkojo = $_GET['orderkojo']; $syohinmei = $_GET['syohinmei']; $kingaku = $_GET['kingaku']; $db_user = "naka";// ユーザー名 $db_pass = "naka";// パスワード $db_host = "192.168.0.9";// ホスト名 $db_name = "bento";// データベース名 $db_type = "mysql";// データベースの種類 $dsn = "$db_type:host=$db_host;dbname=$db_name;charset=utf8"; try { $pdo = new PDO($dsn, $db_user,$db_pass); $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION); $pdo->setAttribute(PDO::ATTR_EMULATE_PREPARES, false); } catch(PDOException $Exception) { die('エラー :' . $Exception->getMessage()); } $timestamp = date("Y-m-d H:i:s") ; try { $pdo->beginTransaction(); $sql = 'INSERT INTO order(syain,syohinmei,kingaku,timestamp) VALUES("'.$syain.'","'.$syohinmei.'",'.$kingaku.',"'.$timestamp.'")'; $stmh = $pdo->prepare($sql); $stmh->bindValue(':syain',$syain,PDO::PARAM_STR); $stmh->bindValue(':syohinmei',$syohinme,PDO::PARAM_STR); $stmh->bindValue(':kingaku',$kingaku,PDO::PARAM_INT); $stmh->bindValue(':timestamp',$timestamp,PDO::PARAM_STR); $stmh->execute(); $pdo->commit(); print "データを更新しました。<br>"; } catch (PDOException $Exception) { $pdo->rollBack(); print "エラー：" . $Exception->getMessage(); } ?> エラーは以下の通りです。 エラー：SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'order(syain,syohinmei,kingaku,timestamp) VALUES("中川","サンマ弁当",450,"' at line 1 Syntax error なので、コマンドの間違えなのだろうと思いますが、解決できません。 同じことを二回してますが、片方ずつでやってもダメなので、色々試してます。 よろしくお願いします。
order by で asc ,desc混合する場合indexが使用できないと思いますが、 たとえば、col1,col2,col3があったとして order by col1 asc, col2 desc, col3 asc ➡ order by col1 asc ,99999999 - col2 asc , col3 asc などのように、 col2を、カラムが取りうる最大値から引いてやることでascに置き換えても indexはかからないでしょうか？
前提： seisekiテーブルに id(Primary), student_id（生徒ID）, kamoku_id（科目ID）, score, time, created　のフィールドがあります。 ランキングの順位条件は、同じ科目でscoreがより高く、timeがより短く、createdがより古い方が高位となります。 同じ科目を何度でも受講できる為、student_idはユニークではありません。 前提条件から、以下３つのランキングを取得したいと考えています。 ランキング１：科目毎のランキング（同じstudent_idが１～10位独占等可） ランキング２：自分（student_id)の全受講履歴と履歴毎のランキング ランキング３：id指定時のランキング情報 各ランキングは、１SQLである必要はなく、PHPでの加工も考慮に入れております。 試行錯誤しているのですが、ORDER BY区にどうやって順位を付ければ良いのか分からず、 SELECT * FROM seiseki ORDER BY kamoku_id DESC, score DESC, time ASC, created ASC ここから進みません・・・ 何卒、よろしくお願いいたします。
SQLのROUND関数において 列の1つのデータに対してROUNDを行うのではなく、1つの列全体にROUNDを行うことはできますか？
MySQLでは、あるカラムをNOT NULL制約にしていたとしても、文字列型には空文字が、数値型には0を保存できます。 NULL、空文字、0をそれぞれ区別している仕様自体は問題ないと思いますが、NOT NULL制約のようにあるカラムで特定の値を許可しないような設定でできないのでしょうか。
SQLの初心者です。 次のようなテーブルがあるとします。 項目：A , B , C , D このテーブル合計を求めたいのです。 条件は、 同一テーブルでB=10の時のAの合計とD=10の時のCの合計の合計です。 B=10の時のAの合計は「sql sum(A) from テーブル where B=10」となります。 D=10の時のCの合計は「sql sum(C) from テーブル where D=10」となります。 この２つの合計を求めたいのです。 宜しくお願いします。
何時もお世話になっております。 日付ごとの最高ポイントを取得する 効率の良いMySQLでのSQLをご教授下さい。 T_DATA flg kbn point biko date ------------------------------ true 3 90 NNN 20141231 true 1 80 XXX 20150101 true 2 60 YYY 20150101 true 3 70 XXX 20150101 true 1 40 xxx 20150201 true 2 60 yyy 20150201 true 1 60 AAA 20150301 true 2 90 BBB 20150301 true 3 40 CCC 20150301 true 1 60 aaa 20150401 true 2 70 bbb 20150401 true 3 30 ccc 20150401 false 4 90 ddd 20150401 ■欲しい状態 kbn point biko date ----------------------- 2 70 bbb 20150401 2 90 BBB 20150301 2 60 yyy 20150201 1 80 XXX 20150101 (1)dateカラム毎にpointカラムが最大のデータを取得したいです。 (2)flgカラムがtrueのデータのみ取得したいです。 (3)dateカラムが降順になるよう取得したいです。 (4)dateカラムは、直近4日分取得したいです。 以上の条件で取得したく思います。 どうぞ、よろしくお願い致します。
いつも、お世話になっております。 MySQL5.5からMySQL5.6にアップデートしたいのですが http://dev.mysql.com/downloads/windows/installer/5.6.html からWindows 64bit版の.msiインストーラーをダウンロードすることができません。 私が使用しているOSは、Windows7 64bitです。 手動でインストールするほかないのでしょうか？
管理番号,ステータス,次の管理番号,表示フラグ 1,1,,1 2,2,1,0 3,2,3,0 4,1,,1 管理番号...auto_incrementにより、一意の値です ステータス…1.非公開,2.公開中 次の管理番号はこのデータの次のデータ管理番号が入っています 表示フラグは０または１が入ります ステータスが2で次の管理番号から管理番号をたどり、 その中で表示フラグ1のものだけを絞り込んで取得したいです。 mySqlの場合はどのように記述すれば、 よろしいでしょうか。
MySQLもCakePHPも初心者です。 詳しい方よろしくお願い申し上げます。 当方のPC環境はMac OS X 10.9.5で、MAMPをインストールして 色々なサイトを見ながらなんとか初期設定までは完了しました。 その後、下記の様なエラーが表示されて、色々グーグル検索し、 CakePHP is NOT able to connect to the database. Database connection "Mysql" is missing, or could not be created. database.phpのファイルも書き換えて、iTermからMysqlに接続して ユーザーも作成出来ましたが、依然としてエラーは解消されないので PHPの設定もphp.iniで追記してみましたが、エラーが解消されず もうどうして良いかわかりません。 （参考にしたページ：http://www.phpbook.jp/cakephp/install/index2.html　 http://locombox.com/posts/35　　他) どうぞよろしくお願いします。
MySQLで時間を加工する方法について教えてください。 例えば、時刻とidと連続する分を示すMySQLのテーブルがあった時に dates id interval 2015-02-13 22:57:30 1001 1 2015-02-14 07:02:10 1002 0 2015-02-14 09:12:22 1002 2 これを以下のように、連続する時間データに変換する方法がわかる方はいらっしゃいますか。 ※intervalは連続する分数を表します。 0の場合はそのまま、1以上の場合はその数だけdatesの「分」の所に+1ずつしていきたいです。 dates id 2015-02-13 22:57:30 1001　 2015-02-13 22:58:30 1001 2015-02-14 07:02:10 1002 2015-02-14 09:12:22 1002 2015-02-14 09:13:22 1002 2015-02-14 09:14:22 1002 SQLに慣れておらず苦戦しております。。。 わかる方がいらっしゃいましたら、教えて頂けると有難いです。
検索用フォームのテキストボックスからの検索についてご教授ください。 OS：Windows７Pro(32Bit) Ver：Access2010 DB：MySQL5.6 Windows版 ◎検索フォームの非連結テキストボックス txt顧客ID txt顧客カナ(先頭一致) 上記いずれかで、検索したい場合のSQL文の書き方。 ソース Private Sub cmd検索_Click() '顧客情報検索 'Mysql接続変数定義 Dim con As New ADODB.Connection Dim rs As ADODB.Recordset Dim stSQL As String 'DB接続 con.Open "Driver={mySQL ODBC 5.3 Unicode Driver}; Server=localhost; Database=jinq; Uid=jinq_a; Pwd=jinqadmin; " On Error GoTo Err 'ＳＱＬ文 stSQL = "SELECT * FROM t_kokyaku" stSQL = stSQL & " WHERE(CusID =" & Me!txt顧客ID & ")" stSQL = stSQL & " OR(kana Like ’" & Me!txtお客様カナ & "'%);" Debug.Print "SQL: [" & stSQL & "]" 'ＳＱＬ文実行＆レコードセット代入 Set rs = con.Execute(stSQL) 上記のプロジージャーを実行した結果、当然ですが、エラーとなります。 stSQL:SELECT * FROM t_kokyaku WHERE(CusID =) or(Kana Like 'txt顧客カナ%'); [MySQL][ODBC 5.3(w) Driver][mysqld-5.6.22-enterprise-commercial-advanced-log]You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ') OR(kana Like 'txt顧客カナ%')' at line 1 複数のテキストボックスの値で検索する場合、どういった書き方をすればよいのでしょうか？ 最終的には、顧客ID、顧客名、顧客カナ、電話番号でいずれかの条件で検索できればと考えています。 アドバイス頂けましたら、幸いです。
Linux環境で、MySQLが立ち上がらないのですが、そういう症状が出るのはメモリが足りないそうで、my.cnfの値を調整すればよいということなのですが、使用するメモリを上げるにはmy.cnfのどこの値をどのくらい調整すればいいか教えてください。 OSは、CentOS 7で、メモリは1GBです。
CentOS 5.11でwordpress4.0.1を動かす為にPHPバージョン5.5.20、MySQLサーバーバージョン5.5.41を入れましたが、wordpressの設定画面が開かず「お使いのサーバーの PHP では WordPress に必要な MySQL 拡張を利用できないようです。」と表示されて、どうしたら良いか判りません。 詳しい方、この様な場合はどの様に対処したら良いか教えて下さい。 宜しくお願い致します。
アンケート結果を集計する効率の良いシンプルなSQLを教えて下さい。 MySQLで、以下の状態です。 テーブル名：hoge カラム：id,kbn id...auto kbn...1～5 欲しい結果は、以下の状態です。 順位,kbn,count 1位,5,60ポイント 2位,3,45ポイント 2位,1,45ポイント 4位,4,30ポイント 5位,2,10ポイント ※位やポイントはプログラム側で付与するので不要です。 2位の様に同点の場合は同じ順位を表示し、3位を飛ばし順位を表示させたく思います。 どうぞ、よろしくお願い致します。
MySQLを使って管理画面を作っております。 $sql='INSERT INTO players(name,price,position_id) VALUES(?,?,?)'; という文で使ったidをコピーしてから次のINSERTの文でそのidの番号を使って別テーブルのカラムにその番号をINSERTするしくみを作りたいのですがなかなか上手くいきません。 var_dump($last_id);では番号がコピーされているのですが、INSERTができません。 いつもお世話になってしまい大変恐縮なのですが、どなたかご教授いただけないでしょうか？よろしくお願い致します。 <!DOCTYPE html> <html> <head> <meta charset="UTF-8"> <link rel="stylesheet" type="text/css" href="../../xxxxx/team.css"/> <title>選手追加完了</title> </head> <body> <div id="main"> <?php $pro_name=$_POST['name']; $pro_price=$_POST['price']; $pro_position_id=$_POST['position_id']; $pro_team=$_POST['team_name']; $pro_name=htmlspecialchars($pro_name); $pro_price=htmlspecialchars($pro_price); $pro_position_id=htmlspecialchars($pro_position_id); $pro_team=htmlspecialchars($pro_team); $dns = "mysql:host=localhost; dbname=player;charset=utf8"; $dns_id = "xxxxx"; $dns_pw = "xxxxxxx"; try { $conn = new PDO($dns, $dns_id, $dns_pw, array(PDO::ATTR_EMULATE_PREPARES => false)); } catch (Exception $e) { echo 'ERROR: ' . $e->getMessage(); die(); } try { //トランザクションを開始する。オートコミットがオフになる $conn->beginTransaction(); //処理その(1) $sql='INSERT INTO players(name,price,position_id) VALUES(?,?,?)'; $stmt=$conn->prepare($sql); $data[]=$pro_name; $data[]=$pro_price; $data[]=$pro_position_id; $stmt->execute($data); //直近id取得 $last_id_sql = "SELECT LAST_INSERT_ID() as id"; $stmt = $conn->prepare($last_id_sql); $stmt->execute(); $last_id = $stmt->fetch(PDO::FETCH_ASSOC); $stmt->closeCursor(); //確認var_dump($last_id); //処理その(2) $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION); $sql2='INSERT INTO team(team_id,team_name) VALUES(?,?)'; $stmt=$conn->prepare($sql2); $data2[]=$pro_team; $data2[]=$last_id; $stmt->execute(array($last_id,$pro_team)); $stmt->closeCursor(); //確認var_dump($last_id); //変更をコミットする $conn->commit(); } catch(PDOException $e){ //変更をロールバックする $conn->rollBack(); echo 'ERROR:' . $e->getMessage(); } // 切断 $conn = null; print $pro_name; print'を追加しました。<br />'; ?> <a href="xxxxx">戻る</a> </div><!--main--> </body> </html>
f1、id、name、price の株価データがhistoryテーブルに入っています。 f1は発注番号です。「id,name=株券」は複数あるため、ひとつの株券だけを見ると発注番号はランダムになります。 SELECT * FROM (SELECT f1,id,name,price FROM history WHERE id = 2001 ORDER BY f1 DESC limit 0,10) as AA ORDER BY f1 ASC 上記のSQL文により、株ID=2001番の直近10回の売買価格(推移)を取得することが可能です。 f1 　　id 　　name 　　price 14585 2001 日本製粉　521 14595 2001 日本製粉　523 14607 2001 日本製粉　527 14684 2001 日本製粉　524 14705 2001 日本製粉　520 14771 2001 日本製粉　519 14795 2001 日本製粉　518 14800 2001 日本製粉　516 14804 2001 日本製粉　517 14882 2001 日本製粉　519 やりたいこと この直近の取引10回に関し、若い順に必ず0から9の番号を振る関数(下記の仮想カラムzeroを追加する)を作りたいと思っています。 f1 　　id 　　name 　　price　zero 14585 2001 日本製粉　521 　　0 14595 2001 日本製粉　523 　　1 14607 2001 日本製粉　527 　　2 14684 2001 日本製粉　524 　　3 14705 2001 日本製粉　520 　　4 14771 2001 日本製粉　519 　　5 14795 2001 日本製粉　518 　　6 14800 2001 日本製粉　516 　　7 14804 2001 日本製粉　517 　　8 14882 2001 日本製粉　519 　　9 株によっては10回未満の取引のものもあり、その場合はたとえば4回しか取引のない株の場合はzeroの値は0から3を振ることになります。 SELECT * FROM (SELECT f1,id,name,price FROM history WHERE id = 2001 ORDER BY f1 DESC limit 0,10) as AA ORDER BY f1 ASC を改良して作ろうとしましたがいいアイデアが浮かびません。 どなたか助けて頂けませんでしょうか? よろしくお願いいたします。
phpmyadmin(ver3.4.9)を利用しています。 リレーションビューを用いて、以下のようなリレーションを組んだとします。 【商品テーブル】 id name 【売上テーブル】 syouhin_id uriagegaku ※商品テーブルのidと、売上テーブルのsyouhin_idがリレーション 売上テーブルのデータ挿入において、 現在は、syouhin_idのセレクトボックスには、 商品テーブルのidの値が出てきます。 これだと何の商品かよくわからないため、 データ挿入の効率を上げるため、 syouhin_idのセレクトボックスに商品名（nameの値）が出るような方法はありますでしょうか。 あくまでも、データ挿入時に商品名を参照したいのであって、 実際のデータは商品id（idの値）をsyouhin_idに入れたいのです。 つたない説明ですが、ご教授ください。 社内プログラマが急病のため、 プログラムを組んだりすることができず、 phpmyadmin画面内でのデータ挿入となりました。 なにとぞ宜しくお願いいたします。
すみません、MySQLのSQL文で教えてください。 以下のSQL文を実行すると UPDATE overflag c, asinprice d SET d.priceCheckUS = TRUE WHERE c.asin=d.asin AND c.priceOverUS=0 LIMIT 1; ERROR 1221 (HY000): Incorrect usage of UPDATE and LIMIT というエラーが出力されます。 UPDATE asinprice d SET d.priceCheckUS = TRUE WHERE d.asin='111' OR d.asin='000' LIMIT 1; は実行できました。 複数テーブルだと実行できないように理解しましたが、何が問題か教えてください。 よろしくお願いします。
select文の記述について質問させていただきます。 下記のデータベースのテーブルの先頭からnumberを条件として ２名分のデータをselect文にて抽出したいと思っております。 (numberが重複し、重複数も異なるデータとなります。） select文の記述をどのようにするか教えていただければと思っております。 よろしくお願いいたします。 データベースのテーブル +——+—————+—————+————+ | id | name | number | score | +——+—————+—————+————+ | 1 | tanaka | 358 | 98 | | 3 | tanaka | 358 | 23 | | 4 | tanaka | 358 | 45 | | 11 | yamada | 126 | 63 | | 17 | yamada | 126 | 77 | | 23 | suzuki | 274 | 36 | | 45 | suzuki | 274 | 16 | | 59 | suzuki | 274 | 89 | | 73 | suzuki | 274 | 75 | | 80 | hanako | 89 | 24 | | (以下続く) | +——+—————+—————+————+ 抽出結果 +——+—————+—————+————+ | id | name | number | score | +——+—————+—————+————+ | 1 | tanaka | 358 | 98 | | 3 | tanaka | 358 | 23 | | 4 | tanaka | 358 | 45 | | 11 | yamada | 126 | 63 | | 17 | yamada | 126 | 77 | +——+—————+—————+————+
windows７上のphpmyadmin(xamppについてくるもの）で、行を挿入しようとしたら、 Warning: #1366 Incorrect string value: '\xE3\x81\xAF\xE3\x81\x98...' for column 'note' at row 1 と言われてしまいまして、行を表示させてみると、マルチバイトのところが、?????と表示されてます。 これは、どうすれば対応できるのでしょうか？ よろしくお願い申し上げます。
質問した内容は以下にあります。 http://oshiete.goo.ne.jp/qa/8863196.html 先ほど、指示されたホームページに行ったら、以下の内容が表示されるようになっていました。 「Table '○○○' is read only」 4.パーミッションを660に chmod 5.オーナーをmysqldに chown 6.グループ権限をmysqldに 7.再起動 残念ながら、上記の4,5,6とも具体的な作業内容が分かりません。 詳しい方、解説をお願いします。
現在Windows上で動いているアプリ（フリー)なのですが、 このアプリが、Apache、php、MySQLを使用していて、 別のPC(windows)に移行したいのですが、MySQLのデーターの移行 とはどのようにすればいいのでしょう？ MySQLのdataフォルダをコピーすればＯＫですか？ それとも、コマンドでエクスポート/インポートしてやるのでしょうか？ データーベースって全くやったことないもので。。。。 手順、コマンド等ご教授いただけたらと思います。。。。 ちなみに、移行するアプリは、そんなに重要なものではないです。
“ERROR 1206 (HY000): The total number of locks exceeds the lock table size”エラーが発生する場合の対処方法について教えてください。 /etc/my.cnfの“innodb_buffer_pool_size”を大きくするのが解決策ですので innodb_buffer_pool_size = 2G のように最大値に変更してみましたが、解決しませんでした。 一応、 max_connections も減らしてみましたが、解決しません。 PHPからMySQLにコネクションを接続し続けて切断するような処理はしていませんが、問題ありますでしょうか？（最初にmysql_connectで接続し、プログラムが終了するまで、何回もmysql_queryでSQL文(SELECTやUPDATE等)を実行しています。） 一概に言えませんが、データベースをバックアップでテキストで出力しても、300Mbyteくらいのデータですが、２Gのメモリを使うのでしょうか？ 物理メモリを増やして innodb_buffer_pool_size を増やすしか解決方法がないのかご教授頂きたいです。 （ロックするテーブルは同時に1個しかしていないです。） 詳細な内容は提示していないので、わかりにくいですが、ご指摘頂ければ提示します。 設定や状態確認や見ておくべき点などが提案ベースでも教えて頂ければ幸いです。 すいませんがよろしくお願いします。
テーブル情報 id start_dt end_dt --+----------+---------- 1 2014-01-07 2014-01-20 2 2014-01-08 Null 3 2014-01-09 Null 4 2014-01-10 Null 5 2014-01-11 Null を以下のSQL文の場合 select * from infomation where start_dt <= '2014/01/10' and (end_dt >= '2014/01/10' or end_dt is null) order by start_dt desc limit 3 id start_dt end_dt --+----------+---------- 4 2014-01-10 Null 3 2014-01-09 Null 2 2014-01-08 Null が取得されます。 id start_dt end_dt --+----------+---------- 4 2014-01-10 Null 3 2014-01-09 Null 1 2014-01-07 2014-01-20 の結果のように取得するSQL文をつくることは可能でしょうか？ 何がしたいかというと ・start_dtが新しい順に並べる。 ・3件のレコードを取得する。 ・start_dtが'2014/01/10'より古いレコードを取得する。 ・end_dtが'2014/01/10'より新しいレコードがある場合は、Nullのレコードより優先する。 どうかお助けください。
このジャンルでお願いします。 次のようなテーブルで CREATE TABLE IF NOT EXISTS item ( id int(11) NOT NULL AUTO_INCREMENT, name varchar(32) NOT NULL, PRIMARY KEY(id) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO item (name) VALUES ('item1'); INSERT INTO item (name) VALUES ('item2'); INSERT INTO item (name) VALUES ('item3'); INSERT INTO item (name) VALUES ('item4'); INSERT INTO item (name) VALUES ('item5'); INSERT INTO item (name) VALUES ('item6'); CREATE TABLE IF NOT EXISTS treepath ( ancestor_id int(11) NOT NULL, descendant_id int(11) NOT NULL, FOREIGN KEY (ancestor_id) REFERENCES item(id) ON DELETE CASCADE ON UPDATE CASCADE, FOREIGN KEY (descendant_id) REFERENCES item(id) ON DELETE CASCADE ON UPDATE CASCADE, PRIMARY KEY(ancestor_id, descendant_id) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO treepath (ancestor_id, descendant_id) VALUES (1, 1); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (1, 2); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (1, 3); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (1, 4); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (1, 5); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (1, 6); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (2, 2); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (2, 4); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (2, 5); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (2, 6); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (3, 3); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (4, 4); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (4, 6); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (5, 5); INSERT INTO treepath (ancestor_id, descendant_id) VALUES (6, 6); item1┬item2 　　　│　├item4 　　　│　│　　└item6 　　　│　└item5 　　　│ 　　　└item3 を item1┬item2 　　　│　│　　 　　　│　└item5 　　　│ 　　　└item3 　　　　　└item4 　　　　　　　└item6 のようにitem4以下のノードをitem3の下に移したいのですが、 その場合のtreepathテーブルの更新はどのようなSQL文にすれば良いのでしょうか？
テーブル情報 id start_dt end_dt --+----------+---------- 1 2014-01-07 2014-01-20 2 2014-01-08 Null 3 2014-01-09 Null 4 2014-01-10 Null 5 2014-01-11 Null を以下のSQL文の場合 select * from infomation where start_dt <= '2014/01/10' order by start_dt desc limit 3 id start_dt end_dt --+----------+---------- 4 2014-01-10 Null 3 2014-01-09 Null 2 2014-01-08 Null が取得されます。 id start_dt end_dt --+----------+---------- 4 2014-01-10 Null 3 2014-01-09 Null 1 2014-01-07 2014-01-20 の結果のように「id:2」よりも「end_dt」を優先して取得するSQL文をつくることは可能でしょうか？ 何がしたいかというと ・start_dtが'2014/01/10'より新しい順に3件取得したい。 ・end_dtが'2014/01/10'より未来で該当する場合にNullのレコードより優先したい。 どうかお助けください。
AWSにあるデータベースをまるごと移行する場合、ローカルにエクスポートしないで移行できる方法があれば教えてください。 AWSは別アカウント、別インスタンスとなります。 よろしくお願いします。
一つのページから別々のテーブルにデータをINSERTしたいのですが、"id"と"number"は同じ値でそれぞれのテーブルにいれたいのですが、どうやってやるのでしょうか？ 下のPHPのコード(一部)でデータを流してみたのですが、このままやると、もしデータに不具合があって片方だけ登録されないことがあると、一方は登録されて、一方は登録されないという事態が発生してしまい、"id"が違う番号で登録されてしまう可能性があります。 id int(8) NOT NULL AUTO_INCREMENT で"id"は作りました！ $insertSQL1 = sprintf("INSERT INTO tbl1 (id, number, name, price) VALUES (%s, %s, %s, %s)", GetSQLValueString($_POST['id'], "int"), GetSQLValueString($_POST['number'], "text"), GetSQLValueString($_POST['name'], "text"), GetSQLValueString($_POST['price'], "int")); $insertSQL2 = sprintf("INSERT INTO tbl2 (id, number, ename, eprice, extra) VALUES (%s, %s, %s, %s, %s)", GetSQLValueString($_POST['id'], "int"), GetSQLValueString($_POST['number'], "text"), GetSQLValueString($_POST['ename'], "text"), GetSQLValueString($_POST['eprice'], "int"), GetSQLValueString($_POST['extra'], "text")); 別々のテーブルで共通のidを使う方法はないでしょうか？ phpMyAdminのSQLを使ってます。 回答よろしくおねがいします！
PHPMyAdminのSQLのコマンドで、 もしdata001がNullだったら、data001に"1"というデータをいれる。 もしdata001がNullじゃないかつdata002がNullだったら、data002に"1"というデータをいれる。 このようなSQLのコマンドはどうやって打つのでしょうか。 回答よろしくおねがいします！
SELECT (`総額` / `個数`) FROM tb_item で`総額`を`個数`で割った単価（のような）値が取得できるものとします。 このとき、この「計算で出た単価」と「10,000という値」を比較して大きいほうの値を返すクエリはどのように書くのでしょうか？ なんとなく、 SELECT MAX(`総額` / `個数`, 10000) FROM tb_item のような感じで取得できるような関数を探していますが、MAXだと列の中で最大値を取得してしまうので渡しが使いたい内容と違います。 サブクエリを使わずになるべく簡潔に書く方法を知りたいです。 どうぞよろしくお願い致します。
下記の質問をさせていただき、解決いたしましたが、それに関連して新たなご質問です。 http://okwave.jp/qa/q8830319.html 上記質問内容は、 以下のようなデータから、「結果」のような形でデータを取り出したいというもので、「いただいたご回答」の形で一旦解決しました。 usr テーブル +--------+------+ | usr_id | name | +--------+------+ | 1 | 太郎 | | 2 | 二郎 | | 3 | 花子 | +--------+------+ usr_trm テーブル +--------+--------+ | usr_id | trm_id | +--------+--------+ | 1 | 1 | | 1 | 3 | | 1 | 4 | | 2 | 1 | | 2 | 2 | | 2 | 3 | | 3 | 2 | +--------+--------+ cat テーブル +--------+------+ | cat_id | name | +--------+------+ | 1 | 性別 | | 2 | 部署 | +--------+------+ trm テーブル +--------+--------+------+ | trm_id | cat_id | name | +--------+--------+------+ | 1 | 1 | 男性 | | 2 | 1 | 女性 | | 3 | 2 | 総務 | | 4 | 2 | 経理 | +--------+--------+------+ 結果 +--------+------+------+------+ | usr_id | name | cat1 | cat2 | +--------+------+------+------+ | 1 | 太郎 | 1 | 3,4 | | 2 | 二郎 | 1,2 | 3 | | 3 | 花子 | 2 | 　 | +--------+------+----- +------+ いただいたご回答 select t1.usr_id,t3.name ,group_concat(if(cat_id=1,t1.trm_id,null)) as cat1 ,group_concat(if(cat_id=2,t1.trm_id,null)) as cat2 from usr_trm as t1 inner join trm as t2 on t1.trm_id=t2.trm_id inner join usr as t3 on t1.usr_id=t3.usr_id group by usr_id さらにそこから、例えば「総務に所属する人をランダムにn件」という形で絞り込もうと思い、 WHERE t2.trm_id=3 と ORDER BY RAND() LIMIT 10 を追加したところ、条件通り抽出はされるのですが、結果の「cat1」「cat2」に他のカテゴリーの値が入らなくなりました。 WHERE t2.trm_id=3 を消すと「cat1」と「cat2」に値が入ってきます。 「cat1」と「cat2」に全ての値が入った状態で絞込をするために、どのようにすればよいかわかりません。 アドバイスをいただけると幸いです。
MySQLを使用したホームページを運用しているのですが、このたびホスティングサーバーを変更する予定で、新しい移行先のホスティング側に、サイトデータ・SQLデータを移行しましたが、データベースを読み込む部分だけ文字化けして表示されてしまいました。 ※日本語だけすべて???で表示されてしまいます。 phpMyAdmin上で見ると、正常にデータベース内容の日本語は表示されています。 照合順序の文字コード変更などをぐぐって作業してみましたが、解決できません。 よろしくお願い致します。
下記のような２つのテーブルがあり、 仕入れテーブルから、2014/1/2にBさんが仕入れたデータを 削除したいのですが、SQLが分かりません。 どのようなSQLにすると実現することができるでしょうか。
以下のようなデータがあります。 このデータから最後の「結果」のような形でデータを取り出したい場合、どのようにすればよいでしょうか？ cat1とcat2を分けない形はgroup_concatを使ってできたのですが、カテゴリーごとに分けて取得したいです。 usr テーブル +--------+------+ | usr_id | name | +--------+------+ | 1 | 太郎 | | 2 | 二郎 | | 3 | 花子 | +--------+------+ usr_trm テーブル +--------+--------+ | usr_id | trm_id | +--------+--------+ | 1 | 1 | | 1 | 3 | | 1 | 4 | | 2 | 1 | | 2 | 2 | | 2 | 3 | | 3 | 2 | +--------+--------+ cat テーブル +--------+------+ | cat_id | name | +--------+------+ | 1 | 性別 | | 2 | 部署 | +--------+------+ trm テーブル +--------+--------+------+ | trm_id | cat_id | name | +--------+--------+------+ | 1 | 1 | 男性 | | 2 | 1 | 女性 | | 3 | 2 | 総務 | | 4 | 2 | 経理 | +--------+--------+------+ 結果 +--------+------+------+------+ | usr_id | name | cat1 | cat2 | +--------+------+------+------+ | 1 | 太郎 | 1 | 3,4 | | 2 | 二郎 | 1,2 | 3 | | 3 | 花子 | 2 | 　 | +--------+------+----- +------+
コマンドプロンプトで「SELECT * FROM testtable」などとやったときに、列数が多いと結果が行単位に改行されて見にくい。 改行させない方法ってありませんか？ あるいはコマンドプロンプト自体の幅を広げる方法とかありませんか？ この質問ここではマズかったかな？
お世話になります。 my ｓｑｌのテキスト欄ですが、以下のような文字化けになってしまいました。 ¤¦¤´¤¶¤¤¤Þ¤¹¡￡<br />¤è¤¤¤È¤³¤í... このような文字化けはどうやったら直るのでしょうか？ 日本語データーがすべてこのようになってしまいました。 ヒントのような事でも良いのでどうか回答の程よろしくお願い致します。
毎回お世話になっています。 今回も知恵を頂けたらありがたいです。よろしくお願い致します。 下記のようなプログラムを組んだところ、ページを開いたらすぐ全データがが出てくる状態になっています。ページを開いても何もデータが出てこない状態にして検索してからデータが出てくるようにするにはどのように書き換えれば良いのでしょうか？ <!DOCTYPE html> <html> <head> <meta charset="UTF-8"> <title>リーグデータ</title> <link rel="stylesheet" type="text/css" href="../common/style.css"/> </head> <?php error_reporting( E_ALL ^ E_NOTICE ); ?> <body id="list"> <div id="main"> <form name="search_form" action="player_list.php" method="post"> <input type="hidden" name="cmd" value="search" /> <table> <tr> <th class="th_top">選手名</th> <td class="td_top"> <input type="text" name="name" size="30" value="<?php echo $_POST['name'] ?>"> </td> </tr> <tr> <th>チーム名</th> <td> <input type="checkbox" name="team_id[]" value="1" <?php if (isset($_REQUEST['team_id']) and in_array('1',$_REQUEST['team_id'])) print 'checked'; ?>/> 名古屋 <input type="checkbox" name="team_id[]" value="2" <?php if (isset($_REQUEST['team_id']) and in_array('2',$_REQUEST['team_id'])) print 'checked'; ?>/> 徳島 <input type="checkbox" name="team_id[]" value="3" <?php if (isset($_REQUEST['team_id']) and in_array('3',$_REQUEST['team_id'])) print 'checked'; ?>/> 千葉 <input type="checkbox" name="team_id[]" value="4" <?php if (isset($_REQUEST['team_id']) and in_array('4',$_REQUEST['team_id'])) print 'checked'; ?>/> 浦和 <input type="checkbox" name="team_id[]" value="5" <?php if (isset($_REQUEST['team_id']) and in_array('5',$_REQUEST['team_id'])) print 'checked'; ?>/> 磐田<br /> </td> </tr> <tr> <th class="th_middle"> ポジション </th> <td class="td_middle"> FW MF DF GK </td> </tr> </table> <p> <input type="submit" value="検索"> <input type="reset" value="リセット"> </p> </form> <?php try { $dsn = 'mysql:dbname=xxxxx;host=localhost'; $user = 'xxxxx'; $password = 'xxxxxx'; $dbh = new PDO($dsn,$user,$password); $dbh->query('SET NAMES utf8'); $sql = 'SELECT code,name,team_name,price,position,gazou FROM mst_player_market WHERE 1'; $stmt = $dbh->prepare($sql); $stmt->execute(); $dbh = null; if(isset($_POST['name'])) { $name = htmlspecialchars($_POST['name']); print($name); } if(isset($_POST['name'])) { if(!$_POST['name']==true){print ''; }else{ $sqlN ='code IN (SELECT code FROM mst_player_market where name LIKE ("%'.$_POST['name'].'%"))'; $sql.=' and ('.$sqlN.')'; } } if(isset($_POST['team_id'])and is_array($_POST['team_id'])){ $ary = array_filter($_POST['team_id'], function($v) {return is_numeric($v);}); $sqlA = 'code IN (SELECT playerid FROM team WHERE team_id IN ('.implode(',', $ary).'))'; }else{ print ''; $sqlA = ' 1 '; $flag=false; } $sql.=' and ('.$sqlA.')'; if($flag) $sql.="AND 0 ";; //参考 print $sql."<br>"; //実行 $pdo = new PDO($dsn,$user,$password); $stmt = $pdo->prepare($sql); $stmt->execute(); //画像処理 $rows=array(); while($row = $stmt->fetch(PDO::FETCH_ASSOC)){ $rows[]=$row; }; //参考SQL文表示 print_r($rows); print'選手一覧<br /><br />'; print'</form>'; } catch(Exception $e) { print'ただいま障害により大変ご迷惑をお掛けしております。'; exit(); } ?> <?php foreach((array) $rows as $row ){ ?> <tr> <td><img src="../player/<?php print( htmlspecialchars( $row["gazou"], ENT_QUOTES )); ?>" /></td> <td><?php print( htmlspecialchars( $row["team_name"], ENT_QUOTES )); ?></td> <td>\<?php print( htmlspecialchars( number_format( $row["price"] ),ENT_QUOTES ) ); ?></td> <td> <?php print( htmlspecialchars( $row["name"], ENT_QUOTES ) ); ?> </td> <td> <?php print( htmlspecialchars( $row["position"], ENT_QUOTES ) ); ?> </td> </tr> <?php } ?> </table> </div> <!------------mainのdiv--------------> </body> </html>
phpMyAdminを使ってます。一つのデータベースに入ってる二つのテーブルを統合するため、機能でいうとFULL OUTER的なのがやりたいのですがphpMyAdminがそれをサポートしていないので、代わりにUNIONを使ってやろうと思ったら、二つのテーブルのカラムの数と型が同じでないとできないらしく、そこで止まってしまってるのですが、どうにかできるコードはないでしょうか？ もともとは日本語のデータベース（１）と英語のデータベース（２）で分けていたのですが、英語（２）では入れなくてもいいデータがたくさんあり、カラムの数が２倍くらい変わってしまっているので、今から英語（２）の方を無理矢理日本語（１）に合わせるとなるとなんかデータが変になりそうなのでそれはまだやってないんですが。←無理矢理合わせるのはどうにも方法がなくて最終手段としてやりたいです。 回答よろしくおねがいします。 何か抜けている点があったら言ってください！
VPSで色々とためしてみているのですが、どうもユーザーとか権限とかよく分かりません。 「Linux自体のユーザー」と「MySQLのユーザー」との間には何か関係はあるのでしょうか？ うまく言えませんが、例えば「MySQLのユーザー」は「Linux自体のユーザー」になってなければならない---なんてことです
PCに数年前に導入したMySQLのrootのパスワードを忘れてしまいました。 どこかに書いておいたはずなのですが、思い出せません。 rootのパスワードを調べる方法、または不明のまま新しいパイワードに変更する方法はあるでしょうか。
現在、レンタルしているサーバのPHPmyAdminにて、データベースを作成しました。 データベースのエンジンはMyISAMになっており、InnoDB型がいいため、 テーブルの作成時にInnoDB型に設定をしました。 すると、構造タブでみるとデータベース：MyISAM テーブル：InnoDB となっておりますが、テーブルはInnoDBとして扱われているという認識でいいのでしょうか。 勉強中のため、詳しい方がおりましたら、教えていただけると助かります。
SELECT ～ FOR UPDATEやSELECT ～ LOCK IN SHARE MODEという行ロックがあり、この件について解説しているサイトをいろいろ見ているのですが、振る舞いが複雑だということはわかりました。 しかしそもそもなぜSELECTで行ロックするのか、運用上でどんなときに使うのかを解説しているサイトは見当たりませんでした。 私は、SELECTするときは単に SELECT * FROM tb_a WHERE id = 1; としか記述していません。 質問1. なぜSELECTするのにトランザクションが必要なのでしょうか？運用上でどんなときにSELECTでトランザクションを使うのでしょうか？よく解説サイトには、 BEGIN; SELECT * FROM tb_a WHERE id = 1 FOR UPDATE; COMMIT; と書いています。SELECTするのに行をロックする必要性がいまいちわからないです。 質問2. トランザクションを開始したときにロックがかかるのではないのでしょうか？つまりBEGIN;でロックがかかるわけではないのですか？SELECTのクエリーにFOR UPDATEと書くということはこのSELECTのコードが実行された時点でロックがかかるのでしょうか？ 質問3. FOR UPDATEやLOCK IN SHARE MODEというのはSELECTにしか使えないのか、もしくはSELECTだから意味があるのでしょうか？UPDATEやDELETEは単にBEGINE;とCOMMIT;で囲えばいいだけですよね？ 質問4. 以下のようなコードを解説しているサイトがあります。 BEGIN; SELECT * FROM tb_a WHERE id = 1; COMMIT; SELECT文にはFOR UPDATEも書いていないのですが、これは何を意味するのでしょうか？つまり、SELECTするのになぜトランザクションを実行するのでしょうか？ 一番知りたいのは運用上どのような場合にSELECTでトランザクションを使って行ロックするのか、ということです。 どうぞよろしくお願い致します。
MySQLにて以下のようなデータを扱っているのですが、 ------------------------------ | id | start | end | ------------------------------ | 1 | 2014-10-14 | 2014-10-14 | | 2 | 2014-09-20 | 2014-10-10 | | 3 | 2014-10-20 | 2014-11-31 | | 4 | 2014-10-15 | 2014-10-16 | | 4 | 2014-09-15 | 2014-09-16 | ------------------------------ SQLで 開始：2014-10-01　から　終了日：2014-10-31 の間に関わるデータを引っ張れないかと試行錯誤しております。 上のデータですと 1,2,3が引けると良いのですが、、、 BETWEEN を使ってしまうと、その間にあるデータしかひっぱれず。。
PHPで、以下のようなソースで、存在しているデータベースtestに接続し、もしない場合、name_listというテーブルを作り、1カラム目をカラム名がnoで、int型でnot null auto_incrementにして、2カラム目をカラム名がnameで、not nullで作りたいのですが、うまくテーブルが作られません。 どうすればうまく作られるか教えてください。 <?php try{ $pdo = new PDO('mysql:dbname=test; host=localhost; charset=utf8', 'root'); $st = $pdo->prepare("create table if not exists name_list (no int(100) not null auto_increment, name varchar(100) not null);"); $st->execute(); }catch(PDOException $e){ print('Error:'.$e->getMessage()); die(); }
phpでmysqlのあるテーブルがない場合、テーブルを作るというのをやりたいのですが、テーブルがあるかないかの判定はどういう風に行えばいいでしょうか。 データベースは存在していて、pdoでmysqlを操作したいと考えています。
以下のようなPHPのソースとMySQLのテーブルで、numberが0の行をhtmlで取得しようとしているのですが、検索窓に0を入れて検索しても取得できません。ちなみに、numberが1や2の行は取得することができます。 なぜnumberが0の行を取得できないかと、どうすればnumberが0の行を取得することができるか教えてください。 <PHPのソース> <?php $url = "localhost"; $user = "root"; $pass = ""; $db = "test"; $html = ""; // MySQLへ接続する $link = mysql_connect($url,$user,$pass) or die("MySQLへの接続に失敗しました。"); // データベースを選択する $sdb = mysql_select_db($db,$link) or die("データベースの選択に失敗しました。"); // クエリを送信する $sql = "SELECT * FROM test"; $result = mysql_query($sql, $link) or die("クエリの送信に失敗しました。<br />SQL:".$sql); //結果セットの行数を取得する $rows = mysql_num_rows($result); ?> <form action="" method="post"> <input type="text" name="numberSearch" value=""> <input type="submit" value="検索"> </form> <?php //表示するデータを作成 if($rows && !empty($_POST['numberSearch'])){ while($row = mysql_fetch_array($result)) { if ($row["number"] == $_POST['numberSearch']) { $html .= "<tr>"; $html .= "<td>".$row["alphabet"]."</td><td>".$row["number"]."</td>"; $html .= "</tr>\n"; } } }else{ $msg = "データがありません。"; } // MySQLへの接続を閉じる mysql_close($link) or die("MySQL切断に失敗しました。"); ?> <html> <head> <meta charset="utf-8"> <title>numberSearch</title> </head> <body> <table width = "200" border = "0"> <tr bgcolor="##ccffcc"><td>alphabet</td><td>number</td></tr> <?= $html ?> </table> </body> </html> <データベースのテーブル> alphabet number A 0 B 1 C 2 D 1 E 1 F 0 G 1
下記のスクリプトで、MySQLサーバーのテーブルの中身を見ようとしたら、 返り値が空でした(行数0) ( クエリの実行時間 0.0010 秒 )　と表示されます。 どこが間違ってるのでしょうか。 ////////////////////// // データベース登録 // ////////////////////// $con = mysql_connect("mysql020.******", "*****", "*****"); // リモートのMySQLデータベースサーバーに接続する mysql_select_db("LAA0471050-ideamemo"); // データベースサーバーに存在する（myPHPAdminで作成済みの）データベースを選択する $sql = "SET NAMES utf8"; mysql_query($sql, $con); $sql = "INSERT INTO ideamemo_table (color, title, contents, create) VALUES ('$color', '$title', '$contents', '$create');"; mysql_query($sql, $con); mysql_close($con); ?>
現在、ブランドサイズをインターナショナルサイズに変換するデータベース設計をしていて悩んでいることがあります。どうか知恵をお貸しください。 参考にしています書籍は、ミック著「達人に学ぶDB設計徹底指南書」です。 書籍には、正規化の次数が低いほど検索SQLのパフォーマンスは良いですが、データ整合性は低く、正規化していくほどパフォーマンスが低下する代わりにデータ整合性が高くなります。と書いています。 ですので、正規化した結果、５つのテーブルが出来上がりました。 これらを正規化したテーブルを中間テーブルで扱うには、どのように設計すればよろしいでしょうか？ 以上、よろしくお願いします。 下記は、正規化したテーブルです。 テーブル名 ：： ブランド 扱うデータ ：： （仮）A、その他ブランド.... テーブル名 ：： 性別 扱うデータ ：： メンズ、レディース、ユニセックス テーブル名 ：： カテゴリー 扱うデータ ：： ウェアー、ボトム、シューズ、その他カテゴリー.... テーブル名 ：： ブランドサイズ 扱うデータ ：： 1、2、3、その他ブランドサイズ.... テーブル名 ：： インターナショナル・サイズ 扱うデータ ：： S、M、L、その他サイズ....
お世話になっております。 MySQLに保存している顧客データの処理について質問させてください。（MySQLとPHPでブラウザ経由でデータ管理をしています） 以下のようなテーブルがあり、顧客に対して配送するダイレクトメールの印刷をする流れのことです。 no　　name　　dm 1　　佐藤　　no 2　　吉田 3　　谷口 4　　伊藤 まず最初にこのテーブルにある顧客を一覧で表示させますが、名前と共にチェックボックスを設け、 noという値が入っているレコードはチェックを入れて一覧表示します。 一覧表示の後、印刷表示というボタンを押すと、印刷用レイアウトの画面に移動し、印刷を実行という流れです。 dmというカラムは印刷をするか否かのフラグであり、noと代入されているか顧客は印刷しないことを意味しますが、 印刷前の確認が出来るようにするためであり、また印刷対象の変更を同時に行えるようにしたいと、このような流れになってます。 そこで質問なのですが、単純に一覧から印刷用ページに移動させるだけなら問題はないのですが、このチェックボックスのチェック、チェックを外したり、チェックを入れたりと、服すのチェックを一度に行い、印刷用ページに移動(ポスト）したとき、チェックの入ったデータだけ印刷一覧に表示したいと考えてます。 このとき、変更があった顧客のdmカラムをアップデートしたいのですが、どのような仕組みが一番負荷が少なくて住むのでしょうか？ 現在の顧客数は1万5千件程度ですが、印刷用ページに移動した際、１つずつチェックをするのは非常に非効率ですし、かといって、元々チェックの入っていたデータと、印刷ページにポストしたとときのデータを共に違う配列に代入して・・・とも考えているのですが、効率のよい流れというものがなかなかイメージすることが出来ません。 お忙しいとは思いますが、お知恵を頂戴できれば幸いです。 宜しくお願いいたします。
ユーザーと商品のテーブル（省略）、 商品ジャンルテーブル、 genre id　　 name 1　　　家電 2　　　3万円台 3　　　テレビ 4　　　黒 5　　　SONY 6　　　三菱 商品とジャンルのリレーションテーブル、 item_genre item_id genre_id 1　　　　1 1　　　　2 1　　　　3 2　　　　1 2　　　　3 2　　　　4 2　　　　6 ユーザーが希望する商品ジャンルのテーブル（ユーザーとジャンルのリレーションテーブル）、 user_genre user_id genre_id 1　　　　1 1　　　　3 2　　　　1 2　　　　3 2　　　　4 3　　　　1 3　　　　3 3　　　　4 3　　　　5 以上があるとします。 この時に商品側から（商品IDを元に）、その商品を希望しているユーザーIDを取得する場合の SQL文の作成方法のご教示をお願いいたします。 上記のテーブルの例ですと、アイテム1から取得したいユーザーIDは1、アイテム2からは ユーザーID 1と2を取得できればOKです。 商品が持つジャンルIDが1,2,3に対してユーザーが希望するジャンルIDが1,3のように少ない 場合は対象にふくまれますが、商品が持つジャンルIDが1,3に対してユーザーが希望する ジャンルIDが1,3,4のように多くなる場合は対象に含めません。 色々と考えてみたのですが、頭がこんがらがってしまい迷宮に迷い込んでしまいました。 すみませんがお知恵をお貸しください。よろしくお願いします。 ※DBサーバーがMySQLのため、MySQLで実現できる方法だとありがたいです。
最近、しょちゅうMYSQLが急に、停止しkillして再起動しておりますが、 その度に、以下のログが記載がありますが、具体的な対策などご存知でしたらご教示下さい。 現在、./ibdata1 は、./ibdata1 と./ibdata1.bak にしております。 InnoDB: Unable to lock ./ibdata1, error: 11 InnoDB: Check that you do not already have another mysqld process InnoDB: using the same InnoDB data or log files. InnoDB: Shutdown completed; log sequence number 0 100570041 [Note] /usr/libexec/mysqld: Shutdown complete mysqld ended InnoDB: Error in opening ./ibdata1 141007 22:41:19 InnoDB: Operating system error number 11 in a file operation. InnoDB: Error number 11 means 'Resource temporarily unavailable'. InnoDB: Some operating system error numbers are described at InnoDB: http://dev.mysql.com/doc/refman/5.0/en/operating-system-error-codes.html InnoDB: Could not open or create data files. InnoDB: If you tried to add new data files, and it failed here, InnoDB: you should now edit innodb_data_file_path in my.cnf back InnoDB: to what it was, and remove the new ibdata files InnoDB created InnoDB: in this failed attempt. InnoDB only wrote those files full of InnoDB: zeros, but did not yet use them in any way. But be careful: do not InnoDB: remove old data files which contain your precious data! 141007 22:41:19 [ERROR] Can't start server: Bind on TCP/IP port: Address already in use 141007 22:41:19 [ERROR] Do you already have another mysqld server running on por t: 3306 ? 141007 22:41:19 [ERROR] Aborting 141007 22:41:19 [Note] /usr/libexec/mysqld: Shutdown complete 141007 22:41:19 mysqld ended
WindowsServerでPHPとMySQLで作成したプログラムを動かしています。 PHPからINSERTでMySQLに登録すると環境依存文字（「(株)・(有)など）が「？」になってしまいます。 PHPからSELECTでブラウザ上に表示させると文字化けはしていませんが、phpMyAdminで確認すると「？」になっています。 このデータベースの内容を他のサーバーに移すときに、phpMyAdminからエクスポートまたはmysqldumpすると「？」のままエクスポートして、他のサーバーでインポートしても当然「？」になってしまいます。 環境依存文字が文字化けしない、あるいは他のサーバーでも環境依存文字をそのまま移行できるようにはできないでしょうか。 よろしくお願いします。 PHPはEUC-JP、データベースはujisで作成しています。 INSERTの直前でSET NAMES UJISを実行しています。
mysql> mysql> show variables like 'character_set%'; +--------------------------+----------------------------+ | Variable_name | Value | +--------------------------+----------------------------+ | character_set_client | sjis | | character_set_connection | sjis | | character_set_database | sjis | | character_set_filesystem | binary | | character_set_results | sjis | | character_set_server | sjis | | character_set_system | utf8 | | character_sets_dir | /usr/share/mysql/charsets/ | +--------------------------+----------------------------+ 8 rows in set (0.00 sec) mysql> mysql> character_set_systemもsjisに変更したいと考えております。 どのようにすれば可能でしょうか？ やりたいことはmysqlworkbenchでselect文のクエリ内容を日本語表記することです。 ご存知の方、宜しくお願いします。
ブラウザでデータベースを取り扱う方法を習得したいと考えています。 VMwareなどを使ってCentOSをインストールしたり MySQLのインストールはできるぐらいです。 FireFoxなどのブラウザで、MYSQLと連携したデータベースの基本を勉強するのに どのような本を勉強したらいいでしょうか？ お勧めの本などあれば教えてください。 よろしくお願いします
このジャンルでお願いします。 次のようなテーブルで DROP TABLE IF EXISTS item; CREATE TABLE IF NOT EXISTS item ( id int(11) NOT NULL AUTO_INCREMENT, parent_id INT, name varchar(32) NOT NULL, level int NOT NULL, FOREIGN KEY (parent_id) REFERENCES item(id) ON DELETE CASCADE ON UPDATE CASCADE, PRIMARY KEY(id) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO item (parent_id, name) VALUES (null, 'item1'); INSERT INTO item (parent_id, name) VALUES (1, 'item2'); INSERT INTO item (parent_id, name) VALUES (2, 'item3'); INSERT INTO item (parent_id, name) VALUES (3, 'item4'); INSERT INTO item (parent_id, name) VALUES (2, 'item5'); INSERT INTO item (parent_id, name) VALUES (null, 'item6'); INSERT INTO item (parent_id, name) VALUES (6, 'item7'); INSERT INTO item (parent_id, name) VALUES (null, 'item8'); DROP PROCEDURE IF EXISTS UPDATE_LEVEL; DELIMITER // CREATE PROCEDURE UPDATE_LEVEL() BEGIN DECLARE CNT INT; DECLARE LVL INT; SET LVL=1; UPDATE item SET level=0; UPDATE item SET level=LVL WHERE parent_id IS NULL; SELECT COUNT(*) INTO CNT FROM item WHERE level=LVL; WHILE CNT>0 DO UPDATE item INNER JOIN (SELECT id FROM item WHERE level=LVL) as temp ON parent_id=temp.id SET item.level=LVL+1; SET LVL=LVL+1; SELECT COUNT(*) INTO CNT FROM item WHERE level=LVL; END WHILE; END // DELIMITER ; DROP TRIGGER IF EXISTS TRG_INSERT_ITEM; DELIMITER // CREATE TRIGGER TRG_INSERT_ITEM AFTER INSERT ON item FOR EACH ROW BEGIN CALL UPDATE_LEVEL(); END; // DELIMITER ; itemテーブルにinsertした場合にトリガーでUPDATE_LEVEL()を実行するようにしているのですが、 実際に挿入すると、 ＞Can't update table 'item' in stored function/trigger because it is already used by statment which invoked this stored function/trigger . このようなエラーが出てしまいます・・・ UPDATE_LEVEL()にinsertらしき記述はないと思うのですが、 これはなぜこのようなエラーが出るのでしょうか？
お世話になっております。GROUP BY に関してつまずいています。 色々と調べているのですが、解決できないため質問させて下さい。 まず下記のような履歴テーブルがあります。 rireki_member_noとは投稿者のIDであり、title1、title2に登録された日付データ（date型）は その投稿者が投稿した日付が登録されています。（title1だけの場合もあればtitle2だけの場合もあり、両方の場合もあります） rirekiテーブル rireki_no　rireki_member_no　　title1　　　　　title2 　1　　　　　　　2　　　　　　　2014-09-12　 　2　　　　　　　1　　　　　　　　　　　　　　　　　2014-09-12 　3　　　　　　　3　　　　　　　2014-09-14 　　2014-09-14 　4　　　　　　　2　　　　　　　2014-09-18 　5　　　　　　　1　　　　　　　　　　　　　　　　　2014-09-19 また、下記は投稿者のテーブルであり、rireki_member_noと、member_noは紐付いたものとなります。 memberテーブル memner_no　　member_name 　1　　　　　　　佐藤 　2　　　　　　　吉田 　3　　　　　　　佐々木 そこで今回行いたいのは、タイトルを指定し、且つ日付を範囲指定した時、その会員の名前、そして投稿した日付を一覧で表示したいと考えていますが、その際のSQL文が分からず困っている状況です。 イメージ的には、 title2を指定し、2014-9-13から20149-19と範囲指定した場合 3　　佐々木　　2014-09-14 2　　吉田　　　2014-09-19 といった結果を求めたいと考えています。 お恥ずかしいとは思いますが、実は昨夜からずっと悩んでいたりして・・・ rirekiテーブル単体であれば、 http://norm-nois.com/blog/archives/1293 で似たような内容で紹介されているのですが、今回のようにJOINが絡むと難易度が高くなっている状況です。 お忙しいなか恐縮ですが、お知恵を頂戴出来れば幸いです。 宜しくお願い致します。
no type name ---------------------------- 1 1 peach 1 1 peach 2 5 tomato 4 6 apple 4 6 apple 1 1 peach 　上記のように、重複するレコード（行）が存在してしまっているテーブルで、重複をなくす処理を、SQLで簡単に行なうにはどうしたら良いでしょうか。MySQLです。上の例では、下のように更新したいのです。よろしくお願いします。 no type name ---------------------------- 1 1 peach 2 5 tomato 4 6 apple
応援しているサッカーチームの試合データをMySQLを利用しテーブルに格納したいと考えています。 そこでMySQLやPHPに詳しい方にお聞きしたいことがあります。 例えばA・Ｂ・Ｃと3チームあるとしたら、A対B、A対Cの試合データは格納しますが、B対Cのデータは不要です。あくまでもAチームに関するデータのみを格納し、私が開設しているサイトで閲覧者に検索フォームから自由な形でデータを参照できるようにしたいです。 参考までに格納したい試合のデータは下記のようなデータです。 http://www.j-league.or.jp/result/2014/j2/030201.html 現在、既に一定のデータはテーブルに格納しています。現在のテーブルの構造です。 https://www.dropbox.com/s/z2qc2zff2fn8m8f/gamedb.pdf?dl=0 スタメンの選手やベンチの選手、交代選手、警告をもらった選手、得点者などはテーブルに格納していません。これらのデータは試合ごとに大きく数が異なるのでどのようにして格納すれば良いのか分からなかったので。 現在は格納していないこれらのデータを格納することで下記のような条件を指定しても対象データが羅列されるようにしたいです。 ・○○選手がイエローカードをもらった試合。 ・点を取られている選手ランキング。□□選手(※対戦相手の選手)には一番点を取られているなど。 ・○○選手がスタメンだった試合。 ・○○選手が途中出場した試合。 ・○○選手はこれまで△試合に▲分出場している。 ・□分～□分の間の得点は何点。逆に失点は何点など。 などなどです。 私が現在思いついている構造ですが、新しくテーブルを複数作成する。こういったケースではそれぞれのテーブルに共通のIDを振る必要があるとのことですが、これは日付（開催日）で代用しようと思っています。同じ日に2試合は絶対にないので。 作成するテーブルは下記のようにします。 ・ホームチームスタメンテーブル ・アウェーチームスタメンテーブル ・ホームチームの警告をもらった選手テーブル ・アウェーチームの警告をもらった選手テーブル ・ホームチーム得点者テーブル ・アウェーチーム得点者テーブル .....などなど。 こういったテーブルを作成し、それぞれID(開催日)と一定数のカラムを予め用意する。得点者のテーブルでしたら1試合で一方のチームが10点を取ることは限りなく0に近いのでとりあえず10用意する。同じように得点した時間も10用意。 datadating(開催日) | goal_1_min(得点時間) ｜goal_1（得点者） ｜ goal2_min(得点時間) | goal2(得点者) |.......... このように格納していけば思い通りの結果が得られるようになるのかな？と思っていますが、果たしてこのようなテーブルで作成していき、後々サイト側の検索フォームから指定した条件で無事に結果を得られるか不安です。 ちょっとしたことでも良いので、詳しい方の意見をお聞きしたいです。 どうぞよろしくお願いします。 長文失礼しました。
このジャンルでお願いします。 次のようなテーブルで CREATE TABLE IF NOT EXISTS user ( id int(11) NOT NULL AUTO_INCREMENT, name varchar(32) NOT NULL, PRIMARY KEY(id) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO user (name) VALUES ('user1'); INSERT INTO user (name) VALUES ('user2'); INSERT INTO user (name) VALUES ('user3'); CREATE TABLE IF NOT EXISTS item ( id int(11) NOT NULL AUTO_INCREMENT, parent_id INT, name varchar(32) NOT NULL, FOREIGN KEY (parent_id) REFERENCES item(id) ON DELETE CASCADE ON UPDATE CASCADE, PRIMARY KEY(id) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO item (parent_id, name) VALUES (null, 'item1'); INSERT INTO item (parent_id, name) VALUES (1, 'item2'); INSERT INTO item (parent_id, name) VALUES (2, 'item3'); INSERT INTO item (parent_id, name) VALUES (3, 'item4'); INSERT INTO item (parent_id, name) VALUES (2, 'item5'); INSERT INTO item (parent_id, name) VALUES (null, 'item6'); INSERT INTO item (parent_id, name) VALUES (6, 'item7'); INSERT INTO item (parent_id, name) VALUES (null, 'item8'); CREATE TABLE IF NOT EXISTS user_item ( id int(11) NOT NULL AUTO_INCREMENT, user_id INT, item_id INT, type varchar(16) NOT NULL, PRIMARY KEY(id), FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE ON UPDATE CASCADE, FOREIGN KEY (item_id) REFERENCES item(id) ON DELETE CASCADE ON UPDATE CASCADE ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO user_item (user_id, item_id, type) VALUES (1, 1, 'allow'); INSERT INTO user_item (user_id, item_id, type) VALUES (1, 3, 'deny'); INSERT INTO user_item (user_id, item_id, type) VALUES (1, 7, 'allow'); user_itemのuser_idが1のitemの行を取得したいのですが、 その条件として ・user_itemテーブルのtypeが'allow'のitem_id以下のitemの行 ・ただしtypeが'deny'のitem_id以下の行は除く この例だと、user_itemの INSERT INTO user_item (user_id, item_id, type) VALUES (1, 1, 'allow'); の行によってitemテーブルの INSERT INTO item (parent_id, name) VALUES (null, 'item1'); INSERT INTO item (parent_id, name) VALUES (1, 'item2'); INSERT INTO item (parent_id, name) VALUES (2, 'item3'); INSERT INTO item (parent_id, name) VALUES (3, 'item4'); INSERT INTO item (parent_id, name) VALUES (2, 'item5'); が取得候補になりますが、 INSERT INTO user_item (user_id, item_id, type) VALUES (1, 3, 'deny'); によって INSERT INTO item (parent_id, name) VALUES (2, 'item3'); INSERT INTO item (parent_id, name) VALUES (3, 'item4'); の行は除かれ、 INSERT INTO item (parent_id, name) VALUES (null, 'item1'); INSERT INTO item (parent_id, name) VALUES (1, 'item2'); INSERT INTO item (parent_id, name) VALUES (2, 'item5'); の行が取得されます。 つまりitemテーブルにおいて上の階層の直近の（user_itemと結合して取得した）typeが 'allow'である場合のみ取得したいのです。 INSERT INTO item (parent_id, name) VALUES (null, 'item1');←取得 INSERT INTO item (parent_id, name) VALUES (1, 'item2');←取得 INSERT INTO item (parent_id, name) VALUES (2, 'item3'); INSERT INTO item (parent_id, name) VALUES (3, 'item4'); INSERT INTO item (parent_id, name) VALUES (2, 'item5');←取得 INSERT INTO item (parent_id, name) VALUES (null, 'item6'); INSERT INTO item (parent_id, name) VALUES (6, 'item7');←取得 INSERT INTO item (parent_id, name) VALUES (null, 'item8'); 複雑ではありますが、これはどのようなSQL文にすれば良いのでしょうか？
以下のようにDBに登録されています。 id　date　cost 129　1404313200　6000 76　1404313200　5000 129　1404226800　4000 54　1404226800　75000 129　1404226800　55000 日付はUNIX TIMEです。 各IDの、最新日のcostを抽出したいのですが、どのようにすればいいでしょうか。 上記だと 76　1404313200　5000 54　14042268007　5000 129　1404313200　6000 が抽出される方法を知りたいです。 （ID129のdateが1404313200で一番大きい＝最新） よろしくお願い致します。
エックスサーバーを借りているのですが、FILE権限がありませんでした。 GRANTで権限を付与しようとしてもエラーとなり付与できませんでした。 OUTFILEでCSVファイルを出力できないのですが、レンタルサーバーでデータベースをファイルで入出力するには一般的にどのような方法でやるのでしょうか？ dumpではなく、Webサービスを利用するユーザーにデータベースのデータをcsvファイルとして出力したいのです。 どうぞよろしくお願い致します。
このジャンルでお願いします。 次のようなテーブルで CREATE TABLE IF NOT EXISTS user ( id int(11) NOT NULL AUTO_INCREMENT, name varchar(32) NOT NULL, PRIMARY KEY(id) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO user (name) VALUES ('user1'); INSERT INTO user (name) VALUES ('user2'); INSERT INTO user (name) VALUES ('user3'); CREATE TABLE IF NOT EXISTS item ( id int(11) NOT NULL AUTO_INCREMENT, name varchar(32) NOT NULL, PRIMARY KEY(id) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO item (name) VALUES ('item1'); INSERT INTO item (name) VALUES ('item2'); INSERT INTO item (name) VALUES ('item3'); CREATE TABLE IF NOT EXISTS user_item ( id int(11) NOT NULL AUTO_INCREMENT, user_id INT, item_id INT, PRIMARY KEY(id), FOREIGN KEY (item_id) REFERENCES user(id) ON DELETE CASCADE ON UPDATE CASCADE, FOREIGN KEY (user_id) REFERENCES item(id) ON DELETE CASCADE ON UPDATE CASCADE ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO user_item (user_id, item_id) VALUES (1, 1); INSERT INTO user_item (user_id, item_id) VALUES (2, 1); INSERT INTO user_item (user_id, item_id) VALUES (3, 2); INSERT INTO user_item (user_id, item_id) VALUES (1, 2); INSERT INTO user_item (user_id, item_id) VALUES (1, 3); INSERT INTO user_item (user_id, item_id) VALUES (3, 3); user_itemテーブルでのselectで、 user_idが1で一番最初に挿入された行だけ を取得したいのですが、どのようなSQL文にすれば良いのでしょうか？ この例なら INSERT INTO user_item (user_id, item_id) VALUES (1, 1);←取得 INSERT INTO user_item (user_id, item_id) VALUES (2, 1); INSERT INTO user_item (user_id, item_id) VALUES (3, 2); INSERT INTO user_item (user_id, item_id) VALUES (1, 2);←user_id=3が最初に挿入されているので取得しない INSERT INTO user_item (user_id, item_id) VALUES (1, 3);←取得 INSERT INTO user_item (user_id, item_id) VALUES (3, 3);
テーブルtb1が以下のようになっているとします id, region, station1, station2, station3, station4, station5 0, 東京, 池袋駅, 渋谷駅, null, 新宿駅, null 1, 横浜, null, 横浜駅, 戸塚駅, 菊名駅, 反町駅 2, 大阪, 梅田駅, 天満駅, 野田駅, null, null このようなテーブルを、以下のような結果として取得するSELECT文はどのようになるのでしょうか？ 0, 東京, 0, 東京, 池袋駅 0, 東京, 渋谷駅 0, 東京, 新宿駅 1, 横浜, 1, 横浜, 横浜駅 1, 横浜, 戸塚駅 1, 横浜, 菊名駅 1, 横浜, 反町駅 2, 大阪, 2, 大阪, 大阪駅 2, 大阪, 梅田駅 2, 大阪, 野田駅 複数の列を行にするのがわかりません。 そもそも、tb1の設計が良くないのですが、これは変えられないと先方に言われました。 どうぞよろしくお願い致します。
おせわになります。助けてください。 id | nendo | sdate | edate 0 | 2012 | 2012-04-01 | 2013-03-31 1 | 2013 | 2013-04-01 | 2014-03-31 2 | 2014 | 2014-04-01 | 2015-03-31 2 | 2015 | 2015-04-01 | 2016-03-31 といったデーターベースがあります。 2014/03/31 という日付がどの年度の日付なのかを 調べるＳＱＬをどう書けばいいのかわかりません。 SELECT * FROM m_nendo WHERE sdate <= '2014/03/31' and edate >'2014/03/31' といった書き方をしているのですが、思う結果を取れません。 ネットでどういう言葉で検索したらいいのかも・・・わかりません。 書き方をご存知の方、教えて頂けませんか？ よろしくお願いします。
MySQLでのINDEXの貼り方にてご教示いただきたく思います。。 現在、ブログサイトを作っていて、記事ID毎にSNSでシェアされた数を保存する仕組みを作っています。 ストレージエンジン = InnoDB を設定しています。 post_idに同じIDが無い場合はINSERTし、ある場合はUPDATEとなります。 検索をかけるSELECT文の想定は以下の2つだと思っています。 SELECT * FROM tablename WHERE post_id = 1234; SELECT facebook FROM tablename WHERE post_id = 5678 作成したテーブル構造は以下になっています。 名前 | データ型 | 属性 | NULL | デフォルト値 | その他 ID | bigint(20) | UNSIGNED | いいえ | なし | AUTO_INCREMENT post_id | bigint(20) | UNSIGNED | いいえ | 0 facebook | bigint(20) | UNSIGNED | いいえ | 0 twitter | bigint(20) | UNSIGNED | いいえ | 0 googleplus | bigint(20) | UNSIGNED | いいえ | 0 pocket | bigint(20) | UNSIGNED | いいえ | 0 pinterest | bigint(20) | UNSIGNED | いいえ | 0 hatena | bigint(20) | UNSIGNED | いいえ | 0 line | bigint(20) | UNSIGNED | いいえ | 0 total | bigint(20) | UNSIGNED | いいえ | 0 datetime | datetime | | いいえ | 0000-00-00 00:00:00 リレーションは行う予定は無いのですが行うかもしれません。 分からないながらもINDEXを設定 ( 添付画像参照 ) してみました。 ご指導ご教示の程よろしくお願いいたします。
現在MySQLを学習しているんですが、ちょっとわからない問題が出てきまして質問させていただきます。 トリガーの問題なんですが、 各種テーブルに対して更新処理（追加、削除、更新）した場合、その処理を実施した時間、ユーザー名、テーブル名、処理内容を別のテーブルに自動保存する って内容なんですが、ここのテーブル名、処理内容の自動保存の構文がびっくりするくらい分かりません。。。。。 結構調べたのですが、なかなかヒットしないので質問させて下さい（涙） お願い致します（涙）
最近MySQLをちょこちょこ触っているものですが、ふとした疑問にぶち当たりました。 もし、ご存じの方がいらっしゃいましたらご教授頂けないでしょうか？ 質問 AというMySQLマスターServer BというMySQLスレーブServer があり、お互いにレプリケーションの関係を築いております。 ここに、突然 全く別のデータが入っている CというMySQLマスターServerの受け皿としてBをスレーブに出来ますでしょうか？ つまり、B(MySQLスレーブServer)はAのスレーブでもあり、Cのスレーブでもある。 ということが出来るのでしょうか？ （出来る、出来ないで結構です、やり方などのご教授はいりません。） MySQLにお詳しい方いらっしゃいましたらアドバイス頂けないでしょうか？ よろしくお願い致します。
お世話になります。 店舗販売、通販を始めて約7年程が経ちました。 少しずつではありますが固定客も増えつつあります。 しかし、弊社は現在のいくつかの問題を抱えています。 下記は、弊社が抱えている問題です。 店舗と通販の在庫が合わず棚卸しの際に、残業が続いてます。 店舗と通販の共通ポイント化がされていません。 顧客ランクの管理。 売上集計がデーターベースとの連携が取れていません。 解決策としてO2O（オーツーオー）を取り入れようと思い製品の説明会に何度も足を運びましたが弊社に合う製品がありませんでした。 結果、店舗と通販の製品を一元管理できるように自社開発することになりました。 ここからが本題なのです。データーベース設計する際、店舗と通販は別々のテーブルを作成する必要があるのでしょうか？ 以上、宜しくお願い致します。
mysqlのバックアップを検索したところ、データベースがオンライン(稼働中)の場合、mysqlhotcopyやmysqldumpを使ってのバックアップで、オフラインの場合は、/var/lib/mysql/*のディレクトリコピーをするといったサイトが多いのですが、オンライン中(稼働中)に/var/lib/mysql/*のディレクトリコピーをするのは問題があるのでしょうか。 単純にディレクトリコピーをしてしまえば、リストアの時も簡単な気がするのですが、オンライン中にディレクトリをコピーしたら、壊れるとかありますか。 よろしくお願いします。
phpMyAdminのデータベースの中に約３０００件のデータがあるので、ある一定の規則に従っていくつかデータを（約１０００件ほど）CSVファイルに落としたいのですが、どうやってエクスポートしたらわかる方がいたら教えてください！ もしくはsqlの指示で絞り込んでからCSVに落とせるなんてコードがあったらよろしくおねがいします。 それか、全部CSVファイルに落としたあと、エクセルとかで絞り込んで、あとからいらないデータは消せばいいよってのがあればそちらもよろしくおねがいします！！
受注金額や発注金額をDBから読み込み、税抜および税込の金額を算出するプログラムを作成しています。 税込金額を算出する際は金額+floor(金額*税率)の式を用いているのですが、 消費税分が整数になる場合、floor計算後に金額が1足らなくなることがあります。 桁上がりしない程度の数を足せばいいと言われたのですが、税率8%計算でギリギリ繰り上がらない0.039を足しても、2500万前後で誤差が発生してしまいます。 扱う金額は現在DBにある中では最大で4000万を越えます。 どうにか誤差が発生しないようにできないでしょうか？
CentOS6.4にpdo_mysqlが入ってなかったので、ダウンロードして展開までしたのですが、 cd PDO_MYSQL-1.0.2 で展開先のディレクトリに入って、 $ ./configure --with-pdo-mysql=shared,/usr/local/mysql を実行しようとすると、configureがないと言われてしまいます。 configureを実行するには何がしかのソフトをインストールする必要があるのでしょうか？ 情報いただけたらと思います。
PHPでMySQLテーブルロックされている一覧を取得したいですがどのようにすれば良いかご教授願います。 Web検索で調べるとロック状態はmysql_list_processesや、show processlistでも試してみましたが、思うような結果は得られませんでした。正常には動作していますが、欲しいデータが取り出せないですす。。。 単純に、現在ロックしているテーブル名（レコードロックは不要です。）を一覧で出力させることはできないのでしょうか？ PHPから実施できるやり方をご教授頂けると幸いです。 -------Test Program()--------- <?php $link = mysql_connect('localhost', 'login_id', 'login_pass'); mysql_select_db('db_name'); mysql_query('LOCK TABLES table1 WRITE'); mysql_query('INSERT INTO table1 SET field1 = "test", field2 = "1"'); //$result = mysql_list_processes($link);　以下のSQL文とも入れ替えて試しました。 $result = mysql_query('show processlist'); while ($row = mysql_fetch_assoc($result)){ printf("%s %s %s %s %s %s %s %s\n", $row["Id"], $row["User"], $row["Host"], $row["db"], $row["Command"], $row["Time"] , $row["State"], $row["Info"]); } mysql_free_result($result); mysql_query('UNLOCK TABLES'); ?>
phpMyAdminをロリポップで使っていて、データベースに入ってる３つの情報（140ほどの行があります）だけを３００列分それぞれ変えたいのですが、SQLから直接変えてたのでは日がくれてしまいます。↓こんな感じ UPDATE items SET data1='2014-07-17', data2='9800', data3='-2.9' WHERE data4=5663; ↑これを３００個それぞれ書く。 なのでExcelのファイルを直接読み込むことができるような機能があれば教えていただくて質問させていただきました！ よろしくおねがいします！
いつも大変お世話になっております、ありがとうございます。 データベースについての質問です。 大変初歩的な質問ですが何卒よろしくお願い致します。 不動産物件の絞り込み検索システムを作成したいのですが、テーブルの作成方法がわかりません。 不動産の条件検索フォーム 物件種別　　チェックボックス　　３種類 価格帯　　　プルダウン 所在地　　　チェックボックス 最寄り駅　　テキスト 間取り　　　チェックボックス　　　　４種類 こだわり条件　　チェックボックス　　１６種類 とする場合、データベース内でいくつテーブルを作成すればしっくりくるのでしょうか？ どうかよろしくお願い致します。
ｍｙｓｑｌの参照の負荷の問題解決はスレーブが有効だがｍｙｓｑｌの登録・更新の負荷の問題解決は何が有効なのでしょうか
こんにちわ カートを作っていてつまづいたのでお力かしていただきたいです。 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> <html xmlns="http://www.w3.org/1999/xhtml"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> <title></title> </head> <body> <?php try{ require_once('../common/common.php'); $post=sanitize($_POST); $pro_name=$post['name']; $pro_namecode=$post['namecode']; $pro_kg=$post['kg']; $pro_price=$post['price']; $pro_gazou_name=$_POST['gazou_name']; $pro_gazou_name2=$_POST['gazou_name2']; $dsn='mysql:dbname=LAA******-******;host=mysql***.phy.lolipop.lan'; $user='LAA******'; $password='********'; $dbh=new PDO($dsn,$user,$password); $pdo=new PDO("mysql:host=mysq***.phy.lolipop.lan;dbname=LAA*****-*******;charset=utf8",'LAA*****','********←パスワード'); $pdo->setAttribute(PDO::ATTR_ERRMODE,PDO::ERRMODE_EXCEPTION); 　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　 $sql='INSERT INTO mst_product(namecode,name,kg,price,gazou,gazou2) VALUES(?,?,?,?,?,?)'; $stmt=$dbh->prepare($sql); $data[]=$pro_namecode; $data[]=$pro_name; $data[]=$pro_kg; $data[]=$pro_price; $data[]=$pro_gazou_name; $data[]=$pro_gazou_name2; $stmt->execute($data); $dbh=null; print$pro_name; print'を追加しました。<br/>'; } catch(Exception $e) { print'ただいま障害により大変ご迷惑をおかけします。<br/>'; exit(); } ?> <a href="pro_list.php">戻る</a> </body> </html> 一応エラーもでないで最後のprint$pro_name;print'を追加しました。<br/>'; までいくんですがデータベースを見ても商品は追加されていません。 エラーもでないで最後まで行くということは一応接続は出来ているということ なんでしょうか？ どうしたらきちんと商品登録でしますか？ レンタルサーバーはロりポップです。 必要かは分からないんですが phpバージョンは５．３ データベースバージョン５．６ よろしくおねがいします。
独学でPHPを勉強しています。 一つ分からない事があったので詳しい方にお聞きしたいです。 DATE型同士で日数を算出し、日数が短い順番に並べたいと思っています。 テーブルは下記のようにしました。 テーブル名：office name(VARCHAR型)｜in(DATE型)｜out(DATE型) 佐藤｜2010-11-10｜2010-12-13 田中｜2010-10-30｜2012-01-30 水谷｜2009-09-20｜2011-03-20 上記のテーブルでいうと次のようなランキングにしたいです。 佐藤　33日 田中　1年92日 水谷　1年197日 このようにDATE型同士で日数を算出する場合、どのようなSQL文になるでしょうか？ ご存知の方いらっしゃいましたらご教示ください。 よろしくお願いします。
以下のような形でDBに登録されています。 iddatecost 12914043132006000 7614043132005000 12914042268004000 54140422680075000 129140431320055000 id 129のものをすべて抽出したいのですが、もしdateが同じだった場合は、同じdateの中でのcostの最大値の行だけ抽出したいです。 このようなことは可能でしょうか。 上記の例でいうと、 12914042268004000 129140431320055000 が取得できればOKです。 あまりmySQLは詳しくないのでselect文でそのまま頂けると嬉しいです。 よろしくお願い致します。
MySQLのカラム名に日本語を使うか、英数字を使うかで迷っています。英数が無難だと思うのですが、日本語の方が簡潔で分かりやすい命名ができるので、もし大した問題が無ければ日本語を使おうと考えています。 そこで3点お伺いしたく存じます。 1. 日本の企業はMySQLのカラム名に日本語を使っているケースが多いのか、それとも英数字のみのケースが多いのか、最近の傾向をご教示頂けますか。統計は無いと思いますので、体感や自社ルールの場合等でも結構です。 2. 日本語を使うことでセキュリティホールができることは考えられますか。例えば、マルチバイト文字はSQLインジェクション対策をすり抜ける・・・等。 3. 自分なら日本語と英数字のどちらを使うか。理由も添えて頂けると幸いです。 当方の開発環境は、PHP(ver. 5.5.9) + MySQL(ver. 5.6.16)です。 お手数おかけしますが、ご教示お願い致します。
PHPとMySQLでデータサイトを作成しています。 詳しい方に二点ほどお聞きしたいのですが。 テーブルは下記の通りです。データベース名はgame。 フィールドについて「issue」は結果。「h_a」はホームかビジターか。「h_score」はホーム側スコア。「a_score」はビジター側スコア。「opponent」は対戦相手です。 テーブル名：game issue(VARCHAR型)｜h_a(VARCHAR型)｜h_score(INT型)｜a_score(INT型)｜opponent(VARCHAR型) ●｜H｜8｜9｜チームB ○｜A｜2｜8｜チームC ●｜H｜4｜9｜チームD ○｜Ａ｜3｜3｜チームB 一点目。 格納したデータから自分のチームのスコアが多い順に10ほど並べたいと思っています。 問題はホームゲーム時（H）の場合はホーム側スコア（h_score）、ビジター（Ａ）の時はビジター側スコア（a_score）を適用することです。 現在は下記のようなコードしか記述していません。 $stmt = $dbh -> query("SELECT * FROM game ORDER BY () DESC LIMIT 10"); 二点目。 対戦相手ごとに勝率を計算し、勝率が高い順から10ほど並べることは可能でしょうか？ 勝率は「勝った試合数÷（勝った試合数+負けた試合数）*100」で計算。 上のデータでいうと、下記の順番です。 1 勝率100％　チームC 2 勝率50％　チームB 3 勝率0％　チームD こちらは不可能でしたら構いません。 ご存知の方いらっしゃいましたらご教示ください。 よろしくお願いします。
groupは予約語のためカラム名には使えないはずですが、alter文だと作れてしまうのはmysqlのバグですか？ ALTER TABLE `hoge` ADD `group` INT NOT NULL ;
店舗の毎日の売り上げを、日付・販売員名・売り上げ額のテーブルで集計しています。 【テーブル例1】 date, name, price 2014-05-01,吉田,2400 2014-05-01,佐藤,1500 2014-05-02,佐藤,3000 ...(中略)... 2014-06-18,佐藤,3000 2014-06-30,吉田,1000 これを月別、販売員別の金額で次のように集計したいのですが、 【例2】 各販売員がその月に売り上げた金額の合計 2014-5 吉田　205000 2014-5 佐藤　120000 2014-6 吉田　75000 2014-6 佐藤　90000 SELECT文における"GROUP BY"の条件を、"GROUP BY date AND name"のように"AND"でつなげてもうまくいきませんでした。 もちろん、条件をひとつだけにした"GROUP BY date"　および　"GROUP BY name"では、それぞれ日付別の集計、あるいは販売員名別の集計が出ます。 【質問】 1.GROUP BYは複数の条件をつけることができないのでしょうか？ 2.どのようにすれば【例2】の集計ができますか？
<th>物件種別</th> <td> <input type="checkbox" name="kid[]" value="1" <?php if( $_REQUEST["kid"] == "1" ){ print( 'checked' ); } ?>/> 温泉 <input type="checkbox" name="kid[]" value="2" <?php if( $_REQUEST["kid"] == "2" ){ print( 'checked' ); } ?>/> キャンペーン <input type="checkbox" name="kid[]" value="3" <?php if( $_REQUEST["kid"] == "3" ){ print( 'checked' ); } ?>/> イベント <input type="checkbox" name="kid[]" value="4" <?php if( $_REQUEST["kid"] == "4" ){ print( 'checked' ); } ?>/> 特別室<br /> <input type="checkbox" name="kid[]" value="5" <?php if( $_REQUEST["kid"] == "5" ){ print( 'checked' ); } ?>/> 和室 <input type="checkbox" name="kid[]" value="6" <?php if( $_REQUEST["kid"] == "6" ){ print( 'checked' ); } ?>/> 喫煙室</td> </tr> <tr> //まずこのSQL文でt_hotelsのテーブルとt_hotel_kodawariを結合します $sql="SELECT t_hotels.id,t_hotels.hotel_name,t_hotels.price,t_hotels.address,t_hotel_kodawari.id,t_hotel_kodawari.kid FROM t_hotels JOIN t_hotel_kodawari USING(id) WHERE 1 "; テーブル t_hotel_kodawari id kid ------------ 1 1 1 2 1 4 2 1 2 5 3 2 4 3 4 6 5 2 5 3 6 1 7 2 テーブルt_hotels id hotel_name price address ----------------------------------------------------- 1 Aホテル 10000 栃木県・・・ 2 Bホテル 12000 栃木県・・・ 3 Cホテル 9000 千葉県・・・ 4 Dホテル 10000 千葉県・・・ 5 Eホテル 15000 愛知県・・・ 6 Fホテル 30000 東京都・・・ 7 Gホテル 40000 神奈川県・・・ テーブルt_hotels とt_hotel_kodawariをJOIN USINで結合して表示 id hotel_name price address id kid ------------------------------------------------------------------- 1 Aホテル 10000 栃木県・・・ 1 1 1 Aホテル 10000 栃木県・・・ 1 2 1 Aホテル 10000 栃木県・・・ 1 4 2 Bホテル12000 栃木県・・・ 2 1 2 Bホテル12000 栃木県・・・ 2 5 3 Cホテル 9000 千葉県・・・ 3 2 4 Dホテル 10000 千葉県・・・ 4 3 4 Dホテル 10000 千葉県・・・ 4 6 5 Eホテル 15000 愛知県・・・ 5 2 5 Eホテル 15000 愛知県・・・ 5 3 6 Fホテル 30000 東京都・・・ 6 1 7 Gホテル40000 神奈川県 7 2 $condition = array(); //仮にkid１が一つ選択されたら まず if( !empty( $_POST["kid"] )){ for($i=0; $i<count($_REQUEST["kid"]); $i++) { $tmpKey = "kid".$i; $sql .= " and kid = :".$tmpKey; $condition[$tmpKey] = $_REQUEST["kid"][$i]; var_dump($sql); } } で絞り込まれSQL文が作られ、 var_dump($sql);でSQL文を表示させると string(184) "SELECT t_hotels.id,t_hotels.hotel_name,t_hotels.price,t_hotels.address,t_hotel_kodawari.id,t_hotel_kodawari.kid FROM t_hotels JOIN t_hotel_kodawari USING(id) WHERE 1 and kid = :kid0" の結果によって、 kid１を選択するとホテルA,B,Fが表示されます。 でkidがまずandで絞り込まれます。 ですが、もう二つ目選択すると string(184) "SELECT t_hotels.id,t_hotels.hotel_name,t_hotels.price,t_hotels.address,t_hotel_kodawari.id,t_hotel_kodawari.kid FROM t_hotels JOIN t_hotel_kodawari USING(id) WHERE 1 and kid = :kid0" string(200) "SELECT t_hotels.id,t_hotels.hotel_name,t_hotels.price,t_hotels.address,t_hotel_kodawari.id,t_hotel_kodawari.kid FROM t_hotels JOIN t_hotel_kodawari USING(id)「 WHERE 1 and kid = :kid0 and kid = :kid1"」 で ------------------------------------------- 二重にand で絞られてしまい何も出てきません。希望としては二回目の選択からkidはor条件にすれば仮にkid1,kid2ホテルA,B,C,E,F,Gと両方を含む表示を実現したいのですが、 実際はSQLの表記の方法をネットや本で調べたのですが、分からない状態です。ご教授いただけたらと思います。 なお、私の希望通りの方法ではなくても実現できれば大丈夫です。 どうかよろしくお願い致します。
エクセルで作ったような単純な縦横型のリレーショナル構造だとして、各列の一番大きな値を赤文字にしたいと思っています。 このとき、 (1)1回のクエリで全体を取得し、連想配列などにいれて各列をソートして1番大きな値を探す (2)必要な回数分、適したクエリを投げて、結果を変数に格納し、IDなどで一致させる という二通りのやり方を考えたのですが、どちらが一般的でしょうか。 (1)の場合は、DBに負荷がかからなくていいのかなと思いますが、多彩なフィルタやソートを使わずに、DBを使う意味があるんだろうかと考えてしまいます。 (2)の場合、列数が多いと、たとえば今回は5列分の結果を取得しようと思っていますが、1ページを表示させるのに5回DBへのアクセスがあることになり、運用としてどうなんだろうと考えた次第です。 アクセス数などにもよるのかと思いますが、一般的にこうする、というのがありましたら教えていただければと思います。 もちろん(1)(2)以外の方法でも歓迎です。 よろしくお願いします。
まだ解決できないので、大変恐縮ですがご教授お願いします。 どうかよろしくお願いいたします。 数人にご教授いただいき、チェックボックスの選択には一つのkid（kodawari_keyの略）に対して２複数の値をもっているホテルを表示させるにはデータベースのtableを複数に分けて紐付けする必要があるとアドバイスをいただき、教えて頂いたとおりtableをホテル用とチェックボックス用とチェックボックスのid用とに分けて、SQL文で紐付けしたつもりだったのですが、チェックボックスをチェックしてから検索ボタンを押すと Fatal error: Call to a member function execute() on a non-object in C:\xampp\htdocs\koredake\xxxxx\ｘｘｘｘｘｘｘ.php on line 97 のようなエラーが出てしまいます。 このことから紐付けのSQL文が間違っているのではと思うのですが、正解がわかりません。 どなたか教えていただけたらと思っております。 //MySQLの部分　教えていただいた部分で大変恐縮です。 //ホテルの基本情報 CREATE TABLE t_hotels(id int not null primary key,name varchar(100) not null,price_min int not null,price_max int not null,address varchar(100) not null); INSERT INTO t_hotels VALUES(1,'HOTEL A',5000,10000,'栃木県・・・'), (2,'HOTEL B',5000,12000,'栃木県・・・'), //こだわり情報 CREATE TABLE t_kodawari_key(id int not null primary key,name varchar(20)); INSERT INTO t_kodawari_key VALUES(1,'温泉'),(2,'ランチ'),(3,' ディナー'); //ホテルごとのこだわり CREATE TABLE t_hotel_kodawari(hid int not null,kid int not null,unique key(hid,kid)); INSERT INTO t_hotel_kodawari VALUES(1,1),(1,2),(1,3),(2,1),(3,2),(3,3),(4,3); //温泉かランチにこだわりがあるところ SELECT hid,t3.name,t3.price_min,t3.price_max,GROUP_CONCAT(t2.name) as kodawari,t3.address //温泉かランチかディナーのうち２つ以上にこだわりがあるところ SELECT hid,t3.name,t3.price_min,t3.price_max,GROUP_CONCAT(t2.name) as kodawari,t3.address //PHP部分　前半省略 <h1>ビジネスホテルの条件検索</h1> <form name="search_form" action="zenzen16.php" method="post" > <input type="hidden" name="cmd" value="search" /> <table> <tr> <th>物件種別</th> <td> <input type="checkbox" name="kid[]" value="1" <?php if( $_REQUEST["kid"] == "1" ){ print( 'checked' ); } ?>/> 温泉 <input type="checkbox" name="kid[]" value="2" <?php if( $_REQUEST["kid"] == "2" ){ print( 'checked' ); } ?>/> ランチ<br /> <input type="checkbox" name="kid[]" value="3" <?php if( $_REQUEST["kid"] == "3" ){ print( 'checked' ); } ?>/> ディナー <input type="checkbox" name="kid[]" value="4" <?php if( $_REQUEST["kid"] == "4" ){ print( 'checked' ); } ?>/> 駐車場</td> </tr> <tr> <th>価格帯</th> <td> <input type="text" name="price_min" value="<?php print( htmlspecialchars( $_REQUEST["price_min"] ,ENT_QUOTES ) ) ?>" size="8"> ～ <input type="text" name="price_max" value="<?php print( htmlspecialchars( $_REQUEST["price_max"] ,ENT_QUOTES ) ) ?>" size="8"><br /> </td> </tr> <tr> <th>住所</th> <td><input type="text" name="address" value="<?php print( htmlspecialchars( $_REQUEST["address"] ,ENT_QUOTES ) ) ?>" size="20"></td> </tr> </table> <input type="submit" value="検索" class="Btn-gray button"> </form> <p>&nbsp;</p> <?php if( $_REQUEST["cmd"] == "search" ){ $pdo = new PDO("mysql:host=localhost; dbname=hotel_reservation; charset=utf8", "koredake", "koredake123", array( PDO::ATTR_EMULATE_PREPARES => false ) ); $sql = "select * from t_hotels where 1 = 1 "; $condition = array(); //この部分が特に自信が無いです。 if( !empty( $_POST["kid"] )){ $sql = $sql . " left outer join kid on t_hotels.hid = kid.hid"; } if( !empty( $_REQUEST["price_min"] ) ){ $sql = $sql . " and price >= :price_min "; $condition[":price_min"] = $_REQUEST["price_min"]; } if( !empty( $_REQUEST["price_max"] ) ){ $sql = $sql . " and price <= :price_max "; $condition[":price_max"] = $_REQUEST["price_max"]; } if( !empty( $_REQUEST["address"] ) ){ $sql = $sql . " and ( address like :address ) "; $condition[":address"] = "%{$_REQUEST["address"]}%"; } $statement = $pdo->prepare( $sql ); $statement->execute( $condition ); $results = $statement->fetchAll(); ?> <table border="1"> <caption>検索結果</caption> <tr> <th></th> <th>ホテル名</th> <th>宿泊料金</th> <th>住所</th> </tr> <?php foreach( $results as $result ){ ?> <tr> <td><img src="hotel/<?php print( htmlspecialchars( $result["id"], ENT_QUOTES )); ?>.png" /></td> <td><?php print( htmlspecialchars( $result["hotel_name"], ENT_QUOTES )); ?></td> <td>\<?php print( htmlspecialchars( number_format( $result["price"] ),ENT_QUOTES ) ); ?></td> <td> <?php print( htmlspecialchars( $result["address"], ENT_QUOTES ) ); ?> </td> </tr> <?php } } ?> </table> </div>
「たったコレだけでPHPプログラミングが理解できる本」を参考にPHPでプログラムを書いていまして、 ビジネスホテルの検索機能をチェックボックス機能を余分につけて検索できないか試したのですが、 チェックボックスにチェックを入れると全く検索できず他のテキストボックスに入力するだけなら検索できます。 なんとかチェックボックスを有効にできないかいろいろなサイトを調べたり本を読んだりしましたが解決策が見つかりません。 いろいろな機能に対応できるようなプログラムを組みたいと思ったのでかなりの初心者で大変恐縮ですが、どなたかご教授お願いできないかと思っております。 あと参考になるサイトがございましたら、教えていただきたいと思っております。 何卒よろしくお願い致します。 前半省略 <form name="search_form" action="" method="post" > <input type="hidden" name="cmd" value="search" /> <table> <tr> <th>物件種別</th> <td> <input type="checkbox" name="kodawari_key[]" value="温泉" <?php if( $_REQUEST["kodawari_key"] == "温泉" ){ print( 'checked' ); } ?>/> 温泉 <input type="checkbox" name="kodawari_key[]" value="ランチ" <?php if( $_REQUEST["kodawari_key"] == "ランチ" ){ print( 'checked' ); } ?>/> ランチ<br /> <input type="checkbox" name="kodawari_key[]" value="ディナー" <?php if( $_REQUEST["kodawari_key"] == "ディナー" ){ print( 'checked' ); } ?>/> ディナー</td> </tr> <tr> <th>価格帯</th> <td> <input type="text" name="price_min" value="<?php print( htmlspecialchars( $_REQUEST["price_min"] ,ENT_QUOTES ) ) ?>" size="8"> ～ <input type="text" name="price_max" value="<?php print( htmlspecialchars( $_REQUEST["price_max"] ,ENT_QUOTES ) ) ?>" size="8"><br /> </td> </tr> <tr> <th>住所</th> <td><input type="text" name="address" value="<?php print( htmlspecialchars( $_REQUEST["address"] ,ENT_QUOTES ) ) ?>" size="20"></td> </tr> </table> <input type="submit" value="検索" class="Btn-gray button"> </form> <p>&nbsp;</p> <?php if( $_REQUEST["cmd"] == "search" ){ $pdo = new PDO("mysql:host=localhost; dbname=hotel_reservation; charset=utf8", "koredake", "koredake123", array( PDO::ATTR_EMULATE_PREPARES => false ) ); $sql = "select * from hotels where 1 = 1 "; $condition = array(); if( !empty( $_POST["kodawari_key"] )){ $sql = $sql . " and kodawari_key = :kodawari_key"; $condition["kodawari_key"] = $_REQUEST["kodawari_key"]; } if( !empty( $_REQUEST["price_min"] ) ){ $sql = $sql . " and price >= :price_min "; $condition[":price_min"] = $_REQUEST["price_min"]; } if( !empty( $_REQUEST["price_max"] ) ){ $sql = $sql . " and price <= :price_max "; $condition[":price_max"] = $_REQUEST["price_max"]; } if( !empty( $_REQUEST["address"] ) ){ $sql = $sql . " and ( pref like :pref or city like :city or address like :address ) "; $condition[":pref"] = "%{$_REQUEST["address"]}%"; $condition[":city"] = "%{$_REQUEST["address"]}%"; $condition[":address"] = "%{$_REQUEST["address"]}%"; } $statement = $pdo->prepare( $sql ); $statement->execute( $condition ); $results = $statement->fetchAll(); ?> <table border="1"> <caption>検索結果</caption> <tr> <th></th> <th>ホテル名</th> <th>宿泊料金</th> <th>住所</th> </tr> <?php foreach( $results as $result ){ ?> <tr> <td><img src="hotel/<?php print( htmlspecialchars( $result["id"], ENT_QUOTES )); ?>.png" /></td> <td><?php print( htmlspecialchars( $result["hotel_name"], ENT_QUOTES )); ?></td> <td>\<?php print( htmlspecialchars( number_format( $result["price"] ),ENT_QUOTES ) ); ?></td> <td> <?php print( htmlspecialchars( $result["pref"], ENT_QUOTES ) ); ?> <?php print( htmlspecialchars( $result["city"], ENT_QUOTES ) ); ?> <?php print( htmlspecialchars( $result["address"], ENT_QUOTES ) ); ?> </td> </tr> <?php } } ?> </table> </div> </body> </html>
mysql4.0.25でlike binaryを使って日本語検索をしていますが インデックスを使いたいので前方一致で条件を作ると検索されません。 文字コードはeuc-jpです。 部分一致でしか検索にひっかからないのですが 文字コードなど関係があるのでしょうか？
SQLを使って、「名前」（カラム名=name)と「コメント」（カラム名=comment)のテーブルを作りました。 このテーブルに対して、検索フォームを作りました。 このフォームに名前を入力すると、該当する行が検索されるようにしました。 ◆入力フォーム　form.php <form action = "kensaku.php" method="post"> 名前：<input type="text" name="name"> <input type="submit" name="submit" value="検索"> </form> ◆検索結果　search.php <?php function connect() { return new PDO("mysql:dbname=★;host=★","★","★", array( PDO::MYSQL_ATTR_INIT_COMMAND => "SET CHARACTER SET `utf8`")); } $pdo = connect(); $st = $pdo->query("SELECT * FROM table WHERE name='" . $_POST["name"] . "' "); $address = $st->fetchAll(); ?> <?php foreach ($table as $g) { ?> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="GENERATOR" content="IBM WebSphere Studio Homepage Builder Version 14.0.8.0 for Windows"> <p>名前<?php echo $g['name'] ?></p> <p>コメント<?php echo $g['comment'] ?></p> <?php } ?> ここで、該当する文言の一部でも検索できるようにしたいです。 ※例えば、「山田太郎」を検索する場合に「山」だけでも検索できるように。 LIKEを使えばよいかと思い、 $st = $pdo->query("SELECT * FROM table WHERE name='" . $_POST["name"] . "' ");を $st = $pdo->query("SELECT * FROM table WHERE name LIKE='%" . $_POST["name"] . "%' "); と、記述してみましたがだめでした。 どのように記述すればよいか教えていただけないでしょうか。 何卒お願いします。
クエリのパフォーマンスチューニングを勉強し始めたのですが、クエリの実行時間の良し悪しはどのように判断したらよいのでしょうか？　実行にかかった時間の目安などはあるのでしょうか？ ちなみに、MySQL5.5を使用しています。 以上、よろしくお願い致します。
自分のパソコンでは文字化けせず、正しく表示されているのですが、 niftyのデータサービスを使ってphpで表示すると文字化けします。 my.iniとmy.cnfの問題と思いniftyサーバーにftpで接続し探したがファイルが見つかりません。 mysqlとphpはutf8で設定しています。 niftyサーバーのmysqlは５、phpMyAdminは2,11,9です。
複数のテーブルを結合してレコードを取得するシステムを作成しています。 問題に関わってくるのが、プロジェクトIDや件名を保存するプロジェクトテーブルと、発注先や買掛日・発注金額などを保存する発注テーブルです。 1つのプロジェクトに対して複数の発注先があり、2つのテーブルはプロジェクトIDによって結合されています。 WHERE句によって各カラムの条件でレコードを絞り、プロジェクトIDや件名でグループ化を行い、最終的にプロジェクトID、件名、グループ内で最も遅い買掛日、グループ内の発注金額の総額etcを表示します。 現在起こっている問題の例を挙げます。 1つのプロジェクトに、発注先がA社・買掛日が2014年4月30日・発注金額が10万の発注と、発注先がB社・買掛日が2014年7月30日・発注金額が20万の発注があるとします。 これを発注先がB社・買掛日が4月1日から5月30日までの間という条件で検索をかけると、 本来ならこのプロジェクトは表示されないはずなのですが、最も遅い買掛日が7月30日(B社の買掛日)、発注金額が10万(A社の発注金額)で表示されてしまうのです。 どうすればこれを修正することができるのでしょうか？
単一レコード内において、 Bの値を条件により決定したいのですが可能でしょうか。 ＜構成＞ テーブル:hoge カラム:A,B ＜条件＞ Aにデータがあれば、Bは"●" Aにデータがなければ、Bは"×" よろしくお願いいたします。
参考の通りに、ストアドプロシージャ作成SQL文を発行し、 コマンドライン上からは、以下の通りの結果1となり、 レコードがinsertされます。 ＜結果1＞ mysql> call logger('ほげ', 'ホゲ'); Query OK, 1 row affected (0.01 sec) mysql> select * from PROCEDURE_LOG; +--------+--------+---------------------+ | NAME | QUERY | EXECUTE_DATE | +--------+--------+---------------------+ | ほげ | ホゲ | 2014-03-26 10:41:26 | +--------+--------+---------------------+ 1 row in set (0.00 sec) ですが、testというストアドファンクションから呼び出してみましたが、 以下の結果2の通り、失敗します。 ＜結果2＞ mysql> select test(); ERROR 1336 (0A000): Dynamic SQL is not allowed in stored function or trigger ＜test＞ BEGIN CALL logger('test','1'); RETURN CONCAT('END'); END 現在動作している環境では、どこでエラーが発生したかがわからず、 ロガーの処理をなんとしても実装したいのですが、 いろいろ試してみても、解決できませんでした。 ご教示のほど、よろしくお願いします。 ＜参考＞ http://treeapps.hatenablog.com/entry/20120106/p1 ＜ストアドプロシージャ作成SQL文(logger)＞ SET NAMES UTF8; delimiter // -- ログ出力 DROP PROCEDURE IF EXISTS logger// CREATE PROCEDURE logger( IN PROCEDURE_NAME TEXT, IN SQL_TEXT TEXT ) BEGIN DECLARE CNT INT; CREATE TABLE IF NOT EXISTS PROCEDURE_LOG ( NAME VARCHAR(64), QUERY TEXT, EXECUTE_DATE TIMESTAMP, KEY IDX1 (NAME, QUERY(64), EXECUTE_DATE) ) ENGINE=MYISAM DEFAULT CHARSET=UTF8; -- 古いログを削除 SELECT COUNT(*) INTO CNT FROM PROCEDURE_LOG; IF CNT >= 1000 THEN DELETE FROM PROCEDURE_LOG LIMIT 1; END IF; -- テーブルにログを記録 SET @sql = CONCAT('INSERT INTO PROCEDURE_LOG VALUES (', QUOTE(PROCEDURE_NAME), ',', QUOTE(SQL_TEXT), ', null)'); PREPARE stmt FROM @sql; EXECUTE stmt; END // delimiter ;
例えば、Twitterのようなシステムを作るとします。ユーザの情報に「名前」「ID」「フォロワー」があります（3つだけユーザー情報とします）。 id , name, follower_idsのようなフィールドが必要だと思います。ですが、この時follower_idsはいくらでも要素が増える可能性があります。このようなユーザー情報をSQL（特にMySQL）で管理することはできますか？ 今回の例のような構造をデータベースに保管したいのですが、どんな形式をとったらいいか迷っているので、質問しました。ちなみにSQLはやったことがありません。おすすめの方法があったらお願いします。XMLやJSON形式というキーワードにもたどり着きましたが、なるべく早いデータ操作をしたいです。
ご覧頂きありがとうございます。 今回の質問ですが、MySQLの表結合時の処理速度（負荷）についてお聞きします。 SELECT abcd.name, hoge.age FROM abdc, hoge WHERE abcd.id = hoge.id; SELECT abcd.name, hoge.age FROM abcd LEFT JOIN hoge ON abcd.id = hoge.id; 上記のいわゆるJOINとJOIN(省略)？になりますが、どちらが処理速度的に優秀なのでしょうか？ 可能であればどういった処理が走っているのかも御存じであれば教えて頂きたいです。 参考URLでも構いませんので、よろしくお願い致します。
Oracleにはテーブルに割り当てられたシノニムの名前がわかるテーブル(名前は忘れました)が あるのですがMySQLには存在するのでしょうか。あるのであればそれはどのようなテーブル名 でしょうか。
SQLについての質問です。 MySQLを使っています。 1か月間の得意先別の入金の集計を取りたいと思っています。 表としては以下のような感じです。 ID　　得意先名　　現金計　振込計　相殺計　手数料計　　合計 =========================================================== 001　aaaaaaa　　　30,000　　40,000　　25,000　　　　840　　95,840 002 bbbbbbb　　　10,000　　20,000　　30,000　　　　420　　60,420 SELECT * sum(nyukin) AS genkin FROM nyukin_meisai WHERE tokuisaki_id = '001' AND nyukin_kubun = '現金' AND uriage_bi BETWEEN '2014/05/01' AND '2014/05/31' SELECT * sum(nyukin) AS furikomi FROM nyukin_meisai WHERE tokuisaki_id = '001' AND nyukin_kubun = '振込' AND uriage_bi BETWEEN '2014/05/01' AND '2014/05/31' 以下続く と得意先毎/各区分ごとに一つひとつSQLを発行すればできるんでしょうけど、 これをひとつのSQLで実現したいと思っていますがSQLをどのように組み立て てよいものやら困っています。 case を組み込んだりしてもうまくいきませんでした。 どなたかご指導下さい。 よろしくお願いします。
テーブルに事前に記載された数値を用い、べき乗の数値の挿入(アップデート)をしたいと考えています。 *********************************************** やりたいこと *********************************************** テーブル　baken umaban___bekijyo___name 1_______NULL____ HOTARUNOHIKARI 2_______NULL____ MADONOYUKI 3_______NULL____ OPPEKEPE 4_______NULL____ KOTARO これをUPDATEして、bekijyo欄に「2のumaban乗」の数値を挿入する。 umaban___bekijyo___name 1_________2_____ HOTARUNOHIKARI 2_________4_____ MADONOYUKI 3_________8_____ OPPEKEPE 4________16_____ KOTARO ************************************************ まずは、べき乗を求めるために下記のSELECT文を作成したところうまくいきました。 SELECT uma_code,umaban FROM (SELECT POW( 2, umaban ) AS uma_code,umaban FROM cbf_today_baken WHERE umaban<'11') AS temp1 umaban___uma_code___ 1_________2_____ 2_________4_____ 3_________8_____ 4________16_____ あとは、上記の2つをくっ付けるだけです。 UPDATE baken SET bekijyo=(SELECT uma_code FROM (SELECT uma_code,umaban FROM (SELECT POW( 2, umaban ) AS uma_code,umaban FROM cbf_today_baken WHERE umaban<'11') AS temp1) WHERE cbf_today_baken.umaban=temp1.umaban) 上記でアップデート可能と思われましたが、エラーになります。 #1248 - Every derived table must have its own alias どこに誤りがあるのかご教授頂けましたら幸いです。
Wordpressにあるusermetaというテーブルに、 別のDBのテーブルからデータをINSERTしたいのですが、 #1241 - Operand should contain 1 column(s)　というエラーが表示されてうまくいきませんでした。 具体的なSQL文は、 insert into ***_usermeta (umeta_id,user_id,meta_key,meta_value) select (null,tableBid,'first_name',''), (null,tableBid,'last_name',''), (null,tableBid,'nickname',tableBname), (null,tableBid,'***_capabilities','a:1:{s:10:\"subscriber\";b:1;}'), (null,tableBid,'***_user_level','0') from dbB.tableB where tableBname<> 'Admin' dbBのtableB にあるAdmin行以外を対象としています。 実際にはもう少しデータが多いのですが、select (null,uid,'first_name','') from ・・・ だけにしても同じエラーが出ましたので、構文の書き方が間違っていると感じています。 （別のDBではなく、同じDBの別のTableからのINSERTでも同じエラーが表示されました） 上記のようなケースの場合、どのようにSQL文を書けばよいのでしょうか？ お分かりになられる方がいらっしゃいましたら、ご教示頂けますと幸いです。 宜しくお願い致します。
$sth = $dbh->prepare('SELECT name, colour, calories FROM fruit WHERE calories < :calories AND colour = :colour'); $sth->bindParam(':calories', $calories, PDO::PARAM_INT); $sth->bindParam(':colour', $colour, PDO::PARAM_STR, 12); $sth->execute(); 上記ではなく $sth = $dbh->prepare('SELECT name, colour, calories FROM fruit WHERE calories < ? AND colour = ?'); $sth->execute(array($calories,$colour)); のようにbindParamやbindValueを使わない場合は危険はあるのでしょうか？ ご教示頂けますと幸いです。 宜しくお願いいたします。
現在、サーバー内には、 ■wordpress ■メールマガジン の２つのシステムが入っております。 システム上から確認したときは文字化けが起こっていないのですが、 PHPadminの画面から確認すると、メールマガジンのデータのみ 日本語が文字化けしておりました。 文字化けの原因は、照合順序がlatin1_swedish_ciのためではないかと、 考えております。 エクスポートを試しても、文字化けしておりました。 照合順序をutf8_general_ciに変更したり、エンコードを変えてみたりも試してみましたが、うまくいきません。 文字化けを直す手段はあるのでしょうか。
一覧画面と検索画面を一緒にしています 一覧画面は10件表示にし、テキストになにも入力されてなかったらデータを全件表示したいです また、1 l　2 l 3 のようにページを表示し、また何件中何件目データですと表示したいです <!--一覧画面 index.php--> <html> <head> <title>一覧画面</title> </head> <body> <br><br> <blockquote> 一覧画面 <br><br> <?php if ($_GET) { // データがGETされていたら $event = isset($_GET['event']) ? $_GET['event'] : ''; // 取得 if (isset ($_GET['page'])==false) { $page=0; } else { //そうでなければpageパラメータの値をpage変数にセット $page = $_GET['page']; } } ?> <?php $pdo = new PDO("mysql:dbname=db_test;host=localhost", "root", "admin"); $name=isset($_GET['name'])?$_GET['name']:""; $sql ="select * from tbl_test where "; $sql.="`氏名` like concat('%',?,'%') "; $sql.="or `住所` like concat('%',?,'%') "; $sql.= " limit " . $page*10 . ", 10" ; $stmt = $pdo->prepare( $sql); $stmt->execute(array($name,$name)); $count = $stmt->rowCount(); if($count>0){ print "<table border=1>" ; print "<tr>"; print "<th>番号</th>"; print "<th>氏名</th>"; print "<th>住所</th>"; print "<th>操作</th>"; while($row = $stmt->fetch(PDO::FETCH_ASSOC)){ print "</tr>"; $ID = htmlspecialchars($row['番号']); $NAME = htmlspecialchars($row['氏名']); $ADDR = htmlspecialchars($row['住所']); echo "<tr> <td>$ID</td> <td>$NAME</td> <td>$ADDR</td> <td><a href='edit.php?番号=$ID'>修正</a> <a href='delete.php?番号=$ID'>削除</a></td></tr>"; }; print "</table>" ; }else{ print "該当するデータがありません"; } ?> <br><br><br> <form action = "index.php" method="GET"> <input type="hidden" name="event" value="find"> <input type="text" name="name"style ="font-size:20px;width: 400px; height: 40px"> <input type="submit" value="検索" style ="font-size:20px;width: 100px; height: 40px"> </form> <br><br> <form action = "regist.php" method="GET"> <input type="hidden" name="event" value="regist"> <input type = "submit" value = "新規登録" style ="font-size:20px;width: 100px; height: 40px"> </form> <input type="hidden" name="page" value="0"> </blockquote> </body> </html> 検索のテキストボックスが空だったら全件表示したいのですが今１０件しか出ません limitの書く場所が原因でしょうか？ またこのように一覧画面と検索結果画面が一緒じゃまずいですかね？ 検索結果を別ウインドウじゃなく自分に返したいと思いこのやり方にしたのですがよくないですか？
一覧画面と検索画面を一緒にしています <!--一覧画面 index1.php--> <html> <head> <title>一覧画面</title> </head> <body> <br><br> <blockquote> 一覧画面 <br><br> <?php if ($_GET) { // データがGETされていたら $event = isset($_GET['event']) ? $_GET['event'] : ''; // 取得 if (isset ($_GET['page'])==false) { $page=0; } else { //そうでなければpageパラメータの値をpage変数にセット $page = $_GET['page']; } } ?> <?php $pdo = new PDO("mysql:dbname=db_test;host=localhost", "root", "admin"); $name=isset($_GET['name'])?$_GET['name']:""; $sql ="select * from tbl_test where "; $sql.="`氏名` like concat('%',?,'%') "; $sql.="or `住所` like concat('%',?,'%') "; $sql.= " limit " . $page*10 . ", 10" ; $stmt = $pdo->prepare( $sql); $stmt->execute(array($name,$name)); $count = $stmt->rowCount(); if($count>0){ print "<table border=1>" ; print "<tr>"; print "<th>番号</th>"; print "<th>氏名</th>"; print "<th>住所</th>"; print "<th>操作</th>"; while($row = $stmt->fetch(PDO::FETCH_ASSOC)){ print "</tr>"; $ID = htmlspecialchars($row['番号']); $NAME = htmlspecialchars($row['氏名']); $ADDR = htmlspecialchars($row['住所']); echo "<tr> <td>$ID</td> <td>$NAME</td> <td>$ADDR</td> <td><a href='edit.php?番号=$ID'>修正</a> <a href='delete.php?番号=$ID'>削除</a></td></tr>"; }; print "</table>" ; }else{ print "該当するデータがありません"; } ?> <br><br><br> <form action = "index1.php" method="GET"> <input type="hidden" name="event" value="find"> <input type="text" name="name"style ="font-size:20px;width: 400px; height: 40px"> <input type="submit" value="検索" style ="font-size:20px;width: 100px; height: 40px"> </form> <br><br> <form action = "regist.php" method="GET"> <input type="hidden" name="event" value="regist"> <input type = "submit" value = "新規登録" style ="font-size:20px;width: 100px; height: 40px"> </form> <input type="hidden" name="page" value="0"> </blockquote> </body> </html> limit10で10件表示にしています 検索のテキストボックスが空だったら全件表示したいのですが今１０件しか出ません limitの書く場所が原因でしょうか？ またこのように一覧画面と検索結果画面が一緒じゃまずいですかね？ 検索結果を別ウインドウじゃなく自分に返したいと思いこのやり方にしたのですがよくないですか？
mysqlで検索フォームを作成しています 入力してデータに該当したら検索結果が出るのですが 該当者がいないときはテーブルの表のみ出力してしまう 該当者なしと入力フォーム側に表示したいです また　''''''を入力するとSQLになるのですが mysql_real_escapeを使えば出なくなります どうしたらいいですか <html> <body> <?php //データベースに接続 if (!$con = mysql_connect("localhost", "root", "admin")) { echo "接続エラー" ; exit ; } //データベースを選択 if (!mysql_select_db("db_test", $con)) { echo "データベース選択エラー" ; exit ; } //フォームで送られてきた条件を元にSELECT文を作成 $sql = "select * from tbl_test where (氏名 LIKE '%{$_GET['name']}%') or (住所 LIKE '%{$_GET['name']}%')"; //SELECT文を実行 if (!$res = mysql_query($sql)) { echo "SQLエラー<BR>" ; exit ; }else{ } //検索結果表示 echo "<table border=1>" ; echo "<tr> <th>番号</th> <th>氏名</th> <th>住所</th> <th>操作</th> </tr>" ; while($row = mysql_fetch_array($res)) { $ID = htmlspecialchars($row['番号']); $NAME = htmlspecialchars($row['氏名']); $ADDR = htmlspecialchars($row['住所']); echo "<tr> <td>$ID</td> <td>$NAME</td> <td>$ADDR</td> <td><a href='edit.php?番号=$ID'>修正</a> <a href='delete.php?番号=$ID'>削除</a></td></tr>"; if ($_GET) { // データがGETされていたら $event = isset($_GET['event']) ? $_GET['event'] : ''; // 取得 } } echo "</table>" ; //結果セットの開放 mysql_free_result ($res) ; //データベースから切断 mysql_close($con) ; ?> </body> </html>
WAMP環境で作ったある情報サイトを運営していますが、下記のようなケースはどのように対応すればよいか教えていただけますでしょうか。 私の運営するサイトではユーザーが情報を登録できるようになっているのですが、入力してもらいたい項目の一つに、ある別サイトAのユーザーIDをいれてもらうのですが、殆どのユーザーはそのIDを記憶していません。 そのAのサイトでは、下記のような文字列がユーザーが比較的取りやすい所から取得できるので、今のところユーザーはそこから部分コピー（もしくは手書きメモ）して対応してくれています。 <a href="http://www.hogehoge.net/honya/rara/987654321?">あいうえお</a> 入力してもらいたいユーザーIDというのはこの、987654321の部分になりますが、ユーザーにストレスをあたえないため、全体コピー、ペーストをしてもらえれば、不要な部分はこっちでカットしてテーブルに収めたいとおもっています。（スマホユーザーには、部分コピーはめんどくさいと思うので） SUBSTRINGを使うのかな、とおもいましたが、どのように書き込めば良いのか一度上級者の方に教えて頂きたい次第です。 また、将来このユーザーIDに英字が混じった場合や、桁数が変わった場合の対処についても考え方を教えていただけますと幸いです。 初級者で恐縮ですがよろしくおねがいします。
MySQLでデータの表示を行っています 10件ずつ表示し、１１件からは２ページ目に表示したいです サイトや本を見ながらデータ表示と次の10件のリンクは表示されるよう自力で頑張ったのですが 次の１０件を押してもデータが変わらず１件目から１０件目のままです どこが違うか教えてもらえますか。 どうコードを入力するか教えてくれたらありがたいです 一覧　ta2.phpです <html> <body> <form action = "ta2.php" method="GET"> <input type="hidden" name="page" value="0"> </form> <?php //データベースに接続 if (!$con = mysql_connect("localhost", "root", "admin")) { echo "接続エラー" ; exit ; } //データベースを選択 if (!mysql_select_db("db_test", $con)) { echo "データベース選択エラー" ; exit ; } //LIMITを使ったSELECT文を作成 $sql = "select * from tbl_test" ; $sql.= " limit " . $page*10 . ", 10" ; //SQL実行 if (!$res = mysql_query($sql)) { echo "SQLエラー<BR>" ; exit ; } //検索結果表示 echo "<table border='1'> <tr> <th>番号</th> <th>氏名</th> <th>住所</th> <th>操作</th> </tr>"; while($row = mysql_fetch_array($res)) { $ID = htmlspecialchars($row['番号']); $NAME = htmlspecialchars($row['氏名']); $ADDR = htmlspecialchars($row['住所']); echo "<tr> <td>$ID</td> <td>$NAME</td> <td>$ADDR</td> <td><a href='edit.php?番号=$ID'>修正</a> <a href='delete.php?番号=$ID'>削除</a></td></tr>"; header('content-type: text/html; charset="utf-8"'); if ($_GET) { // データがGETされていたら $page = isset($_GET['page']) ? $_GET['page'] : ''; // 取得 } } $sql = "select count(*) from tbl_test " ; if (!$res = mysql_query($sql)) { echo "SQLエラー<BR>" ; exit ; } $row = mysql_fetch_array($res) ; $cnt = $row[0] ; //ページ表示 if(!$cnt > 10) echo ceil($cnt / 10), "ページの中の", $page + 1, "ページ目を表示<br>" ; //前の10件 if ($page != 0) { echo "<a href = ta2.php?page= $page>" ; echo "&lt 前の10件" ; } //次の10件 if (($page + 1)*10 < $cnt) { echo "<a href = ta2.php?page= $page>" ; echo " 次の10件 " ; } //結果セットの開放 mysql_free_result ($res) ; //データベースから切断 mysql_close($con) ; ?> </table> </body> </html>
お世話になります。 前回立てたトピック（http://okwave.jp/qa/q8565634.html）でサンプルデータにミスがあったため、立て直しです。 ※顧客＆商品ごとの本申込という文字列が含まれる最新データを取得したい ※商品名の長さは変動します（商品名には実際は番号はありません） ※MySQL5です。 どうぞお知恵をお貸しください。 ■テーブルデータ CREATE TABLE IF NOT EXISTS `TABLE1` ( `SEQ_ID` mediumint(8) NOT NULL AUTO_INCREMENT COMMENT 'シーケンスID', `TO_USER_NM` varchar(128) DEFAULT NULL COMMENT '顧客', `MAIL_TITLE` varchar(256) DEFAULT NULL COMMENT '商品', `SEND_TIME` datetime NOT NULL COMMENT '購入日時', PRIMARY KEY (`SEQ_ID`) ); INSERT INTO `TABLE1` (`SEQ_ID`, `TO_USER_NM`, `MAIL_TITLE`, `SEND_TIME`) VALUES (1 , '顧客A', '『商品1』仮申込', '2014-03-01 13:07:43'), (2 , '顧客C', '『商品1』仮申込 / 変更1', '2014-03-02 10:06:54'), (3 , '顧客E', '『商品1』仮申込', '2014-03-03 10:06:54'), (4 , '顧客E', '『商品1』本申込', '2014-03-04 13:33:51'), (5 , '顧客B', '『商品1』本申込', '2014-03-05 14:58:41'), (6 , '顧客A', '『商品1』本申込 / 変更1', '2014-03-06 16:42:56'), (7 , '顧客D', '『商品1』本申込 / 変更2', '2014-03-07 17:27:33'), (8 , '顧客C', '『商品1』本申込 / 変更1', '2014-03-08 13:56:29'), (9 , '顧客A', '『商品2』仮申込', '2014-03-09 18:44:05'), (10, '顧客A', '『商品2』仮申込 / 変更1', '2014-03-10 10:43:14'), (11, '顧客C', '『商品1』本申込 / 変更2', '2014-03-11 08:51:02'), (12, '顧客C', '『商品1』本申込 / 変更3', '2014-03-12 20:33:39'), (13, '顧客A', '『商品2』本申込', '2014-03-14 18:52:44'), (14, '顧客B', '『商品1』仮申込', '2014-03-15 16:13:47'), (15, '顧客B', '『商品1』本申込 / 変更3', '2014-03-16 21:07:35'), (16, '顧客B', '『商品1』本申込 / 変更4', '2014-03-18 21:07:34'), (17, '顧客B', '『商品3』仮申込', '2014-03-19 21:42:46'), (18, '顧客B', '『商品3』本申込', '2014-03-20 22:14:10'), (19, '顧客A', '『商品2』本申込 / 変更1', '2014-03-21 23:44:06'), (20, '顧客A', '『商品1』本申込 / 変更5', '2014-03-22 08:22:59'), (21, '顧客A', '『商品2』仮申込', '2014-04-01 13:07:43'), (22, '顧客A', '『商品2』本申込 / 変更2', '2014-04-02 10:06:54'), (23, '顧客B', '『商品2』仮申込', '2014-04-03 10:06:54'), (24, '顧客B', '『商品2』仮申込 / 変更1', '2014-04-04 13:33:51'), (25, '顧客B', '『商品2』本申込', '2014-04-05 14:58:41'), (26, '顧客F', '『商品1』仮申込', '2014-04-06 16:42:56'), (27, '顧客F', '『商品1』本申込', '2014-04-07 17:27:33'), (28, '顧客G', '『商品3』仮申込', '2014-04-08 13:56:29'), (29, '顧客F', '『商品1』本申込 / 変更1', '2014-04-09 18:44:05'), (30, '顧客G', '『商品3』本申込', '2014-04-10 10:43:14'), (31, '顧客A', '『商品1』本申込 / 変更6', '2014-04-11 08:51:02'), (32, '顧客A', '『商品2』本申込 / 変更3', '2014-04-12 20:33:39'), (33, '顧客F', '『商品1』本申込 / 変更2', '2014-04-14 18:52:44'), (34, '顧客C', '『商品3』仮申込', '2014-04-15 16:13:47'), (35, '顧客C', '『商品3』本申込', '2014-04-16 21:07:35'), (36, '顧客H', '『商品1』仮申込', '2014-04-18 21:07:34'), (37, '顧客H', '『商品1』本申込', '2014-04-19 21:42:46'), (38, '顧客H', '『商品1』本申込 / 変更1', '2014-04-20 22:14:10'), (39, '顧客E', '『商品2』仮申込', '2014-04-21 23:44:06'), (40, '顧客E', '『商品2』仮申込 / 変更1', '2014-04-22 08:22:59'); ■取得したいデータ 38, '顧客H', '『商品1』本申込 / 変更1', '2014-04-20 22:14:10' 35, '顧客C', '『商品3』本申込', '2014-04-16 21:07:35' 33, '顧客F', '『商品1』本申込 / 変更2', '2014-04-14 18:52:44' 32, '顧客A', '『商品2』本申込 / 変更3', '2014-04-12 20:33:39' 31, '顧客A', '『商品1』本申込 / 変更6', '2014-04-11 08:51:02' 30, '顧客G', '『商品3』本申込', '2014-04-10 10:43:14' 25, '顧客B', '『商品2』本申込', '2014-04-05 14:58:41' 18, '顧客B', '『商品3』本申込', '2014-03-20 22:14:10' 16, '顧客B', '『商品1』本申込 / 変更4' '2014-03-18 21:07:34' 12, '顧客C', '『商品1』本申込 / 変更3' '2014-03-12 20:33:39' 7 , '顧客D', '『商品1』本申込 / 変更2' '2014-03-07 17:27:33' 4 , '顧客E', '『商品1』本申込', '2014-03-04 13:33:51'
先ほども質問したのですが再度質問させていただきます mysql limitページ分割を行っていてエラーは消せたのですが今度 SQLエラーになり出来ません 前の人が質問したのを参考にしてつくったのですがうまくいかず困っています 検索結果を10件ずつ表示して googleみたいに 1l 2l 3 みたいな感じやりたいです <body> <?php error_reporting(E_ALL ^ E_NOTICE); //データベースに接続 if (!$con = mysql_connect("localhost", "root", "admin")) { echo "接続エラー" ; exit ; } //データベースを選択 if (!mysql_select_db("db_test", $con)) { echo "データベース選択エラー" ; exit ; } //LIMITを使ったSELECT文を作成 $sql = "select * from tbl_test where (氏名 LIKE '%{$_GET['name']}%') or (住所 LIKE '%{$_GET['name']}%')"; $sql = "limit" . $page * 10 . ", 10" ; //SQL実行 if (!$res = mysql_query($sql)) { echo "SQLエラー<BR>" ; exit ; } //検索結果表示 echo "<table border=1>" ; echo "<tr> <th>番号</th> <th>氏名</th> <th>住所</th> <th>操作</th> </tr>" ; while($row = mysql_fetch_array($res)){ $ID = htmlspecialchars($row['番号']); $NAME = htmlspecialchars($row['氏名']); $ADDR = htmlspecialchars($row['住所']); echo "<tr> <td>$ID</td> <td>$NAME</td> <td>$ADDR</td> <td><a href='edit.php?番号=$ID'>修正</a> <a href='delete.php?番号=$ID'>削除</a></td> </tr>"; //検索条件に該当する全データの件数取得 $sql = "select count(*) from tbl_test " ; $sql = "where (氏名 LIKE '%{$_POST['name']}%') or (住所 LIKE '%{$_POST['name']}%')"; if (!$res = mysql_query($sql)) { echo "SQLエラー<BR>" ; exit ; } $row = mysql_fetch_array($res) ; $cnt = $row[0] ; //ページ表示 if(!$cnt > 10) echo ceil($cnt / 10), "ページの中の", $page + 1, "ページ目を表示<br>" ; //前の10件 if ($page_num != 0) { echo "<a href = find.php?name=".$name. ". $page -1.>" ; echo "&lt 前の10件"; } //次の10件 if (($page_num + 1)*10 < $cnt) { echo "<a href = find.php?name=".$name. ". $page +1.>" ; echo " 次の10件 &g</a>t" ; } //結果セットの開放 mysql_free_result ($res) ; //データベースから切断 mysql_close($con) ; } ?> </body> </html>
前の人が質問したのを参考にしてつくったのですがうまくいかず困っています 検索結果を10件ずつ表示して googleみたいに 1l 2l 3 みたいな感じやりたいです <html> <body> <?php //データベースに接続 if (!$con = mysql_connect("localhost", "root", "admin")) { echo "接続エラー" ; exit ; } //データベースを選択 if (!mysql_select_db("db_test", $con)) { echo "データベース選択エラー" ; exit ; } //LIMITを使ったSELECT文を作成 $sql = "select * from tbl_test where (氏名 LIKE '%{$_POST['name']}%') or (住所 LIKE '%{$_POST['name']}%')"; $sql = "limit" . $page_num*10 . ", 10" ; //SQL実行 if (!$res = mysql_query($sql)) { echo "SQLエラー<BR>" ; exit ; } //検索結果表示 echo "<table border=1>" ; echo "<tr> <th>番号</th> <th>氏名</th> <th>住所</th> <th>操作</th> </tr>" ; while($row = mysql_fetch_array($res)){ $ID = htmlspecialchars($row['番号']); $NAME = htmlspecialchars($row['氏名']); $ADDR = htmlspecialchars($row['住所']); echo "<tr> <td>$ID</td> <td>$NAME</td> <td>$ADDR</td> <td><a href='edit.php?番号=$ID'>修正</a> <a href='delete.php?番号=$ID'>削除</a></td> </tr>"; //検索条件に該当する全データの件数取得 $sql = "select count(*) from tbl_test " ; $sql = "where (氏名 LIKE '%{$_POST['name']}%') or (住所 LIKE '%{$_POST['name']}%')"; if (!$res = mysql_query($sql)) { echo "SQLエラー<BR>" ; exit ; } $row = mysql_fetch_array($res) ; $cnt = $row[0] ; //ページ表示 if(!$cnt > 10) echo ceil($cnt / 10), "ページの中の", $page_num + 1, "ページ目を表示<br>" ; //前の10件 if ($page_num != 0) { echo "<a href = find.php?name=",$name, ", $page_num -1.">" ; echo "&lt 前の10件"; } //次の10件 if (($page_num + 1)*10 < $cnt) { echo "<a href = find.php?name=",$name, ", $page_num +1.">" ; echo " 次の10件 &g</a>t" ; } //結果セットの開放 mysql_free_result ($res) ; //データベースから切断 mysql_close($con) ; ?> </body> </html> Parse error: syntax error, unexpected '前の10件' (T_STRING), expecting ',' or ';' というエラーが出て自分なりにバグを消しているのですがまだエラーが消えずに困っています
こんにちは質問させてください。 商品が登録されているテーブル A に以下のカラムがあるとします。 id(int),　　name(varcahr),　　dt(datetime) id　　　には 店を識別す固有の番号がふってあり、 name　には 商品名、　 dt　　　には商品を登録した日付が入っているものとします。 やりたいことは ”id が 「１」 である全商品数” と ”今月登録された商品の数” を出力したいのです。 id が 1 である商品の数は以下のSQLで取り出せます。 SELECT　COUNT(*)　FROM 　(　SELECT　*　FROM　A　WHERE　A.id='1'　)　AS tbl1 id が 1 で 今月登録された商品の数は以下のSQLで取り出せます。 SELECT　COUNT(*)　FROM 　(　SELECT　*　FROM　A　 　　 WHERE　A.dt　BETWEEN　DATE(　 　　　　　DATE_SUB(　NOW(),　INTERVAL　DAYOFMONTH(　NOW()　)-1　DAY)　) AND 　　　　　LAST_DAY(　NOW()　)　AND　A.id='1'　)　AS　tbl1 これをひとつのSQLにまとめるにはどうしたらいいのでしょうか…。 宜しくお願い致します。
お世話になります。 以下のテーブル1からサンプル1のようなデータを抽出したいのですが、SQLはどのように書いたらよいでしょうか。 ・顧客と商品ごとに購入日時が最新のデータを取得 ・商品は左側の番号が同じ場合は購入日が最新のデータのみ抽出したい データベースは　MySQL5　です。 よろしくお願いいたします。 ●テーブル1 顧客　　商品　　購入日時 --------------------------------- 　A　　2-2　　2014-04-23 08-00-00 　A　　2-1　　2014-04-21 08-00-00 　B　　2-3　　2014-04-20 09-00-00 　B　　2-2　　2014-04-18 06-00-00 　B　　2-1　　2014-04-15 05-00-00 　A　　1-3　　2014-04-12 08-00-00 　A　　1-2　　2014-04-10 04-00-00 　C　　2-2　　2014-04-09 05-00-00 　C　　2-1　　2014-04-08 06-00-00 　C　　1-2　　2014-04-07 08-00-00 　C　　1-1　　2014-04-06 05-00-00 　A　　1-1　　2014-04-05 02-00-00 　B　　1-2　　2014-04-04 02-00-00 　B　　1-1　　2014-04-03 01-00-00 ●サンプル1 顧客　　商品　　購入日時 --------------------------------- 　A　　2-2　　2014-04-23 08-00-00 　B　　2-3　　2014-04-20 09-00-00 　A　　1-3　　2014-04-12 08-00-00 　C　　2-2　　2014-04-09 05-00-00 　C　　1-2　　2014-04-07 08-00-00 　B　　1-2　　2014-04-04 02-00-00
PHPでデータの登録を行っています いろいろ調べながら試行錯誤しています 登録できる条件があります 1.番号が重複じゃない 2.番号、氏名、住所が空白でない場合です 現状 1.2両方できていてデータも追加されるのですが、 ２の条件、空白だった場合エラーメッセージを表示したいのですが表示されず困っています <?php $err = ""; if(empty($_POST['ID'])) $err.= "<br><br>番号入力してください。<br><br>"; if(empty($_POST['NAME'])) $err.= "<br><br>氏名入力してください。<br><br>"; if(empty($_POST['ADDR'])) $err.= "<br><br>住所を入力してください。<br><br>"; if(empty($err)) { $pdo = new PDO("mysql:dbname=db_test;host=localhost", "root", "****"); $st = $pdo->prepare("INSERT INTO tbl_test VALUES(?,?,?)"); $st->execute(array($_POST['ID'], $_POST['NAME'],$_POST['ADDR'])); if($st->rowCount()>0) { header('Location: http://localhost/top.php'); }else{ print "既に登録している番号です"; } echo $err; } ?> 重複したときは"既に登録している番号です"と表示されるのですが、空白だった場合$errが表示されません
以下のSQL文を実行すると CREATE TABLE if not exists table_A ( idint(11) not null auto_increment, company_idint(11) not null, created_atdatetime NOT NULL, updated_attimestamp NOT NULL, PRIMARY KEY (id) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci; CREATE TABLE if not exists table_B ( idint(11) not null auto_increment, from_idint(11) not null, company_idint(11) not null, created_atdatetime NOT NULL, updated_attimestamp NOT NULL, PRIMARY KEY (id) FOREIGN KEY (from_id) REFERENCES table_A(id) ON DELETE CASCADE ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci; 上記を実行すると以下のエラーがでます。 #1064 - You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'FOREIGN KEY (from_id) REFERENCES table_A(id) ON DELETE CASCADE ) ENGINE=Inn' at line 8 解決方法をご存知の方はご教示頂けますと幸いです。 宜しくお願いいたします。
MySQLのトリガで次のようなコーディングを行いましたが、エラーが発生して、動作しません。 ------------------------------------------------------------------------------------------------- begin UPDATE テーブルA SET テーブルAカラムX = 値, テーブルAカラムY = 値, CASE WHEN テーブルAカラムZ = 1 THEN テーブルAカラムR = 1 WHEN テーブルAカラムZ = 2 THEN テーブルAカラムR = 2 END; end -------------------------------------------------------------------- ENDをEND CASEにしたり消したり、;を色々な位置につけたり消したりしましたが、エラーが発生します。 ストアドの方でselect文中にif文やcase文を入れましたが、エラーが発生します。 大変困っております。 ご協力をお願い致します。 各バージョンは最新バージョンとします。
データの新規登録を行っているのですが 番号が重複しないでまたデータがすべて入力されたらデータの追加を行いたいのですが エラーが出て対処できずに困っています 下記のエラーがでます Parse error: syntax error, unexpected end of file in C:\WWW\test\htdoes\insert.php on line 20 20行目は一番下の行です <html> <body> <?php $pdo = new PDO("mysql:dbname=db_test;host=localhost", "root", "admin"); if($st->rowCount()>0){ if ($_POST['ID'] != '' && $_POST['NAME'] != '' && $_POST['ADDR'] != ''){ $st = $pdo->prepare("insert ignore into tbl_test values(?,?,?)"); $st->execute(array($_POST['ID'], $_POST['NAME'],$_POST['ADDR'])); header('Location: http://localhost/top.php'); }else{ print データ未入力の場所があります; } }else{ print "既に登録している番号です"; ?> </body> </html>
tbl_aとtbl_bから、tbl_cを作りたいのですが どのようなsql文を書けば良いでしょうか？ アドバイス頂けると嬉しいです。よろしくお願い致します。 テーブル：tbl_a ----------------- code1,code2,name ----------------- 001,a,あ 002,a,あ 003,a,あ 004,a,あ 005,b,い 006,b,い 007,b,い 008,c,う 009,c,う 010,c,う 011,c,う 012,d,え 013,d,え 014,d,え テーブル：tbl_b ----------------- code1,point ----------------- 003,10 004,2 008,10 009,5 011,20 テーブル：tbl_c ----------------- code2,name,point ----------------- a,あ,2 b,い, c,う,5 d,え,
３つのテーブルを連携した並び替えのSELECT文について教えて下さい。 例えば次の3つのテーブルがあるとします。 COOK_TBL ---------------- COOK_NAME パスタ パスタ グラタン オムライス グラタン カレー ZAIRYO_TBL --------------- COOK_NAME ZAIRYO_NAME グラタン　 鶏肉 オムライス 卵 オムライス 玉ねぎ パスタ　　 卵 パスタ　　 麺 COOK_KIOKU_TBL --------------- COOK_NAME オムライス グラタン COOK_TBLのCOOK_NAMEでグルーピングしたものに対し、ZAIRYO_TBLのCOOK_NAMEに存在するものは全て抽出し、 COOK_KIOKU_TBLのCOOK_NAMEとCOOK_TBLのCOOK_NAMEと一致するレコードは頭の方（COOK_KIOKU_TBLのCOOK_NAMEのレコード順）に並び替えられるようにしたいです。 得たい結果は次の通りです。 COOK_TBL ------------- COOK_NAME オムライス グラタン パスタ どうしても分かりません。 助けて下さい。 os: windows 7 eclipse: Version: 4.2.0
すいません1つ質問があります。 こちらのサイトでCSVのファイルのインポート方法を勉強していますが、下記の方法だとあらかじめ、データベースが格納されているフォルダにCSVを置いてある前提でこのやり方をやります。 LOAD DATA INFILE "T01Prefecture.csv" INTO TABLE T01Prefecture FIELDS TERMINATED BY "," LINES TERMINATED BY "\r\n"; 僕が知りたいのは、例えば、 C:\Users\Ken\Desktop\T01Prefecture.csv ここに置いてあるCSVを指定してインポートしたいと考えています。 そのやり方がどうもこのパスを書くだけでは出来ないです。 どなたかやり方を教えて頂けますか？ 僕が書いたのは下記の通りです。 LOAD DATA INFILE "C:\Users\Ken\Desktop\T01Prefecture.csv" INTO TABLE T01Prefecture FIELDS TERMINATED BY "," LINES TERMINATED BY "\r\n"; よろしくお願いいたします。
入力フォームに入力された番号が登録されてなかったら新規登録できるようにしたい INSEPT IGNORE INTOで主キーを無視するのではなく重複したらエラーメッセージを出しユーザにもう一度入力させるようにする 新規登録フォーム <html> <head><title>新規登録</title></head> <body> <blockquote> <form action = "insert.php" method = "POST"> <br><br>登録画面<br><br> すべての項目入力してください<br> 番号<input type="number" name = "ID"> (一覧画面にない番号を入力してください) <br> <br>氏名<input type="text" size = "50" name = "NAME"><br><br> 住所<input type="text" size = "130" name = "ADDR"><br><br> <a href="http://localhost/top.php"> <input type = "submit" value = "登録する" style ="font-size:20px; width: 100px; height: 40px"></A> <a href="http://localhost/top.php"> <input type = "button" value = "一覧に戻る" style ="font-size:20px; width: 100px; height: 40px"></A> </body> </blockquote> </form> </body> </html> 登録を実行するフォーム <?php $con=mysqli_connect("localhost","root","admin","db_test"); // Check connection if (mysqli_connect_errno()) { echo "Failed to connect to MySQL: " . mysqli_connect_error(); } if ($_POST['ID'] != '' && $_POST['NAME'] != '' && $_POST['ADDR'] != '') { $id = mysqli_real_escape_string($con, $_POST['ID']); $name = mysqli_real_escape_string($con, $_POST['NAME']); $addr = mysqli_real_escape_string($con, $_POST['ADDR']); $sql="INSERT INTO tbl_test (番号, 氏名, 住所) VALUES ('$id','$name','$addr')"; if (!mysqli_query($con,$sql)) { die('Error: ' . mysqli_error($con)); } header('Location: http://localhost/top.php'); exit(); } else { ?> <html> <body> <blockquote> <br><br>データが未入力の箇所があります。すべてデータを入力してください <br><br><br> <a href="http://localhost/regist.php"> <INPUT TYPE = "button" VALUE = "登録画面に戻る" style ="font-size:20px; width: 140px; height: 40px"></A> <br><br><br> <A HREF="http://localhost/top.php"> <INPUT TYPE = "button" VALUE = "一覧に戻る" style ="font-size:20px; width: 140px; height: 40px"></A> </blockquote> </body> </html> <?php } mysqli_close($con); ?> どういう風にselect文を書けばいですか？
「ストアドファンクションの再帰呼び出し」はできないのでしょうか。 hoge関数をhoge関数の中で呼び出しています。 hoge関数では、条件に当てはまらないと第三引数を、 編集して再帰呼出しをしています。 再帰呼出しする条件を引数に設定して実行すると、以下の実行結果(ERROR)が表示されます。 ＜実行結果＞ mysql> select hoge('7','1234','1234567891012'); ERROR 1424 (HY000): Recursive stored functions and triggers are not allowed. よろしくお願いします。
番号　int プライマリーキ- 氏名　varchar 住所 varchar データベースで入力フォームから新規登録をしたいのですが Duplicate entry '11' for key 'PRIMARY' 11はすでに存在していると出ます オートナンバー型に変えずに"すでに登録されている番号です"というエラーメッセージを出し、もう一度登録画面に戻るしたいのですが、 try文で例外処理させれば出来ますか？ また出来るのであればどういう風に記述するか教えてもらえますか？
初めての質問になります。 以下のようなテーブルで、dataカラムにカンマ区切りのデータを保存しているのですが、こちらはgroup byやcount等を使ってSQL一発で集計結果を取得できるのでしょうか？ SELECT count(*) FROM TEST WHERE FIND_IN_SET('1', data)で1から順番に取得は出来るのですが、数が多いとちょっといかがなものかと思い、質問させていただきました。 環境：mysql5.5 ------------ ｜data ------------ ｜1,2,3 ------------ ｜1,2,10 ------------ ｜1,2,3,10 ------------ 期待する結果は以下のような感じです。 1｜3 --------- 2｜3 --------- 3｜2 --------- 10｜2
MySqlバージョン：5.1.61で、下記のSQLを実行すると、 １件しかデータが無いにも関わらず、EXPLAINの結果で 「Extra: Using where; Using filesort」が発生します。 ---------------- CREATE TABLE IF NOT EXISTS tbl ( user int(11) NOT NULL, item int(11) NOT NULL, prm1 int(11) NOT NULL, prm2 int(11) NOT NULL, prm3 int(11) NOT NULL, PRIMARY KEY (user,item) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO tbl (user,item,prm1,prm2,prm3) VALUES (1,1,10,10,10); EXPLAIN SELECT * FROM tbl WHERE user=1 ORDER BY prm1; EXPLAIN SELECT * FROM tbl WHERE user=1 ORDER BY prm2; EXPLAIN SELECT * FROM tbl WHERE user=1 ORDER BY prm3; ---------------- ORDER BY句で使用する項目(prm[n])は10項目以上になりますので 10件を超える複合インデックスを張る事は避けたいと考えております。 また、tbl全体のデータは1億件、1userあたり100～200件を想定しています。 複合インデックスを使用せず「Using filesort」を 発生させなくする事はできるのでしょうか？
以下の通りストアドファンクションを作成しました。 関数名：fgetLineNew インパラメータ：shop　Varchar 8 ※1つだけ。。。 戻り値： Int 11 ＜ソース＞ BEGIN DECLARE pline INTEGER(11) DEFAULT NULL; SELECT COUNT(1) INTO pline FROM `hoge` WHERE `SHOP` = shop; IF pline IS NULL THEN SET pline = 10000; END IF; RETURN pline; END 上記のように、作成したストアドファンクションですが、 どんな引数を入れても、戻り値が全ての行(817行)になってしまいます。 以下を参照。 Where区がまったく働いていないのですが、何が原因なのでしょうか。 教えてください。 ＜ストアドファンクション実行＞ mysql> select fgetLineNew(1); +----------------+ | fgetLineNew(1) | +----------------+ | 817 | +----------------+ 1 row in set (0.01 sec) mysql> select fgetLineNew(525); +------------------+ | fgetLineNew(525) | +------------------+ | 817 | +------------------+ 1 row in set (0.01 sec) mysql> select fgetLineNew(101); +------------------+ | fgetLineNew(101) | +------------------+ | 817 | +------------------+ 1 row in set (0.00 sec) mysql> select fgetLineNew(525); +------------------+ | fgetLineNew(525) | +------------------+ | 817 | +------------------+ 1 row in set (0.00 sec) mysql> select fgetLineNew('525'); +--------------------+ | fgetLineNew('525') | +--------------------+ | 817 | +--------------------+ 1 row in set (0.01 sec)
一覧画面に更新ボタンを作成しました 更新ボタンを押すとkoushin_input.phpにデータを渡し入力フォームを表示され番号、氏名、住所が選択されたデータが表示されるようにしたいのでが更新ボタンを押しても下記のように出ます string(64) "SELECT `番号`,`氏名`,`住所` FROM tbl_test where `番号`=0" bool(false) データが削除されています ソースコードはtop.php 一覧画面です <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <title>一覧画面</title> </head> <body> <BLOCKQUOTE> <BR>一覧画面<BR><BR> <?php $con=mysqli_connect("localhost","root","admin","db_test"); if(isset($_GET["del"]) and isset($_GET["id"]) and $_GET["del"]==1){ $id=(int) $_GET["id"]; $result = mysqli_query($con,"DELETE FROM tbl_test where `番号`={$id}"); } // Check connection if (mysqli_connect_errno()) { echo "Failed to connect to MySQL: " . mysqli_connect_error(); } $result = mysqli_query($con,"SELECT * FROM tbl_test"); echo "<table border='1'> <tr> <th>番号</th> <th>氏名</th> <th>住所</th> </tr>"; while($row = mysqli_fetch_array($result)) { echo "<tr>"; echo "<td>" . $row['番号'] . "</td>"; echo "<td>" . $row['氏名'] . "</td>"; echo "<td>" . $row['住所'] . "</td>"; echo "<form action=koushin_input.php method=get>"; echo "<td><input type=submit value=更新></td>"; echo "</form>"; echo "<td><a href=\"".$_SERVER["SCRIPT_NAME"]."?del=1&amp;id=".$row['番号']."\">削除</a></td>"; echo "</tr>"; } echo "</table>"; mysqli_close($con); ?> <BR><BR><BR> <A HREF="http://localhost/regist.php"> <INPUT TYPE = "SUBMIT" VALUE = "新規登録"></A> </BLOCKQUOTE> </body> </html> 受け取る側 koushin_input.phpです <html> <body> <?php // データベースに接続 if(!$con=mysql_connect("localhost","root","admin")){ echo"接続エラー"; exit; } // データベースを選択 if(!mysql_select_db("db_test",$con)){ echo"データベース選択エラー"; exit; } // SELECT文を実行 $id=(isset($_GET["id"]))?((int) $_GET["id"]):0; $sql = "SELECT `番号`,`氏名`,`住所` FROM tbl_test where `番号`={$id}"; var_dump($sql); if(!$res=mysql_query($sql)){ echo "SQL実行時エラー"; exit; } // データの存在チェック if(!$row=mysql_fetch_array($res)){ $row=mysql_fetch_array($res); var_dump($row); echo "データが削除されています"; exit; } // 入力画面の出力 echo "<form action=koushin.php method=post>"; echo "名前：<input type=text name=NAME value=\"" . $row['氏名'] . "\"> "; echo "住所：<input type=text name=ADDR value=" . $row['住所'] . "> "; echo "<input type=submit value=更新>"; echo "</form>"; // 結果セットの解放 mysql_free_result($res); // データベースから切断 mysql_close($con); ?> </body> </html> どこが原因なんでしょうか?
一覧画面に更新、削除というボタンをつくり番号を受け取って削除したいのですが、削除ボタンを押しても画面は変わるのですが削除されません 助けてください 番号　int プライマリーキー 氏名 varchar 住所 varchar 一覧画面のソース <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <title>一覧画面</title> </head> <body> <BLOCKQUOTE> <BR>一覧画面<BR><BR> <?php $con=mysqli_connect("localhost","root","admin","db_test"); // Check connection if (mysqli_connect_errno()) { echo "Failed to connect to MySQL: " . mysqli_connect_error(); } $result = mysqli_query($con,"SELECT * FROM tbl_test"); echo "<table border='1'> <tr> <th>番号</th> <th>氏名</th> <th>住所</th> </tr>"; while($row = mysqli_fetch_array($result)) { echo "<tr>"; echo "<td>" . $row['番号'] . "</td>"; echo "<td>" . $row['氏名'] . "</td>"; echo "<td>" . $row['住所'] . "</td>"; echo "<form action=koushin_input.php method=post>"; echo "<td><input type=submit value=更新></td>"; echo "</form>"; echo "<form action=sakujo.php method=post>"; echo "<td><input type=submit value=削除></td>"; echo "</form>"; echo "</tr>"; } echo "</table>"; mysqli_close($con); ?> <BR><BR><BR> <A HREF="http://localhost/regist.php"> <INPUT TYPE = "SUBMIT" VALUE = "新規登録"></A> </BLOCKQUOTE> </body> </html> 削除ソース　 sakujo.php <html> <body> <? // データベースに接続 if(!$con=mysql_connect("localhost","root","admin")){ echo"接続エラー"; exit; } // データベースを選択 if(!mysql_select_db("db_test",$con)){ echo"データベース選択エラー"; exit; } // DELETE文を実行 $sql = "delete from tbl_test where '番号'= 番号; if(!$res=mysql_query($sql)){ echo "SQL実行時エラー"; exit; } // データベースから切断 mysql_close($con); // 登録完了メッセージの表示 echo "削除完了"; ?> </body> </html> どういう風にpostで渡せばいいですか？
○質問の主旨 MySQLのデータベースにテーブルを作ってinsert文で データを追加しようとするとシンタックスエラーが出ます。 SQL文が間違っているのかと思いGoogle検索や本で調べたりしましたが、 なぜ文法エラーが発生するのか分かりません。 エラーと対処方法をご存知の方がいらっしゃいましたらご教示願います。 ○質問の補足 // usersテーブル create table users ( id int not null auto_increment primary key, created datetime not null, modified datetime not null, username varchar(255), password varchar(40) ); desc users; +----------+--------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +----------+--------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | created | datetime | NO | | NULL | | | modified | datetime | NO | | NULL | | | username | varchar(255) | YES | | NULL | | | password | varchar(40) | YES | | NULL | | +----------+--------------+------+-----+---------+----------------+ insert into users (created, modified, username, password) values (now(), now(), 'test1', 'test1'), (now(), now(), 'test2', 'test2') ); ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')' at line 3
データベースのテーブル内容をサーバー上にcsv出力すると同時に出力した内容を配列で取得できないでしょうか？（PDOを利用しています） $sql= "SELECT id, name FROM tb INTO OUTFILE '/tmp.csv'"; $stmt = $dbh->query($sql); これでcsvは出力されるのですが、csv出力した内容を配列で取得したく、 $array = $stmt->fetchAll(PDO::FETCH_ASSOC); をするとGeneral Errorとなります。 先にSELECTで内容を配列で取得してから配列のループでcsvの内容を作成し、出力する方法もありますが、データ量が数十万件あるのでループ処理が遅い気がしています。 良い方法があればお教えください。 よろしくお願い致します。
MySQLの複合インデックスに関して質問させて頂きます。 現在検索条件に3つのカラムを使用して検索をかけているSELECT文があります。 データの件数は100万件ほどあるとします。 【例】 「SELECT * FROM test WHERE a = '1' AND b = 'xxxxx' AND c = '1';」 カラム「a」「c」は、0と1のみが格納されたカラムで、頻繁に更新されます。 カラム「b」は、同じ値が入ることがありますが、ほぼユニークな文字列が格納されます。 上記のような場合、インデックスは ・「a,b,c」の全てを設定した複合インデックスを作成するべきか。 ・cは頻繁に更新されるので、「a,b」のみの複合インデックスを作成するべきか。 ・aも同じく頻繁に更新されるので、WHERE句の検索順をbを先に持ってきて、「b」のみの単独インデックスを作成するべきか。 一概にこうだという答えは無いかもしれませんが、何か良い方法があれば教えて頂けると幸いです。 また、質問に不備な点がございましたら、ご指摘お願いいたします。
いま下記のソースで一覧画面が表示されます！ 氏名をクリックしたら別ウインドウで詳細画面を表示させたいのですがやり方がわかりません 参考までに教えてください <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <title>一覧画面</title> </head> <body> <BLOCKQUOTE> <BR>一覧画面<BR><BR> <?php $con=mysqli_connect("localhost","root","password","db_test"); // Check connection if (mysqli_connect_errno()) { echo "Failed to connect to MySQL: " . mysqli_connect_error(); } $result = mysqli_query($con,"SELECT * FROM tbl_test"); echo "<table border='1'> <tr> <th>番号</th> <th>氏名</th> <th>住所</th> </tr>"; while($row = mysqli_fetch_array($result)) { echo "<tr>"; echo "<td>" . $row['番号'] . "</td>"; echo "<td>" . $row['氏名'] . "</td>"; echo "<td>" . $row['住所'] . "</td>"; echo "</tr>"; } echo "</table>"; mysqli_close($con); ?> <BR><BR><BR> <A HREF="http://localhost/regist.php"> <INPUT TYPE = "SUBMIT" VALUE = "新規登録"></A> </BLOCKQUOTE> </body> </html>
MySQLの文字コードをsetコマンドで変更した後、再度ログインし直すと 元の設定に戻ってしまいます。 他にやるべき作業があるのでしょうか？よろしくお願いします。 mysql -u root show variables like "chara%"; set character_set_server=utf8;　 show variables like "chara%";　←変更されている exit mysql -u root show variables like "chara%";　←元に戻っている version 5.1.73
こんにちは。 今phpとデータベースを勉強中でしてそれを使ったウェブサイトを作りました。 画像とその画像の説明文をいろんな条件で並び替えるサイトです。 プログラム自体はできあがったのですが、文章はデータベースに入れるとして、画像も できたらデータベースに入れたいと思い調べてみると入れる事はできるようです・・。 ただ画像の量が多く最終的には5000枚-10000枚くらいになりそうです。 複数の条件で並び替え→表示とする場合、データベースに画像を入れる場合と、サーバにそのまま置く場合では結果表示速度に差ってでるものなのでしょうか・・。（そのサイトを数十人が一度に並び替えをすると仮定して） どこかのサイトに画像をデータベースに入れるとかなり遅くなるというような事が書いてありました。 事実でしょうか？ 質問の意味が分かりにくいかもしれませんが詳しい方いましたらご回答いただけると助かります。
よろしくお願いいたします。 PostgreSQLの、 CREATE TABLE global_points ( id SERIAL PRIMARY KEY, name VARCHAR(64), location GEOGRAPHY(POINT,4326) ); というSQLの、最後の location GEOGRAPHY(POINT,4326) というところを、MySQLで、実装しようとしているのですが、MySQLにも、地理情報に関する命令はあるようですが、どうすればよいのか見当がつかなく困っています。 どなたか、MySQLでは、こういう風に書くなどのことをご存知の方おられましたら、どんなことでも構いませんので、ご教授願います。
mysql で　 ON DUPLICATE KEY UPDATE 　といれると、 すでに同じプライマリキーのデータが存在した場合アップデートとして 扱われますが、プライマリキーが同じであり、かつ　プラス条件を 課すことはできないのでしょうか？ たとえば、プライマリキーが　５のデータを更新すると すでに、5のデータが存在した場合はアップデートとして扱われるが ただし、ある条件（日付が◯◯日以下等）に反する場合は アップデートも行われない。 というような処理です。
この質問を記事投稿後　やっぱり消したいと思って、消すとします。 この時、サーバーに　「◯◯のアカウントで投稿された◯◯番の記事を削除する」　 というリクエストを送っているのであれば ログインIDはセッション等から読み込むことで書き換えれないでしょうけど 記事番号は POST値やGET値をツール等で書き換えてしまったら 本来消すことのできない記事も消えてしまわないのでしょうか。 つまり　SQLにして UPDATE 　質問テーブル SET 　表示 = 0 WHERE 　アカウントID = 私のID AND 　記事ID = この記事のID←この値を改ざん！ 　 のようなことがおこらないように一般的にどうやって防いでいるのでしょうか？
XamppでインストールしたphpMyAdminには インストールされた初期状態では rootユーザーが最初から３つ登録されています。 1.root ホスト 127.0.0.1 2.root ホスト ::1 3.root ホスト localhost ３つとも削除はできないようになっていますが rootユーザーが３つあるのは それぞれ何か特別な役割があるのでしょうか？ パスワードを設定する場合は それぞれ異なるパスワードを設定することになるのでしょうか？ よろしくお願いいたします。
水平分割（パティショニング/シャーディング）されたテーブルが何十個もあり、それらのテーブルから一気に条件にあうデータを抽出したいです。 このような場合にどのようにSelect文を書けば良いでしょうか？ 自分で作ったものではなく、ただの利用者であるため、分割しないように作り直すなどの根本的な対策はできないです。 なお、使っているDBはMySQLです。
まず、御覧頂きありがとうございます。 早速質問なのですが、 CREATE TABLE `hoge` ( `id` int(8) NOT NULL, `name` varchar(30) NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO `hoge` (`id`, `name`) VALUES (1, 'hogeA'), (2, 'hogeB'), (3, 'hogeC'), (4, 'hogeD'); CREATE TABLE `test` ( `id` int(8) NOT NULL, `name` varchar(30) NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO `test` (`id`, `name`) VALUES (1, 'testA'), (4, 'testD'); という値が入ってるテーブルがあるとします。(長くなってすみません) で、 hoge.id と test.id が重複した場合 test.name を表示させたいです。 期待値としては id,name 1.testA 2,hogeB 3,hogeC 4,testD になります。 業務でJoinを使うようなテーブル構造にそもそもしないというのもあり、クリティカルなSQLコードに不慣れで御知恵を借りたく質問させて頂きました。 よろしくお願いします。
mysql初心者です。 3つのテーブルでスケジュールの仕組みを考えていますが Staff→スタッフデータ id　　name 1　　　田中 Sch1→日付出勤 id　　start_time　　end_time　　date　　flg 1　　　9:00　　　22:30　　　2014-03-17　　　1 Sch2→曜日出勤 id　　start_time　　end_time　　dateW 1　　　9:00　　　22:30　　　1 ※dateWは曜日(0～6) 日付出勤優先なので、なければ曜日出勤を出力します。 たとえば、 田中さん (1)日付登録：2014-03-17（月）　09:00-18:00 (2)曜日登録：1（月）　10:00-19:00 (3)曜日登録：2（火）　09:00-18:00 PHP側でやるなら、 for (一週間分回す) { if (Sch1[date]) { 日付設定出力 }else{ 曜日設定出力 } } 全出力した（日付、曜日）データを一個の配列に入れて、start_timeでソートするかで出力する。。 Mysqlのif文かcase文分でどう書いたらいいですか？ 説明が下手ですが、 どなたかご存知の方がいらっしゃれば是非、ご教授ください。
MySQLで下記SELECTレコードを削除したいと思い、 DELETEへ変えたら文法エラーになります。 SELECT * FROM `piyo` AS a LEFT JOIN `hoge` AS c ON a.`hoge_id` = c.`hoge_id` WHERE c.`x_id` =13 DELETE * FROM `piyo` AS a LEFT JOIN `hoge` AS c ON a.`hoge_id` = c.`hoge_id` WHERE c.`x_id` =13 どう書けば良いでしょうか？
ランキングを作成する、効率の良いSQLを教えて下さい。 MySQLで、以下の状態です。 テーブル名： hoge カラム： id,kbn,name,score,flg,date id…自動 kbn…1～4 name…string score…int flg…bool date…年月日 (1)dateが1週間以内のデータのみ (2)flgがtrueのデータのみ (3)kbn毎に、5レコード取得 (4)順位は、点数が重複している場合は同一の順位をつけSQLで生成しn位のフォーマット (5)6レコード以降に同一スコアのデータがある場合は日付が古い順 (6)scoreは、n点のフォーマット (7)該当データが5レコード存在しなかった場合は、順位だけをセットし他をnull 欲しい結果は、以下の状態です。 kbn,順位,name,score 1 ,1位 ,ホゲ,100点 1 ,2位 ,あい, 85点 1 ,2位 ,かき, 85点 1 ,4位 ,くけ, 70点 1 ,5位 ,さし, 65点 2 ,1位 ,すせ, 99点 2 ,1位 ,たち, 99点 2 ,3位 ,つて, 80点 　　・ 　　・ 　　・ 4 ,4位 ,らり, 10点 null ,5位 ,null, null 以上、よろしくお願い致します。
以下のようなテーブルがあります。 そのテーブルの内容と、そのテーブルのあるカラムの件数を条件にして抽出したいのですが、どのように指定すればよろしいでしょうか？ テーブルA id(int) AUTO_INCREMENT, user_id(varchar), price(int), date(datetime) 表示したい一覧 user_id | date | price A | 2014-03-10 10:00:00 | 2600 B | 2014-03-11 11:00:00 | 2720 A | 2014-03-13 12:00:00 | 2500 C | 2014-03-14 15:00:00 | 2860 B | 2014-03-18 13:00:00 | 2450 A | 2014-03-19 19:00:00 | 2550 ・・・ などのレコードがあった場合、 user_idが同じ場合のレコード数が2～5の場合等を抽出したいと思います。 うまく表現できませんが、このような場合の抽出の仕方をわかる方、よろしくお願いします。
質問させて頂きます。 PHPとMySQLを使用して、ユニークな値(10桁ほどの英数文字列)を持ったデータを、DBに大量に登録したいと考えています。1度に1万件ほどを想定しています。 その場合、 先に大量のデータを作成して、1件ずつユニークかのチェック→DBに登録(insert)といった方法や、 1件データを作成→ユニークチェック→DBに登録(insert)を繰り返す方法などあると思うのですが、 どのような方法が比較的DBに負荷をかけずに短い時間で行なうことが出来るでしょうか。 質問が大雑把になってしまい申し訳ありません。 自分なりに調べてはみたのですが、確認したサイトなどによって方法がバラバラでしたので、こちらで質問させて頂きました。 処理以外の部分でも、テーブルやカラムにこういった設定を行なうと良いなど、どのような情報でもよろしいので、ご教授頂けると幸いです。 また、上記の質問内容に不備な点がございましたら、申し訳ございません。 ご存じの方がいらっしゃいましたら、よろしくお願いいたします。
WKテーブルにカラム ID(PK), POSTNO, DATA, FLAGがあります。 POSTID毎にIDで小さい順に並べて2件以上の行にFLAGを1に設定したいです。 以下のようなイメージです。 カンマは実際にはありません。 select * from WK; ID POSTID DATA FLAG 1 1 aaaa 0 2 1 bbbb 0 3 1 cccc 0 →これを1 4 1 dddd 0 →これを1 5 5 eeee 0 6 5 ffff 0 7 5 gggg 0 →これを1 8 4 hhhh 0 9 4 iiii 0 10 4 jjjj 0 →これを1 まず行単位にPOSTID毎の件数が必要と思い以下のselect文を書いてみました。 更にPOSTID毎に上位2件以外を抽出するにはどうすればいいでしょうか。 またはもっと上手いやり方があればご教示お願いします。 select a.ID, a.POSTID, b.CNT from WK a, (select POSTID, ID, count(POSTID) as CNT from WK group by POSTID) b where b.POSTID = a.POSTID order by a.POSTID, a.ID; ID POSTID CNT 1 1 4 2 1 4 3 1 4　この行を抽出したい 4 1 4　この行を抽出したい 8 4 3 9 4 3 10 4 3　この行を抽出したい 5 5 3 6 5 3 7 5 3　この行を抽出したい
MySQLを利用して点数の抽出をしたいと思います。 -------------------------------------- point | -------------------------------------- 9 1 1 5 6 6 3 2 1 9 2 3 8 9 9 4 3 -------------------------------------- というテーブルデータがあったとして、point の存在する順が欲しいのです。 PerlからMySQLを利用しています。その際のSQL文が知りたいです。 point 9 が4件で一番多いので　9 という数字が最初に返り、 point 3 が3件で二番めに多いので　3 という数字が次にかえってくる という風にしたいのですが、可能でしょうか？
Mysqlの件で教えてください。 Mysqlのバージョンは5.6.14です。 +---------------------------------------------------+ |　　juchuu　　|　　keishiki　　|　　　starttime　　　|　　koutei 　　| +----------+-----------+---------------+------------+ | 8830 | 7745 | 2013-12-1 14:24 | 1010 | |　　8830 | 7745 | 2013-12-2　8：30 |　　　1020　 | |　　8835 |　　　7720　 | 2013-12-3　15：20 |　　　1010 ｜ | 8840 |　　 7745　　　| 2014-01-01 8：30 |　　　1010　 | |　　8840 |　　7745 | 2014-01-01 13：30 ｜　　1020 | 上記のテーブルで、 ・keishiki=7745　のデータ ・直近のjuchuuのグループのリスト（4行目と5行目のリスト） を取得する構文を教えてください。 juchuuグループは2行とは限りません。 よろしくお願いします。
・MySQLで一致条件に正規表現を使用することは出来ますか？ ・もし出来るとすればどのようにすれば良いでしょうか？ ■やりたいこと ・aテーブルのurlカラム内容が「/color/★★」だったら「/color/」以下の★★を抽出して、bテーブルのidと一致したレコードを抽出したい ・aテーブルの★★と、bテーブルのidカラムが一致しているレコードが欲しい ・aテーブルのurlカラムには「/color/58」「/color/26」「/hoge/■■」などが入っています SELECT ＊ 　 　 FROM a 　 　　 LEFT JOIN a.url = b.id 　　　 REGEXP '^(/color)'？ 　　　 where a.★★ = b.id
MySQL5に、以下のような月刊雑誌目次データがあります。 mysequenceが通巻第●号、のような数字を表しています。 最新の3号（あるいは6号、12号）だったら 仮想カラム myflg=1と印をつけるSELECT文をご教示 いただけないでしょうか。 データ例では138～236号と途中を省略しまくってますが 実際は1号から数百号まであり、最新の3冊（あるいは6冊、12冊） だったら、 if ($myflag = 1 ){ echo "<img src='./image/最新の3号.gif'>"; } みたいな使い方をしたい次第です、よろしくお願い致します。 select *, (if( select (max(mysequence) - 3),1,0 ) as myflg) from mymagazine みたいな雰囲気かと思いますが、left joinとか難しい照会が 必要でしょうか。よろしくお願い致します。 create table mymagazine ( mycode int(5) unsigned not null auto_increment comment '管理コード', mypubyear int(4) default null comment '発行年', mypubmonth int(2) default null comment '発行月', mysequence int(3) default null comment '号', mysortno int(2) default null comment '巻毎のソート番号', mycategorycode int(2) default null comment '分類コード', mytheme varchar(900) default null comment 'テーマ', primary key( mycode ) ) engine=InnoDB default charset=utf8 auto_increment =1; insert into mymagazine ( mypubyear , mypubmonth , mysequence , mysortno , mycategorycode , mytheme )values(2005,7,138,1,99,''),(2005,7,138,2,1,'サッカー'),(2005,7,138,3,1,'サッカー'),(2005,7,138,14,16,''),(2005,7,138,15,15,''),(2005,8,139,4,1,'野球'),(2005,8,139,5,1,'野球'),(2005,8,139,17,17,''),(2005,8,139,18,17,''),(2005,9,140,1,99,''),(2005,9,140,2,1,'テニス'),(2005,9,140,3,1,'バスケ'),(2005,9,140,4,1,'バスケ'),(2005,9,140,5,1,'バスケ'),(2005,9,140,6,1,'水泳'),(2005,9,140,7,2,''),(2005,9,140,8,14,''),(2005,9,140,9,13,''),(2005,11,142,2,1,'柔道'),(2005,11,142,3,1,'剣道'),(2005,11,142,4,1,'剣道'),(2005,11,142,5,8,''),(2005,11,142,6,2,''),(2006,1,144,2,1,'卓球'),(2006,1,144,3,1,'卓球'),(2006,1,144,4,1,'バレー'),(2007,9,236,2,1,'陸上'),(2007,9,236,3,1,'陸上'),(2007,9,236,4,1,'陸上'),(2007,9,236,5,4,'ソフト'),(2007,9,236,6,5,'');
MySQLのdatetime型カラムに「月」や「日」だけ不明なデータを格納したいのですが、どうすれば良いでしょうか？ ・具体的なパターンは、下記3フォーマットの何れかです ・2013-03-02 ・2013-03 ・2013 ※月日が不明なデータは全体の一部 ■案1 ・不明な日付を0に置き換え格納 ・2013-03-00 ・2013-00-00 ■案2 ・不明な日付を1に置き換え格納 ・2013-03-01 ・2013-01-01 ※本来の日付と見分けがつかなくなる ■質問 ・日付不明が後で判別できるよう、出来れば0で置き換えたい ・MySQL的に問題ないでしょうか？ ・一般的に日付が不明なデータはどのように処理するのでしょうか？ ■環境 ・MySQL ・PHP
同順位を考慮したランクの取得について(1～55位まで) 下記の2つのテーブルがあります。 rankingscoreinfo フィールド名 型 長さ missionid integer 4 NOT NULL name varchar 20 NOT NULL skill integer 4 NOT NULL score integer 4 NOT NULL rankinginfo フィールド名 型 長さ NOT NULL missionid integer 4 NOT NULL name varchar 20 NOT NULL kind integer 4 NOT NULL missionidとname２つのテーブルの共通フィールドです。 この二つを組み合わせて同順位を考慮したスコアランキングを作成したいです。 １位のscoreが３人同点の場合、３人のスコアランキングは１位で次の人は４位になるようにしたいです。 SQLを組んだのですがレコード数が増えるにつれてどんどんSQLが返ってくる速度が遅くなって困っています。 この二つのテーブルの最速のSQLを組みたいのですがどなたか教えて下さい。 とりあえずINDEXは考慮なしでお願いします。 参考までに私が組んだSQLは下記のものになります。 SELECT d.name FROM (SELECT *, (SELECT COUNT(a.score)+1 FROM rankingscoreinfo AS a , rankinginfo as b WHERE a.missionid=10 AND a.skill= 2 AND b.kind = 2 AND a.missionid = b.missionid AND a.name = b.name AND a.score > c.score ) AS score_rank FROM rankingscoreinfo AS c WHERE c.missionid = 10 AND c.score AND c.skill=2 ) AS d , rankinginfo as e WHERE e.missionid = 10 AND e.kind = 2 AND d.skill = 2 AND d.missionid = e.missionid AND d.name = e.name AND d.score_rank >=1 AND d.score_rank <= 55 ORDER BY score_rank
社員のデータをテーブルに格納しました。 テーブルは下記のようになっています。inが入社年。outが退社年です。退社年が空白の社員は在籍中を表しています。 テーブル名：office nama(VARCHAR型)｜in(INT型)｜out(INT型) 田中｜2003｜2008 加藤｜1995｜2001 桐谷｜2009｜ やりたい事が二点あります。 (1)「2007年に在籍した社員」と指定した場合。上のテーブルでいうと田中のデータを抽出。 「in<2007 AND out>2007」このような指定をすればいいのかと思ったのですが、空白(現在も在籍中)の場合どうすればいいのか分かりません。 (2)「在籍年数が4年以上6年未満の社員」と期間を指定した場合。上のテーブルでいうと田中と桐谷のデータを抽出。 この場合SQL文はどのようにすれば良いでしょうか？ このテーブルのデータの書き方だと難しいでしょうか？難しければもっとこうした方が良いなどアドバイスを頂けると幸甚です。 ご存知の方いらっしゃいましたらご教示ください。 よろしくお願いします。
PHPやMySQLの勉強を兼ねてサッカーチームの試合データをテーブルに格納しました。 テーブルは下記のようにしました。他にもフィールドはありますがとりあえず3つのみ。 左からホームゲーム(H)かアウェーゲーム（A）か。ホームチームの得点。アウェーチームの得点です。 table名：gamedata h_a(VARCHAR型)｜home_score（INT型）｜away_score(INT型) H｜5｜3 A｜2｜1 A｜3｜4 このようなテーブルから「2得点以上5得点未満の試合」を抽出したい場合はどのようなSQL文になるのでしょか？ 上記のテーブルだと「A｜3｜4」このデータだけ抽出されることになります。 問題点だと思うのは下記の二つ。 一つはホームゲームの場合は「home_score」に得点が格納されていますが、アウェーゲームの場合は「away_score」に得点が格納されていることになります。 二つ目はデータがまだ不十分で得点が何も入力されていないデータもあるという点です。こういうデータはスルーしたいです。 ご存知の方いらっしゃいましたらご教示ください。 よろしくお願いします。
登録されているレコードが６カ月または１２ヶ月以内か判定し、TRUEならフラグに１を記すSELECT文をご教示お願いいたします。 MySQL5です。テーブル　mytableに、 (1) myName（氏名、varchar(600)、レコード例：加藤太郎） (2) RegistDate（INSERTした日付、timestamp、レコード例：2005-06-25 09:30:00） と２カラムがあります。 考え方としては照会時に、 「本日のサーバーの月度　マイナス　RegistDateの月度 ≧ 7ヶ月（または13ヶ月）」なら「myFlag=1」ということになるかと思いますが・・・ select case when to_days(now()) - to_days(RegistDate) >=7 then myFlag = '1' from mytable とか、 IF THENなどになろうかと思いますが、よろしくお願い致します。
ワードプレスで作ったホームページをあるサーバーでアップしてましたが 突如エラーが出始めた為、サーバーの移転を考えていますが、その新たな サーバーのphpmyadminを起動して、以前のサーバーからエクスポートした mysqlのデータをインポートしようとしましたが、エラー１０４４というのが 出てきてしまい、困っています。 ホームページ制作に関しては素人中の素人な為、ネット上で解決方法を 模索してみるもののいまいち分からず今に至っています。 とりあえず、ネットで調べた方法の１つでmysqlのデータを見れるようにして CREATE DATABASEから始まる記述を削除してみたのですが、これでも 上手くいかず、、。 他にも調べた結果、Dosコマンドの事やルート権限の事も書かれていましたが、 私には難しく、分からずじまいでした。 どこをどうしたらいいのかさっぱり分からず途方にくれています。 このエラーを解消し、データを上手くインポートするにはどうしたらいいのかを 教えて頂けたらと思います。
以下の2つのテーブルがあった場合 Aテーブル 商品番号,種別 123456,A 123456,C 123456,M Bテーブル 商品番号親 123456 123123 123321 以下のようなView にしたいのですができますでしょうか。 Viewテーブル 新商品番号 123456 123123 123321 A123456 C123456 M123456 上3レコードは、Bテーブルのレコード、 下3レコードは、Aテーブルの種別と、商品番号を、CONCATしています。 なお、Viewテーブルは、全てユニークなレコードになります。 すみませんが、ご回答よろしくお願いいたします。
エックスサーバーを借りたのですが、phpMyAdminでトリガーが作れません。 そもそもトリガーのタブがなく、データベースを選んでSQLコマンドでトリガーを作成すると、 #1227 - Access denied; you need the SUPER privilege for this operation と出て「SUPER権限がないために実行できない」ようです。 phpMyAdminのトップ画面には「特権なし」と書いていますし、どうすればトリガーを作成できるのでしょうか？ そもそも作成できないのでしょうか？ エックスサーバーのマニュアルにも記載されておらず、ネットで検索しても出てきません。 何かおわかりでしたらお教えください。 どうぞよろしくお願い致します。
お世話になっております。データベースのテーブルの別け方について質問させて下さい。 例えば、会員制のブログサービスを公開するとして、各会員の個人情報を収めるmemberというテーブルを以下のような構成で用意したとします。 （idはURLの一部となるもの） no　　id　　　mail　　　pass　　name　　blog_title 1　　lala　***@***.com　1234　　佐藤　　私の日記帳 2　　tecno　**@***.com　5432　　石田　　明日は何処へ 3　　nonno　**@***.com　9812　　毛利　　音楽大好き 上記は、会員の個人情報と併せ、ブログのタイトルなども1レコードで済むことが出来るので、会員情報とブログの情報も登録したケースです。 対して、以下は会員情報とブログ情報を別けた場合です。 memberテーブル no　　mail　　　pass　　name 1　***@***.com　1234　　佐藤 2　**@***.com　 5432　　石田 3　**@***.com 　9812　　毛利 blog詳細テーブル(member_noとnoで紐付けている） no　member_no　id　　　blog_title 1　　1　　　　lala　　私の日記帳 2　　3　　　　nonno　音楽大好き 3　　2　　　　tecno　明日は何処へ 例えばhttp://blog.sample.com/lala/ というURLにアクセスされた場合、１つのテーブルに情報が収められている場合、個人情報が登録されたテーブルに接続しなければなりませんが、ブログ情報だけを別にしたテーブルを設けていると、個人情報が登録されたテーブルには接続しなくても済むかと思います。 ここで質問させて下さい。 以前、1つのレコードで収まるなら、複数のテーブルを用意する必要はないといった意見を聞いたことがあるのですが、上記のような2つのケースの場合、やはり貴重な情報を含まれたテーブルは、極力、接続機会を減らす方が良いのでしょうか？ 今日まで、1つのレコードで収まるなら複数のテーブルは用意することなく来ましたが、もしかして、 ・2つのテーブルに別けようが、１つが漏洩したら全て漏洩したと同じだ。だから1つにまとめて問題ない。 ・貴重なテーブルは接続機会を減らすべきだ。 というような意見があるのでは？と、意見を伺えればと思い、質問させて頂きました。 お忙しいとは思いますが、ご意見のほど宜しくお願い致します。
こんにちは。 改行を含む文字列「abc改行def」をVARCHAR型のカラムに登録した時に、文字列「改行def」が削除されてしまい困っております。解決方法をご存知の方がいらっしゃいましたら教えて頂きたいです。
PDOを利用してprepareとbindValueでPDO::PARAM_INTなどと型指定をしてINSERTしているのですが、ネットをいろいろ見てみると「型指定をしてもexecute()時に全ての型は文字列として扱われる」と書いています。 これはデータベースの各カラムの型は無視して全て文字列としてINSERTしているのでしょうか？ それともデータベースの型にMySQL側で勝手に変換して値を挿入してくれるのでしょうか？ INSERTした数値を含むデータをprepareでSELECTしてexecute()してみると数値を含めて全てのカラムがstringとして取得しています。 MySQL側ではカラムの型をINTやFROATとして定義しても数値を文字列として挿入するとMySQL側も文字列として扱うのですか？それとも数値に変換されて挿入されますか？ もし文字列として挿入されたらインデックスに影響しますか？ いまいちどうすればいいのかわかりません。 一応 $id = 1; $name = "hoge"; $float = 0.055; $stmt = $dbh->prepare("INSERT INTO REGISTRY (id, name, float) VALUES (:id, :name, :float)"); $stmt->bindValue(:id, $id, PDO::PARAM_INT); $stmt->bindValue(:name, $name, PDO::PARAM_STR); $stmt->bindValue(:float, (string)$float, PDO::PARAM_STR); としています。 あと、PDO::PARAM_FLOATはないみたいで、PDO::PARAM_STRにすべきと書いていますが、このように指定してもMySQL側で勝手にFLOAT型に変換して値をINSERTするのでしょうか？ どうぞよろしくお願い致します。
環境 OS:windows8 XAMPP：ver1.7.3 ウィルスソフト：市販のものは使ってません。 状況： 同じPCで以前まで使えていたのですが、windows8の自動更新の影響かわかりませんが、 XAMPPを立ち上げて、Apacheはスタートボタンを押して「Running」のステータスに かわりますが、MySqlはスタートボタンを押して「Running」のステータスに 変わりません。。 MySqlはスタートボタンを押したその後の ステータスは 「MySql started busy...」 となります。 どなたか同様の問題で解決された経験の方がいらっしゃいましたら お知恵をいただければ幸いです。 よろしくお願い致します。
ただいま以下の一つのテーブルを正規化しようとしています。 テーブル：英単語 フィールド：単語、意味1、意味2、意味3、品詞、分類1、分類2、分類3、例文、難易度、ID（主キー・オートインクリメント） これを以下のように分けました。（分類とは単語の分類です。例えば year なら意味は 年 で分類は 時間 とか 単位 とか属性を入れたいのです。） ＊＊＊＊＊＊ テーブル：英単語 フィールド：単語、意味1、意味2、意味3、分類ID、分類ID、分類ID、例文ID、難易度、ID（主キー・オートインクリメント） テーブル：分類 フィールド：分類名、ID（オートインクリメント　主キー） テーブル：品詞 フィールド：品詞名、ID（オートインクリメント　主キー） テーブル：例文 フィールド：例文、ID（オートインクリメント　主キー） ＊＊＊＊＊＊ (1)これで正規化できているでしょうか？ もしできていないなら、どうすればよいでしょうか？ (2)また、仮にこのままデータベースを作るとすると、INSERTの時に英単語テーブルの分類IDに、分類テーブルのIDをひもづけるにはどうしたら良いのでしょうか？ INSERT INTO 分類 (分類名) VALUES("時間") のあと、オートインクリメントされたIDを取り出して、英単語テーブルに入れるにはどうしたらいいでしょうか。
SELECT文で質問があります。 商品情報を格納したテーブルを作成し、「商品名を検索するとその商品番号を取得する」という単純なSELECTですがうまくいきません。 ■tb_items　→　商品情報を格納しています。 -------------------------------------------- 商品番号　サイズ　重さ 001　　　50　　　120 002　　　30　　　200 -------------------------------------------- ■tb_details　→　店舗毎の情報を格納しています。 -------------------------------------------- 商品番号　店舗番号　商品名　　　　　　　価格 001　　　shop_A　　シャープデジカメ　　50000 001　　　shop_B　　シャープcamera　　　56000 002　　　shop_A　　パナソニックスマホ　85000 002　　　shop_B　　Panasonicスマホ　　 79000 -------------------------------------------- ここで、「商品名を検索するとその商品番号を取得できる」としたいのですが、例えば「シャープ」で検索すると商品番号001を取得できますが、「sharp」で検索すると当然ですが商品番号001は取得できません。 そこでタグのようなものを登録するテーブルをさらに作成しました。 ■tb_tags -------------------------------------------- タグ　　　　　商品番号 sharp　　　　　001 カメラ　　　　 001 スマートフォン 002 携帯　　　　　 002 -------------------------------------------- 試しに「sharp カメラ」を検索してみました。SELECT文は以下のようにしました。 -------------------------------------------- SELECT 　tbI.`商品番号` FROM 　tb_items AS tbI LEFT JOIN 　tb_details AS tbD ON tbI.`商品番号` = tbD.`商品番号` LEFT JOIN 　tb_keywords AS tbK ON tbI.`商品番号` = tbK.`商品番号` WHERE 　( 　　((tbK.`タグ` = 'sharp') OR (tbK.`タグ` = 'カメラ')) OR 　　( 　　　(tbD.`商品名` LIKE '%sharp%') AND (tbD.`商品名` LIKE '%カメラ%') 　　) 　) -------------------------------------------- 取得した結果は、 001 001 というように同じ商品番号を重複して2つ取得してしまいます。 検索を「シャープ camera」にしても重複して2つ取得してしまいます。 やりたいことは、「検索文字列（空白区切りあり）で商品名とタグを検索してヒットした商品番号を重複なしに取得したい」です。 どのようなSELECT文にすれば良いのでしょうか？ お手数ですがアドバイスを頂けたらと思います。 どうぞよろしくお願い致します。
phpmyadminで日本語のデータだけ文字化けしてしまいます。 phpで作成された掲示板からデータをmysqlに投稿し、そのデータを再度掲示板で表示しています。 投稿・表示するphpファイルはutf8で、mysqlのmy.cnfは以下のようになっています。 --------------- [mysqld] datadir=/var/lib/mysql socket=/var/lib/mysql/mysql.sock user=mysql # Disabling symbolic-links is recommended to prevent assorted security risks symbolic-links=0 character-set-server=utf8 [mysqld_safe] log-error=/var/log/mysqld.log pid-file=/var/run/mysqld/mysqld.pid [mysql] default-character-set=utf8 [mysqldump] default-character-set=utf8 --------------- phpmyadmin（2.11.11）側は、MySQ の接続照合順序:utf8_unicode_ci にしています。 phpmyadminで文字化けしているデータをphpで見ると問題なく表示されてるのが不思議です。 どこが問題なのでしょうか。
SELECT文を使って件数やデータを取得することはできますが、 INSERT文を使って、データを追加することができません。 他のテーブルへはこの記述で書き込みを行えております。 書き込めない理由がわからず困っています。 よろしくお願いいたします。 ■INSERT文のソースコードです。※テーブル名、項目名は一部変更しておりますが、 実際のソース上では、テーブル名、項目名は同じにしております。項目数に変更はございません。 -------------------------------------------------------------------------- if($dbh != null){ print '接続に成功しました。<br />'; //データを登録 $sql = 'insert into test (name,flag1,content1,content2,flag2) values (?,?,?,?,?)'; $stmt = $dbh->prepare($sql); var_dump($stmt); print '<br />'; $flag = $stmt->execute(array($name,$flag1,$content1,$content2,$flag2)); if($flag){ print 'データの追加に成功しました<br />'; }else{ print 'データの追加に失敗しました<br />'; var_dump($flag); print '<br />'; } }else{ print '接続に失敗しました。<br />'; } ■画面への表示※質問板に投稿するにあたり、テーブル名、項目名の変更している都合により、string(80)とは異なっております。項目数に変更はございません。 ---------------------------------------------------------- 接続に成功しました。 object(PDOStatement)#2 (1) { ["queryString"]=> string(80) "insert into test (name,flag1,content1,content2,flag2) values (?,?,?,?,?)" } データの追加に失敗しました bool(false) ■データベース※質問板に投稿するにあたり、テーブル名、項目名の変更しております。項目数、型に変更はございません。 ---------------------------------------------------------- テーブル: test 項目： numbigint(20)UNSIGNEDAUTO_INCREMENT namevarchar(255) flag1int(1)→０か１が入ります content1longtext content2longtext flag2int(1)→０か１が入ります
プログラム初心者です 掲示板のレスを削除フラグを立てて後からメンテの時に削除するようにしました 将来行う削除する方法なんですが、daleteで行を削除するのではなく、カラムに入っている内容を削除しただけでもパフォーマンスはよくなりますか？残った行はid番号だけにする予定です 例えば100ＭＢの容量が70ＭBくらいになるイメージです それともメンテの時に行を削除したほうがいいでしょうか？ 大体の経験からの判断でいいのでよろしくおねがいします
プログラム初心者です phpとmysqlで簡単な掲示板を作りました 一つのテーブルでsure_idごとにスレッドをつくり、resu_idでレス番号をつくっています そこで削除フラグがある場合にはそのレスを表示しないようにしたいのです 素人なのでこんな方法しか思い浮かばないのですがこれで大丈夫でしょうか？ 5番のスレッドを全て取得し、削除フラグがない行を全て取得 SELECT * FROM bbs WHERE sure_id=5 and dll_flg=0 質問1 削除フラグはどのような立て方が良いでしょうか?0と1でしょうか？ 質問2 削除フラグのカラムにもインデックスを張ったほうが速いですか? 質問3 phpでいちいちif文で判定するよりsqlで表示判定したほうが早いですよね？ よろしくお願いします
mysql初心者です 行数を取得したいです 処理をすこしでも軽くしたいです このように書くとテーブルの中身は見に行かないらしいのですが SELECT COUNT(*) AS cnt FROM bbs WHEREをつけると中身を見に行きますか? SELECT COUNT(*) AS cnt FROM bbs WHERE sure_id=5 中身を見に行く場合、カラムを指定したほうが早いでしょうか? SELECT COUNT(id) AS cnt FROM bbs WHERE sure_id=5 よろしくお願いします
タイトルの件について、分かる方おりましたらどなたかご教授ください。 [DBサーバ] Linux CentOS 6.4 CPU Xeon core4 SSD 250GB RAM 32GB バージョン情報 MySQL 5.5 tomcat 6 JDK 6 会員データをCSVから大量にUSERテーブルへINSERTする処理を行っています。 また、それに関連するデータも同時にINSERTをします。 (USER_ID を持っている SERVICE_POINTテーブルやADDRESSテーブル) 処理の流れとしては以下となります。 (1) 会員情報の入ったCSVファイルをサーバへアップロード (2) 1でアップロードしたCSVファイルを○○○○件毎に一時ファイルに切り分ける ～～ ここからバックグラウンドで実行 ～～ (3) 2で切り分けたファイルをループで回しながら、メアドの重複やフォーマットエラーなどを判定する (4) 3でエラーがあれば即座にERRORSテーブルにエラー詳細をINSERTし、コミット＆continue; (5) 3でエラーがなければUSERテーブル・SERVICE_POINTテーブル・ADDRESSテーブルへINSERT処理 (6) その他関連するテーブルへUPDATE処理 (7) 3に戻る ストレージエンジンは全てInnoDBです。 my.cnfのInnoDBの設定は以下の通りです。 innodb-buffer-pool-size = 24G innodb-log-buffer-size = 8M innodb-log-file-size = 1024M innodb_log_files_in_group = 3 innodb_fast_shutdown = 0 innodb_data_file_path = ibdata1:10M:autoextend innodb_file_io_threads = 4 innodb_change_buffering = all innodb_thread_concurrency = 16 innodb_flush_log_at_trx_commit = 2 innodb_max_dirty_pages_pct = 90 innodb_flush_method = O_DIRECT innodb_lock_wait_timeout = 120 innodb_additional_mem_pool_size = 128M innodb_file_format = Barracuda innodb_file_per_table = 1 なお、ERRORSテーブルのINSERTは非常に速いです。 会員数が全くない状態だとスムーズに登録されていくのですが (1秒に15件程度) テーブルが肥大化して20万件を超えると１秒に１件ほどしかINSERTされません。 この速度を少しでも速くしたいなと思っています。 １件ずつコミットしているのには理由があります。 ただ、1000件ずつコミットしても速度はほぼ変わりませんでした。 こういう場合、やはりパーティショニングを検討しなければならないでしょうか。 よろしければどなたかご教授ください。 以上、よろしくお願いいたします。
WEB上でリッチテキストエディッタで入力した内容を そのままデーターベースに保管したいです。 最大文字列などが想像できませんが、かなり文字数が多くなる場合もあると 考えております。 その場合、保管先になるデーターベースの型と値は何を指定しておくと いいのでしょうか。 ご教授いただけると助かります。 よろしくお願いいたします。
システム設計初心者です。 googlemap 、mysqlでマーカー（クリックで情報ウィンドウ表示）とサイドバーを表示するシステムを作っているのですが、マーカーは表示されたのですがサイドバーが表示されません。 以下にソースを表示しましたので、添削をお願いします。 サイドバーには、ｍｙSQLから持ってきたtitleを表示したいと考えています。 宜しくお願いします。 ・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・ <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml"> <head> <meta http-equiv="content-type" content="text/html; charset=utf-8"/> <title>閲覧画面</title> <script src="http://maps.google.com/maps?file=api&v=2&key=ABQIAAAAR0TWf73rulOP_SnETQPFKxRj5djmSsmVAgDaRb1psFcJlThRhxSjxifqM96NjrBsBn2XrZWSE-QQqQ" type="text/javascript"></script> <script type="text/javascript"> function initialize() { //サイドバーのボタンを作成 createMarkerButton(marker); } //<![CDATA[ function load() { if (GBrowserIsCompatible()) { var map = new GMap2(document.getElementById("map")); map.addControl(new GSmallMapControl()); map.addControl(new GMapTypeControl()); map.setCenter(new GLatLng(35.6894875,139.6917064), 13); // Change this depending on the name of your PHP file GDownloadUrl("posts.php", function(data) { var xml = GXml.parse(data); var markers = xml.documentElement.getElementsByTagName("marker"); for (var i = 0; i < markers.length; i++) { var title = markers[i].getAttribute("title"); var nitiji = markers[i].getAttribute("nitiji"); var message = markers[i].getAttribute("message"); var picture = markers[i].getAttribute("picture"); var point = new GLatLng(parseFloat(markers[i].getAttribute("latitude")), parseFloat(markers[i].getAttribute("longitude"))); var marker = createMarker(point, title, nitiji, message, picture); map.addOverlay(marker); } }); } } function createMarker(point, title, nitiji, message, picture) { var marker = new GMarker(point); var html = "<table>"+"<tr>"+"<td>"+"タイトル:"+"</td>"+"<td>"+ title +"</td>"+"</tr>"+"<tr>"+"<td>"+ "日時:"+"</td>"+"<td>"+nitiji+"</td>"+"</tr>"+"</table>"+ "<h3>"+"コメント:"+"</h3>"+"<h4>"+message+"</h4>"+"<h3>"+"写真:"+"</h3>"+picture; GEvent.addListener(marker, 'click', function() { marker.openInfoWindowHtml(html); }); return marker; } function createMarkerButton(marker) { //サイドバーにマーカ一覧を作る var ul = document.getElementById("marker_list"); var li = document.createElement("li"); var title = marker.getTitle(); li.innerHTML = title; ul.appendChild(li); //サイドバーがクリックされたら、マーカーを擬似クリック google.maps.event.addDomListener(li, "click", function(){ google.maps.event.trigger(marker, "click"); }); } google.maps.event.addDomListener(window, "load", initialize); //]]> </script> </head> <body onload="load()" onunload="GUnload()"> <h1>閲覧</h1> <div id="map" style="width: 800px; height: 600px"></div> <div><h3><a href="index.php"/>戻る</a></h3></div> </body> </html> ・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・・
たとえば銀行口座に2/4時点で100万円あったとします。 2/10に-10万円 2/25に+20万円 2/27に-1万円 というような感じで、日付と入出金額をDBに入れていきます。 このとき、ある日付時点での残高を表示するにはどうしたらいいでしょうか。 つまり、 2/4　100万円 2/10　90万円 2/25　110万円 2/27　109万円 という結果が得られるようにしたいです。 Excelを使えば簡単ですが、そのほかにもやることがあるのでDBを使っています。
プログラム初心者です テーブルに途中からプライマリーキーを作成することはできますか？ idとゆうカラムを追加で作成して主キーにしようとしたのですがエラーがでます idはint型でテーブルには100行あるのですが全部0になっているのが原因かもしれません このidカラムに1～100まで数字を与える方法はありますか？ よろしくお願いします
1対多で結合する場合に、多が絞り込み条件となった場合のSQLについての質問です。 たとえばカスタムテーブルを使ったSELECT文などで、このような絞り込み条件が必要になると思います。 まずカスタムテーブルの具体例として、たとえばユーザーテーブルがあったとします。 [user_table] id=INT //オートインクリメント user_id=VARCHAR //adminなどのユーザーID文字列 user_pass=VARCHAR //パスワードを保存※ハッシュ化した値 user_name=VARCHAR //山田太郎などのユーザー名 user_mail=VARCHAR //ユーザーのメールアドレス user_description=TEXT //ユーザーの自己紹介文 user_created=DATETIME //ユーザーの登録日 とりあえず、上記のようなデータをユーザーの基本データだとします。 このユーザーテーブルから、たとえば名前を元に検索するのは単純です。 たとえばこのような感じでしょうか。 SELECT * FROM user_table WHERE user_name = '山田太郎' このテーブル構造を変更することなくカスタムデータを追加したい(しかも柔軟に)という要望を実現するために、ユーザーカスタムテーブルを作ったとします。 [user_custom_table] id=INT //オートインクリメント relational_id=INT //user_table.idへの参照 custom_name=VARCHAR //カスタムフィールド名 custom_value=VARCHAR //カスタムフィールドの値 custom_name、custom_valueには、たとえばそれぞれ以下のような値が入るとします。 custom_name、custom_value Birthday 、1998/1/1 CompanyName 、○○株式会社 CompanyTel、000-0000-0000 CompanyAddress、東京都千代田区○○-○○ user_custom_table.relational_idはuser_table.idにリレーションしているとすると、INNER JOINして値を取得する方法は判ります。 ※カスタムテーブルに値がない場合という状況は無視できる仕様です。 たとえば、会社住所が東京都で始まるユーザのみを抽出すると、以下のような感じでしょうか。 SELECT user_table.* FROM user_table INNER JOIN user_custom_table ON user_table.id = user_custom_table.relational_id WHERE user_custom_table.custom_name = 'CompanyAddress' AND user_custom_table.custom_value LIKE '東京都%' ただ、この方法だと、誕生日が○月○日以前で、会社名に○○を含んで、会社住所が東京都で始まり…と検索条件が増えていった場合にINNER JOINがどんどん増えていって、いかにも効率が悪いと思えてなりません。 とりあえず適当に書いてみるとして、以下のような感じでしょうか。 SELECT user_table.* FROM user_table INNER JOIN user_custom_table AS custom_1 ON user_table.id = custom_1.relational_id INNER JOIN user_custom_table AS custom_2 ON user_table.id = custom_2.relational_id INNER JOIN user_custom_table AS custom_3 ON user_table.id = custom_3.relational_id WHERE custom_1.custom_name = 'CompanyAddress' AND custom_1.custom_value LIKE '東京都%' AND custom_2.custom_name = 'Birthday' AND custom_2.custom_value < '2001/1/1' AND custom_3.custom_name = 'CompanyName' AND custom_3.custom_value LIKE '%○○%' もっと効率の良い書き方、一般的にはこういう場面ではこんな書き方をするなど、識者の方から教えを請いたくて質問しました。 ※ちなみにDBはMySQLですが、とくにMySQLに限らない方法で答えを頂ける方がありがたいです。
mysqlのデータを今csvファイルに保存しようとしているのですが、 データの中にcsvファイルに保存しなくてもいい情報と保存したい情報があります。 例えばデータが 姓 　　山田 名 　　太郎 年齢　　 20 住所 東京 学校 東京大学 だったとします。 そこで 姓と名と年齢だけの情報を保存したいとします select * from テーブル名 where 名前 and 名 and 年齢 INTO OUTFILE "ファイル名.csv" fields terminated by ',' これで保存されると思ったのですが、 保存されたcsvファイルは空白でした。 学校が東京大学の人がデータに5人中3人だとして　東京大学の人のデータを取り出したい場合にwhere 学校 = "東京大学"みたいに使うのだろうと思いました。 自分は全員分のデータの中のここでいう姓と名と年齢だけの情報を保存したいです。 なので姓と名と年齢だけの情報を保存したい場合にはどうしたらいいですか？
単純な質問ですみません。 idを例えばアルファベット5～10文字程度にしたVARCHAR(10)とする場合と、tinyintにする場合では検索スピードはどちらが速いのでしょうか？ idの種類は多くても10種類くらいです。 レコード数は50万件くらいあります。 アルファベットのidを数値にするとは、例えば apple → 0 orange → 1 banana → 2 というような感じです。 また、idをもしtinyintにした場合、phpMyAdminなどでレコード表を確認した場合、何のidかわかりにくいですが、これは仕方ないのでしょうか？
mysqlで　SELECT文を作成しています。　 諸事情であるテーブルとテーブルを１対１の関係でプライマリーキー同士でつないでいます。 この時、Aというテーブル　と　Bというテーブルでつないでるとして Aテーブルにあるカラムのみを使ってでソートする場合パフォーマンスは問題なく Bテーブルにあるカラムのみでソートする場合もパフォーマンスに問題はありません。 しかし、Aテーブル　Bテーブルのカラムを組み合せてソートすると パフォーマンスが極端に落ちてしまいます。 これを改善する方法はないでしょうか？
プログラム初心者です mysqlのカラム、varchar(255)に実験で270文字HTMLフォームからmysqlに入れてみました そうしたら、255文字しか保存されていませんでした もしかしたら、PHPで文字数制限しなくてもmysql側のカラムの文字数設定だけでいいのではないかと思ってしまいましたがこれだと不具合とかでてきますか？ データ型のtextも文字数指定できるのでしょうか？ やっぱり、文字数制限はPHPなどでやったほうがいいのでしょうか？ よろしくお願いします
プログラムど素人です プライマリーキーはつけといたほうがいいでしょうか？ プライマリーキーがないとプライマリーキー以外のカラムをselectするとき遅くなるのでしょうか？ プライマリーキーのカラム名はid以外でもいいですか？ 質問2 phpmyadminからindexを他のカラムにつけた場合はそのカラムにindexつけた後に追加された行も自動的にindexがついていますか？ よろしくお願いします
プログラム初心者です シンプルな掲示板をつくりました ホームページのトップページに新しく書き込まれたスレッドを表示したいです bbsに書き込まれたらbbsテーブルに行番号を付けてどんどんインサートしていくようにしてます トップページはindex.phpです id （オートインクリメントでつけた行番号） sure_id （タイトルごとのid。これでタイトルごとにまとめています） mes 書き込まれた文章 name 書いた人の名前 time 型はdatetimeです（書き込まれた日付） bbs番号3番のスレ 2番目の書き込み　2013-09-12←これが新着で取得したい値 1番目の書き込み　2013-09-10←なぜかこちらを取得してしまう 下記のようにindex.phpで表示したいです bbs番号3番のスレが2013-09-12 しかしやってみたら新着順にはなるものの3番目のレスの古いほうから値を取得していました SELECT * FROM bbs GROUP BY sure_id ORDER BY MAX(time) DESC LIMIT 1,10 bbs番号3番のスレが2013-09-10 bbs番号5番のスレが2013-09-11 bbs番号6番のスレが2013-09-09 こうなるようにしたいです bbs番号3番のスレが2013-09-12　←最新の書き込まれたスレッドのなかから一番新しい日付を表示したい bbs番号5番のスレが2013-09-11 bbs番号6番のスレが2013-09-09 よろしくお願いします
このジャンルでお願いします。 tbl id　　starttime　endtime　val 1　　　　　0　　　　　　40　　3 2　　　　　160　　　　170　　1 3　　　　　160　　　　190　　2 starttimeとendtimeは「分（160なら60×2＋40で2時40分になります）」で保存してます。 このようなテーブルで、時間毎にvalの平均を出したいのですが、 id　　hour　avg(val) 1　　　　0　　　3　　←　0～1時まで 2　　　　1　　　0　　←　1～2時まで 3　　　　2　　　1.5　　←　2～3時まで 4　　　　3　　　2　　←　3～4時まで ・ ・ 24　　　23　　　0　　←　23～24時まで といった感じで24区間に分けてその区間毎のvalの平均を出したいです。 これはどのようなSQL文になるのでしょうか？ またこのようなSQL文で１度に取得するやり方と、 いったん全行取得してPHPなどでループして平均を計算するやり方とでは レコード数が増えてきた場合にどちらが速いとかはあるのでしょうか？
プログラム初心者です phpとmysqliで簡単な掲示板を作りました。これをスレッド掲示板に変更したいと思っています 質問1 MyISAMの違うテーブルに同時アクセスできるのでしょうか？ bbs1とゆうテーブルに同時アクセスはできないのはわかりますがテーブルを二つに分けた場合どうなりますか？ 例えばbbs1とbbs2とゆうテーブルを作った場合、bbs1とbbs2に同時に書き込まれた場合でもテーブルが違うと書き込めるのでしょうか? 質問2 2chのようにスレッド掲示板にしたいのですが、テーブルは2つで作れると考えました（スレッドとレス）スレッド番号でレスをまとめるやり方です このような1つのテーブルでレスをまとめた場合、複数のカラムにindexをつけると将来100万行とかになっても軽快に動きますか? それとも、スレッドごとにテーブルを作ったほうがいいのでしょうか？ よろしくお願いします
Mysqlでわからないところがあります。 テーブル名はtestで下のようになるとします test clm1 | clm2 ----------- 3 | 1 2 | 1 4 | 1 3 | 2 4 | 2 1 | 2 2 | 2 6 | 2 このときにclm1に2.4.6を含むclm2を出力させたいです。 この場合2.4.6すべてを含んでいるclm2の2が期待する答え（1は2.4しか含んでいないため）です。 どなたかご教授願います。
仮登録から本登録の流れというのは、どの設計になるのでしょうか？仕組みは色々な方法があると思うのですがいまいちイメージがつかめないです。 以下は、私が設計したいと思っている流れです。 (1)お問い合わせフォームまたは電話にてお申込み連絡を承ります。サービスの利用が可能かを確認致します。 ここで基本的な会社の情報をいただきます。メールにて送信。 ↓ (2)メール確認後、ご訪問、電話にてご説明。 弊社担当よりサービスのご案内・利用方法についてご説明させて頂きます。 ↓ (3)クライアントがサービス利用と判断された場合は利用に必要な項目を確認、取得します。 最終的にはどのようなデータベース設計になるのでしょうか。 よろしくお願いします。
単純な質問ですみません。 現在、商品の名前や価格・在庫数を商品テーブルに記録しています。 この商品の価格や在庫数の1年分（365日分）の履歴をデータベースに記録したいのですが、通常はどのような設計になるのでしょうか？ 価格テーブルや在庫テーブルを作って356日分のカラムを作るのが普通ですか？ あと、商品データベースには商品テーブルが一つだけあります。 もし上記のように価格テーブル、在庫テーブルを作るとしたら商品データベースの中に作るのでしょうか？ それとも価格データベースの中に価格テーブル、在庫データベースの中に在庫テーブルを作るのでしょうか？ 長所・短所などがありましたら教えてください。 どうぞよろしくお願い致します。
テーブルから他テーブルへデータの更新をしたいと思っています。 テーブルは下記のような構成になっています。 テーブルSTOCK(主キーは商品コード) 商品コード（varchar),数量(int) A001,5 B002,10 C003,30 テーブルTOTAL(主キーは商品コード) A001,10 B002,20 やりたいことは、テーブルTOTALを更新させる事です。テーブルSTOCKの商品コードがテーブルTOTALにあれば、減算をおこないたいです。 そこで下記のSQLを書きました。 INSERT INTO テーブルTOTAL SELECT * FROM テーブルSTOCK ON DUPLICATE KEY UPDATE テーブルTOTAL.数量 = テーブルTOTAL.数量 - テーブルSTOCK.数量 更新結果 A001,5 B002,10 C003,30 商品コードがA001、B002は欲しい結果がでました。欲しい結果はC003が「-30」になることです。 テーブルTOTALにはC003の商品コードがないため、30でアップデートされてしまうのですが、なんとか「-30」で更新できるようにできないでしょうか？ よろしくお願いいたします。
MySQLで改行を含む文を登録したいんですが、改行を改行コードに書き換えて登録したいです。 改行コードはどのように書けばいいですか？ 登録したい文： あいうえお かきくけこ さしすせそ
MySQLで改行を含んだ文を登録したいんですが、ネットを見ると改行を文字コードに変換して1行にしているようですが、これはどういう意味があるんですか？ そのまま改行した文を登録出来るようですが、文字コードにしたものとの違いがよくわかりません。 取り扱い方などの違いを詳しく説明してください。
大変申し訳ありません。本日も質問させてもらったのですが、一部情報（履歴）が不足していて追加で質問させてください。 以下のようなテーブルがあり、価格が異なるところを差額一覧を出したいと思っております。 （先ほどは2名の方に回答頂き、すみませんベスト１０の設定がわからず設定できなくて、すみませんでした。） 【テーブル構成】 商品ID、商店ID、価格（円）、履歴 というテーブルがあり、 商品A、商店１、1000、1 商品A、商店２、1500、1 商品A、商店３、800、1 商品A、商店１、2000、2 商品A、商店２、2500、5 商品A、商店３、1800、3 商品B、商店１、2000、1 商品B、商店２、1700、1 商品B、商店３、2600、1 商品B、商店１、2500、4 商品B、商店２、2000、6 商品B、商店３、2800、7 ・・・（多くの商品データがあります） というデータが格納されております。 商品と商店の区分ごとに履歴の最も大きいものを取り出し　（←追加） 商店１を基準に、商品毎に商店２、３の価格差を大きい順にソートして出したいと考えています。 SQL分ではどのように記載すれば良いでしょうか？ （実際に比較したデータは以下を抽出し）【履歴の古いのは無視】 商品A、商店１、2000、2 商品A、商店２、2500、5 商品A、商店３、1800、3 商品B、商店１、2500、4 商品B、商店２、2000、6 商品B、商店３、2800、7 ・・・（多くの商品データがあります） （今回の場合の希望出力が以下のような感じです。） 価格差、商品名、商店　（←綱目です。） 800、商品B、商店３ 500、商品A、商店２ -200、商品A、商店３ -500、商品B、商店２ ご教授頂けると幸いです。 ちなみに、教えて頂いたSQLをもとに以下のようにやってみましたが、うまくいきませんでした。。。 全くよくわかっていません。少し解説を入れて頂けると幸いです。 ------------------------------------ SELECT a.価格 - b.価格 AS 価格差, a.商品ID AS 商品名, a.商店ID AS 商店 FROM 対象テーブル a INNER JOIN 対象テーブル b ON (a.商品ID = b.商品ID AND b.商店ID = '商店１') WHERE a.商店ID <> '商店１' AND a.履歴 = (SELECT MAX(a.履歴)) AND b.履歴 = (SELECT MAX(b.履歴)) 【←追加】 ORDER BY a.価格 - b.価格 DESC; ---------------------------------------- select t2.価格-t1.価格 as 価格差 ,t1.商品名 ,t1.商店 from テーブル1 as t1 left join ( select 価格,商品 from テーブル1 where 商店=商店1 ) as t2 on t1.商品 = t2.商品 where t1.商店<>商店1 AND a.履歴 = (SELECT MAX(a.履歴)) AND b.履歴 = (SELECT MAX(b.履歴)) 【←追加】 ORDER BY t2.価格 - t1.価格 DESC;
大変申し訳ありません。ほかにも似たようなのがあるのですが、応用が利かずわかりませんので、ご教授頂けると幸いです。 以下のようなテーブルがあり、価格が異なるところを差額一覧を出したいと思っております。 【テーブル構成】 商品ID、商店ID、価格（円） というテーブルがあり、 商品A、商店１、1000 商品A、商店２、1500 商品A、商店３、800 商品B、商店１、2000 商品B、商店２、1700 商品B、商店３、2600 ・・・（多くの商品データがあります） というデータが格納されております。 商店１を基準に、商品毎に商店２、３の価格差を大きい順にソートして出したいと考えています。 SQL分ではどのように記載すれば良いでしょうか？ （今回の場合の希望出力が以下のような感じです。） 価格差、商品名、商店　（←これは当然、出力されない） 600、商品B、商店３ 500、商品A、商店２ -200、商品A、商店３ -300、商品B、商店２ ご教授頂けると幸いです。
このジャンルでお願いします。 t1テーブル id　name 1　　aaa 2　　bbb 3　　aaa t2テーブル id　t1_id　num 1　　1　　　10 2　　2　　　100 3　　1　　　1000 4　　3　　　1 このようなテーブル構成で、 t1のnameが「aaa」 かつ t2のidが最新の行だけnumを合計した数値を得たいのですが、 この例だと、 まずt2テーブルの id　t1_id　num 1　　1　　　10 3　　1　　　1000 4　　3　　　1 が該当して、t2のidが最新の行だけなので id　t1_id　num 3　　1　　　1000 4　　3　　　1 に絞られて、1000＋1で「1001」という結果が得たいのです。 どのようなSQL文にすれば良いのでしょうか？
以下のようなテーブル table1 があります。 ******************* table1 ******************* Name, Kyouka, Score, ID ******************* 山田, 国語, 92, 10001 鈴木, 国語, 71, 10002 田中, 国語, 89, 10003 山田, 数学, 65, 10004 鈴木, 数学, 69, 10005 杉田, 英語, 96, 10006 山田, 英語, 63, 10007 田中, 英語, 76, 10008 ... ******************* カラムIDはPRIMARYを指定しています。 カラムScoreはインデックスを作成しています。 このテーブルで、「IDと教科」を指定したときに、以下の2つのデータを得たいと思っています。 (1) IDに対応する名前と、その教科中の順位 (2) その教科のレコード数 具体例としては、例えば「ID=10001、教科=国語」を指定したときに、「山田、3人中1位」というような情報が得たいです。 （「ID=10001、教科=英語」のようなおかしな組み合わせは指定しないようになっています。） (1) は、以下のようにして名前と順位を得る事が出来ました。 SELECT Name, (SELECT COUNT(*) + 1 FROM table1 b WHERE b.Score > a.Score and Kyouka='国語') AS rank FROM table1 a WHERE ID='10001' ORDER BY Score DESC; (2)は、以下のようにして特定の教科のレコード数を得る事が出来ました。 SELECT COUNT(*) FROM table1 WHERE Kyouka='国語'; しかし、実際にはレコード数が大量にあり、頻繁にこの検索を実行する予定なので、負荷が心配です。 出来るだけサーバーの負荷を減らすために、1回のSELECT文の実行で(1)と(2)をどちらも実現できるような方法はないでしょうか。 また、このテーブルでインデックスを作成しているのはIDとScoreのみですが、より負荷を減らすにはKyoukaにもインデックスを作成した方が良いでしょうか。 何卒、よろしくお願いいたします。
Canvasを使ってweb上にグラフを表示するサイトを作成したいです。 作りたいグラフのデータは項目が20あり、個数は1700以上あります。 外部であらかじめ作成したデータファイルを読み込む形式で作成したいと考えております。 CSV形式がよいのか、他の方法がよいのかご教授お願いいたします。
Windows8Proにmysql-workbench-community-6.0.8-win32.msiをインストールしました。 コマンドプロンプト(MySQL 5.6 Command Line Client)からパスワードを入力して ローカル接続できることは確認しました。 MYSQL WORKBENCH6.0とA5M2でも問題なく接続できますが、 かねやんmysqladminで接続ができません。 libmySQL.dlをmysqladmin.exeのルートに置くと接続できるとの情報があったので C:\Program Files\MySQL\MySQL Server 5.6\bin内に入れてみましたが同じです。 libmySQL.dlはBIN内になく、LIBにあったので上書きしてみましたが、こちらも同じです。 何か考えられることはありますでしょうか。
現在古いAccessで住所録の管理をやっていて、ハガキの印刷など帳票の出力にも使ってます。 近々PCを買い換えます、Accessは買い換えずにMySQLに移行しようと考えています。 データとしては問題ないのですが、入出力で困ってます。 特に帳票の出力は何で作ればいいものでしょうか。 というか、皆様何で作っているんでしょうか。 今までAccessだったので、そんなことを考えたこともありませんでした。 アドバイスをお願いいたします。
テーブル名：tb event | artist 23 | hamasaki 23 | hamasaki 23 | smap 24 | speed 24 | smap 上のデータは イベント23で浜崎が２曲歌ってSMAPが１曲歌い、 イベント24でスピードが１曲、SMAPが１曲歌ったようなことを考えます。 このようなデータが与えられたときに 浜崎が出演している回数をランキング形式で表示するのに SELECT artist, COUNT( artist ) FROM tb GROUP BY artist ORDER BY COUNT( artist ) DESC とすると同じイベント23で２曲歌っているので 浜崎は2回カウントされます。 これをイベントごとに１回分までしかカウントしない （参加したイベント数）のような意味でカウントするには どうしたらよいでしょうか？
'SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry '2147483647' for key 'hoge' ・「Duplicate entry」と表示されたので重複エラーかと思ったのですが、コードを見ても良く分かりませんでした ・そこで再度検索したら、「'2147483647'」まで含む同じエラーが幾つかヒットしました https://www.google.co.jp/search?q=Fatal+error%3A+Uncaught+exception+'PDOException'+with+message+'SQLSTATE%5B23000%5D%3A+Integrity+constraint+violation%3A+1062+Duplicate+entry+'2147483647'&oq=Fatal+error%3A+Uncaught+exception+'PDOException'+with+message+'SQLSTATE%5B23000%5D%3A+Integrity+constraint+violation%3A+1062+Duplicate+entry+'2147483647' ■質問 ・エラーの意味を教えてください ・「'2147483647'」には何か特別な意味があるのでしょうか？ ※エラー見た時は、'hoge'カラムに「'2147483647'」があって、それが重複されていると思っていたのですが… ■環境 ・MySQL
MySQLは「5.1」をCentOS5.8上で使っています。 - date,station 2013-11-01,urawa 2013-11-01,omiya 2013-11-01,omiya 2013-11-02,omiya 2013-11-02,akabane 2013-11-02,ikebukuro 2013-11-02,omiya - 日付ごとのdistinctなstationの個数について、 1ヶ月分の合計数を出すためのSQLを作りたいと思っています。 上の例で言うと、 2013-11-01はdistinctなstationは2個 2013-11-02はdistinctなstationは3個なので、 2013-11分の合計として、 「5」個という数を出したいと思っています。 - select count(distinct station) from table_name where date like '2013-11-%' - とすると日付の区別もなく、 固有のstationの個数として「4」個と出てきてしまい、 どうしていいか分からないでいます。 どんなSQLを作れば、 日付ごとの「distinctなstation数」の1ヶ月分の合計値を出すことが出来るでしょうか。 教えていただけますと幸いです。
お世話になります。 よく他のサイトなどで見かけるカテゴリ分けの際にそのカテゴリに属する件数を表示する際、下記のどような方法が賢いのでしょうか？ 【例】 登録されている不動産データ（1万件前後とします）を県別でカテゴリ表示 ・東京都（1,234） ・神奈川県(987) というように表示をしたい。 【方法１：】 データを追加・変更をする時点で、変更前のカテゴリの個数から-1、変更後のカテゴリの個数に+1をしてUPDATEで変更する 【方法2：】 定期的にcronでカウントするプログラムを走らせる ⇒ただこの方法だと実際の件数とCronが走るまでの間に個数に差が発生してしまう問題がでてしまう。 【方法3：】 ページを読み込む際に、count(*)で数える 【方法1】で作っていましたあ２つのカテゴリにまたがる場合（東京都、神奈川県両方）もあり、このとき【方法1】での処理が難しく質問をさせて頂きました。 上記以外にも何か良いカテゴリ件数の表示方法がありましたらアドバイス頂けますと幸いです。
「MySQL ODBC 5.1 Driver」でMySQLへの接続はできなくて困ってます。 ローカルデスクにあるMySQLには正常に接続できま、「Connection successful」と表示されます。 レンタルサーバーにあるMySQLに接続できなくて困っています。 問い合わせたところ、レンタルサーバーさんでは「接続できる設定だし、実際テストしたら問題なくできました」という回答でした。 ところが私のほうからやると、エラーになります。 エラー表示内容:Connection Failed:[08S01][MySQL][ODBC 5.1 Driver]Lost connection to MySQL server at 'reading authorization packet',system error:2 レンタルサーバーさんは、「私のほうの環境や設定の問題でしょう」ということで詳しい説明をしてくれません。 他のサーバーに置いてあるphpプログラムから正常にアクセスできますので、MySQL自体はなんら問題ないと思います。 「環境や設定の問題」って具体的に何をどう調べればいいのか分からず、困ってます、どなたか教えてください。
お世話になります。 VB.NETでウェブアプリ開発をしようと、以下の環境に、(1)～(4)の手順で環境を作成しました。 作業環境：Win7 x64 Pro（仮想マシン） 使用ツール：Visual Web Developer2010 MySQL：5.6.15 Conector/NET：6.7.4 (1)Visual Web Developer2010　をインストール (2)SQLServerではなく、MySQLが使いたい為、別途MySQLをインストール (3)データベース：TEST_DB　と、テーブル：t_sample を作成 (4)mysql-connector-net-6.7.4.msi　　をダウンロードし、インストール。 　（Select Platform:Microsoft Windows) 環境作成後、 Visual Web Developer2010　を起動し、プロジェクトを新規作成し データベースエクスプローラーより、接続の追加を選択し、 データソースの選択　ダイアログを開くきましたが データソース一覧に、MySQLが表示されず、接続が出来ません。 .net、MySQLで検索をしますと、多くの参考資料が見つかります。 その殆どが、「Conector/NETのインストール」だったのですが、 他にも何か必要なもの、あるいは操作が必要なのでしょうか？ もしくは、手順上に誤りがあるのでしょうか？ ご教授くださいませ。
タイトル通りですが、windowsで特にいじりません。 バックアップとして置いておきたいだけです。 置いてリストアなどでLinux側へ配置後実施の流れをとる場合、何か問題があるでしょうか。 [環境] Linux:CentOS6.3 windows:windows server 2003 mysql:mysql2 よろしくお願いします。
MySQL Version 5.1.41 このジャンルでお願いします。 例えば地名を格納する テーブル「area」 +------+-------+ |　id　|　name　| +------+-------+ |　1　|　渋谷１丁目| +------+-------+ |　2　|　渋谷２丁目| +------+-------+ があったとします。 次にその上位？（これらの丁目を包括する）データが必要なった場合に 新たにテーブルを作ってその外部キーをテーブル「area」に新たに追加する方法が良いのでしょうか？ テーブル「grouparea」 +------+-------+ |　id　|　name　| +------+-------+ |　1　|　渋谷区| +------+-------+ テーブル「area」←このテーブルの列構造をその都度変える +----+---------------+-----------+ |　id　　|　grouparea_id　　|　　　name　　| +-----+-------------+-----------+ |　1　　|　　　　　　1　　　　|　渋谷１丁目| +-----+-------------+-----------+ |　2　　|　　　　　　1　　　　|　渋谷２丁目| +-----+-------------+-----------+ でもこれだとさらにその上位概念のエリア「東京」や「東京」は 「関東」、あるいは「東日本」といった具合に追加したくなった場合に、 順番的に「grouparea」テーブルの先に「ken」テーブルを追加してて 後に「grouparea」テーブルを追加したくなったら テーブル「ken」 +------+-------+ |　id　|　name　| +------+-------+ |　1　|　東京都| +------+-------+ テーブル「area」 +----+---------------+-----------+ |　id　　|　　　　　ken_id　　|　　　name　　| +-----+-------------+-----------+ |　1　　|　　　　　　1　　　　|　渋谷１丁目| +-----+-------------+-----------+ |　2　　|　　　　　　1　　　　|　渋谷２丁目| +-----+-------------+-----------+ 次に「grouparea」テーブルを追加したくなったら テーブル「ken」 +------+-------+ |　id　|　name　| +------+-------+ |　1　|　東京都| +------+-------+ テーブル「grouparea」 +----+---------------+-----------+ |　id　　|　　　　　ken_id　　|　　　name　　| +-----+-------------+-----------+ |　1　　|　　　　　　1　　　　|　渋谷１丁目| +-----+-------------+-----------+ テーブル「area」 +----+---------------+-----------+ |　id　　|　grouparea_id　　|　　　name　　| +-----+-------------+-----------+ |　1　　|　　　　　　1　　　　|　渋谷１丁目| +-----+-------------+-----------+ |　2　　|　　　　　　1　　　　|　渋谷２丁目| +-----+-------------+-----------+ このような変更しなくてはいけないですよね？（このような変更が可能なのかは分かりませんが・・・） 自分的にはこのやり方は違うような気がするのですが、 なにか良いやり方や考え方があればアドバイス頂けないでしょうか？
wordpress目的でxamppを入れて、しばらく利用してたのですが 今日突然apacheのみ立ち上がらなくなりました。 mysqlとftpはOKです。 localhostはみれてます。 ☆環境 ・OS：mac 10.6.8 ・xampp：1.7.3 ・エラーメッセージ： httpd: Syntax error on line 120 of /Applications/XAMPP/xamppfiles/etc/httpd.conf: Cannot load /Applications/XAMPP/xamppfiles/modules/mod_apreq2.so into server: cannot create object file image or add library XAMPP内にmod_apreq2.soというのは無いようです。。。 ☆試したこと ・再起動 ・ポート80がかぶっていることが原因のケースがあるようなので確認しましたが特にスカイプなど利用しておらず無さそうです。 ・「システム環境設定」より「web共有」のon/off 再度インストールはまだしてないのですが、その前に改善方法があらばと、 ご質問させて頂きました。どなたかご教授いただけますと幸いです。
フォームに数個テキストボックスがあり任意の文字列で検索できるようにしていますが、 ”この文字列を含まないもの”　という検索もできると検索精度が上がります。 クエリの1つのフィールドの抽出条件に　 Like "*" & form!フォーム名!テキストボックス1 & "*" And Not like "*" & form!フォーム名!テキストボックス2 & "*" ということがしたいのですがうまくいきません・・・ （Like と Not Like が混在は無理　というのも理解できるのですが…） form!フォーム名!テキストボックス1　→　この部分に直接文字列を記述すると機能するのですが、フォームに入力された文字列を検索　という記述にすると機能しません… フォームのテキストボックスに何も記述されていない時は全部表示するようにしたいです。 こんなことは可能でしょうか? よろしくお願い致します。
お世話になります。 商品データとカテゴリテーブルをそれぞれ分けたデータベースを作っており、JOINで該当カテゴリ名を抽出しています。 しかし商品によって複数のカテゴリに属する（カンマ区切りで「1,2,3」というように現状格納しています）場合、それらのすべてを拾ってくることは可能でしょうか？ またカテゴリひとつひとつに対して商品データ内にカラムを用意するべきでしょうか？ select `shop`.no, left outer join list_category on `shop`.category=`list_category`.no （現状） どうぞよろしくお願い致します。
すいません。今phpなどを使いウェブサイトを作っているのですが、データベースがどうしても 必要となり、参考サイトなどを見ながら作りました。 ほとんどできたのですが、最後に一部データベースの関数などでわからない事があり困っています。 （正直私はプログラムはphp程度が少し分かる程度で、データベースも単純な使い方しかしない 予定なので参考サイトをざっと見ただけでmysqlの事がほとんど分かりません） ググってそれらしい物を探してはいるのですが、私がやりたい事はデータベースから 件数を取りたいだけです。 取った件数をphpで表示したいのですが、何時間やっても良くわかりません。 申し訳ないんですが取り出した後その件数をphpのechoで表示するまでをサンプルとして書いてもらえませんか？（可能であれば「ここでこのような処理が行われている」とコメントがもらえると助かります） データベース関係はphpと違って初心者用のサイトなども無く、書いてある事がほとんど分かりません。 （ここでSELECT COUNT(*)を使うと教えてもらったのですが、SELECT COUNT(*)でググっても サンプルなども出てきません） $pdo = new PDO("mysql:dbname=aaa", "root"); $pdo->query("set names utf8;"); // ------------------------------------------------ $sql = $pdo->query("SELECT COUNT(*) FROM bbb"); $stmt = $pdo->query($sql); $stmt->execute(); $count=$stmt->rowCount(); echo $count; ----------------------------------------------- $result = mysql_query("SELECT COUNT(*) FROM bbb"); $row = mysql_fetch_assoc( $result ); echo $row;
プログラム初心者です phpとmysqliの手続き型を使っています 簡単な掲示板を作りました MyISAM から InnoDBに変更したいです phpadminから InnoDBにテーブルは変更できました InnoDBを使うときのsqlはMyISAM で使っていたsqlをそのまま使っていいでしょうか?（特に変更するところはないでしょうか？） よろしくお願いします
すいません。今PHPとデータベースを勉強中なのですが、 $st = $pdo->query("SELECT * FROM udon WHERE not abc = '111' limit 5, 10 "); 例えば上記のような絞り込みをした後、絞り込んだ後の数を数えたいのですがそのような 事はできますでしょうか？ 絞り込み後の検索結果が５件以上の場合、残りを「次のページ」などのように分けて表示させたいのですがデータベースの絞り込み後の数を数える方法が分からないため先に進めません。 わかる方いましたら教えてください。
以下のようなSQL文があった場合 SELECT table_a.* FROM table_a LEFT JOIN table_b ON (table_a.id = table_b.aid) これでtable_bを連結したtable_aができると思いますが、table_bのフィールドは id , aid, value となっていた場合、valueが「1」かつ「2」のデータを検索する場合は、どのようにWHERE句を書けばいいのでしょうか。 WHERE (table_b.value = '1' AND table_b.value = '2') ではうまく取得出来ませんでした。 お分かりの方、よろしくお願いします。
表題にUNIQUE制約の値を「更新」する方法とありますが、 正確にはUNIQUE制約が設定された値を「入れ替える」方法について質問します。 あるテーブルに order という並び順（数値）を格納するカラムがあるとします。※このテーブルのプライマリーキーは id とします。 並び順ですので一意な値です。よって、order にUNIQUE制約を設定しています。 例えば 1～5 個のデータ（フィールド）があったとして、並び順も 1～5 あるわけですが、この並び順を入れ替える場合、並び順を格納しているカラム（ order ）にUNIQUE制約があるため、それぞれ UPDATE で上書きすることができません。 つまり、{ id: 1, order: 1 } というデータと { id: 2, order: 2 } というデータの並び順（ order ）を { id: 1, order: 2 } と { id: 2, order: 1 } というように入れ替えようとする場合、並び順（ order ）は一意であるため、UPDATE で上書きができないのです。 できればトランザクション内で処理したいのですが、これらの処理をスマートに更新する方法はないでしょうか。それとも、並び順（ order ）にUNIQUE制約を設定せず、アプリケーション側で並び順（ order ）を一意に保つよう実装するしかないでしょうか。
現在phpMyAdminを利用してデータを入力しています。 初めてで不安な点があるので詳しい方にお聞きしたいことがあります。 □数字の入力について 後から平均を出したり足し算したりする予定ですが、コンマを入れた状態でも演算できますか？入れない方が良いのでしたら、tableに出力するときにコンマを入れて出力できれば良いのですが。 「20,150」「20150」 □名前の入力について 現在は「山田　太郎」というように姓と名の間に全角スペースを入れて一つのフィールドに入れているのですが、これは姓と名で分けたほうが良いでしょうか？ 例えばスペースを入れた状態でサイトの閲覧者がテキストフィールドから「山田太郎」と入力し検索して引っかかりますか？ □改行について 一つのセル？内に改行してデータを入力することはできますか？ 以上の三点です。 ご存知の方いらっしゃいましたらご教示ください。 よろしくお願いします。
お世話になります。早乙女遙佳と申します。 Webサイト上から会員名や点数を入力し、 送信ボタンが押されると、 受け取ったCGI側でDBに書き込み、 今月成績の良かった方、上位3名は○○さんと○○さんと○○さんです というサイトを作りたいと思っています。 データベースは、MySQLを使って学習していますが、 教えていただけますでしょうか？ scoreテーブルとして、以下のテーブルを作っています。 会員の毎月の点数と、先月からの点数の増加分を格納するテーブルです。 ID name score month increment 1 taro 100 11 0 2 jiro 200 11 0 3 taro 50 10 0 4 jiro 250 10 0 /* 今月の点数を求める */ SELECT score AS thisMonthScore FROM `score` WHERE name = 'taro' AND MONTH = '11'; /* 先月の点数を求める */ SELECT score AS prevMonthScore FROM `score` WHERE name = 'taro' AND MONTH = '10'; /* 点数の増加分を書き込む */ UPDATE `score` SET `increment`= 50 WHERE name = 'taro' and month = '11'; 質問１ 上記のUPDATE文では、増分を書き込むために、 `increment`= 50 としていますが、 upScore = thisMonthScore - prevMonthScore `increment`= upScore のように書けたらと思うのですが、できないものでしょうか？ 質問２ WHERE name = 'taro' の様に各会員の氏名を書いていますが、 「すべての会員についてループさせる」 様にはできないでしょうか？ 擬似コードですが memberName = select name from `score`; //会員名の配列 memberCount = select count('name') as cnt from `score`; //会員数 for (i = 0; i < memberCount; i++){ 　thisMonthScore = SELECT score AS thisMonthScore FROM `score` WHERE name = 　memberName[i] AND MONTH = '11'; //今月の点数 　prevMonthScore = SELECT score AS prevMonthScore FROM `score` WHERE name = memberName[i] AND MONTH = '10'; //先月の点数 　upScore = thisMonthScore - prevMonthScore; //点数の増加分 　UPDATE `score` SET `increment`= upScore WHERE name = memberName[i] and month = '11'; //DBの更新 } のようなイメージです。 DBの呼び出し元であるCGIでループを書けばもちろんできるのですが、 SQL文で処理させた方が速いのかなとも思ったりもしたのですが、 通常、どのように書くものでしょうか？ 毎月100件、1年で1000件、10年分で10000件くらいのレコード数になりますが、このくらいであればあまり速度などは気にせずとも良いものでしょうか？ 質問３ 成績の良かった方、上位3名を抽出するにはどのようなSQL文になるでしょうか？ 第一位　taroさん 50点 第二位　jiroさん -50点 第三位　saburoさん -100点 のような感じです。 初歩的な質問で恐縮ですが、 どうぞ、よろしくお願いします。
no | food_id ---------- *1 | 2 *2 | 3 *4 | 1 ---------- food_id | food -------------- **** 1 | バナナ **** 2 | ラーメン **** 2 | いちご ------------ こんな風にIDの対応表みたいな テーブルを作ったとして 今までfood_idみたいなネーミングをしてたのですが 紛らわしいかなと思って名前を変えたいと思いました。 よくあるパターンだと思うのですが どんな一般的にネーミングが考えられますか？
以下の様なデータが、データベースに入っています。 table 映画データ 映画館　　　　映画名　　　　 日付　　　 メモ ------------------------------------- バルト9 　「タイタニック」　　2013-10-16　　※2000円 バルト9 　「E.T」　　　　　　　2013-10-19　　※子ども向け 渋谷東急　「007」　　　　　　2013-10-17　　※R指定 バルト9 　「タイタニック」　　2013-10-17　　※2000円 渋谷東急　「007」　　　　　　2013-10-18　　※R指定 渋谷東急　「アメリ」　　　　 2013-10-20　　※女性向け バルト9 　「E.T」　　　　　　　2013-10-18　　※子ども向け バルト9 　「タイタニック」　　2013-10-15　　※2000円 渋谷東急　「007」　　　　　　2013-10-19　　※R指定 これを映画館 >映画名 > 日付（初めから終わりまでつなげる）の順番で抜き出したいです。 以下のように。 バルト9 　「タイタニック」　　2013-10-15 - 2013-10-17　　※2000円 バルト9 　「E.T」　　　　　　　2013-10-18 - 2013-10-19　　※子ども向け 渋谷東急　「007」　　　　　　2013-10-17 - 2013-10-19　　※R指定 渋谷東急　「アメリ」　　　　 2013-10-20　　　　　　　　　　　※女性向け このようなSELECT文はどう書けばよいでしょうか。 すみませんがよろしくお願いいたします
id place 5　上野 6　銀座 7　銀座 これに対して SELECT place,count(*) FROM tb GROUP BY place ORDER BY COUNT(*) DESC; でplaceのvalueごとのランキング的なものを作成することはできたのですが id place 5　上野 6　銀座,東京 7　銀座,上野 8　銀座 に対して place COUNT(*) 銀座 3 上野 2 東京 1 という表を表示したいのですが、可能ですか？
初心者ではございますが、質問失礼いたします。 下記のようなＳＱＬ文を使っています。 例文： SELECT table1.no, table1.titile, table1.date FROM table1 WHERE ( table1.title REGEXP "りんご" || table1.title REGEXP "みかん" || table1.title REGEXP "ばなな" || ......... AND date > '2013-11-11' ORDER BY table1.date DESC table1.titleから、各単語を含むタイトルを全て表示させるもので、 検索する単語は無制限に増える予定です。 現在の文でも結果など特に問題ないのですが、 コードが長くてこれでいいものかと思い探したところ特になかったため、 良い方法をご存知の方がいらっしゃったら・・・という望みで 質問の方させていただきました。 お時間のある際にでもお教えいただければと思います。 もし、上記に変わる表現がない場合は、無いとお教えいただければ助かります。 何卒宜しくお願い致します。
MYSQLを使っています。 【売上テーブル】 ||　日付　||　金額　|| ----------------- ||　2011/01/01　||　100　|| ||　2011/01/01　||　200　|| ||　2011/01/02　||　600　|| 　　　　　　　　　　・ 　　　　　　　　　　・ 　　　　　　　　　　・ ||　2012/12/31　||　500　|| ||　2012/12/31　||　100　|| SELECT　SUM(金額) FROM　売上テーブル WHERE　日付 BETWEEN '2011-01-01' AND '2011-12-31' GROUP BY DATE_FORMAT(日付, '%Y/%m') で月初から月末のデータを表示させることはできますが、 2011/01/10～2011/02/09を一か月として 以降は 2011/02/10～2011/03/09 2011/03/10～2011/04/09 　　　　　　　・ 　　　　　　　・ 　　　　　　　・ 2011/12/10～2012/01/09 といった感じに1年間のデータを表示させる方法がわかりません。 どうぞ宜しくお願いします。
MySQLの設計について質問があります。 まずDBの設計ですが以下のような場合どのようにすればよいのでしょうか？ 1. 商品情報が数十万件あり、商品DBを作ってその中に全商品を登録するテーブルを作る 2. 各会員が上記の中から自分が扱いたい商品を登録するテーブルが必要 このとき、2.のテーブルは、 　A. 1.のDBの中に作る 　B. 各会員のDBを作ってその中に扱いたい商品のテーブルを作る 　C. 会員DBを作って会員ごとのテーブルを作る のどれが正しいのでしょうか？各会員が扱う商品数も数万～数十万件になります。 どうぞよろしくお願いいたします。
必要に駆られたのでMySQLについて勉強しているのですが、 ファイル読み込みで問題が起こり、詰まってしまっています。 MySQL上で自作したsampledb内にテーブルprefectureを作成し、 そのテーブル内にPrefecture.csvファイル(文字コードshiftJIS)からデータを入力しようと しているのですが、最初の一件しかテーブルに格納されず、他のデータが入らないのです。 以下に入力したクエリ文を掲載します。 create database sampledb　default character set sjis create table Prefecture(PREF_CD INT(3),PREF_NAME VARCHAR(10),PRIMARY KEY(PREF_CD)) LOAD DATA INFILE "Prefecture.csv" -> INTO TABLE Prefecture FIELDS TERMINATED BY"," -> LINES TERMINATED BY"\r\n"; Query OK, 1 row affected, 1 warning (0.08 sec) Records: 1 Deleted: 0 Skipped: 0 Warnings: 1 select * from prefecture +---------+-----------+ | PREF_CD | PREF_NAME | +---------+-----------+ | 　　　　　 1 | 北海道 2 | +---------+-----------+ 1 row in set (0.00 sec) Prefecture.csvについてはこちらのサイト仕様上添付できませんでしたが、 1,北海道 2,青森県 3,岩手県 . . .（以下省略） のように、47都道府県の番号と地名を並べたものです。 独力では解決法を見出せません。 どうかご助力お願いします。
すいません。PHPを初めて勉強して実際にプログラムを作ってみたのですが、 その際データベースについて少し疑問があります。（初めてデータベースやPHPに触るので おかしな質問だったらすみません） 私は自分で撮った写真等を自分のウェブサイトに掲載したいと考えています。 データベースも同時に勉強し、とりあえずウェブサイトの形はできました。またデータベースに 入れるフィールドが8個あります（フィールドというのかカラム名というのかよくわかりませんが・・） さらに写真が2000枚くらいありますのでかなりの量となります。 （写真は今後もっと増えます） 例 写真のファイル名、カメラの種類、日付、季節、場所、カメラの設定、コメント、評価 これを季節や日付、場所など絞込、並び替えなどを訪問者が自由に できるようにしたいと考えています（フォームボタンを設置してラジオボタンなどで 並び替えをするサイトです。並び変えはデータベースで行いループで全てphpで表示します） ただそれに加え、画像の横に以下のような説明欄を設けデータベースから表示させるつもりです。 日付　2013-1-1 場所　海 カメラの種類　*** カメラの設定　*** コメント　********** 例えば　日付なら"日付$ggg"みたいな事になります。つまり以下のようにします。これが一番 更新が楽なのでそうしたいです。ただこの場合だと当たり前ですが5つのフィールドから5つの データを取り出す事になりますし、さらに何千枚もの写真の並び替えも同時に行う事になります。 （並び替えのプログラムなどは省略してあります） $pdo = new PDO("mysql:dbname=*****", "root"); $pdo->query("set names utf8;"); // $st = $pdo->query("SELECT * FROM ******************"); while ($row = $st->fetch()) { $ggg = ($row['日付']); 日付　$ggg 場所　$aaa カメラの種類　$bbb カメラの設定　$ccc コメント　$ddd 表示は1ページに200枚ぐらいと考えていますが、このような事はレンタルサーバーで可能なので しょうか？パソコンの事はあまり詳しくないのですが、普通に考えれば処理できそうにないような 気がしますがどうでしょうか・・。
MySQLでデータベースを作成して、データベース認証させてコンテンツを表示するプログラムを書いているのですが、パスワードやユーザー名をルートディレクトリの外に置いてrequire_onceする意味が今ひとつわからないので教えて下さい。 require_once('../../../DBparameter.php');　//　DBparameter.phpの中にパスワードやユーザー名 として、ルートディレクトリの外にDBparameter.phpを置けば確かに、パスワードやユーザー名を見ることはできませんが、このプログラムが存在するフォルダ内をのぞけるぐらいの詳しい人であれば、このプログラムを見るのは簡単にできると思うんですが、そうすると、 $con = mysql_connect(host, username, password); などとしてデータベースを開き、結局はデータベース内の情報を抜かれてしまうような気がするのですが、どうなんでしょうか？ 確かに、データを抜き取るためのプログラムを他人のドメインにアップロードするのは簡単ではないので、ほとんど無理だとは思うんですが、それならばスクリプト内にパスワードやユーザー名をそのまま書いてもいいのではないかという気がするんです。
01234561 の中に 1 は何個ありますか？ 期待値 2 という文字列に対する関数があったはずなのですが、調べても出てきません。 ご存知の方いらっしゃいましたらお願いします。
PHPとSQLで投稿サイトを作成中の初心者です。 いままでsjisで統一してきたものを、character_setをutf8に変換したく、 MySQL\MySQL Server 5.0\my.ini ファイルの default-character-set=sjis となっていたところをすべて default-character-set=utf8 に変え、 show variables like 'character_set%'; で確認しましたが、下記の状態となり、いくつかutf8 にかわってくれません。 +--------------------------+---------------------------------------------------------+ | Variable_name | Value | +--------------------------+---------------------------------------------------------+ | character_set_client | utf8 | | character_set_connection | utf8 | | character_set_database | sjis | | character_set_filesystem | binary | | character_set_results | utf8 | | character_set_server | sjis | | character_set_system | utf8 | | character_sets_dir | C:\Program Files\MySQL\MySQL Server 5.0\share\charsets\ | +--------------------------+---------------------------------------------------------+ 残りのdatabase, filesystem, serverもutf8にしたいと思い。 my.iniファイルが他の場所にあるのかいろいろさがしていますが、まだ見つけられません。 どこを調べて、どこを変えればよいのか、お分かりの方いましたらご教授ください。 また、もしかすると全てutf8にしなくても良いのかも知れませんが、いろいろ調べていると皆さん統一されて いるようにお見受けしたので恐らく統一すべきなんだろう、と解釈しています。 MySQL Command Line Clientで 設定ファイルを読みにいく順番と場所を示してくれるコマンドとかないでしょうか？ 稚拙な質問で恐縮ですが、どなたかご指南よろしくお願いいたします。
データベースについて詳しい方にお聞きしたい事があります。 初心者なので書いている内容におかしな点もあるかと思いますが、よろしくお願いします。 5年ほど前のJavaを習っていて、簡単なデータベースを作ったことはあります。 □現在、会社が違うレンタルサーバーを一つずつ借りています。 A社のサーバー上で作成したデータベースをB社のサーバー上に公開しているサイトから呼び出し、テーブルを一覧表示できるのでしょうか？ □初心者がデータベースを作成するにはphpMyAdminを使用するのが一番良いでしょうか？ 使い方を検索してみたらちょっと難しそうですね。 Javaでデータベースの勉強をしていた時はあらかじめ作ったフォームにデータを入力していくだけだったので、同じような感じのシステムはないかなと思いました。 □現在使用しているサーバーはMySQLが5つ使えると書いています。 既にWordPressでブログ開設していて4つ使用しています。残りは一つ。 野球チームのデータベースを作成しようと思っているのですが、これまでの試合の記録のデータ、これまでの選手のデータのデータベースを作成したいと思っています。 MySQLは残り一つですが、この二つのデータベースを作る事は可能なのでしょうか？二つ必要ですか？ □スマホのサイトも作成しているんですが、PCサイトと同様にデータベースに接続し、一覧表示できるのでしょうか？ スマホでPHPが使えるのかなと思ったので。 ご存知の方いらっしゃいましたらご教示ください。 よろしくお願いします。
プログラム初心者です phpとmysqlで簡単な掲示板を作りました カラムは sure、title、text、time、name selectで同じスレ名をselectします それで取得できたのがこんなかんじになります スレ名(sure) タイトル(title) テキスト(text) 書き込まれた時間(time) 書き込んだ人の名前(name) タイトル(title) テキスト(text) 書き込まれた時間(time) 書き込んだ人の名前(name) このレス一覧に番号を振る方法を教えてください こんな感じにしたいです NO2 タイトル(title) テキスト(text) 書き込まれた時間(time) 書き込んだ人の名前(name) NO1 タイトル(title) テキスト(text) 書き込まれた時間(time) 書き込んだ人の名前(name) よろしくお願いします
・MySQLのGREATESTで、引数のどれかが NULL である場合、NULLを戻さず、それ以外の残りから ( 最大値の ) 引数を戻すことは可能でしょうか？ ・また、GREATEST以外で、同じような処理をするにはどうすれば良いでしょうか？ ・後、MAXとは何が違うのでしょうか？ ■最終的にやりたいこと ・「aカラム」と「NULLを含むbカラム」の最大値基準で、降順表示したい
■前提 ・MySQLの同じテーブル内に、datetime型の「aカラム」「bカラム」がある ■質問 ・この時、bカラムがNULLだったら、aカラムの値をbカラムへコピーするSQL文を教えてください
顧客ごとにテーブルを作る香ばしいプログラムのSQL文を書くことになりました。 user_0001 user_0002 user_0003 user_0004 user_0005 といった具合にどんどん増えていきます。 カラムは仮に id, name, tel が入っているとします。 プログラムの修正は行えません。 通常JOIN句でテーブルの結合を行うと思うのですが、「user_」という文字列を含んでいるテーブルを全て結合せよ！みたいな命令文はSQLで書けるのでしょうか？ 無理、無駄、素直にプログラムで出せ、というアドバイスでも構いませんのでよろしくお願いします。
　ある教本でPHPを勉強中です。 私のパソコンは普通の現代版Wiedowsパソコンですがそのパソコンに、 　XAMPPをインストールして、MySQLを構築しました。 最初は手探り状態でスタートして、やっと教本の半ばを過ぎました。 　現在、６章を勉強中です。 その６章はMｙSQL（RDB）の、最初に「Webアプリケーションの標準構成」の図がありました。 　図を言葉で表すと 　「各端末 ⇒ Webサーバ ⇔ PHP ⇔ MySQL」 　となります。 　その図を、客観的に見た場合、 Webサーバ ⇔ PHP ⇔ MySQLと別々に書かれているので、 　　３台のパソコンで構築されているように見れます。 　たぶん間違いはないと思うのですが、XAMPPは、「Webサーバ ⇔ PHP ⇔ MySQL」を一台の パソコンで構築できるとの認識で間違いないでしょうか！？ 　教本は「基礎から学ぶ」とは書いてありますが、ページ制限も有るだろうから、詳しくは、解説がありません！？ 　以上よろしくお願いします。 　
PHPとMySqlを勉強し始めたものです。 超初心者ですが、よろしくお願いします。 ＠PAGES（http://atpages.jp/）というサイトを使っています。 ネットで見つけたサンプルプログラムを使って、データベース（MySql）へのデータの入力と読み出しをやってみたのですが、半角英数字なら、読み込みや書き出しはできるのですが、日本語の文字であれば、空白になってしまいます。 プログラムを調べてみると、PHPでのデータベースへの書き込みのときは、ちゃんと日本語の文字を書き出そうとしているようなのですが、「phpMyAdmin」というサイトで書き込まれた情報を見てみると、空白なので、データベース側がデータの受け取りを拒絶したようにも思われます。 サイトで検索して、HTMLの<HEAD></HEAD>のところに下記のような行を入れたり、 <meta http-equiv="Content-Type" content="text/html; charset=euc-jp"> 『mysql_query("SET NAMES 'utf8'"); 』という行をデータの書き込み行の前に入れたりしても、変わりませんでした。 どのようにすれば、日本語もデータベースで扱えるようになるのか教えてください。 よろしくお願いします。
頭の整理ができないので技術的なこともさることながら、SQL構築の考え方もうかがいたいのですが、 以下のテーブルに対して、スペース区切りで複数キーワードをAND条件で結ぶとして ID　MyCol1　MyCol2 -------------------------- 1　いちご　みかんジュース 2　ぶどう　いちごみるく 3　みかん　すいかジュース 4　すいか　めろんソーダ 5　めろん　ぶどうガム 検索フォームに「いちご　ソーダ（※スペース区切り）」と入れたら、IDの1、2、4がマッチするようにしたいです。 スペース区切りで複数キーワードをAND条件で結ぶSQLは、以前教わりました。 http://okwave.jp/qa/q1212708.html $sql = 'select * from t_url'; if ($title != '') { $titles = array(); foreach (preg_split('/(\s|　)+/', $title) as $word) { array_push($titles, "MyCol1 like '%$word%'"); } $sql .= ' where (' . implode(' and ', $titles) . ')'; } 今回の質問は、受け取った$titleを「MyCol1」だけでなく「MyCol1かMyCol2」にも同じ照会する方法をうかがいたいです。 検索キーワードが「いちご　ソーダ」だったとき、MyCol1だけなら、 and (MyCol1 like '%いちご%' and MyCol2 like '%ソーダ%') でよいわけですが、MyCol2はどう熱かったらいいのでしょうか。 and (MyCol1 or MyCol2 like '%いちご%' and MyCol1 or MyCol2 like '%ソーダ%') みたいにできればよいのでしょうが。 PHPのコードも、上記のものだとMyCol1にしか照会がかかりませんが・・・
MySQL5　に年度、通し番号が　格納されており、 select year, number from mytable ・・・と抽出すると以下のようになります。 2005　1 2005　2 2005　3 2008　4 2008　5 2008　6 2008　7 2008　8 2010　9 2011　10 2011　11 2011　112 同じ年度グループ内で、最大となる通し番号の行に「myFlg =1」と付けるSQL文をご教示ください。if とか group by とか as myFlg =1 みたいな記述をするのかなと想像するんですが・・・ PHP5のWHILE文でmyFlg = 1となっている行だけを出力し、上記データ例では、 while ($col = mysql_fetch_array($rst)) { if ($col['myFlg']) == '1') { echo $col['year'] . "年の最大番号は、" . $col['myFlg']. "番"; } } を実行することで、以下のような結果を得ることを期待しています。 2005年の最大番号は、3番 2008年の最大番号は、8番 2010年の最大番号は、9番 2011年の最大番号は、112番 よろしくお願いします。
テーブル名 : table1 カラム1 : id(int) カラム2 : table2_id(int) テーブル名 : table2 カラム1 : id(int) カラム2 : time(int) ← phptaimestamp この二つをviewとして連結したいです。 table1.table2_id と table2.id をキーにするとして、問題はtable2.dateの中身がphpのtimestampで格納されている事です。 VIEW上で連結した際に、このtable2.dateのphpで吐いたtaimestampを通常の20131015の様な変換を加えたいのですが、MySQLの中で完結する方法はあるのでしょうか？ 長文で申し訳ありませんが、アドバイス宜しくお願いします。
プログラム初心者です シンプルな掲示板をつくりました ホームページのトップページに新しく書き込まれたスレッドを表示したいです 状況を説明します bbsに書き込まれたらbbsテーブルに行番号を付けてどんどんインサートしていくようにしてます トップページはindex.phpです index.php(トップページ) mysqli（手続き型）のカラム　bbsテーブル id （オートインクリメントでつけた行番号） bbs_id （タイトルごとのid。これでタイトルごとにまとめています） title スレタイトル mes 書き込まれた文章 name 書いた人の名前 time 型はdatetimeです（書き込まれた日付） 例えば、下記のように書き込まれたら 新しい書き込みがbbs番号3番のスレが2013-09-10 12:10:00 新しい書き込みがbbs番号5番のスレが2013-09-10 12:00:00 だとしたら 3番のスレへのリンク 5番のスレへのリンク のようにトップにスレへのリンクを書き込みが新しい順に20くらい表示したいです よろしくお願いします
さくらインターネットや、カゴヤのデータベースサービスを利用しているのですが データをバックアップするにもいつも途中で止まってしまいます。 データは多いテーブルで100万データあります。 効率のよいバックアップ方法、もしくは別サービスのデータベースに移す方法とかありますでしょうか？ よろしくお願いします。
使用環境：mysql　5.1 内容：テーブルに格納されている最後の行数が知りたいです。 テーブル名：seito noname 1tanaka 2suzuki : : 100kato のように1つのレコードに番号を振って名前をつけているのですが、 「seito」テーブルに登録されている最後の番号を取得するSQL文 を教えていただけないでしょうか？ ちなみに、最後が必ず「kato」というわけではないので「seito」テーブルの noカラムにおける最後の番号を取得したいと考えてます。 上記の場合「100」番が取得できれば希望の結果となります。 よろしくお願い致します。
■環境 ・MySQL ■前提 ・テーブルA … idカラム ・テーブルB … A_idカラム ■やりたいこと ・テーブルAデータを取得する際、テーブルAレコードに応じて、テーブルB「A_idカラム」の数(レコード数)も取得したい ■取得イメージ例 ・テーブルA「全カラム」、「count」カラム ※「count」カラム … テーブルBにある「A_idカラム」の数 ■知りたいこと ・どこにも存在しないこの「count」カラムはどうやって作成したら良いでしょうか？ ・全体のSQL文
３つのテーブルを結合させたSQL文について作成方法を教えてください。 よろしくお願いいたします。 【テーブル構成】 テーブル名---項目名/項目名・・・です。 tblA---id/del_flg/name tblB---id/del_flg/add tblC---id/del_flg/family 各テーブルはidによりリンクされます。 tblAのdel_flgは在籍者＝0　退職者＝1で、一人１レコードです。 tblBでは住所管理をしています。 旧情報を残したいので、更新時には新たにdel_flg＝0でレコードを作成し、既存レコードはdel_flg＝1に更新します。 tblCは、既婚者のみ作成されるレコードです。 つまり、tblBとtblCは、レコードが存在しない、あるいはdel_flg＝0のみ、del_flg＝0とdel_flg＝1が混在　のどれかのパターンになります。 【やりたいこと】 いま、これらすべてのテーブルを全部つなげて、在籍している人の情報だけ集めたいのです。 tblAからはdel_flg=0のレコードをすべて取得したうえで、tblBとtblCにdel_flg＝0のレコードがあればその情報も取得したい。 【経過】 select * from (tblA inner join tblB on tblA.id = tblB.id ) inner join tblC on tblA.id = tblC.id とりあえずwhere条件をつけなくても、tblCに存在している人しか取得ができないのです。 where条件も含めて、上記条件のもと、希望するようなSQLの組み立て方をご教授ねがいたいのでよろしくお願いいたします。 できれば、早目の回答が希望です。
さくらのレンタルサーバを利用しています そのサーバにあるphpMyadminの利用での質問です さくらサーバのデータを1レコードCSVでエクスポートした時、テキストエディターで そのデータをみた時、本来、1行で表示されるべき所が複数行になってみえています。 よくみると、さくらサーバ側のあるフィールドで改行して表示させている所が エディター側で改行されているようです CSVにエクスポート時にどこか指定する所がありきちんとみえるようになるのでしょうか よろしくお願いします。
Mysqlにてテーブルをロックしようとして以下２つの方法を試し疑問に思ったので質問します。 １．select for update によるテーブルロック 以下のselect for update（where句にレコードを一意に特定できない条件を指定） をコマンドライン で実行。 select * from test where test_state=0 for update; 別に起動したコマンドラインから下記アップデート文を実行したところ ロックされることが確認できました。 update test set test_official=0 where test_id = 1; しかし、最初に実行した select for update 文を下記のようにしたところ上記update文はロックされず に実行されてしまいました。 select * from test where test_state　is null for update; これはなぜでしょうか。
先程、次のような質問をして、素晴らしい回答をいただきました。 http://questionbox.jp.msn.com/qa8279886.html しかし、ベストな回答でない事に気付きましたので、再び質問させていただきます。 ちなみに、データベースはMYSQLです。 下記が先程の質問の回答を踏まえて少し質問を変えたものです。 重要なのが☆の部分です。 ************************************************************************ 現在の日時を基準に下記テーブルより直近で空いている日付とその時間帯を求めるSQLを教えて下さい。 下記のjikan_tblは、未来の予定のレコードが登録されています。 １レコード目は、2013年9月27日10時から同日の10時15分までの予定のデータです。 ☆（先程の質問はこちら） 15分間隔で予定のレコードを登録していますが、現在の日時が2013年9月27日の10時の場合、 直近で予定を入れられる時間帯を知りたいのでSQLで同日の10時45分から11時が空いていると取得できればベストです。 ちなみに同日の11時15分から11時30分と取得されてしまうのは、NGです。 ☆（今回の質問ではこちら） 15分間隔で予定のレコードを登録していますが、直近で予定を入れられる15分間隔の時間帯を知りたいので 次のそれぞれのパターンで取得できればベストです。 現在日時：2013年9月27日の8時50分の場合　→　取得時間帯は9:00～9:15 現在日時：2013年9月27日の9時05分の場合　→　取得時間帯は9:15～9:30 現在日時：2013年9月27日の10時00分の場合　→　取得時間帯は10:45～11:00 現時点から直近の15分区切りの時点を求め、求めた時点から直近で空いている15分間の時間帯を求めたいです。 先程の回答では、27日10時現在では、素晴らしい結果がでましたが、現在時間を27日9時と設定しても 10時45分から11時が求められました。 私の質問の書き方が悪かったと思います。 回答していただいた方にお詫びします。 jikan_tbl start datetime, end datetime jikan_tblのレコード 2013-09-27 10:00| 2013-09-27 10:15 2013-09-27 10:15| 2013-09-27 10:30 2013-09-27 10:30| 2013-09-27 10:45 2013-09-27 11:00| 2013-09-27 11:15 2013-09-27 11:30| 2013-09-27 11:40 知恵を貸して下さい。 宜しくお願いします。 os: windows 7 eclipse: Version: 4.2.0 Build SDK: Android 4.3(API 18) PHP 5
現在の日時を基準に下記テーブルより直近で空いている日付とその時間帯を求めるSQLを教えて下さい。 下記のjikan_tblは、未来の予定のレコードが登録されています。 １レコード目は、2013年9月27日10時から同日の10時15分までの予定のデータです。 15分間隔で予定のレコードを登録していますが、現在の日時が2013年9月27日の10時の場合、 直近で予定を入れられる時間帯を知りたいのでSQLで同日の10時45分から11時が空いていると取得できればベストです。 ちなみに同日の11時15分から11時30分と取得されてしまうのは、NGです。 jikan_tbl date_start int(8), time_start int(4), date_end int(8), time_end int(4) jikan_tblのレコード 20130927 | 1000 | 20130927 | 1015 20130927 | 1015 | 20130927 | 1030 20130927 | 1030 | 20130927 | 1045 20130927 | 1100 | 20130927 | 1115 20130927 | 1130 | 20130927 | 1140 難しく調べても分かりません。 知恵を貸して下さい。 宜しくお願いします。 os: windows 7 eclipse: Version: 4.2.0 Build SDK: Android 4.3(API 18) PHP 5
SELECT id (price * 10) FROM table WHERE id IN (1, 2, 3) を、実行すると +--+-----+ | id | price | +--+-----+ | 1 | 100 | | 2 | 100 | | 3 | 100 | +--+-----+ に、なります。 この結果に対してid1には*10、id2には*20、id3には*30というような処理はMySQLで可能でしょうか？ 期待値としては +--+-----+ | id | price | +--+-----+ | 1 | 100 | | 2 | 200 | | 3 | 300 | +--+-----+ です。 よろしくお願いします。
質問は二つあります。 (1)二つのコードをひとつにしたいのですが、どうもうまくいきません SELECT id, （price * 10) FROM table WHERE id = 1; SET @sum = @sum + (SELECT ( SELECT id, （price * 10) FROM table WHERE id = 1); (2)コードの簡略化 SELECT id, （price * 10) FROM table WHERE id = 1 OR id = 3 OR id = 8; の、WHERE id = 1 OR id = 3 OR id = 8; の部分です。 よろしくお願いします。
説明下手ですがお付き合いください。 まず table には +----+---+ | id | num | +----+---+ | 1 | 10 | | 1 | 10 | | 2 | 10 | +----+---+ この様な値が格納されており、これに対して SELECT id, SUM(num) FROM teble GROUP BY id; を実行すると +----+---+ | id | num | +----+---+ | 1 | 20 | | 2 | 10 | +----+---+ この様になります。 では、本題です。 上のコマンドで出力した結果に対してさらに 20 <= num のような条件を付加させたいです。 その場合の期待値としては +----+---+ | id | num | +----+---+ | 1 | 20 | +----+---+ です。 書いてて泣きたくなる程説明が下手ですが、よろしくお願いします。
現在桁指定での値取り出しはこうやっています。 mysqlテーブルのhogeの中にある1～3桁の値を取り出す。 SELECT hoge FROM mysql WHERE hoge LIKE '_' OR hoge LIKE '__' OR hoge LIKE '___'; これを1～8桁なんてことにすると*8も書くことになります。 何か省略の方法ありましたら御教授下さい。 よろしくお願いします。
SELECT @num := "abcdef"; を実行すると +--------+ | @num | +--------+ | abcdef | +--------+ 結果はこうなります。 次に現在悩んでいる事なのですが、 SELECT @num := "abcdef" FROM @num WHERE @num LIKE '%a%'; これを実行すると ERROR 1064 (42000) ～省略～ at line 2 と、なります。 FROMの書式が悪いのかな？と色々と調べ (@num) ("@num") @num := "abcdef" 等々色々当て込めてみ、 SELECT @num := "abcdef" FROM (SELECT @num := "abcdef") WHERE @num LIKE '%a%'; ERROR 1248 (42000): Every derived table must have its own alias line2の書式はクリア？したのですがここから一歩も前に進まない状態です。 特に何に使うという訳ではなく実験的な試みです。 MySQLの仕様だったらそれはそれでスッキリするので投稿させて頂きました。 もしよろしければ回答いただけると幸いです。 よろしくお願いします。
さくらサーバを利用しています そのサーバにあるphpMyadminの利用で質問させてください テーブルAにレコードA1～A1000までの1000件のデータがあります そこに1001件目のレコードを追加したいのですが、フィールドが 700項目程度あり、そこに1項目ごと入力するのが大変なので、 A1～A1000のデータの中から、類似の1つのレコードをCSVでダウンロードして パソコン側でそのデータを修正してアップロードしたいと思います そこでphpMyadminを利用しての次のような手順でデータ操作しようと思っています phpMyadminのメニューにあるエクスポートで該当のレコードをPC側に抽出し そのデータをエクセルで必要な所を修整します そして、A1～A1000にないID番号を振り、そのデータをphpMyadminで インポートさせようと思います そこでお聞きしたいのは この1件のデータをインポートをさせた時、サーバ側にある1000件のデータにプラス されて1001件になるでしょうか それとも、1000件の上にインポートされたデータがかぶせられて、1000件の データがなくなり1件になってしまうのでしょうか 自分では前者のように1001件になると思うのですが万一後者になったら 大変なため質問させていただきました よろしくお願いします。
mysql初心者です phpとmysqliを使っています テーブルhogeにid、gifとカラムがあります gifのカラムを空にしたいのですがこんな感じでいいでしょうか？ mysqli_query($link,sprintf('UPDATE hoge SET gif="%s" WHERE id=%d', "", mysqli_real_escape_string($link,$id) )); よろしくお願いします
タイトル通りです。 VirtualBoxの仮想環境のCentOS内に Apatch+PHP+Mysqlで開発環境を作っているのですが どうにもこうにも文字化けします 症状としては phpmyadminで確認した時、日本語のデータが正しく表示されるが 実際にphpでデータベースから取り出して表示すると???になります。 phpのフォームから日本語を入力してそのデータを表示すると正しく表示されるのですが 今度はデータベース内のデータが文字化けしています。 こちらのスクリプトでは文字化けしないのでPHPの設定ミスではないようです http://tsuttayo.jpn.org/php/char_trn/ phpinfoの情報 DirectiveLocal ValueMaster Value mbstring.detect_orderautoauto mbstring.encoding_translationOffOff mbstring.func_overload00 mbstring.http_inputautoauto mbstring.http_outputpasspass mbstring.http_output_conv_mimetypes^(text/|application/xhtml\+xml)^(text/|application/xhtml\+xml) mbstring.internal_encodingUTF-8UTF-8 mbstring.languageJapaneseJapanese mbstring.strict_detectionOffOff mbstring.substitute_characterno valueno value Mysqlの設定もご覧の通りです Variable_name Value character_set_client utf8 character_set_connection utf8 character_set_database utf8 character_set_filesystem binary character_set_results utf8 character_set_server utf8 character_set_system utf8 character_sets_dir /usr/share/mysql/charsets/ 以下my.cnf [mysqld] datadir=/var/lib/mysql socket=/var/lib/mysql/mysql.sock user=mysql # Disabling symbolic-links is recommended to prevent assorted security risks symbolic-links=0 character_set_server=utf8 default-storage-engine=InnoDB innodb_file_per_table default-character-set=utf8 skip-character-set-client-handshake [client] default-character-set=utf8 [mysql] default-character-set=utf8 [mysqldump] default-character-set=utf8 [mysqld_safe] log-error=/var/log/mysqld.log pid-file=/var/run/mysqld/mysqld.pid スクリプトはちゃんとUTF-8BOMなしで作っています。 Mysqlのバージョンは 5.5.33です。 PHPのバージョンは 5.4.19です。 PDOのオプションも試しみましたがうまくいきませんでした。 非常に困っています。 回答いただけたら幸いです。
データベース・MySQLの初心者です。 もう一つ教えてください。 下のテーブルで、NO、数値、和算カラムがあります。 NOカラムの１、２の行の数値カラムを足し、 NOカラム２の和算カラムに、結果の３を入れます。 同じように、２行づつ和算を行なうには、どのようにSQL文を つくれば良いでしょうか？ テーブル NO　数値　和算　和算カラムの結果 １　　１　　　null　　null ２　　２　　　null　　３ ３　　５　　　null　　７ ４　　２　　　null　　７ ５　　２　　　null　　４ よろしくお願いします。
データベースの初心者です。MySQLを使用してSQL文を試しましたが、うまくいきません。 わかりやすく教えていただけますか？ 下のような２つのテーブルで、テーブル２の項目カラムに存在するデータが、 テーブル１の区分にあれば、一致する行（NOカラムの５～７）だけに、 フラグ”１”を付けたいのです。（区分カラムに、"*"で始まるデータは除きます） 区分に、データが全て埋まっていれば簡単に出来るのですが、 先頭行のみデータがあって、次の区分まで、Nullが入っています。 テーブル１ NO　区分 フラグ １　　aaaaa　　　null ２　　null　　　　 null ３　　null　　　　 null ４　　null　　　　 null ５　　bbbbb　　 null ６　　null　　　　 null ７　　*nozoku　 null ８　　ccccc null ９　　null null テーブル２ NO　項目 １　　bbbbb ２　　eeeee よろしくお願いします。
XAMPP Version: 1.8.2　です。 　 Xamsのデータベースをデータベースから削除した後 　SQLから、以下2個プログラムを入力しました。 　すると、削除したにも関わらず、エラーが出て プログラムが反映されません。 　Xamsを削除後、再起動したらまたXamsのデータベースが 再構築されます。 　私は作成した記憶はありません。 　すでに存在しているので、作成しする必要は ないのか、よくわかりません！？ 　皆様どう思われますか！？ 　以下入力したプログラムです。 ---------------------------------------------------------------- CREATE DATABASE xmas; USE xmas; CREATE TABLE xmastran ( book_id int not null auto_increment, name varchar(30) not null default '' , org varchar(50) not null default '', addr varchar(80) not null default'', tel varchar(20) default '', mail varchar(40) default '', course varchar(30) default '', nums integer default 0, PRIMARY KEY (book_id) ) ENGINE=MyISAM DEFAULT CHARSET=utf8; エラー 実行したSQL： DATABASEクリスマスを作成します。 のMySQLのメッセージ：ドキュメント ＃1007 - データベース'クリスマス'を作成できません、データベースが存在している -------------------------------------------------- CREATE DATABASE if not exists xmas; USE xmas; CREATE TABLE xmastran ( book_id int not null auto_increment, name varchar(30) not null default '' , org varchar(50) not null default '', addr varchar(80) not null default'', tel varchar(20) default '', mail varchar(40) default '', course varchar(30) default '', nums integer default 0, PRIMARY KEY (book_id) ) ENGINE=MyISAM DEFAULT CHARSET=utf8; エラー 実行したSQL： TABLE xmastranを（CREATE book_idのINT NOT NULL AUTO_INCREMENT、 名VARCHAR（30）NOT NULL DEFAULT''を、 orgのVARCHAR（50）NOT NULL DEFAULT''を、 addrはVARCHAR（80）NOT NULL DEFAULT''を、 電話VARCHAR（20）DEFAULT''を、 メールVARCHAR（40）DEFAULT''を、 もちろんVARCHAR（30）DEFAULT''を、 numsはINTEGERのデフォルトは0、 PRIMARY KEY（book_id） ）ENGINE = MYISAM DEFAULT CHARSET= utf8を; のMySQLのメッセージ：ドキュメント ＃1050 - テーブル 'xmastran'は既に存在します。 ------------------------------------------------------------------- 以上よろしくお願いします。
MySQL 5.1 利用中です。 テーブルに登録されている文字列が以下のようになっている場合 右から1文字だけを削除するSQL文を教えてください 右から「部とか課や/」が削除されるイメージです。 →SQL実行前 name 経理課 営業部 開発部 部門開発部 RアンドD/ →SQL実行後 name 経理 営業 開発 部門開発 RアンドD よろしくお願い致します。
カラムについてご質問が御座います。 "complete"か"uncomplete"をDBに値を変えて挿入する場合、 カラムはENUMでインデックスを利用して"complete"は1、"uncomplete"は2としてphp側から格納するのがよいのか、カラムをTINYINT(1)やCHAR(1)でDBに0か1で格納すればよいのか、それとも別の方法がよいのか分かりません。 ご指導頂けると幸いです。 mysql Ver 14.14 Distrib 5.1.44 PHP Version 5.3.2
http://php1st.com/435/ 　にある説明config.inc.phpファイルですが、 $cfg['Servers'][$i]['auth_type'] = 'config'; $cfg['Servers'][$i]['user'] = 'root'; $cfg['Servers'][$i]['password'] = '12345'; ---------------------------------------------- にすると 以下のエラーが出ます。 ＾＾＾＾＾＾＾＾＾＾ phpMyAdmin へようこそ エラー MySQL のメッセージ: ドキュメント #1045 - Access denied for user 'root'@'localhost' (using password: YES) MySQL サーバに接続しようとしましたが拒否されました。config.inc.php のホスト、ユーザ名、パスワードが MySQL サーバの管理者から与えられた情報と一致するか確認してください。 それで ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ $cfg['Servers'][$i]['auth_type'] = 'cookie'; $cfg['Servers'][$i]['user'] = 'root'; $cfg['Servers'][$i]['password'] = '12345';　 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ 　にすると、 　phpMyAdmin phpMyAdmin へようこそ 言語 - Language ログインドキュメント ユーザ名:root パスワード：・・・・・ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ それで 　http://php1st.com/435/ 　にある説明では 　$cfg['Servers'][$i]['auth_type'] = 'config'; 　にしなさいとあります。 しかし、私の場合は、この質問の冒頭にでた同じエラーが出たので、 $cfg['Servers'][$i]['auth_type'] = 'cookie'; 　としたら、 　ちゃんとログイン画面が出るうになりました。 　なぜでしょうか！？ 　宜しくお願いします。　
1日24回（約1時間毎に）米ドルの為替レートを記録したテーブル（米ドルtbl）があり、 内部に数年分のデータが蓄積されています。 取得日時(datetime)　　米ドル為替レート(usd) ----------------------------------- 2012-10-23 23:00:01　　79.45 2012-10-24 00:00:00　　79.38 2012-10-24 01:00:05　　79.40 2012-10-24 02:00:01　　79.41 　　　　・　　　　　　　　　　　・ 　　　　・　　　　　　　　　　　・ このテーブルを使って、各月の米ドルの最大値（最安値）を求めたければ、 select year(datetime) as 年, month(datetime) as 月, max(usd) as 最大値 from 米ドルtbl group by 年, 月; とすれば、 年　　　月　　最大値 ------------------------- 2012　9　　　79.21 2012　10　　80.36 2012　11　　82.76 2012　12　　84.94 2013　1　　　91.38 2013　2　　　94.71 2013　3　　　96.69 という結果が得られるのはわかるのですが、 この結果に更に、その最大値を取得した日時を加えて、 年　　　月　　最大値　　取得日時 --------------------------------------------- 2012　　9　　　79.21　　2012-09-06 15:00:01 2012　　9　　　79.21　　2012-09-13 04:00:00 2012　　9　　　79.21　　2012-09-22 22:00:02 2012　　10　　80.36　　2012-10-24 03:00:00 2012　　11　　82.76　　2012-11-18 22:00:03 2012　　12　　84.94　　2012-12-21 13:00:02 2013　　1　　　91.38　　2013-01-18 20:00:01 2013　　2　　　94.71　　2013-02-14 11:00:00 2013　　3　　　96.69　　2013-03-26 21:00:02 というようなデータを得たいと思うのですが、 どういう構文を書けばいいか、皆目見当がつきません。 その月に最大値の取得日時が何回もあるなら、 上記2012年9月のように、それらすべてが表示されるのが理想です。 どうぞ宜しくお願い致します。
MySQL 5.1 利用中です。 area | number /tokyo/01/ aa1 /tokyo/02/ bb2 /chiba/01/ aa1 上記のようにテーブルに情報が登録されているとします。 やりたいことは、areaフィールドに登録されている 「tokyo」がある場合はnumberフィールドを「東京」の名前を 追加したいと考えてます。 やりたい事の実行結果 area | number /tokyo/01/ 東京/aa1 /tokyo/02/ 東京/bb2 /chiba/01/ aa1 このように処理するには 　UPDATE テーブル名 SET WHERE area LIKE '%tokyo%' = REPLACE(number,'','東京/'); こんな感じかと実行してみたら、やっぱりだめでした、、 何かアドバイスをいただけないでしょうか？ よろしくお願い致します。
商品のデータベースがあるんですが、一つの商品テーブルに複数の店舗の商品をまとめて登録しています。在庫数は店舗別のテーブルで分けているのですが、これをＳＱＬで商品コードで結合ができません。 仮に商品がＡ、Ｂ、Ｃと登録されていたとして、店舗１にはＡとＢの商品があるため２つの在庫数を設定しており、店舗２にはＢとＣの商品があるため２つの在庫数を設定しています。 つまり片方のみの商品もあれば両方に存在する商品があります。 このときにＳＱＬで商品情報を取得する場合に、結合したいのですが結果が0件となり上手く結合ができません。 商品コードがＢのときにＳＥＬＥＣＴ文で両店舗の在庫数を同時に取得したいし、ＡやＣではそれぞれの店舗在庫を取得したいのですが、何か良い方法はないものでしょうか？
MySQL 5.6をWindowsサーバ上でサービス実行しています。 クライアントからの接続がある状態でサービスを停止すると、イベントログに 「MySQL: Forcing close of thread xx user 'xx'」 というメッセージが警告レベルで出力されます。 このメッセージが出力されないよう、MySQL側で設定できるならしたいと考えているのですが、 うまく抑止できません。海外の類似事例で、--skip-external-lockingをつけるとよいとあったのですが、 解決しませんでした。 そこで、 ・上記メッセージを出力しなくする方法 ・あるいはWindowsのイベントログを一律出力しなくする方法 がもしありましたらご教授下さい。
http://okwave.jp/qa/q8247435.html 　以上のトラブルの経緯がありまして・・ 次に出たのが以下のエラーです。 XAMPP Control Panel v3.2.1ですが 　気になることがあります。 　以下[Apache]の項目のほとんどが赤文字です。 　これって何か”ヤバイ”ことなのでしょうか!!?? 　よろしくお願いします。 3:32:31 [main] Initializing Control Panel 3:32:31 [main] Windows Version: Windows 7 Ultimate SP1 64-bit 3:32:31 [main] XAMPP Version: 1.8.2 3:32:31 [main] Control Panel Version: 3.2.1 [ Compiled: May 7th 2013 ] 3:32:31 [main] Running with Administrator rights - good! 3:32:31 [main] XAMPP Installation Directory: "c:\xampp\" 3:32:31 [main] Checking for prerequisites 3:32:59 [main] All prerequisites found 3:32:59 [main] Initializing Modules 3:32:59 [Apache] Problem detected! 3:32:59 [Apache] Port 80 in use by ""c:\xampp\apache\bin\httpd.exe" -k runservice" with PID 1108! 3:32:59 [Apache] Apache WILL NOT start without the configured ports free! 3:32:59 [Apache] You need to uninstall/disable/reconfigure the blocking application 3:32:59 [Apache] or reconfigure Apache and the Control Panel to listen on a different port 3:32:59 [Apache] Problem detected! 3:32:59 [Apache] Port 443 in use by ""c:\xampp\apache\bin\httpd.exe" -k runservice" with PID 1108! 3:32:59 [Apache] Apache WILL NOT start without the configured ports free! 3:32:59 [Apache] You need to uninstall/disable/reconfigure the blocking application 3:32:59 [Apache] or reconfigure Apache and the Control Panel to listen on a different port 3:32:59 [mysql] XAMPP MySQL Service is already running on port 3306 3:32:59 [main] Starting Check-Timer 3:32:59 [main] Control Panel Ready 3:33:10 [Apache] Installing service... 3:33:14 [Apache] Problem detected! 3:33:14 [Apache] Port 80 in use by ""c:\xampp\apache\bin\httpd.exe" -k runservice" with PID 1108! 3:33:14 [Apache] Apache WILL NOT start without the configured ports free! 3:33:14 [Apache] You need to uninstall/disable/reconfigure the blocking application 3:33:14 [Apache] or reconfigure Apache and the Control Panel to listen on a different port 3:33:14 [Apache] Problem detected! 3:33:14 [Apache] Port 443 in use by ""c:\xampp\apache\bin\httpd.exe" -k runservice" with PID 1108! 3:33:14 [Apache] Apache WILL NOT start without the configured ports free! 3:33:14 [Apache] You need to uninstall/disable/reconfigure the blocking application 3:33:14 [Apache] or reconfigure Apache and the Control Panel to listen on a different port 3:33:14 [Apache] Attempting to start Apache app... 3:33:26 [Apache] Installing service... 3:33:27 [Apache] Successful! 3:33:27 [Apache] Successful! 3:33:28 [Apache] Status change detected: running
現在IDを主キーとするデータが有り、複数のデータをまとめて書き換える際、 一時テーブルにIDと変更内容を用意しておいて、UPDATE と INNER JOIN を用いて 一気に書き換える予定です。 更新そのものはこれで問題ないのですが、その際に一時テーブルに無いレコードは削除したいのですがどうすればいいのでしょうか？ 参考： http://qiita.com/masuidrive/items/0671ea7efa91a99c0268
XAMPP Control Panel v3.2.1ですが 　気になることがあります。 　以下[Apache]の項目だけが赤文字です。 　これって何か”ヤバイ”ことなのでしょうか!!?? 　よろしくお願いします。 5:17:14 [main] Initializing Control Panel 5:17:14 [main] Windows Version: Windows 7 Ultimate SP1 64-bit 5:17:14 [main] XAMPP Version: 1.8.2 5:17:14 [main] Control Panel Version: 3.2.1 [ Compiled: May 7th 2013 ] 5:17:14 [main] Running with Administrator rights - good! 5:17:14 [main] XAMPP Installation Directory: "c:\xampp\" 5:17:14 [main] Checking for prerequisites 5:17:14 [main] All prerequisites found 5:17:14 [main] Initializing Modules 5:17:14 [Apache] Apache Service detected with wrong path 5:17:14 [Apache] Change XAMPP Apache and Control Panel settings or 5:17:14 [Apache] Uninstall/disable the other service manually first 5:17:14 [Apache] Found Path: "c:\Apache24\bin\httpd.exe" -k runservice 5:17:14 [Apache] Expected Path: "c:\xampp\apache\bin\httpd.exe" -k runservice 5:17:14 [Apache] Problem detected! 5:17:14 [Apache] Port 80 in use by ""c:\xampp\apache\bin\httpd.exe" -k runservice" with PID 2636! 5:17:14 [Apache] Apache WILL NOT start without the configured ports free! 5:17:14 [Apache] You need to uninstall/disable/reconfigure the blocking application 5:17:14 [Apache] or reconfigure Apache and the Control Panel to listen on a different port 5:17:14 [Apache] Problem detected! 5:17:14 [Apache] Port 443 in use by ""c:\xampp\apache\bin\httpd.exe" -k runservice" with PID 2636! 5:17:14 [Apache] Apache WILL NOT start without the configured ports free! 5:17:14 [Apache] You need to uninstall/disable/reconfigure the blocking application 5:17:14 [Apache] or reconfigure Apache and the Control Panel to listen on a different port 5:17:14 [mysql] XAMPP MySQL is already running on port 3306 5:17:14 [main] Starting Check-Timer 5:17:14 [main] Control Panel Ready
環境は PHP5.3.3 MySQL5.0.95 です。 現在TBL1にURL(address)と、そのURLのタイトルタグの中身(title)と、独自に数えてる数字(count)を入れています。 その1つのアドレスに対してcountの数は色々あるので、 そのcountをアドレスと対にして合計したもの(SUM)で並び替えています。 (分かりづらかったらすいません。addressは主キーではないということです。) タイトルに関しては最近取得し始めたところで入ってるところと入っていないところがあります。 その状況下で SELECT address, title, sum(count) as SUM FROM TBL1 where address LIKE "%hoge.com%" group by address order by sum DESC LIMIT 10; こういうSQL文を使ってSELECTした際に、 hoge.com以下の例えばhoge.com/1.html,　hoge.com/2.html, ... といった感じのURLごとにSUMの数で並び変わるのですが この場合titleはどのカラムを参照していることになるのですか？ (address) (title) (SUM) hoge.com/1.html | test1 | 500 | hoge.com/2.html | test2 | 400 | hoge.com/3.html |　　　　| 300 | hoge.com/4.html | test4 | 200 | hoge.com/5.html | test5 | 100 | hoge.com/6.html |　　　　| 40 | hoge.com/7.html | test7 | 20 | hoge.com/8.html |　　　　| 10 | hoge.com/9.html |　　　　| 6 | hoge.com/10.html |　　　 | 5 | こんな結果だったとして、titleが入っているものと入っていないものの区別がつきません。 入っていないURL(例えばhoge.com/3.html)のaddressカラムも全て空というわけではありません。 逆に入っているものに関しては、全ての行にtitleが入っているわけではありません。 主キーは今回のSELECTとは関係してない"ID"です。 ID | address | count | title 1 | hoge.com/1.html | 3 | test1 2 | hoge.com/1.html | 10 | 3 | hoge.com/1.html | 43 | test1 ID | address | count | title 1 | hoge.com/3.html | 4 | test3 2 | hoge.com/3.html | 3 | 3 | hoge.com/3.html | 42 | それぞれは主キーに応じてcountが個別にある状態です。 上記は正確ではありませんが、こんな感じです。 こうして共に入ったり入ってなかったりするのにSELECTした結果に 入ってるものと入ってないものが出てくるのが分かりません。 ちなみに、検証すると一番countが多い行にtitleが入っていたらSELECT文にも出てくるというわけではないようです。 なぜtitleが出るものと出ないものがあるのでしょう？ ご教授宜しく御願い致します。
あるテーブルtable01にname列があったとします。 その列に ”様"　をつけたいと思い、concat文を使おうと思い、 以下のようにしたのですが、 mysql> Select concat(name,"様") from table01; +-------------------+ | concat(name,"様") | +-------------------+ | ito様 | | sato様 | | aikawa様 | | abe様 | | yamada様 | +-------------------+ 5 rows in set (0.00 sec) 列名もconcat(name,"様")となってしまっていますが、　As nameを使う以外に nameとだけ表示させる方法はありますか？
MySQLでWhere句の書き方で苦戦しています。 以下のuser_table（オーダー)が来たときに、スタッフが用意すべき数量を商品ごとに抽出するSQLを書いています。 Where句の書き方が思いつきません。ご指導をお願いいたします。 user_table (name) (product) (user_volume) takada | pro_001 | 500 | takada | pro_002 | 100 | matuda | pro_003 | 400 | kawase | pro_001 | 200 | yosida | pro_001 | 500 | tanaka | pro_001 | 300 | tanaka | pro_002 | 500 | tanaka | pro_003 | 300 | 作りたいテーブル(SQLの結果) total_table (id)(product_name)(total_volume) staff | pro_001 | 1500 | staff | pro_002 | 600 | staff | pro_003 | 700 | 途中まで作って断念したSQL INSERT INTO total_table (id ,product_name,total_volume) SELECT 'staff',product,SUM(user_volume) FROM user_table WHERE ・・・;
Apache2.2をアンインストールしたいのですがどうしたらできますか！？ OSはWindpws7です。 　なぜか！”アプリケーションの追加と削除”には存在しません 　よろしくお願いします。
データベース(MｙSQL)に更新があった場合、GoogleMap上にリアルタイムにマーカーを表示させたいと考えています。 現在、XMLファイルの読み込みライブラリー downloadxml.js を利用し、PHPのXMLファイルを読み込んで実装しています。 調査していくと、リアルタイムに更新を行うには、ajaxを利用することがわかりました。 そのため 、jQuery のJavaScriptライブラリーを利用してPHPのXMLファイルを読み込む形になるのか、と思っているのですが、データベースに更新があった場合にリアルタイムにGoogleMapを更新させるには、どちらの読み込みで行うとよろしいのでしょうか？ またリアルタイム更新には、cometという技術を使う必要があるということを調査して分かったのですが、具体的なソースコードが出ているページなど詳しい説明が載っているページがあれば、教えていただきたいです。 よろしくお願いします。
PHPのforeachでSQL文を処理しても良いか教えてください。 ・foreachループの中でSQLを書いているのですが、なるべくしない方がよいのでしょうか？ (一般的な書き方ではない？) ・MySQLで代替する書き方はあるでしょうか？ ・もし代替する書き方がなくてforeach文を使う場合、SQL文が長くてもクエリ数が少ない書き方の方がよいのでしょうか？
　ｐｈｐMｙＡdminでSQLに 　以下の文を入力しました。 　CREATE DATABASE xmas; USE xmas; CREATE TABLE xmastran ( book_id int not null auto_increment, name varchar(30) not null default ' ' , org varchar(50) not null default ' ', addr varchar(80) not null default' ', tel varchar(20) default ' ', mail varchar(40) default ' ', course varchar(30) default ' ', nums integer default 0, PRIMARY KEY (book_id) ) ENGINE=MyISAM DEFAULT CHARSET=utf8; 　以上SQLに入力した文ですが！ 　以下のエラーが出て先に進みません。 　 エラー 実行した SQL: CREATE DATABASE xmas; →　(http://dev.mysql.com/doc/refman/5.5/en/create-database.htmlにリンクされている) MySQL のメッセージ: ドキュメント #1007 - Can't create database 'xmas'; database exists サーバ "127.0.0.1" 上でクエリを実行する: CREATE DATABASE xmas; USE xmas; CREATE TABLE xmastran ( book_id int not null auto_increment, name varchar(30) not null default ' ' , org varchar(50) not null default ' ', addr varchar(80) not null default' ', tel varchar(20) default ' ', mail varchar(40) default ' ', course varchar(30) default ' ', nums integer default 0, PRIMARY KEY (book_id) ) ENGINE=MyISAM DEFAULT CHARSET=utf8; 　　以上ですが、何が原因で進めないか原因を追及中です。 　最近SQLを始めたので、全く見当がつきません。 皆様よろしくお願いします。 　
SQL文でダブルクォートかアポストロフィーか迷っています！？ 　以下のＳＱＬ文の 　name varchar(30) not null default " ,等の 　最後から２番目に　"　ダブルクォートがあります。 　教本を見ながら入力したのですが、' ' アポストロフィーが２個あるようにも見えます。 この場合、どちらが正規でしょうか！ 　 　以下問題のＳＱＬ文です。 　よろしくお願いします。 CREATE DATABASE xmas; USE xmas; book_id int not null auto_increment, name varchar(30) not null default " , org varchar(50) not null default ", addr varchar(80) not null default", tel varchar(20) default ", mail varchar(40) default ", course varchar(30) default ", nums integer default 0, PRIMARY KEY (book_id) ) ENGINE=MyISAM DEFAULT CHARSET=utf8;
PHP,MYSQLを使って、一日置きの間隔で 更新のプログラムを実行させたいのですが、 JAVASCRIPTではブラウザを開いていないと 実行されない為、他の方法を考えています。 簡単な方法で何かないでしょうか？ よろしくお願いします。
現在 100万件程ある データから ・date( 作成日時 ) で縛り ・int( 0 から 5 ) の出現数を カウントする 命令を実行しているのですが、どうも下記では効率悪く思われてなりません。 SELECT 　　COUNT( int = 0 OR NULL ) AS r0, 　　COUNT( int = 1 OR NULL ) AS r1, 　　COUNT( int = 2 OR NULL ) AS r2, 　　COUNT( int = 3 OR NULL ) AS r3, 　　COUNT( int = 4 OR NULL ) AS r4 FROM 　　table WHERE 　　date BETWEEN '2013-08-13' AND '2013-08-13' 他に良い方法はないでしょうか。 また ゆくゆくは intの部分を 0 から 5 の固定ではなく 可変( '2013-08-13' にある 数字を調べて それぞれの出現数を 数える ) にしたいとも思っています。 しかし その方法は さっぱり見当もつかないので 合わせて 教えて貰えたら嬉しいです。 宜しくお願いします。
XAMPP Control Panel v3.2.1 でMySQLのAdminをクリックしたら以下のエラーが出て先に進まなくなりました。 致命的なエラー：mb_detect_encoding未定義関数の呼び出し（）でC：\ XAMPP \ phpMyAdminの\ライブラリ\ PHP-gettextの\ gettext.inc上にライン177 　エラーは　以上です。 　iisは停止していて、Apache2,2は自動で動いています。 以上よろしくお願いします。
　現代版のXAMPP Control Panel v3.2.1 セットアップしました。 　教本の内容は古くて、xampp-win32-1.7.3.exeとの内容で書かれています。 　 　すると、php.iniのプログラムの中身と教本と書いてあることが違います。 　 　「php.ini」ファイルで795行目あたりですが 　 ; Windows: "\path1;\path2" include_path=".;C:\xampp\php\PEAR" C:\xampp\php\includes" 以上のプログラムで\PEAR"の最後に"ダブルクォーテーション(") で区切られています。 　 しかし、教本には \PEAR;の最後はセミコロン（;）にと印刷されています。 セットアップしたての(")か、教本の（;） どちらが正規でしょうか 　実際のphp.iniが以下で見れます。 最後のアドレスかは、php.iniをZIPで圧縮したファイルが取れます。 参考にされてください。 　http://homepage3.nifty.com/mtaiyo/php.ini http://homepage3.nifty.com/mtaiyo/php.zip
mysqlのデータの表示順番を変えたいのですが、 思うようにいかず悩んでいます。 例えば、顧客データで　東京在住で入会年月日順の出力をして、 その後に、名古屋在住でID順に出力させたいとします。 下記のように書けば、nagoyaのほうがid順になりません。 考え方が違うのでしょうか？ よろしくお願いします。 SELECT ～ FROM ～ WHERE ～ ORDER BY tokyo,nyukai ASC,nagoya,id ASC,
WordPressを使ってHP制作をしたく思っています。 FTPでうちの会社のサーバーへwordpressの解凍ファイル一式を送り、アクセスすると、データーベース情報を設定する画面になり、ここでつまずいています、 ユーザー名、パスワード等は分かるのですが、データベース名というのが分かりません、 調べてみますとMySQLというものの設定が必要との事ですが、知識等未熟な当方の頭ではどうアクションすればいいのか分かりません。 MyQSLはソフトと言うよりはサーバーの機能のようなものでしょうか、データベースというものがよく分かっておりませんしwebで調べても恥ずかしながらちんぷんかんぷんでありました、 お手数をおかけしますが、解決に向けて分かりやすい説明を頂ければ幸いです。 使ってるPCはMacOS10.6です、
My SQL バージョン5.5です。 学校で習っている時に 追加で、　not nullを設定しようと思い、 modify文を色々試して使いましたが Syntaxのエラーが出て、 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ' c_pass not null' at line 1 （※c_pass　はカラム名です） change　型名（桁数）を使うと変更できました。 なぜmodifyなどでは追加変更出来なかったのか、原因がわかる方はいらっしゃいますか？ バージョンの問題ですか？
http://okwave.jp/qa/q8209284.html 　以上の質問で、まだ解決には至っていません！？ 　御回答をいただいたのですが、私にはその意味が分かりませんでしたので 再度質問しました。 　初めてすることは、手探り状態なので、苦労しています_ _! 　教本を読んでも、エラー対策などは 、何も書かれておらず、ネットで一生懸命、状況を説明して、解決するしか、方法 はないので、宜しくお願致します。 　 　それで、エー・っと　 　 　#1007 - Can't create database 'xmas'; database existsの ”エラーメッセージ”をGoogle翻訳で直訳したら 　 ”＃1007 - データベース'クリスマス'を作成できません、データベースが存在している” 　とでて、原因として、”データベースが存在している”からできない！？ 　 　うーん　よく分かりませせん どなたか、こうゆう場合の解決策として、代替でいいですので、手順を箇条書きにして、教えて もらっていいでしょうか！＾＾ 　１）・・・ 　２）・・・ 　３）・・・ 　以上宜しくお願いします。
こんにちわ。PHPとMysqlで色々やろうとしている者です… すっごい初心者です。 こんな感じのテーブルがあって… tagsテーブル [int id(PK)(A_I)][varchar tag(index)][int u_id] 1、うどん、5 2、そば、5 3、うどん、2 4、ラーメン、2 5、そうめん、1 6、そば、3 ....（つづく） こんな文があります… SELECT u_id, count(CASE WHEN tag = "うどん" or tag = "そば" THEN 1 ELSE NULL END ) AS `agr` FROM tags GROUP BY u_id ORDER BY agr DESC 結果は [u_id][agr] 5、2 8、2 4、1 3、0 ....（つづく） tagが「うどん」or「そば」のu_idを集計して多い順にソートするんですが これの結果を「うどん」and「そば」の結果だけを出力したい（この場合agrの結果2のみ） …要するにtagをandで検索したいという事です… 回答よろしければお願いします…
MySQLで10,000を超えるデータが有り、その中から最大6件まで指定して表示するプログラムを作る予定です。 6つの枠が有りそれぞれの枠にデータを選んでセットしていく形式です。 この場合データのテーブル側に枠にセットされていることを示すフラグのようなものを付けてそれをもとに抽出するか、別のテーブルにデータIDの記入された data1～data6 のカラムを作ってそれをもとに抽出するかどちらが速度・構造的に良いのでしょうか？
　phpMyAdminのSQLで SQL文を登録するため、以下のエラーメッセージの中にあるCREATE DATABASE xmas;で始まる 　SQL文を実行したところ、以下のエラーメッセージがでて、登録でできずに困っています。 　どうしたら登録できますか！？ 　 　宜しくお願いします。 　　 エラー 実行した SQL: CREATE DATABASE xmas; MySQL のメッセージ: ドキュメント #1007 - Can't create database 'xmas'; database exists サーバ "127.0.0.1" 上でクエリを実行する: ドキュメント CREATE DATABASE xmas; USE xmas; CREATE TABLE xmastran ( book_id int not null auto_increment, name varchar(30) not null default '' , org varchar(50) not null default '', addr varchar(80) not null default'', tel verchar(20 default '', mail varchar(40) default '', course varchar(30) default '', nums integer default 0, PRIMARY KEP (book_id) ) ENGINE=MyISAM DEFAULT CHARSET=utf8;
お世話になります。 表題のとおり、MySQLの特定のカラムの全データを削除したいのですが、ググるとテーブル全削除やWHEREで「30以下を削除」などの条件付きはすぐに出てくるのですがカラムの一行だけを空にする方法が見つけられません。 phpmyadminのSQLタブから実行しています。 ご達人の諸先輩方、どうぞお知恵をお貸しください。 phpmyadminのSQLタブに記載するSQL文をお教え願えますでしょうか。 宜しくお願いします。 MySQL、Window7 64bit Apacheサーバ　phpmyadmin
SQLに関して質問させて頂きます(MySQLを使用しています)。 下記のようなデータを使用して、賞味期限に設定した日付が、24時間以内にせまったレコードの危険フラグを1にしたい場合、どのようなSQLを記述すれば良いでしょうか？ SQLの実行は1回でも2回に分けてもらってもよいので、効率的な方法があればよろしくお願いします。 ※必要であればPHPを使用して下さい。 ＜カラム＞ ｜商品名｜賞味期限｜危険フラグ｜ ＜例＞ | 魚　 | 2013-07-31 21:30:00 | 0 | | 肉　 | 2013-08-01 21:00:00 | 0 | | 野菜 | 2013-08-02 21:30:00 | 0 | SQLを実行した時の時刻が「2013-07-31 19:00:00」であれば、肉の賞味期限が24時間以内に迫っているので、危険フラグを1にしたいと考えています。 よろしくお願いします。
かなり初心者です。もしかしたら妙な事を訊いているのかもしれません。 php5.4.16とmysql5.5.32でSNSのフレンドリストのような機能を作ろうと思います。 フレンド最大数は1000とします。この場合、1000個もカラムを作るのでしょうか？ それとも、会員個別にテーブルを作ってそこで管理するのでしょうか。 もしくは、テーブルは一つとし、会員番号のカラムを二つ用意、関係性を示したテーブルを作るのでしょうか？ もしくは、カラムは一個で文字列で操作したりするのでしょうか？（カンマで区切る等） パフォーマンス的にどの設計が正しくて、どの設計が間違いなのでしょうか… 回答よろしくお願いします。
MySQL ver.5.0.95です。 PHPからSQL文を作ってDBへインサートしているのですが 重複した値が合った場合はupdateするように書いています。 TBL1には |id　　　|string　　　|count 1　　　　aaa　　　　0 2　　　　bbb　　　　3 3　　　　ccc　　　　1 TBL2には |id2　　　　|string2　　　　|count2 1　　　　　 aaa　　　　　　0 2　　　　　 bbb　　　　　　2 3　　　　　 ccc　　　　　　1 実際はもう少し複雑ですが、こういう感じでデータが入ってるとします。 このとき、TBL1のそれぞれをインサート若しくはアップデートするのに TBL2の同一IDのものの、count2の状態によって場合分けしたく 同一IDのcount2が1以上なら変更しない、という風にするため以下のように書いたのですが insert into TBL1 values (1, "aaa", 3), (2, "bbb", 3), (3, "ccc", 3), (4, "ddd", 3) on duplicate key update count = CASE WHEN (select count2 from TBL2 where id2 = values(id)) >=1 THEN count ELSE count + values(count) END; #1064 - You have an error in your SQL syntax;というエラーになって出来ません。 WHENの中のサブクエリで、where id2 = values(id)　恐らくこの文がダメなようです。 例えば決め撃ちで1つ1つ書くと通ります。 insert into TBL1 values(1, "aaa", 3) on duplicate key update count = CASE WHEN (select count2 from TBL2 where id2 = 1) >=1 THEN count ELSE count + values(count) END; insert into TBL1 values(2, "bbb", 3) on duplicate key update count = CASE WHEN (select count2 from TBL2 where id2 = 2) >=1 THEN count ELSE count + values(count) END; insert into TBL1 values(3, "ccc", 3) on duplicate key update count = CASE WHEN (select count2 from TBL2 where id2 = 3) >=1 THEN count ELSE count + values(count) END; insert into TBL1 values(4, "ddd", 3) on duplicate key update count = CASE WHEN (select count2 from TBL2 where id2 = 4) >=1 THEN count ELSE count + values(count) END; これをエラーになったような文に変えて1文にまとめたいのですが、無理でしょうか？ あとそもそもこれをまとめたほうが速いと思ってそうしたいのですが、 変わらないのなら1文1文;でつなげて書くやり方でいこうと思っています。 まとめると速くなることはあるでしょうか？
MySQL　初心者です。 テーブルを作成して、いろいろとデータを入れ込もうと思うのですが、 CURRENT_TIMESTAMP を指定すれば、データを入れた瞬間にその時の日付が登録されると思うのですが、 それとは別に勝手に連番をつけていくような機能はないのでしょうか？
MYSQLを勉強中です。 下記のようなテーブルがあります。 【クライアトテーブル】： クライアントID 1 | A社 2 | B社 3 | C社 4 | D社 【お問合せテーブル】： お問合せmail |お問合せ先のクライアントID|お問合せ日時 aaa@aaa.com |1 |2013-02-01-10:00:00 aaa@aaa.com |2 |2013-03-01-10:00:00 bbb@bbb.com |3 |2013-04-01-10:00:00 ccc@ccc.com |4 |2013-04-02-10:00:00 aaa@aaa.com |1 |2013-04-03-10:00:00 ここで、 クライアント毎に、4月分の問合せ数を表示したいのですが、 4月1日～4月末日に問合せのあったメールアドレスと、 2月1日～3月末日に問合せのあったメールアドレスを比較して、 下記のように重複分をクライアント毎にカウントしたいです。 問合せ数： A社：1件　重複1件 C社：1件　重複1件 D社：1件　重複0件 クライアントIDを個別で指定すれば正しく表示できるのですが、 クライアント一覧を取得するのはどのようなSQLを書けばよいのでしょうか。。。 もう１ヶ月悩んでおります。 すみませんが、教えて頂けますと幸いです。
リレーショナルデータベース管理システムについて確認したいのですが。 バッチ処理とかの途中でシステムがダウンし、Commit しなかったとき データベースは、Commit していないのでトランザクション開始前の状態が 維持されると思うのですがその理解で合っていますか？ Commit しなかったトランザクションデータは、破棄されると思うのですが その理解も合っていますか？ MySQL の場合について、教えてください。 よろしくお願いします。
http://ponk.jp/php/basic/php_mysql すいません。データベースを初めて勉強中なのですが、上記のサイトに書いてあるように文字をphpで表示させた場合日本語が???に文字化けします。いろいろググってみたのですが解決できず先に進めません・・。 照合順序などはutf8_general_ciとなっていまして、phpの方も<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />とutf-8が指定してありますので問題ないと思います。 考えられる原因というのはどんなものがありますか？ テーブル表 CREATE DATABASE men; USE men; CREATE TABLE udon(name TEXT, price INT); INSERT INTO udon VALUES('たぬきうどん', 340); INSERT INTO udon VALUES('てんぷらうどん', 440); INSERT INTO udon VALUES('カレーうどん', 420); INSERT INTO udon VALUES('うどん定食', 520); 表示プログラム <table border="1"> <tr><th>名前</th><th>価格</th></tr> <?php $pdo = new PDO("mysql:dbname=men", "root"); $st = $pdo->query("SELECT * FROM udon"); while ($row = $st->fetch()) { $name = htmlspecialchars($row['name']); $price = htmlspecialchars($row['price']); echo "<tr><td>$name</td><td>$price 円</td></tr>"; } ?> </table>
データベースにチェックボックスのON、OFF状態を 保存しようとしているのですが、 やり方が色々あり、どのやり方が一番いいのかわかりません。 調べたところ、大きく以下の４つがあることがわかりました。 ----------------------------------------- 方法１　チェックボックス分カラムを用意する ----------------------------------------- 例 id　name　flag4　flag3　flag2　flag1 15　なまえ　１　　　１　　　０　　０ ----------------------------------------- 方法２　ビット演算を使う ----------------------------------------- id　name　bit 15　なまえ 12 ----------------------------------------- 方法３　カンマで区切ってデータを入れる ----------------------------------------- id　name　check 15　なまえ 3,4 ----------------------------------------- 方法４　チェックボックス管理テーブルを作る ----------------------------------------- main_tb id　name 15　なまえ check_tb id　check 15　4 15　3　 それぞれ、一長一短があると思うのですが それぞれのメリット・デメリット、一般的にどの方法が好まれているのか等 アドバイス頂けると嬉しいです。
お世話になります。 現在、DB内のindividualというテーブルのname_enというフィールドにおいて、 日本人の名前が英語表記で登録されています。 ただし、一般的な表記でなく、「姓, 名」というようになっています。 例えば、玉木宏さんであれば、 Tamaki, Hiroshi となっています。 これを一般的な Hiroshi Tamaki に一発で置換するようなSQL命令文がありましたら教えていただきたいのですが、 如何でしょうか。 何卒よろしくお願いいたします。 バージョン情報などは下記の通り引用します。 MySQL Server: Localhost via UNIX socket Server version: 5.1.67 Protocol version: 10 MySQL charset: UTF-8 Unicode (utf8) Web server Apache/2.2.23 MySQL client version: 5.1.67 PHP extension: mysqli phpMyAdmin Version information: 3.3.10.5
phpでデータベースを呼び出してデータがなかった場合の処理をif文を使って行いたいのですがどうしたらいいのでしょう？ $result = mysql_query("select id from table where id = 1"); として1というidが入ってない場合$resultの中身はどうなるのでしょうか？ if(idが存在しない時の条件) { echo "そんなデータ登録されてないよー" }else{ echo "$result" } としたいのですがifの条件の作り方がわかりません。 みなさんならどうしますか？
「去年の登録者」「今年の登録者」というテーブルがあるとします。 カラムは両方とも「名前」「性別」「年齢」があり、人物の情報が入ってます。 両方にデータが入ってる人もいれば、片方にしかデータが入ってない人もいます。 この2つのテーブルから男性のデータを引き出し 名前　去年の年齢　今年の年齢 太郎　21歳　　　　22歳 二郎　24歳　　　　データなし 三郎　データなし　20歳 このようにしたいのですがsql文が思いつきません。 アドバイスをください。
1つのテーブルから重複したデータを取り除いて表示するときに使う 【select distinct カラム名 from テーブル名;】 がありますよね。 それと同じようなことを複数のテーブルをまたいで行いたいのですがうまくいきません。 ちなみに両方のテーブルのカラム名は同じです。 【select distinct カラム名 from テーブル1 union select distinct カラム名 from テーブル2;】 としても重複を取り除いた後にテーブルを結合してるので結果的に両テーブルの重複した値を取り除くことができず。 そこで 【select distinct T1.カラム名, T2.カラム名 from テーブル1 T1. テーブル2 T2;】 としてみたのですが、クエリを実行中のまま反応がないので悩んでます。 ちなみに2つのテーブルのデータはそれぞれ2万件ほどです。 こういう時どういうsql文を組むのが正しいのでしょうか？
現在VB.NET 2008を用いて、システムを作成しています。 Access2008の.accdb内のデータと、MySQL内のデータをinner joinして取得したいと考えていますが、 可能でしょうか? 可能であればどのようにすればよいでしょうか?
下記の'←追加'と書いた部分を追加して実行しましたが、動いてくれません。 ご教授お願いします。 ("SELECT song.song_ID, song.song_name, song.song_name_yomi, kashu.kashu, ka2.kashu as kashu2, ka3.kashu as kashu3, ka4.kashu as kashu4, ka5.kashu as kashu5, ka6.kashu as kashu6, ka7.kashu as kashu7, ka8.kashu as kashu8, ka9.kashu as kashu9, ka10.kashu as kashu10, kashu.kashu_yomi, sakushi, sakushi_yomi, sakkyoku, sakkyoku_yomi, hennkyoku, hennkyoku_yomi, tie_up.tie_up, ti2.tie_up as tie_up2 kashu_yomi, ←追加 ky2.kashu_yomi as kashu_yomi2 ←追加 FROM (((((((((((((((( song left JOIN kashu ON song.kashu_1_ID = kashu.kashu_ID) left JOIN kashu_yomi ON song.kashu_1_ID = kashu.kashu_ID) ←追加 left JOIN kashu_yomi ky2 ON song.kashu_2_ID = ky2.kashu_ID) ←追加 left JOIN kashu ka2 ON song.kashu_2_ID = ka2.kashu_ID) left JOIN kashu ka3 ON song.kashu_3_ID = ka3.kashu_ID) left JOIN kashu ka4 ON song.kashu_4_ID = ka4.kashu_ID) left JOIN kashu ka5 ON song.kashu_5_ID = ka5.kashu_ID) left JOIN kashu ka6 ON song.kashu_6_ID = ka6.kashu_ID) left JOIN kashu ka7 ON song.kashu_7_ID = ka7.kashu_ID) left JOIN kashu ka8 ON song.kashu_8_ID = ka8.kashu_ID) left JOIN kashu ka9 ON song.kashu_9_ID = ka9.kashu_ID) left JOIN kashu ka10 ON song.kashu_10_ID = ka10.kashu_ID) left JOIN sakushi ON song.sakushi_ID = sakushi.sakushi_ID) left JOIN sakkyoku ON song.sakkyoku_ID = sakkyoku.sakkyoku_ID) left JOIN hennkyoku ON song.hennkyoku_ID = hennkyoku.hennkyoku_ID) left JOIN tie_up ON song.tie_up_1_ID = tie_up.tie_up_ID) LEFT JOIN tie_up ti2 ON song.tie_up_2_ID = ti2.tie_up_ID where song_name like '%%'" ))
【名字、名前、昨日のメモ、今日のメモ】というカラムがあります。 名字、名前、昨日のメモは過去のデータなので、新しく今日のメモを追加したい場合どうしたらよいでしょう？ また、一括でデータを挿入するときに、名字・名前の両方一致するものがないデータがあれば新しくレコードを作るという風にしたいのですが、可能でしょうか？ なお、同姓同名は存在しないものとします。
お世話になります。 文字化けが解消できずに困っています。 PHPからローカルXAMPPのMYSQLにCSVでデータを上げたいのですが、日本語が文字化けして表示されます。秀丸テキストエディタで可能な限りのエンコードを試しましたが解決できず、サーバ側のエンコード設定も確認しましたがutf8_unicode_ciです。 Mysqlの管理画面のsqlから実行しても同様の結果です。 もう、色々やり過ぎてPHPが悪いのかMysqlサーバの設定なのかCSVの問題なのかわからず途方に暮れています。 諸先輩方でお分かりになられる方がいらっしゃいましたら是非、お知恵を貸してもらえませんか。 PHPのソースです。 ------------------------------ $host = "localhost"; $mysql_user = "root"; $mysql_password = "password"; $db = "utsun_db"; $cn = mysql_connect($host,$mysql_user,$mysql_password); if(!$cn){ die("db connect Error"); } if(!(mysql_select_db("$db"))){ die("db select error"); } $file = '"c:/tablea.csv"'; $sql = "LOAD DATA LOCAL INFILE $file INTO TABLE tablea FIELDS TERMINATED BY ',';"; $query = mysql_query($sql); mysql_close($cn); ----------------------------- CSVの中身 N551佐々木37 N552伊藤41 N553斉藤31 N554井上43 N555阿倍31 ----------------------------- Mysqlの方ではこのように表示されています N552 ä¼Šè—¤ 41 N553 æ–‰è—¤ 31 N554 äº•ä¸Š 43 N555 é˜¿å€ 31 ほんとうに困っております宜しくお願いします。 環境 Apache/2.4.3 (Win32) OpenSSL/1.0.1c PHP/5.4.7 phpMyAdmin バージョン情報: 3.5.2.2, 最終安定バージョン: 4.0.4.1
MYSQL初心者です。 簡単なメッセ機能を作りたいと思っています。 MyISAMテーブルを使おうとしています テーブルロックならしようとおもえばなんとかできます 質問（ロックしなかった場合） 複数の人が同時に書き込んだ(INSERTした)ときにどんな壊れ方をするんでしょうか? 一番最後の書き込まれた行だけ壊れるんですか？ 壊れ方はどんなふうになるんですか？書き込まれないだけですか？ 壊れた後でも、書き込みはできますか？ テーブルロックしておけば重複したINSERTはふせげますか？
mysqlで表の結合。 下記のように書きましたが、うまく動きません。 「left JOIN kashu ka2 ON song.kashu_2_ID = ka2.kashu_ID」 「ka2.kashu as kashu2」 ↑この部分、2つを追加しました。 何も表示されませんでした。 上の二つを削除すると動きます。 何がいけないのでしょうか？ mysql_query("SELECT song.song_ID, song_name, song_name_yomi, kashu, kashu_yomi, sakushi, sakushi_yomi, sakkyoku, sakkyoku_yomi, hennkyoku, hennkyoku_yomi, tie_up.tie_up, ti2.tie_up as tie_up2, ka2.kashu as kashu2 FROM (((((( song left JOIN kashu ON song.kashu_1_ID = kashu.kashu_ID) left JOIN kashu ka2 ON song.kashu_2_ID = ka2.kashu_ID) left JOIN sakushi ON song.sakushi_ID = sakushi.sakushi_ID) left JOIN sakkyoku ON song.sakkyoku_ID = sakkyoku.sakkyoku_ID) left JOIN hennkyoku ON song.hennkyoku_ID = hennkyoku.hennkyoku_ID) left JOIN tie_up ON song.tie_up_1_ID = tie_up.tie_up_ID) left JOIN tie_up ti2 ON song.tie_up_2_ID = ti2.tie_up_ID where song_name like '%%'");
SELECT MAX文で、フィールドの最大値を出しています。 これまで、何の問題もなく動作していたのですが、フィールドの数値が9999を超えたとたん、10000、10001などの数値があっても常に9999を最大値として返してくるようになりました。 どうしてでしょうか? 【説明】 A. 例文は次のようなものです。 SELECT MAX(`idc`) from testinvoice; B. `idc`は長さ13のVARCHERです。整数がLatin1で収納されています。 C. `idc`に収納されているデータは、1580からはじまって、9998、9999、10000、10001まで続く約8500件の連番(整数)です。 D. これまで何年も問題なく最大値を出してきました。 とても不思議です。
下記のようなSQLについてご指南頂きたく思います。 下記のようなテーブルがあり、 商品毎の売上を販売店毎に 売れた順に格納しています。 ＜販売テーブル＞ No　|　商品コード　|　販売個数　|　販売店コード --------------------------------------------- 1　　|　商品A　　　|　　　1　　|　1 2　　|　商品A　　　|　　　1　　|　2 3　　|　商品A　　　|　　　1　　|　3 4　　|　商品B　　　|　　　2　　|　1 5　　|　商品B　　　|　　　2　　|　2 6　　|　商品B　　　|　　　1　　|　3 7　　|　商品A　　　|　　　3　　|　1 8　　|　商品A　　　|　　　4　　|　2 9　　|　商品A　　　|　　　1　　|　3 　 上記のテーブルを使って下記のようなデータを取ってきたく考えております。 　　|商品コード|販売個数　　　　　　　　　　　　　　|販売店コード　|商品コード毎販売個数合計 　　|　　　　　　　|※ある商品の店毎の販売総数|　　　　　　　　　　|※ある商品の販売総数 　　-------------------------------------------------------------------------------- 　　|　商品A　　|　　　4　　　　　　　　　　　　　　　|　1　　　　　　　　|　11 　　|　商品A　　|　　　5　　　　　　　　　　　　　　　|　2　　　　　　　　|　11 　　|　商品A　　|　　　2　　　　　　　　　　　　　　　|　3　　　　　　　　|　11 　　|　商品B　　|　　　2　　　　　　　　　　　　　　　|　1　　　　　　　　|　　5 　　|　商品B　　|　　　2　　　　　　　　　　　　　　　|　2　　　　　　　　|　　5 　　|　商品B　　|　　　1　　　　　　　　　　　　　　　|　3　　　　　　　　|　　5 　　----------------------------------------------------------------------------- 　　やり方としては下記の(1)と(2)の結合ができれば良いと考えております。 　　一回のSQLで上記の結果を得られるようにしたいと考えております。 　　どなたかアドバイス頂ければと思います。 　　宜しくお願い致します。 (1)下記のようなSELECT文で商品コード毎の集計はできました。 　　　SELECT　商品コード,SUM(販売個数)　FROM　販売テーブル　group　by　販売テーブル.商品コード; 　　|　商品コード　　|販売個数　　　　　　　　　　 　　|　　　　　　　　　|※ある商品の店毎の販売総数 　　--------------------------------------- 　　|　商品A　　 　　|　　11　　　　　　　　　　 　　|　商品B　　 　　|　　　5　　　　　　　　　 (2)また、下記のようなSELECT文で販売店、商品コード毎の集計もできました。 　　　SELECT　商品コード,　SUM(販売個数),　販売店コード　FROM　販売テーブル　 　　　　　　　　　　　　　　　　　　　　　GROUP　BY　CONCAT(商品コード,'and',販売店コード)　; 　　|　商品コード　|販売個数　　 　　　　　　　　　　　|販売店コード 　　|　　　　　　　　|※ある商品の店毎の販売総数　|　　　　　 　　---------------------------------------------------- 　　|　商品A　　　|　　　4　　　　　　　　　　　　　　　　|　1　　　　 　　|　商品A　　　|　　　5　　　　　　　　　　　　　　　　|　2　　　　 　　|　商品A　　　|　　　2　　　　　　　　　　　　　　　　|　3　　　　 　　|　商品B　　　|　　　2　　　　　　　　　　　　　　　　|　1　　　　 　　|　商品B　　　|　　　2　　　　　　　　　　　　　　　　|　2　　　　 　　|　商品B　　　|　　　1　　　　　　　　　　　　　　　　|　3　　　　 　　----------------------------------------------------
2つのテーブルで、同じユーザテーブルを参照してデータ取得したいのですが、 どうやって結合すれば良いのでしょうか？ ■概要 ・ユーザがアクションに挑戦すると、結果を表示 ・その際、「アクション作成者」と「アクション挑戦者(ユーザ)」を表示したい ※「作成者」「挑戦者」は、同じ「user」テーブルで管理したい ■3テーブル ・「result」「action」「user」 ・「result」「action」テーブルには、それぞれ「user_id」カラムがある ・「result」テーブルには、「action_id」カラムがある。1対多？ ■知りたいこと ・一気にまとめて一覧として取得する方法 ・最終的に「結果」と、「result」「action」それぞれに対応した「user」テーブルの「name」カラムを取得したい ■試してみたこと ・これだと「挑戦者名」が取得できない 　　　　　　SELECT * 　　　　　　　FROM result r 　　　　　　　　LEFT JOIN `action` a ON r.`action_id` = a.`id` 　　　　　　　　LEFT JOIN `user` u ON r.`user_id` = u.`id` ・これだと「挑戦者」のユーザIDしか取得できない 　　　　　　SELECT *,a.user_id AS actionuser_id 　　　　　　　FROM result r 　　　　　　　　LEFT JOIN `action` a ON r.`action_id` = a.`id` 　　　　　　　　LEFT JOIN `user` u ON a.`user_id` = u.`id`
MySQLの「 INT」型と「 DATETIME」型の違いを教えてください。 ・「 DATETIME」型とは、単に日付形式を担保してくれる型に過ぎないのでしょうか？ ・日付形式(フォーマット)以外を挿入すると、「0000」になってしまうということでしょうか？ ■「 DATETIME」メリット ・データ内容が見た目で分かる以外、何があるのでしょうか？ ■「 INT」メリット ・早い？
●質問の主旨 phpMyAdminのMySQLで ストアドプロシージャの動作確認をしています。 試しに、 delimiter // create procedure pr30() begin select * from tb; select * from tb1l; select * from tb1; end // delimiter ; というプロシージャを作成して、 実行を押しても、画面が全く変化しません。 エラーの表示さえされません。 （もちろんデータベーステーブルのtb、tb1l、tb1が 存在することは確認済みです） また、作成している最中に、 命令文が勝手に消えることもあります。 普通に select * from tb; と、書いていても消えることはないのですが…。 この現象や対策についてご存知の方がいらっしゃいましたら、 アドバイスをお願いします。 ●環境 windows8 xammp1.8.1 phpMyAdmin3.5.2.2 MySQL5.5.27
現在MySQL Adminにアクセスしています。 選択できるデータベースが多数あります。 このデータベース内の特定のテーブルの最終更新日が1ヶ月以内のものが何があるのか調べたい時どのような方法がありますか？
次の２つのテーブルがあります。 テーブル master 形式kata 客先kyaku コードcode テーブル data 形式kata 客先kyaku 発行年月hakko 数量suryo 発行年月が201303と201305の両方があるマスタを抜き出したいため、次のＳＱＬを考えました。 select m.kata,m.kyaku,m.code from master m join data d on m.kata=d.kata and m.kyaku=d.kyaku where 201303 in (select d.hakko from data d where m.kata=d.kata and m.kyaku=d.kyaku) and 201305 in (select d.hakko from data d where m.kata=d.kata and m.kyaku=d.kyaku) 無駄があるようで、また速度向上したいのですが、どう記述していいか分かりません。 教えてください。
■環境 ・PHP+MySQL ■質問 ・「順位データ」の持ち方について教えてください ・「順位データ」はデータベース側で保存するものでしょうか？ ・あるいはPHPで都度処理するのでしょうか？ ・ケースバイケース？ ■データベース側で保存する場合 ・「通常データ」だと、該当レコードを「挿入」もしくは「更新」すればそれで済みますが、「順位データ」だと1件データを「挿入」もしくは「更新」するだけで、全レコードに影響を及ぼす可能性があります ・この場合、1レコードでもデータを変更したら、全レコードに変更処理をかけるしかないのでしょうか？
社内でwordpressを利用したブログを開設しようと考えています。 社内の管理者は、セキュリティやサーバー負荷を懸念し、MySQLデータベースを社内のサーバーに作成することに躊躇しているようなのですが、たとえば、「wordpressの構成ファイル（index.htmlやwordpressテンプレートなど）を社内のwebサーバーにインストールし、MySQLデータベースは外部のサーバー（もしくは社内の別サーバー）を利用する」といったようなことは可能でしょうか？
LAMP環境で開発をしています。 SQL文でCOUNTを求める際に、まとめて結果を求めようとして上手く行きません。 状況としては以下です。 テーブルdはidをkeyにa,b,c３つのテーブルとjoinしています。 id = 1の場合、テーブルa,b,cにマッチするレコードがそれぞれに４個、１個、０個あります。 ひとつひとつを SELECT COUNT(CASE WHEN a.name IS null THEN 1 ELSE null END) as a_count FROM d INNER JOIN a ON a.id = d.id WHERE d.id = 1 として結果を求めると4,1,0と出るのですが、まとめて SELECT COUNT(CASE WHEN a.name IS null THEN 1 ELSE null END) as a_count, COUNT(CASE WHEN b.name IS null THEN 1 ELSE null END) as b_count, COUNT(CASE WHEN c.name IS null THEN 1 ELSE null END) as c_count FROM d INNER JOIN a ON a.id = d.id INNER JOIN b ON b.id = d.id INNER JOIN c ON c.id = d.id WHERE d.id = 1 とすると28,5,0という値が返されます。 どのように書けば正しい4,1,0を得られるのでしょうか？ よろしくお願いします。
Mysql+phpで日報システムを作っています。 独学でWebサイトの情報を見ながら作っているのですが、 更新系の処理に手間取っています。 環境は以下の通りです。 PHP:5.2.4 OS:WindowsServer2003 SP1 MYSQL:5.1.41 元画面から、ボタンを押してDBの更新処理を行うと、画面が真っ白になってしまい固まった状態になります。 MYSQLの問題かなと当初は思ったのですが、更新自体もされてはいますので、PHPの問題ではと思い投稿させて頂きました。 他の参照系のスクリプトは正常に動作します。 ちなみに、この現象はIEでしか出ません。 FFやChromeでは正常に動作します。 ポップアップブロックも外し、IEのアドインを全部外してみましたが、結果は同じでした。 同様の事態を経験された方、考えられる原因を御存じの方がおられましたら、コメント頂ければ幸いです。 更新スクリプトの内容は以下の通りです。 <?php // MySQL 接続 if (!($cn = mysql_connect("192.168.*.***", "user", "password"))) { die; } // MySQL DB 選択 if (!(mysql_select_db("mydatabase",$cn))) { die; } 　　（中略） $SQL="UPDATE NIPPO SET = ***** "; 　　（中略） print $SQL; // ***** この内容が出ずに固まっている ****** $sts = mysql_query($SQL,$cn); if (!$sts) { print "<br><img src='img/error.jpg' width=32 height=32>"; print "更新に失敗しました。"; print "<br><A HREF='javascript:history.back()'>前のページに戻る</A>"; } else { print "<br><img src='img/inf.jpg' width=32 height=32>更新しました。"; print "<br><A HREF='moto.php'>前のページに戻る</A>"; } } ?> </body> </html>
SQL(MySQL)についての質問です。 顧客データの中からある月の誕生日のデータを抽出しようと考えています。 6月生まれだったら、 SELECT * FROM customer WHERE DATE_FORMAT(birthday, '%m')= 6; 12月生まれだったら SELECT * FROM customer WHERE DATE_FORMAT(birthday, '%m')= 12; でできるんですが、実は顧客データの中には誕生日がわからない人がいて、 その場合「1900-01-01」をセットしています。 ですので、１月生まれを指定する SELECT * FROM customer WHERE DATE_FORMAT(birthday, '%m')= 1; とすると誕生日が「1900-01-01」の人も含まれてしまいます。 誕生日「1900-01-01」のデータを排除するSQLがわからなくて困っています。 NOT IN とか EXCEPT とか使ってみたんですがうまくいきませんでした。 どなたか教えて頂けると大変うれしいです。 よろしくお願いします。
INDEXが着いていないカラムをSELECTで検索しても他のカラムにプライマリーキーがあれば、検索は高速になるのでしょか? テーブル ID、NAME IDにプライマリーキーが付いていて、NAMEのカラムのみを検索するときにも高速になるのでしょうか？
「INT」でかつ「AUTO_INCREMENT」のカラムに0をINSERTしようとするとうまくいかないのですが、 「AUTO_INCREMENT」では0はダメなのでしょうか？ それとも「INT」だから？
データーベースが下記の様にあります、 PHPファイル内で、 この様なSQLを実行して下記の様にprintしてみましたが、 tie_upの部分、AIRとしか表示されません。 このPHPファイル内のprint($row['tie_up']);部分が怪しそうですが、 解決策が思いつきません。 もちろん、外部キーの設定も済んでいます。 --下記、SQL文-- SELECT * FROM ((((( song left JOIN kashu ON song.kashu_ID = kashu.kashu_ID) left JOIN sakushi ON song.sakushi_ID = sakushi.sakushi_ID) left JOIN sakkyoku ON song.sakkyoku_ID = sakkyoku.sakkyoku_ID) left JOIN hennkyoku ON song.hennkyoku_ID = hennkyoku.hennkyoku_ID) left JOIN tie_up ON song.tie_up_1_ID = tie_up.tie_up_ID) LEFT JOIN tie_up ti2 ON song.tie_up_2_ID = ti2.tie_up_ID --SQL文、終わり-- --下記、phpファイル内のprint文-- while ($row = mysql_fetch_assoc($result)) { print($row['tie_up']); } --print文、終わり-- --データベース-- song +-----------+--------------------+--------------------+--------------------+ |　ID　　　|　song_name　｜　tie_up_1_ID　|　tie_up_2_ID　| +-----------+--------------------+--------------------+--------------------+ |　0　　　|　鳥の詩　　　　|　0　　　　　　　|　0　　　　　　| +-----------+--------------------+--------------------+--------------------+ |　1　　　|　青空　　　　　|　1　　　　　　　|　0　　　　　　| +-----------+--------------------+--------------------+--------------------+ tie_up +----------------+--------------------+------------------------+ |　tie_up_ID　|　tie_up　　　　｜　tie_up_yomi　　| +----------------+--------------------+------------------------+ |　0　　　　　|　AIR　　　　　|　エアー　　　　　　| +----------------+--------------------+------------------------+ |　1　　　　　|　CLANNAD　　|　クラナド　　　　　| +----------------+--------------------+------------------------+ --データベース、終わり--
関係有りそうな部分だけ抜粋します。 mysqlで外部キーを設定して、 下記のようなSQLを実行してみましたが、 #1066 - Not unique table/alias: 'tie_up'と エラーメッセージが表示されました。 何がおかしいのでしょうか？ 外部キーは「song」テーブルの「tie_up_1_ID」、同「song」テーブルの「tie_up_2_ID」、 それと「tie_up」テーブルの「tie_up」です。 SQLを触るの5年振りなんで・・・。 SELECT * FROM ((((( song left JOIN kashu ON song.kashu_ID = kashu.kashu_ID) left JOIN sakushi ON song.sakushi_ID = sakushi.sakushi_ID) left JOIN sakkyoku ON song.sakkyoku_ID = sakkyoku.sakkyoku_ID) left JOIN hennkyoku ON song.hennkyoku_ID = hennkyoku.hennkyoku_ID) left JOIN tie_up ON song.tie_up_1_ID = tie_up.tie_up_ID) left JOIN tie_up ON song.tie_up_2_ID = tie_up.tie_up_ID;
jspファイルを実行するとカラムが見つかりませんというエラーが出ました。 対象のテーブルにoniカラムは置いてあります。 どこを見直せば良いのでしょうか？よろしくお願いします。 java.sql.SQLException: Column 'oni' not found. at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1078) at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:989) at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:975) at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:920) at com.mysql.jdbc.ResultSetImpl.findColumn(ResultSetImpl.java:1167) at com.mysql.jdbc.ResultSetImpl.getInt(ResultSetImpl.java:2851) at org.apache.tomcat.dbcp.dbcp.DelegatingResultSet.getInt(DelegatingResultSet.java:275) at org.apache.tomcat.dbcp.dbcp.DelegatingResultSet.getInt(DelegatingResultSet.java:275) at suika.SuikaDAO.findKeisanByID(SuikaDAO.java:134) at suika.SuikaServlet.doPost(SuikaServlet.java:39) at javax.servlet.http.HttpServlet.service(HttpServlet.java:647) at javax.servlet.http.HttpServlet.service(HttpServlet.java:728) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:222) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:953) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:408) at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1023) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:312) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) at java.lang.Thread.run(Thread.java:722)
下記のようにテーブルが有り、外部キーの設定も済んでいますが、 PHPファイル内で「select * form song WHERE song_name LIKE '%%'」と実行すると 「0,眠り姫,0」と表示されます。 このsql文を実行した上の結果の一番右側を「0」でなく「栗林みな実」と出力したいのですが、 なにぶん最後にsqlを扱ったのが5年以上前で、 全部頭から抜けてしまっていますorz 外部キーは「song」テーブルのkashu_IDと「kashu」テーブルのkashu_IDに設定してあります。 mysqlのバージョンは5.1.69
データベースを作り、サーブレットを通してjspに出力させるプログラムを作っているのですが 実行するとYou have an error in your SQL syntaxとエラーが出ます。 SQL文がおかしいらしいので見ていただきたいです。DAOパターンを使用しています。 SQL文でやりたいことは言葉(kotoba)を入力するとその言葉にあてはまるカラム(colom)から賃金(kane)の合計を計算して出力させたいです。 String sql = "select sum(kane) from employee where colom 'kotoba'=" + kotoba; 文章が変でしたら教えてください。よろしくお願いします
（テーブルA）と（テーブルB）をleft joinした際の結合条件について 詳しい方に伺いたいのですが、 on以下の部分は、（テーブルAの中にあるカラム）と（テーブルBの中にあるカラム）を 比較するような文でなければいけないですか？ 例えば、、、 ------------------------------------------------------------------------- SELECT* FROM 　timeTpl2 AS t LEFT JOIN booked AS b ON 　t.start = b.startTime AND 　b.settingDay = $day ------------------------------------------------------------------------- 上記の最後の部分（b.settingDay = $day）は テーブルbにしかない要素を変数（$day）と比較しています。 ◆疑問 記述としてだいじょうぶかどうかを知りたいです。 つまりon以下結合条件は必ず左右のテーブルの、存在するカラム のみしか比較する事ができないかどうかが知りたいです。 よろしくお願いします。
idの順位を取得する方法はありますか？ voteが一番多い順にソートして指定したidの順位を取得したいです もしくは、指定したidが3番以内に入っているかどうか調べたいです テーブル id　vote 1　5 2　6 3　3 4　1 5　12 ソートした後のテーブルのイメージ　id3の順位を指定した場合、4番目なので4を取得したいです id　vote 5　12 2　6 1　5 3　3 4　1 よろしくお願いします
二つのテーブルの行数は同じとします 1行に10カラム以上あるテーブルから1カラムだけ取得するのと idとvoteだけの2カラムで作ったテーブルから1カラムだけ取得する場合の処理スピードは速くなりますか? updateで更新する時のスピードもカラム数が多いと違いが出ますか？ よろしくお願いします sprintf("SELECT vote FROM hoge WHERE id=%d", $id );
XAMPPでｍｙｓｑｌを使ってます。 CSVをインポートするとUTF-8が文字化けしてしまいます。詳しくわかる方いましたらお知恵をお貸しください。 まず、ｍｙｓｑｌの設定ですが show variables like 'char%'; をおこなうと +--------------------------+--------------------------------+ | Variable_name | Value | +--------------------------+--------------------------------+ | character_set_client | utf8 | | character_set_connection | utf8 | | character_set_database | utf8 | | character_set_filesystem | binary | | character_set_results | utf8 | | character_set_server | utf8 | | character_set_system | utf8 | | character_sets_dir | C:\xampp\mysql\share\charsets\ | +--------------------------+--------------------------------+ 8 rows in set (0.05 sec) となっています。 次に、アップロードするCSVですが、 １回目は、terapadを愛用しているので、terapadの機能でUTF-8に変換して保存したのですが、インポートすると文字化けしてしまいました。 次は、エクスプローラーでUTF-8に変換したファイルを読み込むと文字化けしており、エクスプローラーのエンコードで文字コードをUTF-8に変換し保存したものを、CSVに変換してインポートしたのですが、やっぱり文字化けしてしまいました。 私の知識ではこれ以上手がないのでなにかあたらしい突破口や間違いがあれば教えてください。
テーブルで一番古いレコードだけをSELECTしたいのですが、どうすれば良いでしょうか？ ■背景 ・テーブルからデータを取得しようと思ったら、「id」及び「autoincrement」に該当するカラムがありませんでした ・日付に該当するカラムもありません ・「phpMyAdmin」で確認すると、いつも同じ並び順で表示されるので、格納したレコード順で表示されているのではないかと思いました ■質問 ・この時、そのテーブルで一番古いレコードだけをSELECTしたいのですが、どうすれば良いでしょうか？ ・where?
mysq初心者です 値の取得する順番を変えないで、値を取得する方法はありますか？ 会員IDが5、1、3で取得したいのですが1、3、5に並び替えられてしまいます テーブルはIDとNAMEのみ、重複なしで、ID番号と名前番号が一致しています sprintf('SELECT id FROM hoge2 WHERE name="%s" or name="%s" or name="%s" ', ほげ5, ほげ1, ほげ3 ); $recd = array(); while ($rec = mysql_fetch_assoc($sql2)) { $recd[] =$rec['id']; }
お世話になります。 基本的な質問かもしれませんが、教えて頂けますとうれしいです。 PHP Version 5.4.14 MySQL 5.5.27 の環境です。 MySQLでたとえば以下のようなテーブルを3種類用意したとします。 ●group gr_id | gr_name | gr_status 1 | 野菜 | 1 2 | 果物 | 1 3 | 穀物 | 0 ●product pr_id | pr_name | pr_gr_id | 1 | 大根 | 1 | 2 | キャベツ | 1 | 3 | にんじん | 1 | 4 | イチゴ | 2 | 5 | 米 | 3 | ●picture pc_id | pic_file | pc_pr_id | 1 | 1.jpg | 1 | 2 | 5.jpg | 1 | 3 | 10.jpg | 1 | 4 | 100.jpg | 2 | 5 | aiueo.jpg | 2 | 6 | kakikuk.jpg | 3 | 6 | xxxxxxx.jpg | 4 | 6 | zzzzzzz.jpg | 5 | 各テーブルは （親）group[gr_id] = （子）product[pr_gr_id] （子）product[pr_id] = （孫）picture[pc_pr_id] の項目で、親、子、孫の関係になっています。 このとき、gr_status = 1 に該当する全データを、 3つのテーブルを連結した上で取得し、 「親テーブルの結果 => 子テーブルの結果 => 孫テーブルの結果」 という形で多次元配列化したいのですがどのようにすれば出来そうでしょうか？ SQLでそのように取得する方法があるか、それとも 一度全データを取得した後、PHPで入れ子にする方法があるのでしょうか。 よろしくお願いします。
データベースとSQLを接続するプログラムを作っています。 いざ実行すると下のようなエラーが出てきました。 検索してもあまり理解が出来なくて困っています。これはどういう意味なのでしょうか？ 回答よろしくお願いします。 [root cause] java.sql.SQLException: ResultSet is from UPDATE. No Data.
DBに以下のようなデータが格納されているとします。 | id | name | | 01 | apple | | 01 | banana | | 02 | onion | | 02 | potato | | 02 | carrot | | 02 | radish | | 03 | beef | | 03 | chicken | | 03 | pork | GROUP_CONCATという関数を使えば、 | id | name | | 01 | apple,banana | | 02 | onion,potato,carrot,radish | | 03 | beef,chicken,pork | と、まとめられることは分かっているのですが、 データ個数を指定または最大値に合わせることは可能でしょうか。 実現したい例を以下に記載します。 | id | name | | 01 | apple,banana,NULL,NULL, | | 02 | onion,potato,carrot,radish | | 03 | beef,chicken,pork,NULL | ※「id:02」の最大値「4データ」に合わせるまたは「4」を指定する GROUP_CONCATの引数にはこのような機能はないように見受けられました。 他の手法でも構わないのですがこのような内容を実現できる方法がありましたら ご教授頂ければ幸いです。 どうぞよろしくお願いします。
自分ではすぐに浮かばないのですが、結構急ぎのことなのでお時間がある方でご存知の方がいらしたら教えて下さると嬉しいです。なので、途中で解決していたり質問を途中で消しているかもしれませんがよろしくお願いします。 SQLで自分が書いた文を高速化したいのですが、一般的にこうすると遅いからこうする方が良いというのがあれば教えてください。 一応自分でも調べててWHERE句では結合よりも先に条件を記載する方が良いとか書いてました。 あと、IN演算子がちょっと問題な演算子ということが。 確かにSQL文を書いているソースではいくつかSELECT文があって、それぞれでIN演算子を使っています。 調べてるとIN演算子をEXISTS演算子に書き換える方が良くなるとあったのですがEXISTS演算子はカッコ内で再度SELECT文を作るんですよね？ 今使っているIN演算子では、ほぼカッコ内に数字のいくつかの候補があってそこから該当する数字を選ばれるという形の方。 WHERE　ＡＡＡ　ＩＮ　（'122','244','366'） といった形です。 あるＳＥＬＥＣＴ文でＩＮ演算子を使って絞った値データを次のＳＥＬＥＣＴ分のＩＮ演算子の値候補として使用しています。 つまり、上記のような文１２２と２４４のデータが見つかってＳＥＬＥＣＴされると次のＳＥＬＥＣＴ文のＩＮ演算子の候補として１２２と２４４が入るという形です。 ちなみにこの処理のメインとなるテーブルでは一つの項目の値を木構造で分けているのでその辺りも考えないといけません。 以前、こちらのサイトで教えて貰った方法で動いている GROUP BY ＡＡ．Ａ１ HAVING COUNT(*) >= 0 といった処理も重くしてしまうのでしょうか？
値を1レコードに詰め込む必要があり30個近くになってしまいました。 SELECTやINSERTのときの速度が気になるのですが、問題ありませんででしょうか？ また、問題があれば、どのような回避策がありますでしょうか？ 宜しくお願いします。
お世話になっております。 勉強がてらネットショップを作っているのですが、売上一覧を表示すべくところで立ち止まってしまいました。 以下にテーブルの構成および得たい結果を書き残しますので、ご教示頂けた幸いです。（MySQL5) テーブル名：member member_no　　name1 　1　　　　　　佐藤 　2　　　　　　小島 　3　　　　　　石田 　4　　　　　　鈴木 テーブル名：sales sales_no　sale_slip_no　sales_date　　member_no　goods_name　request_money　receipt_maney 　1　　　　　1　　　　　2013-6-6　　　　　2　　　　　キュウリ　　　　　　5250 　2　　　　　1　　　　　2013-6-6　　　　　2　　　　　イチゴ　　　　　　　3150 　3　　　　　1　　　　　2013-6-6　　　　　2　　　　　バナナ　　　　　　　8400 　4　　　　　2　　　　　2013-6-7　　　　　1　　　　　りんご　　　　　　　5250 　5　　　　　2　　　　　2013-6-7　　　　　1　　　　　　　　　　　　　　　　　　　　　　　　　3000 　6　　　　　3　　　　　2013-6-8　　　　　4　　　　　ほうれん草　　　　　9450 　7　　　　　3　　　　　2013-6-8　　　　　4　　　　　しいたけ　　　　　　2100 　8　　　　　4　　　　　2013-6-8　　　　　3　　　　　マンゴー　　　　　　6300 ・各テーブルにあるmember_noカラムは対となる紐付くデータです。 ・sale_slip_noは伝票番号です。 ・request_moneyは商品単位での小計金額です。 ・receipt_maneyは入金金額（またはポイントが支払いに使われた時の金額）です。 ・質問と無関係と思われるカラムは省略しています。 以上のような構成のテーブルがありますが、以下のように伝票番号毎に別け、かつ伝票毎の合計額を求めたいと考えています。 sale_slip_no　sales_date　　name　　request_money 　4　　　　　　2013-6-8　　　石田　　　　6300 　3　　　　　　2013-6-8　　　鈴木　　　　11550 　2　　　　　　2013-6-7　　　佐藤　　　　2250 　1　　　　　　2013-6-6　　　小島　　　　16800 以上ですが、join group sumの組み合わせになるのかな・・と考え調べ、試行錯誤を繰り返していますが、描いている結果を得ることが出来ません。どのようなSQLになるのかご教示いただければ幸いです。 また、売上データとして蓄積させるテーブル構成を作ったのは初めてですが、もっと適切なものがあれば、こちらも併せてアドバイスを頂けると幸いです。 お忙しいなか恐縮ですが、宜しくお願い申し上げます。
PHPとＭＹＳＱＬをつかっています 会員情報から友達の名前を登録できるようにしました postで受け取った情報は友達の名前のみです 友達の名前から友達のID番号を取得したいのですが、15人分まとめて取得する方法はありますか？ 調べるテーブルのカラムにはidとnameがあります(idとnameに重複はありません) ｈｔｍｌフォームは(input=text)が15個ほどあって、何も記入されていない欄もあります（fre3に書き込んであってfre2が空白の場合があります） $fre1 = $_POST['fre1']; $fre2 = $_POST['fre2']; $fre3 = $_POST['fre3']; 　　　・ 　　　・ 　　　・ $sql = sprintf("SELECT id FROM friend WHERE name LIKE '%s'",$fre1); $recordSet = mysql_query($sql); $data = mysql_fetch_assoc($recordSet);
tbというテーブルのbangというカラムに4が含まれていれば表示というのは select * from tb where (bang) like '%4%' ; という形になりますが、このtbテーブルにさらにname,tukiというカラムがあったとして カラムに関係なくレコードのどこかに４が入っていれば抽出するというSQL文が書きたいです。 select * from tb where bang like '%4%' or name like '%4%' or tuki like '%4%' ; と書くことで何とか今まではやってきたのですが、カラム数が増えてきてしまったので、ものすごく長いSQL文なってしまいました。 もう少しスマートにする方法はありませんか？
http://oshiete.goo.ne.jp/qa/1599858.html この質問に疑問があります。 回答２で where (column1 || '/' || column2 ||'/' || column3) like '%word1%' ; というアドバイスに対して質問者は where　( concat( column1 , column2 , column3) like '%word1%' ) でできたと返しています。 なぜ、質問者はwhere ( concat( column1 , column2 , column3) like '%word1%' ) というSQL文にいたったのでしょうか？ where　( concat( column1 , column2 , column3) like '%word1%' ) では、だめだったのでしょうか？
eclipseを使ってデータベースの検索を行いたいのですが、実行すると java.lang.ClassNotFoundException: com.mysql.jdbc.Driver とエラーが出ます。ビルド・パスのライブラリーには下記のものが入っているのですが あとは何が足りていないのでしょうか？ jstl.jar standard.jar TOMCAT_HOME/common/lib/jasper-runtime.jar TOMCAT_HOME/common/lib/jsp-api.jar TOMCAT_HOME/common/lib/servlet-api.jar jdk1.5.0_22
すいません。現在phpを勉強中で、その際データベースが必要で、初心者サイトを見ながら初めてsqlをさわったのですが Admin自体に接続できなくなり困っています。 （最初は接続できたのですが、PCをシャットダウンして再度接続しようとしたらできなくなりました） エラーメッセージは #2002 - サーバが応答しません (あるいはローカルサーバのソケットが正しく設定されていません)。 設定ファイルに定義されている管理ユーザ(controluser)での接続に失敗しました。 と表示されました。 他の教えてgooの質問や、ググったりしてそれらしい解決方法は読んでいるのですが、専門用語だらけでほとんど分かりません。 接続ができないと何もできませんし、どなたか具体的にどういった解決方法があるか教えてもらえませんでしょうか・・。（ここの設定を見なおせ・・というアドバイスはありがたいのですが、具体的にその 設定画面までいける方法も教えてもらえると助かります。とにかくどの名前のファイルを開けるのかを教えてほしいです）
お世話になっております。 PHPにてMySQLのデータを取得するスクリプトを制作しています。 （MySQL5) 日付データ（DATE型）カラムを持つテーブルがあり、現在から直近日を取得したとき、そのデータが現在より1ヵ月以内のデータであるか否かを分別したいと考えています。 そこでお聞きしたいのは、データを参照する際、MAX()にて直近日を取得し、そのデータが1ヵ月以内であるか確認するパターンと、max()を使わず、WHERE（条件）にて、1ヵ月以内に収まる日付データがあるか確認しるパターンと、どちらが処理が速く済むのでしょうか？ 他の処理を行うための条件なので、これら処理によりデータを取得する必要はなく、該当する日付があるか否か、という確認だけのものです。 お忙しいなか恐縮ですが、アドバイスのほど頂戴出来れば幸いです。 宜しくお願い致します。
CREATE DATABASE cooking; としたら ERROR 1004 (42000): Access denied foruser ''@'localhost' to database 'cooking' と出ました。 どこが悪いんでしょうか・・・ お願いします
下記のようなテーブルがあります。 【tableA】 tableAは、各ユーザーが友人として登録しているリストです。 ID_A が本人名、f1～f5　が友人登録リストです。 鈴木さんは、友人として「横田さん、小森さん、原さん」の3人を登録していることになります。 【tableB】 tableBは各人が保有しているポイントです。 この2つから、「自分及び登録した友人とのポイント比較画面」を作りたいと思っています。 ************************************ tableA ID_A f1 f2 f3 f4 f5 suzuki yokota komori seki yokota komori hara yokota hara seki komori hara seki komori hara ************************************* tableB ID_B point suzuki 550 yokota 400 hara 250 komori 350 seki 600 honda 520 ************************************* やりたいこと IDをベースに自分、及び友人の点数を羅列させたい 欲しい結果 tableB.ID_B = 'suzuki' の場合 suzuki 550 yokota 400 komori 350 seki 600 tableB.ID_B = 'yokota' の場合 yokota 400 komori 350 上記のSQLを組むことができません。 お知恵を拝借したくお願い申し上げます。 当方が組んだSQLです。膨大な羅列が返ってきました。（汗) SELECT tableB.ID_B,tableB.point from tableA,tableB WHERE (tableA.ID_A=tableB.ID_B or tableA.ID_A=tableB.f1 or tableA.ID_A=tableB.f2 or tableA.ID_A=tableB.f3 or tableA.ID_A=tableB.f4 or tableA.ID_A=tableB.f5) and AND tableB.ID_B = 'suzuki' 宜しくお願い致します。
ちょっと壁に当たったので、わかる範囲でお答え頂きたいのですが、 以下のようなテーブルがあったとします。 id　user　price　date 1　A　1000　2013/5/31 2　A　1200　2013/6/1 3　B　1000　2013/5/20 4　A　1500　2013/5/12 5　C　1300　2013/5/31 6　C　1400　2013/5/14 7　C　1000　2013/5/6 8　B　1100　2013/5/24 9　B　1200　2013/5/30 10　B　1100　2013/5/4 11　A　1800　2013/4/12 12　C　900　2013/4/6 ・・・ 次に取得したいのは、 A　1200　2013/6/1 A　1000　2013/5/31 A　1500　2013/5/12 C　1300　2013/5/31 C　1400　2013/5/14 C　1000　2013/5/6 B　1200　2013/5/30 B　1100　2013/5/24 B　1000　2013/5/20 このようなデータなのですが、 条件： １．userでグループ化したうちの日付降順で並べる ２．そのuserのデータの中で、日付降順で並べる ３．userのデータが複数あっても、取得するのは新しいものから3件のみ この条件を満たすSQL文はどのように記述すればよいか、お知恵をお貸し下さい。 よろしくお願いします。
■質問 ・MySQL予約語名でもカラムを作成できるのでしょうか？ ■背景 ・文法エラーSQL文の原因を調べると、どうやら予約語を利用したためだと分かりました ・予約語と知っていたら初めから利用しなかったのですが、その名前で普通にカラムを作成できたので、てっきり使えるものだと思い込んでしまいました ■知りたいこと ・予約語を回避するには、ここをチェックするしかないのでしょうか？ ▽MySQL 5.1 リファレンスマニュアル :: 8.3 MySQLでの予約語の扱い 　 http://dev.mysql.com/doc/refman/5.1/ja/reserved-words.html ・予約語による影響を受けるのはどんな時？(CREATEは関係ない？)　予約語によって異なる？
さきほどバグがあがってきて対策をしています。 現状、恥ずかしながらテンパってしまっていて 急ぎで、対策するまでの間やりたいことがあるんです・・・。 それは、 「複数あるテーブルすべての、あるカラムの値が０であるすべての行のカラムの値を９に変えたい」です。 もう少し具体的に書きます。 [KOKYAKU_TABLE] [TYUMON_TABLE] [GAZOU_TABLE] という複数のテーブルがあって、 その複数のテーブルには<id>というカラムがあります。 （<id>で関連付けしてあるんです) 全てのテーブルから、<id>の値が「0」になっている行を検索し、 その値を「9」に書き換えたいんです。 何分テンパっていて、 改修作業中にいじられちゃったりしてさらにテンパってます、ごめんなさい よろしくお願いいたします＞＜
VBでアプリを開発する予定です。 データベースにMySQLの使用を検討していますが、ライセンスについてわからないので 教えてください。 VBのアプリはexeのみを配布する予定で、VBのプログラムは客先に公開しない予定です。 この場合、ライセンスは無償ではなく有償扱いになるのでしょうか。 情報をお願いします。
MYSQL初心者で参考書にかじりついてプログラミングしています。 主にDBの内容をPHPで吐き出させるといった使い方をしています。 SQL文があまりにも長ったらしくなってきたのでストアドプロシージャを使いたいのですが、使っているSQL文が (SELECT * FROM　.変数. WHERE .変数. LIKE '.変数.') UNION (SELECT * FROM .変数. WHERE .変数. LIKE '.変数.'); となっており、引数を複数使えないとスッキリさせられない状況です。 ストアドプロシージャで複数の引数を設定することはできないのでしょうか？
php初心者です。 （DB：mysqlをphp（PDO）で操作） 最近PDOの勉強をし始めましたが、記述の際に （接続に関する部分）と（クエリに関する部分） の記述位置に関してのルールがはっきりしません。 上記２つを続けて記述をすれば問題なく動くのですが、例えば、 ----------------------------------------------------------------------- try{ $link = new PDO($db, $user, $pass); }catch(PDOException $e){ echo 'データーベースに接続できません。' . $e->getMessage(); } ----------------------------------------------------------------------- だけ先に記述しておき（接続しておいて）、その後htmlやphpの記述をはさみ、 必要な部分で以下のように（クエリ）の記述をした場合、動きません。 <?php $stmt = $link->query('SELECT * FROM booked order by rsvTime asc'); ?> <table border="1"> <tr> <th>予約時間</th> <th class="wdt_at">施術開始</th> <th class="wdt_at">施術終了</th> <th>予約未、済</th> </tr> <?php if (!$stmt) { $info = $link->errorInfo(); exit($info[2]); } 　　　　　　　　 　　　　　　（※ここでクエリしたものを使用） 　　　　　　　　　　　　↓ while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) { print "<tr>\n"; print "<td>".htmlspecialchars($row["rsvTime"])."</td>\n"; print "<td>".htmlspecialchars($row["startTime"])."</td>\n"; print "<td>".htmlspecialchars($row["finishTime"])."</td>\n"; print "<td>".htmlspecialchars($row["kafuka"])."</td>\n"; print "</tr>\n"; } print "</table>"; ?> ■質問内容 そこで質問です。PDOの接続とクエリの記述位置やその他のルールを 詳しく教えて下さい。 よろしくお願いします。
php+mysqlでシンプルな会員登録を作りたいのですがパスワードは暗号化したほうがいいですか？ パスワードを簡単に暗号化できる方法はありますか？ postされたpassと暗号化されたpassのチェック方法がわかりません ログイン if ($_POST['id'] !='' && $_POST['pass'] !='') { $sql = sprintf('SELECT * FROM hoge WHERE id="%s" AND pass="%s"', mysql_real_escape_string($_POST['id']), mysql_real_escape_string($_POST['pass']) ); $record = mysql_query($sql) or die(mysql_error()); if ($table = mysql_fetch_assoc($record)) { $_SESSION['id'] = $table['id']; $_SESSION['name'] = $table['name']; } else { //エラー }
会員の名前の更新するときに、会員以外の重複がないか調べたいです 会員以外のidと名前の一致を取得しようとしましたがうまくうごきません やりたいことは 会員以外の名前と入力した名前が重複してないか調べたいです $id = mysql_real_escape_string($_POST['id]); $name = mysql_real_escape_string($_POST['name']); $name3 = mysql_query("SELECT name FROM hoge2 WHERE NOT id='.$id.' AND name='".$name."'");
MySQLの外部結合について教えてください 「結合の対象となっているカラムの値が一致」は必須なのでしょうか？ ■やりたいこと ・Aテーブルaカラム内にある「デリミタの先頭文字列」を抽出して、Bテーブルのidカラムと結合したい ■最終的にやりたいこと ・上記一致条件で、両テーブルデータをSELECTしたい ■試したこと ・「SELECT SUBSTRING_INDEX」で「デリミタの先頭文字列」を抽出できたのですが、そこで行き詰まりました ■質問 ・そもそもやろうとしていることが無謀なのでしょうか？ ・テーブル構成を見直した方が良いのでしょうか？
下記のようなSQLを実行しています。 SELECT db_1.*, CASE WHEN db_1.tihou = '北海道' THEN '1' WHEN db_1.tihou = '青森' THEN '2' WHEN db_1.tihou = '秋田' THEN '3' WHEN db_1.tihou = '山形' THEN '4' WHEN db_1.tihou = '岩手' THEN '5' WHEN db_1.tihou = '宮城' THEN '6' WHEN db_1.tihou = '福島' THEN '7' else '9' END AS kita, db_2.no, db_2.title, db_3.name, db_3.url from (db_1 left JOIN db_2 ON db_1.nonber = db_2.no) LEFT join db_3 on db_1.nonber = db_3.non WHERE db_1.nonber LIKE '1%' ORDER BY db_1.day DESC LIMIT 0,30 ※DB名、テーブル名は仮名としています db_1というメインのデータベースに合わせて db_2、db_3の情報をくっつけて結果を出したいと思っていますが実行に25秒強かかっています。 （PHPMyadmilで実行しました） db_1単体でしたら実行は速かったのですが db_2、db_3はどうしても付属させたく、また、db_1とは別のデータとしておきたいと考えています。 補足ではありますが、 「db_1.*」としているのは、db_1のデータ全て表示に使う為です。 良い方法をご存知の方いらっしゃいましたら、どうかお教え下さい。
検索対象項目が http://www.AAA.com/中略/0109.html http://www.AAA.com/中略/acb.html や http://www.AAA.com/中略/0110-1.html であったとき 文字列の右から判断して 0109.html 0110-1.html のように数字が入っている場合のみ、検索結果の対象としたいと考えてます。 上記に関する、SQL文の書き方を教えていただけないでしょうか？ 以前、 SELECT * FROM テーブル名 WHERE フィールド名 REGEXP '/[0-9]+\\.html$' と教えていただいたのですが、対象テキストに「-」が入っているケースが増えてしまったので 改めて質問となります。 正規表現の箇所次第なのかと思うのですが、、どうもわからりません。。 よろしくお願い致します。
IF もしくは CASE文(？)を利用して、FROM 箇所を変更することはできるでしょうか？ ■やりたいこと ・「hoge_id」カラムが0だったら、普通に「redult」カラムからデータ取得 ・「hoge_id」カラムが0以外だったら、「hoge_id」」「id」カラムで自己結合したテーブル(ビュー？)から「result」カラムデータ取得
ただいま『基礎からのmysql」という本で、ＭＹＳＱＬの勉強をしています。 本の中の、18-03という問題で <?php $s=mysql_connect("localhost","root","PASS") or die("失敗です"); print "成功しました。<br />"; mysql_select_db("db1".$s); mysql_query("INSERT INTO tb1 VALUES('k888','エスキュ',25)"); $re=mysql_query("SELECT * FROM tb1"); while($kekka=mysql_fetch_array($re)){ print $kekka[0]; print ":"; print $kekka[1]; print ":"; print $kekka[2]; print "<br />"; } mysql_close($s); ?> このような文章があるのですが、うまく動きません。 ----------------------------------------------- 成功しました。 Warning: mysql_fetch_array() expects parameter 1 to be resource, boolean given in C:\xampp\htdocs\sounyu_hyouzi.php on line 9 ----------------------------------------------- ↑のエラーを返すのですが、 スペルミスなどはなく、さっぱり原因がわかりません。 line9ということなので、 while($kekka=mysql_fetch_array($re)){ に問題がありそうな気もするのですが、見当もつきません。 ちなみに、 コマンドプロンとで、SELECT * FROM tb1をやると +------+-----------+------+ | bang | nama | tosi | +------+-----------+------+ | A101 | SATOU | 40 | | A101 | SATO | 40 | | A101 | NAKAGAWA | 40 | +------+-----------+------+ と表示され、 show databases;でも +--------------------+ | Database | +--------------------+ | information_schema | | cdcol | | db1 | | db21 | | db511 | | mysql | | performance_schema | | phpmyadmin | | test | | webauth | +--------------------+ このように表示されますので、データベースやテーブルの問題ではないのかと思います。 なにかピンとくる方おられましたらよろしくおねがいします。
mysqlで ■address_book +------+------+------+ | code | tel | name | +------+------+------+ | 41 | 012| android | +------+------+------+ ■customers +------+------+------+ | code | title | name | +------+------+------+ | 41 | abc| android | +------+------+------+ SELECT * FROM address_book NATURAL JOIN customers; で自然結合を行って、 その結果 +------+------+------+------+ | code | title | name |　tel | +------+------+------+------+ | 41 | abc| android | 012| +------+------+------+------+ と結果が出て、 この結果を +------+------+------+ | title | code | name | +------+------+------+ | abc | 41 | android | +------+------+------+ の順に表示させる様に、SQLを実行したいのですが、 SELECT * FROM address_book NATURAL JOIN customers; SELECT title, code, name FROM address_book; と連続でコマンドを実行できる方法はないのでしょうか？ phpmyadmin でSQLを実行しています。 お分かりになられる方、ご教授お願い致します。
MEMORY エンジンの説明にはテーブルサイズ制限の記載がないようですが、 InnoDBと同様に64TBまで、という解釈で良いでしょうか。 （現実にはそんなにメモリを搭載した環境はないと思いますが） 今検討しているデータベースではデータ容量の見積が最大100GBなので、 メインメモリ128GBのサーバで max_heap_table_size=110G とすれば データ全体をメモリ上に収容できると考えて良いでしょうか。
新規登録の時の重複をチェックしたいです テーブルのカラムはシンプルにidとnameとpassだけです nameに同じ名前の人がいると困るので、HTMLフォームから送られた名前と登録してある名前の重複がないかチェックするようにできますか？ やってみましたが動きません(ーー；； $name = mysql_real_escape_string($_POST['name']); $name3=array(); $name2 = mysql_query('SELECT name FROM hoge2 WHERE name=$name'); while($data = mysql_fetch_assoc($name2)) { array_push($name3, $data['name']); } if(isset($name3)){ print "重複があります"; }else{ //ここからsql $sql = sprintf('INSERT INTO hoge2 SET name="%s", pass="%s"', $name, mysql_real_escape_string($_POST['pass']) ); //ここまで mysql_query($sql) or die(mysql_error()); }
初心者です。 ユニークキーでここのレコードにコード番号をつけたいのですが、AUTO_INCREMENTでは数字しか対応してもらえず、A101.A102のようなコード番号を自動でつけることができません。 最終的にはAテーブル　Bテーブルというかたちで作っていき、場面場面でグループ化などしたいので、アルファベットがほしいのですが、そういう場合はどのようなやり方をするのが主流なのでしょうか？
すでに作ってしまったテーブルにユニークキーを付けたいと考えています。最悪の場合、新しくカラムを作っての追加でもかまわないのですが、いろいろ試してもエラーが返されてしまいます。 codeというカラムにユニークキーを設定したいのですが、 alter table テーブル名 modify unique code; alter table テーブル名 add unique code2; alter table テーブル名 modify code unique; alter table テーブル名 add code2 unique; alter table テーブル名 modify code test unique; alter table テーブル名 add code2 test unique; alter table テーブル名 modify unique code test; alter table テーブル名 add unique code2 test; alter table テーブル名 modify (code unique); alter table テーブル名 add (code2 unique); alter table テーブル名 modify (code text unique); alter table テーブル名 add (code2 text unique); など、思いつく限り試し、グーグルで調べる限り調べたのですが、出てきたものをためしてもダメでした。 テーブルを作成した後、カラムにユニークキーを設定した経験のある方、どのように変更をしたのでしょうか？
予約システムの時間を管理するような部分の記述がわかりません。 時間を比較するにあたり、ある値から1時間引いた値を利用したい ですが、その１時間を引くという記述がわかりません。 以下の５行目の一番最後の部分はどう記述したら良いですか？ 1: "select *from 2: timeTpl as t left join booked as b 3: on t.bookTime>=b.rsvTime and t.bookTime<b.finishTime 4: && 5: t.bookTime<b.rsvTime and t.bookTime<'b.rsvTime - 01:00:00' 6: where b.rsvTime is not null"; 　↑ うまくうごきません。 [db] ・timeTpl : 予約時間の候補を納めたテーブル 　　（ex.10:30,11:00,11:30,12,00・・・・） ・booked : すでに予約済みのデーターを収めたテーブル （予約時間rsvTime=（来店時間）、矯正時間startTime、矯正終了時間finishTime） ※時間の関係する部分は"time型"となってます。 ちなみに最終的に行いたいことは・・・ コースごとに取得できる予約時間が決まっています。（timeTpl) 予約時間の３０分後から矯正が始まり、その１時間後に終了します。 timeTpl（予約候補時間）の中から、予約可能なものだけを表示したい。 よろしくお願いします。
MySQLで複数テーブルからデータ取得する際、 FROMの後に、テーブル名を2つ書いて、「WHERE」で繋げる書き方と、 「JOIN ★★ ON」で繋げる書き方では、何が違うのでしょうか？ ・「INNER JOIN」と同じ意味でしょうか？ ・書き方によっては、「LEFT OUTER JOIN」みたいにも書けるのでしょうか？ ・普通は、どちらの書き方で書くとか、そういうお作法的な暗黙の了解はあるでしょうか？ ・例えば「WHERE」だと3つ以上繋げられない(？)から、奨励されていない、とか…
php独学（数ヶ月）の初心者です。 予約を管理するプログラムを自分でつくっています。 調べても調べてもどの関数をどのように使えば 良いかわからないまま数日がたってしまいました。 （初心者のため知らずに勉強し始めてしまった非推奨のmysql関数等を とりあえずまだ使用しています。mysql関数で教えていただければと思います。 ある程度理解を深めた時点できちんと勉強しなおします） ■予約の概要 コースごとに取得できる予約時間が決まっています。 予約時間の３０分後から矯正が始まり、その１時間後に終了します。 （予約時間に来店、30分間マシーンに乗り、その後先生の矯正が １時間ある。） ■作成したDB [DB01]予約時間テンプレート：time1 コースごとに取得できる予約時間が決まっています。 （以下はあるコースの予約可能時間のテンプレです。） id, time（time型） 1,10:15 2,11:45 3,14:30 4,16:00 5,17:30 6,19:00 [DB02]予約済みを貯めたDB：booked (時間はすべてtime型） id,name,time,start,finish,course 203,tanaka,10:00,10:30,11:30,a 101,abe,14:30,15:00,16:00,a 112,yoshida,17:00,17:30,18:30,c ■質問 [DB01]のうち予約可能な時間のみ<select>文で表示させたい。 ちなみ（予約可能な時間）は、11:45,16:00,19:00の３つです。 色々考えましたが、今の自分の実力では上記を実行させるコードが断片的に しか分からずお手上げとなりました。 よろしくお願いします。
mysql素人です group_idが登録者番号で5000以上の情報を持たせたいのですがテーブル設計がわかりません 才能ないなりに考えたのですがこんなテーブルしか思い浮かばないです・・・どんどんインサートしていく感じで考えたのですが良く考えたら、登録者が1万人くらいになったら1千万行くらいになって重くなる気がしました。もっと効率の良いテーブル設計ないでしょうか？ id group_id valu idは単なる行の番号、valuが点数の情報です
下記のような同一フィールド名を持つ異なるテーブルがあります。 tableA key1 field1 0007 AAAAAA 0009 B----- tableB key1 field1 0001 AAAAAA 0002 B----- 0003 AAAAAA 0004 C----- 0005 D----- 0006 AAAAAA 0008 E----- この２つテーブルから field1='AAAAAA'　となる列を取得して下記結果を得たいと考えています。 key1 field1 0007 AAAAAA 0006 AAAAAA 0003 AAAAAA 0001 AAAAAA お教え頂きたくお願いいたします。
ブログの1エントリーを、複数カテゴリーに属するようにしたいです。 ■テーブル構成？ ・「エントリーテーブル」「カテゴリーテーブル」 ・エントリーテーブルの1カラムで、属する「カテゴリーid」を保存するのでしょうか。例えば「2,3」みたいに ・この時、あるカテゴリーに属するエントリーをSELECTするにはどうすれば良いでしょうか？
テーブル作成について勉強しています。 将来、フィールドが増えてもいいようにテーブルをつくるには、 どのように作るべきでしょうか。 例えばですが、現時点で必要なフィールドは２つだけ（id,name）ですが、 今後、５つぐらいフィールドが増えても問題ないようにしたいです。 ご教授いただけませんでしょうか。 宜しお願い致します。
mySQLを使ってます。 SQL文で以下のことが実現したいです。 フィールドに登録されている文字列が http://www.AAA.jp/BBB/CCC/08191.html/?cp=waribiki http://www.AAA.jp/shop/DDD/EEE/08191.html http://www.AAA.jp/shop/DDD/EEE/ZZZ.html というタイプがあります。 SQL文で検索結果を表示したいのは、 http://www.AAA.jp/shop/DDD/EEE/数字.html のように右から「数字.html」の場合のURLパスだけを抽出したいです。 SELECT * FROM `テーブル名` WHERE `フィールド名` LIKE '%html' とやってみましたが、 http://www.AAA.jp/shop/DDD/EEE/ZZZ.html というものもヒットしてしまうため 右から「数字.html」の場合だけのSQL文の書き方を教えていただけないでしょうか？ よろしくお願い致します。
mysqlとperlを勉強中です 2つのテーブルから同じIDの情報を取得したいです。 hoge1テーブルとhoge2テーブルのIDは共通で一致しています。 （実際にはフィールドはもっと多いですがわかりやすくしています） hoge1テーブルは3つフィールドがあります ID　INT1　INT2 hoge2テーブルは3つフィールドがあります ID　TEXT1　TEXT2 hoge1テーブルで取得するのは数字が一致したIDです SELECT id FROM hoge1 WHERE int1=10 or int2=10 ORDER BY id hoge2テーブルで取得したいのはhoge1テーブルで取得したIDのTEXTです。やりたいことはこんな感じです SELECT TEXT1,TEXT2 FROM hoge2 WHERE id=hoge1テーブルで取得したID ORDER BY id; while (my $rec = $sth->fetchrow_array) { push(@recs, $rec); } perlでは配列で取得して後で、foreachで100個ほどprintしています。 hoge2も同じように取得したいのですが、hoge2はフォームを空白で送信できるようになっているので値がなにもないときがあります 配列に入れてしまうと空白のレコードがあるとその分、配列がずれてしまいます hoge1テーブルで取得したIDとhoge2テーブルで取得したテキストのIDを一致させる方法はありますか？ やりたいのはこうゆうことです。 テーブル1で値が一致しているIDを取得する テーブル2でテーブル1で一致したIDのテキストを取得する リレーションも考えましたが素人なのでピンときませんでした テキストのほうも配列で取得して100個ほどprintしたいのです よろしくお願いします
お世話になっております。 データベース名:payment_daibiki（MySQL 5.1） daibiki_no　postage_price_min　postage_price_max　daibiki_price 1　　　　　　　0　　　　　　　　9999　　　　　　　　315 2　　　　　　10000　　　　　 　29999　　　　　　　　420 3　　　　　　30000　　　　　　 99999　　　　　　　　630 4　　　　　 100000　　　　　　300000　　　　　　　 1050 という内容のテーブルがあります。 これは商品を発送する際の代引手数料が格納されているのですが、 postage_price_minと、postage_price_maxを参照して、この範囲内の手数料を 抽出するというものです。 例えば、発送する商品の代金が、2240円の場合、 postage_price_minより多きく、postage_price_maxより小さいものを参照するので、 求める手数料は315を返したいと考えています。 そこで質問なのですが、 SELECT * FROM payment_daibiki WHERE postage_price_min <= '2240' AND postage_price_max >= '2240' とSQLを実行させると、該当するデータはないと返されてしまいます。 初歩的な質問ですが、どこに誤りがあるのでしょうか？ また、一番小さな手数料を求めるため、 SELECT * FROM payment_daibiki ORDER BY daibiki_price DESC LIMIT 1 と実行させると、630が返ってきてしまいます。 初歩的な事とは重々承知していますが、色々と設定を変えても返ってくるデータが どれも予想を反するもので、どこに誤りがあるのか分からなくなってきました。 以上ですが、このような状況、どういったことが考えられるのでしょうか？ お忙しいなか恐縮ですが、アドバイスのほど頂戴出来れば幸いです。 宜しくお願い申し上げます。
はじめまして、私は、本業は3DCGで趣味でWeb系のツール開発をしている者です。 localhostでうまくページを表示できなくて困っています。 作っているものがCG用の開発ツールで外部に公開するものではなく、 ローカル環境のみでの使用になります。 開発環境はwindows7 64bit PHP5.3.23　Apache2.2 MySQL5.5になります。 個人で取得しているドメインのサーバーにデータをアップして見ると正常にページが 表示されますので記述したコード自体には問題はなさそうです。 昔WindowsXPで構築したマシーンのlocalhostでも正常表示されます。 以下、Windows7のlocalhostでの挙動になりますが、 (1)phpinfoのページは正常に表示されます。 (2)PHPからのMySQLへの接続とデータの取得もうまくいきます。 (3)しかし、MySQLのデータを取得し、formのselectを用いて <option value='<?=$c[$i]?>'><?=$c[$i]?></option> と記述するとルックアップメニューには空文字が入力されてしまいます。 (4)そこであえて(3)の記述を <<option value='<?php echo $c[$i]?>'><?php echo $c[$i]?></option> のように書くとなんとかメニューにMySQLのデータが入ってきます。 (5)しかし、以下のように $cate=$_GET[cate];　 などのような文を記述するだけでエラーが起きてしまいまして どう対処してよいかわかりません。 localhost環境で何か設定すべきところをしていないのか、 windows7のセキュリティの問題なのかわかりませんが、 どうしたら解決しますでしょうか。 当方、Web系は中規模ネットショップを独学で構築したレベルで実務経験はありません。 そのため難しい表現をされると理解できませんので、 あくまで初心者むけということで指導していただけると幸いです。
お世話になります。 ネットショップでの送料の計算を行いたいのですが、どのようなSQL文が適切なのか、アドバイスを頂戴したく質問させて頂きます。 以下のようなテーブルがあり、都道府県、サイズ、送料が登録されています。 no　　addr　　size　　price 1　　大阪府　140　　630 2　　大阪府　160　　840 3　　福岡県　140　　735 商品毎に商品サイズ、および発送先（都道府県別）によって、送料を抽出したいと考えているのですが、 １．同じ都道府県の登録、かつ不注意により同じサイズが登録されている。 ・・・この場合は、LIMIT　1として抽出。 ２．該当するサイズが登録されていなかった。 ・・・この場合は、同じ都道府県から一番大きな金額を抽出。 ３．該当する都道府県が登録されていなかった。 ・・・この場合は全てから一番大きな金額を抽出。 と、考えられる想定を事前に施しておきたいのですが、この場合どのようなSQL文になるのでしょうか？ PHPで制作しているのですが、１つのSQL文が思いつかずTRUEとFALSEで処理する形になってしまい、該当する都道府県がなかった場合は、結果、3度もDBに問い合わせてしまう形になっています。 お忙しいなか恐縮ですが、アドバイスなど頂戴出来れば幸いです。 申し遅れましたが、DBはMySQLの５を利用しています。 宜しくお願い致します。
mysqlを使用しております。 下記のようなテーブルを作りたいと思っているのですが、 親通し番号が同じ行についてのみ1からオートインクリメントすることは出来るのでしょうか？ どなたかアドバイス頂ければと思います。 -------------------------------------------------------------------------------------- column1：親番号 column2：子通し番号 　　・ 　　・ 　　・ column1：1 column2：1　←カラム1が同じ値のとき、カラム2はinsertされた順に増えていく column1：1 column2：2 column1：1 column2：3 column1：2 column2：1　←カラム1が増えたとき、カラム2は1に戻りインクリメントされていく。 column1：2 column2：2 column1：2 column2：3
hoge_●● hoge_★★ など、テーブル名が「hoge_」で開始するテーブルを、削除するSQL文を教えてください
プログラム素人です。 初心者なのでこんなテーブルを思いつくのですが、これってカラムをいちいち作らないといけないので後のメンテが大変な気がします CREATE TABLE hoge( id INT PRIMARY KEY, item1 VARCHAR(255), value1 INT, item2 VARCHAR(255), value2 INT, item3 VARCHAR(255), value3 INT ); こんな感じのテーブルにどんどんINSERTしていきたいのです CREATE TABLE hoge( id INT PRIMARY KEY, item VARCHAR(255), value INT ); 聞きたいこと MYSQL側 IDにPRIMARY KEYが付いているのですが2つ同じPRIMARY KEYはINSERTでききませんよね？どうすればいいでしょうか？ perl側 IDごとにまとめて取得して配列に入れる方法はありますか？ idが1のアイテムを全部取得して配列に入れる方法がわかりません（他にいい方法があったらお願いします） よろしくお願いします
●質問の主旨 コマンドプロンプトでMySQLを呼び出し、 SELECT * FROM db1.tb1; とデータベースとテーブルの全内容を呼び出すと、 文字化けがします。 普通に日本語を表示させるためには、どうしたら良いでしょうか？ ご存知の方、よろしくお願いします。 ●質問の補足 先日から、他の質問でも、文字化けが発生しています。 対応するために、「あれこれ」いじっているうちに、 MySQLでも文字化けが起こりました。 「あれこれ」いじった内容は、記憶が定かではありません。。 ●関連質問 eclipseの文字化けについて（PHPファイル) http://okwave.jp/qa/q8068188.html なぜ何も表示されないのか？ http://okwave.jp/qa/q8065031.html ●開発環境 windows8 xammp1.8.1 (phpmyadmin)
ＤＢ名に"-"を使いたいと思います。 ところが、コマンドから入れると、下記のようにエラーになってしまいます。 mysql> create database a-test; ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '-test ' at line 1 しかしながら、ｐhpMyAdminの方からは、作成することが出来ます。 コマンドの方からa-testと言ったＤＢを作成するのにはどうしたらいいのでしょうか？ 尚、バージョンは5.5.27です。 宜しくお願いします。
mysqlのtext型の文字数は何文字くらいまで入るのですか? 例えばひらがなの「あ」で何文字くらい入りますか? 200文字くらいの誤差はあってもいいのです 日本語を入れる場合は何文字くらいに制限するのがいいでしょうか？ よろしくお願いします
すいませんphpとmysqlの処理のしくみがわかってないです phpの処理の中でmysqlからSELECTで値を取得する場合 mysqlが大量のデータで処理に時間がかかった場合は、SELECTの処理に5秒くらいかかっても、phpの処理の中でそこで待ってくれているんですか？ SELECTの処理が何秒かかったとしても終わってから次のphpの処理にいっているんですか？ phpって速いのにmysqlのスピードが遅かったらちゃんと読み込まれないんじゃないかと心配になっています
SSHを使ったmysqlのエクスポート方法を教えてください LinuxコマンドもMysqlも初心者ですが、最近SSHを使ってレンタルサーバーに接続をしていろいろと試してみています。 以下を試してみましたが、エラーが出てでエキスポートできませんでした。 1. $mysql -h サーバー名 -u ユーザ名 -p 2. mysqlのパスワードを入力してmysqlにログイン 3.mysql> mysqldump -u サーバー名 -p データベース名 > testdump.sql; ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'mysqldump -u サーバー名 -p データベース名 > testdump.sql' at line 1　というエラーができてエクスポートできません。 mysql> mysqldump --user=ユーザ名 --password=パスワード名 データベース名 < testdump.sql も試してみましたができませんでした。 以上のものは全てweb上で見つけたコマンドです。 よろしくお願いいたします。
今現在、PHP MySQLにてDB＆簡単なCMSを作成中です。 仕入テーブル(id, date_y, date_m, id_cost, price, etc...)と勘定項目テーブル(id_cost, name_cost)をid_costをキーにして連結し、月々の勘定項目ごとの集計画面を作成したいのです。 SELECT 仕入テーブル.date_y, 仕入テーブル.date_m, 仕入テーブル.id_direct_cost, 勘定項目テーブル.name_cost, SUM(仕入テーブル.price) AS sumcost FROM 仕入テーブル NATURAL JOIN 勘定項目テーブル WHERE 仕入テーブル.date_y="'.$y.'" AND 仕入テーブル.date_m="'.$m.'" AND 仕入テーブル.typecost="direct" AND 仕入テーブル.id_direct_cost=勘定項目テーブル.id_cost ※$y, $mは集計画面で選択された年月です。 とすると、月々の合計が抽出され、勘定項目ごとの集計ができません。 当方、半年くらい学校にてPHP MySQLを習ったのですが、まだまだ未熟者のため解決できません。 お力をお貸しいただけますと大変ありがたく存じます。 どうぞよろしくお願い致します。
●質問の主旨 下記のサイトを見ながら、データベースのテーブルを インポートしようとしていますが、エラーが出ます。 この場合、phpmyadminのどこを確認すればよいでしょうか？ ご存知の方、ご教示願います。 http://www.dbonline.jp/phpmyadmin/export-import/index3.html ●開発環境 windows8 xammp1.8.1 ●エラーの内容（添付画像） エラー 実行した SQL: -- -- データベース: `mydb10` -- CREATE DATABASE `mydb10` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci; MySQL のメッセージ: #1007 - Can't create database 'mydb10'; database exists ●インポートの内容(mydb.sql) -- phpMyAdmin SQL Dump -- version 3.5.2.2 -- http://www.phpmyadmin.net -- -- ホスト: 127.0.0.1 -- 生成日時: 2013 年 4 月 20 日 08:27 -- サーバのバージョン: 5.5.27 -- PHP のバージョン: 5.4.7 SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO"; SET time_zone = "+00:00"; /*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */; /*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */; /*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */; /*!40101 SET NAMES utf8 */; -- -- データベース: `mydb10` -- CREATE DATABASE `mydb10` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci; USE `mydb10`; -- -------------------------------------------------------- -- -- テーブルの構造 `db10` -- CREATE TABLE IF NOT EXISTS `db10` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` text NOT NULL, `address` text NOT NULL, `tel` text NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=4 ; -- -- テーブルのデータのダンプ `db10` -- INSERT INTO `db10` (`id`, `name`, `address`, `tel`) VALUES (1, 'あああ', 'いいい', '111'), (2, 'ううう', 'えええ', '222'), (3, 'おおお', 'かかか', '333'); /*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */; /*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */; /*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
SSH接続によりTera Termを使ってmysqlに接続しています。 今までmysqlにはphpmyadminでしかアクセスしたことがなく、初めてコマンドで挑戦中です。 mysql> show databaces　というコマンドを打つと ->　　　 という表示がされて、それ以降何を打っても　-> しかでてきません。 ->というのはどのような意味なのでしょうか？ また、どうのように mysql>　の表示に戻せるのでしょうか？ よろしくお願いいたします。
CentOS6.3(64bit)にmysql-serverとmysql-develをインストール後 mysql>　の状態の時に mysql> mysql -u root -p　と入力したところ mysql> mysql -u root -p -> 上記の画面になり 抜けようとして「quit」「bye」「exit」やら打ち込んでenterしても -> の文字がずーと出続けます。 mysql> mysql -u root -p 　　　-> quit 　　　-> bye 　　　-> quit こんな状態です。 抜ける「キャンセル」したいのですがどのようにすればよいのでしょうか。
AユーザーとBユーザーがいてmysqlデータベース(innoDB)に同時アクセスします。 (実際にはphpから行っています) このときAtomicity(原子性)が保たれていないように見える現象が３割程度の確率で発生します。 以下がその問題の現象が発生する流れです。 error_logで出力したものです。 beginTransactionとcommitTransactionは、実際にはphpのpdoのメソッドを呼んでいます。 テーブル1 : state (初期値 0) テーブル2 : answer (初期値 0) stateに対しては常に行の排他ロックをかけている(必ずテーブル2に対するアクセス前) (念のため、stateに対するアクセスはもちろん同じレコードに対してです。 answerに対するアクセスももちろん同じレコードに対してです。) B : beginTransaction 前 B : beginTransaction 後 B : answer=0を読み込み確認 B : state=0を読み込み確認 B : answer=1を書き込む B : state=3を書き込む A : beginTransaction 前 A : beginTransaction 後 B : commitTransaction 前 :state=3を読み込み確認 B : commitTransaction 前 :answer=1を読み込み確認 A : state=3を読み込み確認 // 問題 A : answer=0を読み込み確認 // A : commitTransaction 前 :state=3を読み込み確認 A : commitTransaction 前 :answer=0を読み込み確認 B : commitTransaction 後 :state=3を読み込み確認 B : commitTransaction 後 :answer=1を読み込み確認 A : commitTransaction 後 :state=3を読み込み確認 A : commitTransaction 後 :answer=1を読み込み確認 問題はAユーザー側の途中の処理でstate=3とanswer=0という、中途半端な組み合わせの値を読み込んでしまっていることです。 あるべき状態はAユーザー側で、state=0とanswer=0あるいはstate=3とanswer=1と確認できることです。 一体何が起こっているのでしょうか。 また解決方法はどのようなものでしょうか。 直接の答えでなくてもヒントだけでも頂けると助かります。
Access初心者で、独学で頑張っています。 どうしても一人で解決できないので、教えてください。 下記のようなコードを書きましたが、＃１で　『PARAMETER句の構文エラーです』　となります。 Dim qd As DAO.QueryDef Dim rs3 As DAO.Recordset Dim mySQL As String Set qd = CurrentDb.CreateQueryDef("") mySQL = "PARAMETERS [ParaヘッダーID] COUNTER;" mySQL = mySQL & "SELECT [テーブルA].[明細ID], [テーブルA].[ヘッダーID] " _ & "FROM テーブルA " _ & "WHERE ((([テーブルA].[ヘッダーID])='ParaヘッダーID'));" With qd .SQL = mySQL 　 '　#1　ここで『PARAMETER句の構文エラーです』　となる .Parameters("ParaヘッダーID") = [TempVars]![tempヘッダーID] Set rs3 = .OpenRecordset() End With （この後、処理を続ける） やりたいことは、 「テーブルA」から、「ヘッダーID」が一時変数[TempVars]![tempヘッダーID]と一致するデータを抜き出し、後続の処理に使いたいのです。 なお、ヘッダーIDは長整数型で、[TempVars]![tempヘッダーID]をウォッチで確認すると整数が入っていました。 SQLについて、いろいろ調べて試しましたが、なかなか上手く行きません。 どこが違うのかご教授お願いします。
恐れ入ります。 Mysqlにて、ひとつ上のレコードを参照し、 真であれば○○偽であれば××という処理をしたいのですが、どのような方法がありますでしょうか。 EXELで行うと、=if(A1=A2,"1","0") のような処理になります。 昇順で並び替えて、重複レコードについて処理を行いたいです。 よろしくお願いします。
MySQL 5.6 なのですが・・・・ ＤＢの文字コードはＤＢ作成後にデータを登録した後に、途中で文字コードを変更した場合、ＤＢに登録済みの全角文字はどうなりますか？ 文字化けする場合、変換ツールのようなものはあるのでしょうか？ また文字コードの変更は ini ファイルを変更してMySQLを再起動するだけでいいのでしょうか？
よろしくお願いします。 OS：Redhat Enterprise Linux 6 DB：MySQL5.6 OSでrootで作業をしており、MySQLをrpmパッケージからインストールすると、 実行ユーザがrootになってしまうことを危惧しています。 サービスをrootで起動することはセキュリティ上 望ましくない、と聞きました。 別途「mysql」というユーザを作成しました。 このmysqlユーザをサービスの起動ユーザとしたいのですが、 どういった手順でそれを実施すれば良いでしょうか？。
mysqlに「１－１－１」という文字をUTF8で登録しました。 sjisで書かれたphpファイルでこの文字を表示するために、sjisに変換したのですが 「１?１?１」となってしまいます。 うまく表示するにはどうすれば良いでしょうか？
order byする際、2カラムの先頭1文字で判断して、並べ替えることは可能でしょうか？ ■想定 ・titleカラム ・yomiカラム ※運用案 案1 「titleカラム」先頭1文字目に漢字が入っているときだけ、yomiカラムにカタカナでフリガナを振る 案2 「titleカラム」先頭1文字目に漢字が入っているときは必ず、yomiカラムにカタカナでフリガナを振る
稚拙な質問ですみません、大学に通いながらウェブサイトを作成しているものです。 友だちのお店のサイトを頼まれているのですが、 機能としては、 ・会員機能　（メール、名前、住所等、電話等） ・ログイン状態で、予約フォームを使う際に、情報が入力されており入力する手間が省ける ・マイページで予約履歴 の３点です 予約フォームはできております。 htmlとCSSは大体分かります。 簡単なphpは分かります。 この状態から、オープンソースでもいいので作れる方法はありますでしょうか。 なければ、何と何を学べばいいでしょうか。 phpとデータベースをどのくらいとか、何が分からないといけないなど。 店といいましても趣味のような店なので、正式なビジネスのようなものではないのですが、勉強して作れるようになりたいです。 プログラマの先輩方、稚拙な質問で申し訳御座いませんが、よろしくお願いします。
恐れ入ります。 Mysql で、２つのテーブルがあり、 １つが1000レコード 2つめが1500レコードあります。 プライマリーコードを参照して、 1つめの1000レコードに、2つめのテーブルを揃えたいのですが、 うまくいきません。 delete from t2 left join t1 on t2.num=t1.num where t1.num IS NULL; としましたがうまくいきませんでした。 1つめのテーブルのレコードにマッチしたもの以外を2つめのテーブルから削除みたいな感じです。 よろしくお願いします。
カラムはidとnameです AUTO_INCREMENTをidにつけました googleで検索したら、「AUTO_INCREMENTをつけた場合はindexをつけなくてはいけない」 と書いてあったのですが、なぜindexをつけないといけないのでしょうか？indexなしだとよくないですか？ 今あるidのカラムにsqlでindexを付けることはできますか？ よろしくお願いします
●質問の主旨 kensaku.htmlから数字（データベースのコード番号）を入力・検索して、 PHPMyAdminにあるデータベースから、特定のレコードを取り出したいのですが、 データベースにあるすべてのデータが返されます。 検索窓に入力した特定のレコードの内容だけを 返すためには、下記のichiran.phpをどのように直せばよいでしょうか？ ●プログラムの流れ 1．kensaku.htmlの検索窓に番号を入力・送信 2．PHPMyAdminにあるデータベース（aketo)にアクセス 3．ichiran.phpで検索結果を表示 ●プログラムコード （kensaku.html) <!DOCTYPE html> <html lang="ja"> <head> <meta charset="UTF-8"> <title>PHPの基礎</title> </head> <body> <form method="post" action="kensaku.php"> ご意見コードを入力してください。<br/> <input name="code" type="text" style="width:100px"><br/> <br/> <input type="submit" value="送信"><br/> </body> </html> （ichiran.php） <!DOCTYPE html> <html lang="ja"> <head> <meta charset="UTF-8"> <title>PHPの基礎</title> </head> <body> <?php $code=$_POST['code']; $dsn = 'mysql:dbname=phpkiso2;host=localhost'; $user = 'root'; $password = ''; $dbh = new PDO($dsn,$user,$password); $dbh->query('SET NAMES UTF-8'); $sql = 'SELECT * FROM anketo WHERE code='.$code; $stmt = $dbh->prepare($sql); $stmt->execute(); $stmt->execute(); while(1) { $rec = $stmt->fetch(PDO::FETCH_ASSOC); if($rec == false) { break; } print$rec['code']; print$rec['nickname']; print$rec['email']; print$rec['goiken']; print'<br/>'; } $dbh = null; ?> </body> </html> ●開発環境 windows8 xammp1.8.1 MySQL(PHPMyAdmin)
●質問の主旨 wordpressのデータベースに接続しようとしたら、 「接続確立エラー」が表示されます。 （添付画像） Google検索などで自分で調べて対策を講じてみましたが、 次の画面に進めません 他に何か対策をご存知の方、よろしくお願いします。 ●状況 1．xampp1.8.1をアンインストールした後、 再インストール ↓ 2．wordpressをダウンロード ↓ 3．wordpressフォルダ内にある wp-config-sample.phpを書き換え ↓ 4．wordpressフォルダをC\xammp\htdocsの下に配置 ●書き換えたwp-config-sample.phpの参考サイト 「MySQL 設定」部分の書き換え。 http://39kn.com/2011/05/17/5366/ 「ホスト名」の書き換え http://hryksbt.b.sourceforge.jp/archives/338/
●質問の主旨 phpMyAdminのデータベースを削除したら画面の左側に エラーが出ました。この表示を消すためにはどうすればよいでしょうか？ 昨日、はじめたばかりでまだよく分かっていません。 ご存知の方よろしくお願いします。 ●質問の補足（エラーの状況） 1．データベースにチェックを入れる 2．削除ボタンをクリック 3．エラーが表示 4．このあと新規でデータベースを作成しても、 フィールドの設定をするとエラーが出る ●開発環境 windows8 xammp
mysqlを使おうと勉強中です mysqlに同時書き込みした場合についての質問です 例えば,5人のユーザーが同時に書き込んだとします。書き込むレコードは全て違います ユーザー1がレコード1行目に書き込み ユーザー2がレコード2行目に書き込み ユーザー3がレコード3行目に書き込み ユーザー4がレコード4行目に書き込み ユーザー5がレコード5行目に書き込み この場合は、普通のtableで処理できますか？
現在、mysql＋phpを使ったwebシステムの開発を行っているのですが、日本語の文字化けに 苦戦しています。 mysqlのコマンドでselect * from テーブル名　と打ったところ、insertコマンドで投入した要素名で 日本語で入力したものが、?????で表示されてしまいます。 しかし、create tableコマンドでField名を日本語で入力したのですが、こちらは正しく表示されて います。 my.iniの内容を変更したりしていますが、状況に変化がありません。 どうすれば、直りますか？ 以下に、show valiablesの結果を記載します。 +--------------------------+------------- | Variable_name | Value | +--------------------------+--------------- | character_set_client | cp932 | | character_set_connection | cp932 | | character_set_database | utf8 | | character_set_filesystem | binary | | character_set_results | cp932 | | character_set_server | utf8 | | character_set_system | utf8 | | character_sets_dir | C:\xampp\mysql\share\charsets\ | +--------------------------+-----------------
PHPで、「htmlタグを含んだ文字」を、 データベースへ読み書きする安全な方法を教えて下さい。 リンクタグや、フォントタグなどは、 そのまま使用できるようにしたいです。 ■追加する時 htmlフォームからデータベースに保存（SQLインジェクション） ■編集する時 データベースからデータを読み出す（htmlエスケープ） htmlフォームで再編集し、データベースに保存（SQLインジェクション） こういう作業になるかと思いますが、 どのように処理したら、htmlタグを使いつつ、 安全に更新ができるでしょうか？ 教えてくださいm(_ _)m
このようなSQL文は危険でしょうか？ $sql = "delete テーブル名 where id = :id"; $stmt = $dbh->prepare($sql); $stmt->execute(array(":id" => $_POST['id'])); 上記の例だと、$_POST['id']は、 ちゃんとエスケープできているのでしょうか？
始めたばかりの初心者です。 よろしくお願いします。 phpmyadminの事で質問があります。 ◇型の設定で、桁数を決める際にINTで（６）としても 試しに１０桁を入れても（phpmyadminで直接） 入ってしまいます。試しにと思ってINTのところに ”あいうえお”を入れても入ってしまいます。 どういう事でしょうか？ ◇またINTの上限数値って4294967295だとすると 桁数の設定は（10）までは意味があっても、(11)以上に しても意味がないのでしょうか？ ◇INT（１１）に上限数値の4294967295をいれると 何が起こるのですか？ ◇最後にもうひとつ テーブル作成の際にphpmyadminの（sqlタブ）でつくるとき 以下のような記述をするとそのやり方を習ったのですが、 　（サンプル） 　　Name` varchar(32) NOT NULL default '', この記述の意味がイマイチ理解しきれません。 NOT　NULLとは、ヌル値は認めないというのに、 defaultは””（ヌル）で設定ができてしまう。って 矛盾してませんか？それとも私の解釈が間違っていますか？ たくさん質問してしまいましたが、よろしくお願いします。
下記の結果になるような構文教えてください。 表1 商品CD カラーCD サイズCD c101 102 501 x201 101 502 d102 103 502 表2 商品CD 商品名 x201 Windows7 d102 Mac c101 Android 表3 CD 名称 101 黄 102 赤 103 緑 501 S 502 M 503 L 欲しい結果 商品CD 商品名　　カラーCD 名称　サイズCD　名称 x201 Windows7　102 赤 501 S d102 Mac　　　　101 黄 502 M c101 Android　　103 緑 502 M いろいろJOINしてみたのですが、表1と表3を2回参照してエラーが出ちゃいます。 どうぞよろしくお願いします。 使用環境 MySql
◆やろうとしていること 現在エクセルで管理している40個ほどのドメイン情報を、Webで管理(検索・更新・削除)する簡易システムをデータベースとPHPの勉強をかねて構築しようとしています。 ※環境は、LAMPで構築しようとしております。 ◆知りたいこと ドメイン情報管理テーブルを作ろうとしているのですが、その作成の仕方について、アドバイスしていただけたらと思っています。（正規化の方法？？） ◆疑問点 管理対象のドメイン情報は、重複が多いデータです。 ・同一のネームサーバで複数のドメインを管理している ・同一の業者が複数ドメインのレジストラとなっている ・同一の担当者が複数案件の担当者となっている ・同一IDで複数ドメインの管理を行っている たとえば、次のような感じです。 例） ドメイン名　　　　　　レジストラ　　　　　　ネームサーバ　案件担当者　 ID　　　　　　　　案件情報　　　　　　　　　　　 hoge.com お名前.com 　　　ns.bbb.jp 東京一郎　　a0002　自社ECサイト hoge.jp　 　　お名前.com　　　　　 　ns.bbb.jp　　 東京一郎　　a0002　　自社コーポレイトサイト test.jp さくらインターネット ns.bbb.jp　　 京都一郎　　a0003 あいう社コーポレイトサイト aaa.jp さくらインターネット ns1.bbb.jp　　大阪一郎　　a0004　　かきく社コーポレイトサイト aaa.net ムームードメイン ns1.bbb.jp　　東京一郎　　a0005 さしす社blogサイト bbb.net ムームードメイン ns1.bbb.jp　　東京一郎　　a0005 たちつ社ECサイト　 現在、エクセルで上記のような情報を管理しています。 これを初学者の私なりに正規化してみると ・ドメインリストテーブル（主キーとドメイン名だけが入っているテーブル） ・案件担当者リストテーブル（主キーと案件担当者だけが入っているテーブル） ・レジストラリストテーブル（主キーとレジストラだけが入っているテーブル） ・ネームサーバリストテーブル（主キーとネームサーバだけが入っているテーブル） ・IDリストテーブル（主キーとIDだけが入っているテーブル） ※各テーブルの主キーは、ドメインリストテーブルの主キーを設定 と、知識と経験が無いため、テーブルをいちいち細かくすることしかできないのです。 そこで、このようなデータを管理するテーブルを作る場合の一般的な考え方・注意事項・コツ・ポイントなどを踏まえアドバイスをいただけたらと思い質問いたしました。 具体的に、俺だったら、こういうテーブルに分割してドメイン情報を管理する。その理由は云々、といったかたちでアドバイスいただけますと大変助かります。 よろしくお願いします。
mysqlの危険回避の質問です。 （私がした１つ前に質問したものでは、解決しなかったので再度表現を変えて行います。） mysqlでwhere句の値に 1 OR effective=0 が入ると危険であり、シングルクオテーションで回避できる、とあるサイトでみました。 それを踏まえ、それまで以下の(1)で動いていたものを(2)にしたら、動かなくなりました。 そこで質問です。 （初めてphpに触れた人に教えるレベルで、かなり噛み砕いて教えていただけたら幸いです。） ■(1)はそのままでは危険という認識でよろしいですか？ ■(2)はなぜ動かないのでしょうか？ ■(1)を危険のない（もしくは可能な限り危険のない）書き方をするとしたらどうしたら いいでしょうか？（PDOで書く事！やmysqliがいい、というのは知っています。 どうしてもmysql_real_escape_stringを使わなくてはいけないという条件があったと 想定して強引にやるとしたらどうか、という事でお答えをいただければと思います。） (1) $sql = sprintf("SELECT id , password FROM `adminDatabase` where id = '%s' and password = '%s' order by id", mysql_real_escape_string($id),mysql_real_escape_string($password)); (2) $id = "'" . mysql_real_escape_string($id) . "'"; $password = "'". mysql_real_escape_string($password) . "'"; $sql = sprintf("SELECT id , password FROM `adminDatabase` where id = '%s' and password = '%s' order by id",$id , $password ); よろしくお願いします。
MySQLで、テーブルに書籍名リストが入っているとします。 このとき、列「書名」には、以下のような、書名の後に1から11までの連番がついたデータが順不同で入っています。 国語辞書 1 国語辞書 2 国語辞書 3 ・・・ 国語辞書 11 このテーブルに対して、「ORDER BY 書名 ASC」でSELECTをかけると、 「国語辞書 11」が一番最初に来て、その後１から順番に並びます。 これを自然な並び（１１で始まるのではなく、１～１１の順で整列）にするには、どうしたらよいでしょうか？
独学数ヶ月の初心者の質問で恐縮です。 もろもろの事情で仕方なくmysql_real_escape_stringを 以下(1)のように使用しなくてはならないと仮定し、 セキュリテイの面で(2)のようにシングルクオテーションつける 事で危険を回避できますか？ またシングルクオテーションは(2)のようにつけてはいけない とかありますか？（記述の基本が曖昧なため、ただの確認の質問） (1) $sql = sprintf("SELECT id , password FROM `adminDatabase` where id = '%s' and password = '%s' order by id", mysql_real_escape_string($id), mysql_real_escape_string($password)); (2) $sql = sprintf("SELECT id , password FROM `adminDatabase` where id = '%s' and password = '%s' order by id", ’mysql_real_escape_string($id)’, ’mysql_real_escape_string($password)’); よろしくお願いします。
php初心者です。独学で現在勉強していますが、環境に 関する本当に基本的な事がぜんぜん理解できていない事に 気づきました。 質問をする上でちょって変な表現をしてしまうかもしれませんが お許しいただき、また子供に教えるように噛み砕いてお答え いただければ幸いです。 質問 ■mysql mysqlそのものがいったいなんだかがよくわかりません。 （はじめは、htmlやJavaなどコンピューター言語の１つ なのかと思っていました。） ・mysqlとはDBのシステムの１つと考え、それはパソコンで いうところのOSみたいな通常はあまり意識する事が ない存在という事なのでしょうか？ ・lolipop（サーバー）を利用しているのですが、通常は mysqlというものをインストールしないと動かないものが はじめから用意されているからmysqlを意識せずにいられる のでしょうか？ ■mysqlが非推奨？？ ネットであれこれ情報を集めていたら、mysqlが今後非推奨に なるのか？mysqlの関数が非推奨になるだの、PDOやらmysqli がいいだのとありましたが、まだ全体の知識が浅いため いっている内容がさっぱり理解できません。 ・もしphpのバージョンによりmysqlを使えないと仮定した場合 サーバー上ではどんな設定が必要で、ソースの書き方はどうなって しまうのでしょうか？ （自分の理解） (1)サーバーにmysqli（これってシステム？言語？なのかすらよく 理解できていません）をインストール (2)phpでデーターを呼び出す時は、mysqliの記述の仕方で呼び出す ■これからどういう順序で何を勉強したら良い。 時間とお金がないので可能な限り効率的な順序で勉強をしたいのですが、 これからPHPとDBを扱うには何をどういう順番で勉強すると いいのでしょうか？また他にアドバイスがあればよろしくお願いします。 （クラスだの、オブジェクト指向だのが全くわかりません、またフレーム ワーク、その他難しいことは、基礎を覚えた後にやらないと結局痛い目に あうものでしょうか？などなどに対するアドバイス等） 長々となってしまいましたが、頭が混乱しているので、 頭の中の整理をお付き合いいただける方、よろしくお願いします。
いま、英字新聞で、『ウィキペディア』に関する記事を読んでいます。 その中で、「ウィキペディアを編集するためには、ウィキシンタックス(wiki syntax） を学ばなければならない。」とあるのですが、ウィキシンタックスとは、何ですか。 また、日本語に訳したら、何て言うのでしょうか。（「ウィキシンタックス」でいいのでしょうか。） どなたか、教えてください。
現在MySQLのひとつのテーブルに小さな（50KB程度）画像データとメタデータを500万件程度管理しています 数千万件程度までは増える可能性があります テーブルが大きくなりすぎて、WHERE節によるソートがとても時間がかかるようになってしまったので、これを整理しようと思っているのですが、やり方に迷っています 今候補なのは A．テーブルを画像データテーブルとメタデータテーブルにわける B．メタデータだけをMySQLで管理して画像はファイルで管理する です Aだと使いやすいですが、結局画像を管理するテーブルは巨大になってしまうのが気になります、また、データベースに詳しい人に少し相談するチャンスがあった時に画像はDBで管理するものじゃない、というようなことを言われたのも気になります そこでBで、やってみようと思ったのですが、ファイルの置き方に困ってしまいました ext4を使っているサーバなので、ひとつのディレクトリにおけるファイル数の制限はないようですが、ひとつのフォルダに数百万個のファイルを置いてもいいものなのでしょうか？ また、ではファイル1000個程度づつをフォルダに分散させようと思った時に、どのような法則で分散させればよいのでしょうか？ 何かフォルダ構造のつくり方のスタンダードはあるのでしょうか？ ちなみに画像ファイルのファイル名は連番の数字と考えてもらってかまいません（連番じゃなくて、ハッシュかなにかにしたほうがいいのであれば、もちろんそれでもかまいません） アドバイスもしくは、参考になるサイトなど教えていただければありがたいです
MySQL Workbench Queryの範囲指定 ■範囲指定 Object Browserから対象のテーブルにカーソルを合わせて右クリックすると Select Rows Limit-1000を選択すると1-1000までが表示されます。 これを1001-2000の範囲を指定する方法のご教授をお願いします。
あるテーブルのデータをダンプしてエクスポート(export_utf8.sql)しました。 それを他のMysqlへインポートしようと以下のコマンドを実行したところ、 mysql -p --default-character-set=utf8 db < export_utf8.sql 以下のエラーが出力されました。 Unknown MySQL server host 'border="1"' (1) おそらく、エスケープ関連でコケているものかと思いますが、 どうすればインポートできるのかわかりません。 ご存知の方、宜しくお願いします。
UNIONする際、片方のテーブルしかないカラムも利用したいのですが、どうすればよいでしょうか？ ■現状 SELECT tablename, id, level 　FROM ( 　　SELECT \'A\' tablename, s.id, s.level FROM A s 　　　UNION ALL 　　SELECT \'B\' tablename, r.group_id, r.level FROM B r 　) as UNI ■やりたいこと ・テーブルAにしかないカラム「age」も一緒にSELECTしたいのですが、どうすれば良いでしょうか？ ・UNIONしたいわけではなく、UNIONした後のレコード同様、「age」カラムもSELECTしたい、という意味です ・UNIONの外側で何かやればいいのかな、と思い試したのですが、うまくいきませんでした
恐れ入ります。 Mysql をつかって、2つのテーブル（同一並びのカラム）の、各々のレコードを足したいのですが、 どのようにしたらよろしいでしょうか。 table1 ------------ col1|col2|col3 20 |30 |40 40 |40 |50 10 |20 |20 ------------ table2 ------------ col1|col2|col3 10 |10 |20 20 |20 |20 10 |20 |20 ------------ 処理後 ------------ col1|col2|col3 30 |40 |60 60 |60 |70 20 |40 |40 ------------ のようにしたいです。よろしくお願いします。
http://oshiete.goo.ne.jp/qa/7944235.html の件に引き続きどうSQL文を書いてよいかわからず困っています。 create table team(team_id int not null primary key,team_name varchar(30),year int(4), leagueid int(32) ); insert into team values(1,"A",2012,1),(2,"B",2012,1),(3,"C",2012,1),(4,"D",2012,1),(5,"A",2012,2),(6,"B",2012,2),(7,"C",2012,2),(8,"D",2012,2),(9,"A",2011,1),(10,"B",2011,1),(11,"C",2011,1),(12,"D",2011,1); create table taisen(id int not null primary key auto_increment,hometeam int,homepoint int,awayteam int,awaypoint int); insert into taisen (hometeam,homepoint,awayteam,awaypoint) values(1,3,2,2),(3,1,4,0),(1,0,3,2),(2,2,4,2),(1,1,4,2),(2,0,3,0),(2,1,1,2),(4,1,3,3),(3,5,1,2),(5,3,6,3),(5,1,7,1),(7,1,8,1),(9,1,10,1),(11,1,12,3); とあり、 taisen.hometeamとteam.idとtaisen.awayteamとteam.idを結合し、taisenテーブルにteamのyear、leagueid、team_nameが表示されればと思っています。 通常のjoinであればできるのですが、どのようにsql文をかけばよいのかわからず困っています。 taisen.hometeamとteam.idとtaisen.awayteamとteam.idを結合したときに | taisen.hometeam | ホームチーム名 | taisen.homepoint | taisen.awayteam | アウェイチーム名 | taisen.awaypoint | team.year | team.leagueid で結果がとれるようにしたいのですが、どのようにしたらよろしいでしょうか？
phpmyadmin上の異なるデータベース間のテーブルでリレーションをかけたいのですが、うまくいきません。 new_linkフラグをtrueにすることで異なるデータベースを開くところまではできました。 アドバイスいただけないでしょうか。 ※DB1の中にtable1が、DB2の中にtable2がある //失敗する $con1 = mysql_connect("localhost",username,pass); mysql_select_db('DB1',$con1); $con2 = mysql_connect("localhost",username,pass,true); mysql_select_db('DB2',$con2); $sql = "select * from table1,table2 where table1.id = table2.id"; $result = mysql_query($sql) or die(mysql_error()); メッセージ⇒Table 'DB2.table1' doesn't exist //これは成功する $con1 = mysql_connect("localhost",username,pass); mysql_select_db('DB1',$con1); $con2 = mysql_connect("localhost",username,pass,true); mysql_select_db('DB2',$con2); $sql1 = "select * from table1"; $result1 = mysql_query($sql,$con1) or die(mysql_error()); $sql2 = "select * from table2"; $result2 = mysql_query($sql2,$con2) or die(mysql_error());
MySQLにフォームでインサートすることに悩んでいます。 INSERT INTO table (id,date) VALUES ('1234',CURDATE()) とするとmySQLにユーザーIDと本日の日付を入力できます。 これをフォームから下記の形で入力しようとすると、日付が入力されず、0000-00-00 になってしまいます。 <form action ="insert.php"> <input type="hidden" name="id" value='1234' > <input type="hidden" name="date" value="<?php print(CURDATE()); ?>" > <input type="button" value="submit" name="入力"> </form> value=""の中で本日の日付を指定する場合はどうすればいいかをご教示願います。
MySQLでテーブルの完全同期を行いたいです。 例えばAテーブルをUpdateしたらリアルタイムでBテーブルもUpdate、同様にInsert、Delete。 Aテーブルに１０００レコードはいっていて、Bテーブルが０件の場合、自動的に１０００件Bテーブルに取り込む。 このようなことを実現することは可能でしょうか
order byで複数カラム指定(?)したいのですが、どうすればよいでしょうか？ 具体的には、カラムが空の場合は別カラム指定したいのですが、可能でしょうか？ ■前提 ・titleカラム、yomiカラム ■最終的にやりたいこと ・titleカラムを五十音で並べ替えたい ■運用例(案) ・titleカラムが「漢字」の場合は、yomiカラムにひらがな、を入力 ・titleカラムが「ひらがな」の場合は、yomiカラムは空 ・titleカラムが「英字」の場合は、yomiカラムは空 ・titleカラムが「先頭数語がひらがなもしくは英字で、最後が漢字」の場合は、yomiカラムは空？ ■分からないこと ・漢字対策として、「yomiカラム」作成したけど、すべてのレコードに対して、「yomiカラム」を埋める必要があるでしょうか？ ・「ひらがなだけ」、「英字だけ」、あるいは、「先頭数語が英字で最後の方だけ漢字」なタイトルは、わざわざ「yomiカラム」を埋めなくてもよい？ ■知りたいこと ・全ての「yomiカラム」を埋めなくても、「titleカラム」を五十音で並べ替える方法があれば、教えてください ※件数が多くてちょっと面倒なため、何かいい方法があればと思い、質問しました。「yomiカラム」全部埋めた方がいい、のであれば、その方向で検討しようと思います
namesテーブルのcontentsカラムにねこを含むレコードのうち、 現在までに書き込まれたものを新しいものから抽出したいと思います。 contentsはverchar(255)、unixtimeはint(11)です。 しかし、 SELECT * FROM names WHERE MATCH (contents) AGAINST ('+ねこ' IN BOOLEAN MODE) AND BETWEEN unixtime < 1360850220 ORDER BY `unixtime` DESC limit 1,50 ; が出力されません。 このSQL文はどこが間違っているのか、ご指摘ください。 SELECT * FROM names WHERE MATCH (contents) AGAINST ('+ねこ' IN BOOLEAN MODE) ORDER BY `unixtime` DESC limit 1,50 ; だと出力されるので AND BETWEEN unixtime < 1360850220 が怪しいと思うのですが、どう訂正したらいいのかわかりませんでした。 よろしくお願いいたします。
MySQL 5.6を最近使い始めました。 大量のcsvファイルで保存されているデータを読み込んで、データベースとして扱いたいのですが、どうすれば良いでしょうか？ ファイル名は、 data1_1.csv data1_2.csv data1_3.csv data2_1.csv data2_2.csv といった形で、規則正しく並んでいるのですが、大量にあるため、ループを使って自動化したいと思っております。そのために、LOAD DATA INFILE ファイル名　を使って、このファイル名を順次変えて繰り返す方法がわかりません。 まず、ファイル名に変数が使えるのかと思って @file="data1_1.csv"としてファイル名を置き換えてみたのですが、エラーでした。これでは、この1_1を順次動かす以前に変数が無理なのかも？と思っています。 何かやり方があるようでしたら、どなたかお教えください。 どうぞよろしくお願いいたします。
create table team(team_id int not null primary key,team_name varchar(30),year int(4), leagueid int(32) ); insert into team values(1,"A",2012,1),(2,"B",2012,1),(3,"C",2012,1),(4,"D",2012,1),(5,"A",2012,2),(6,"B",2012,2),(7,"C",2012,2),(8,"D",2012,2),(9,"A",2011,1),(10,"B",2011,1),(11,"C",2011,1),(12,"D",2011,1); create table taisen(id int not null primary key auto_increment,hometeam int,homepoint int,awayteam int,awaypoint int); insert into taisen (hometeam,homepoint,awayteam,awaypoint) values(1,3,2,2),(3,1,4,0),(1,0,3,2),(2,2,4,2),(1,1,4,2),(2,0,3,0),(2,1,1,2),(4,1,3,3),(3,5,1,2),(5,3,6,3),(5,1,7,1),(7,1,8,1),(9,1,10,1),(11,1,12,3); データベース内にデータがあったときに年やleague_idごとに順位表を作りたいのですが、どのようにSQL文を書いてよいかわからず困っています。 理想はこのような感じです。 http://soccer.yahoo.co.jp/ws/standing/?l=52 お分かりの方がいらっしゃいましたらご教授お願いいたします。
新しくWordPressをインストールしたいんですが、初期設定でのデータベース接続のための詳細を入力する画面で入力して「送信」ボタンを押すと「データベース接続確立のエラー」が出て進めません。 参照サイト「http://lolipop.jp/manual/blog/wp/」 現在、ロリポップにてレンタルサーバーを利用しております。 実はすでに利用しているＡというドメイン（例：http//www.aaa.com）があり、それもロリポップで利用しており、そのサイト内でロリポップからできるphpMysqlのデータベース(例：「ＡＤ」)を使っています。 今回は、新たなＢというドメイン（例：http//www.bbb.com）を利用して、そのサイトで使うデータベースをＡで使っているデータベースで接続して共有しようと思っています。ただ、そのＡＤというデータベースの情報を入力して「送信」ボタンを押すと上記のエラーが出てしまいました。 Ｂで別途データベース「ＢＤ」とか作ってもいいのですが、データを一元管理というか共有しておきたくて。 Ａと同じドメインの配下で別途WordPressをインストールしたことがありましたがはそのときは上手くいきました。つまりＡのサイトがhttp://www.aaa.com/wordpressだとしたら配下に作ったのは//www.aaa.com/wpxxxとかです。 他ドメインのデータベースを設定することはできないのでしょうか？
お世話になります。質問がふたつあります。 このような、IDとTypeのふたつのカラムで重複しているレコードが多いテーブル「tb」があるとします。 ID Type age 1 1 20 1 2 35 1 3 42 1 2 31 1 3 45 1 2 33 2 1 21 2 3 41 2 1 26 2 2 31 2 1 25 2 1 28 これを、以下のようにしたいのです。 ID Type age 1 1 20 1 2 35 1 3 42 2 1 21 2 2 31 2 3 41 group by ID, Typeとしたところ、 似たような形にはなったのですが、IDとTypeが重複した ID Type age 1 2 35 1 2 31 1 2 33 のうち、group byによってどのような基準でひとつが選択されるのでしょうか？ レコードの追加が新しいものが選ばれるのでしょうか？ また、ageをランダムでひとつを選択するような書き方はできるのでしょうか。 よろしくお願いします。
id　　　　　field1　　　　　field2 1　　　　　　1　　　　　　　　A 2　　　　　　1　　　　　　　　A 3　　　　　　1　　　　　　　　B 4　　　　　　2　　　　　　　　A 5　　　　　　2　　　　　　　　B 6　　　　　　2　　　　　　　　C 7　　　　　　3　　　　　　　　D 8　　　　　　3　　　　　　　　D 9　　　　　　3　　　　　　　　D field1とfield2の値が他のレコードのfield1とfield2と重複している場合はひとつのデータとして返したいです。 id1.2はfield1とfield2の値が同じなので、ひとつのデータしか返しませんが、id3はfield2が異なるので返します。 id4.5.6はいずれもfield2の値が異なるので4.5.6全てを返します。 id7.8.9はfield1とfield2が同じ値なのでひとつのデータしか返しません。 id 1 3 4 5 6 7 該当するレコードは上記のように6個となるようにするにはどのようなsql文を発行すれば良いでしょうか？ ご教示頂けますと幸いです。 宜しくお願い致します。
MySQLで購入管理データを作っています。 buying_table`(`b_usr_id`, `b_buy_volume`, `b_buyname`) `usr_table`(`u_usr_id`, `u_buy_volume`, `u_buyname`) の2つのテーブルがあります。 `usr_table`　には100件のユーザーデータが入っています。 このうち特定のユーザーについてbuying_table`に複写します。 ユーザー名を1001に指定し下記のSQL文を行うと、無事複写が出来ました。 INSERT INTO `buying_table`(`b_usr_id`, `b_buy_volume`, `b_buyname`) SELECT `u_usr_id`, `u_buy_volume`, `u_buyname`, FROM `usr_table` WHERE `u_usr_id`=('1001') 今回は、()の中で、複数のユーザー名を指定し、インサートをする必要があります。 そこで、サブクエリの複数指定で使用するANYを使用し下記のSQL文にしたのですがエラーになります。 INSERT INTO `buying_table`(`b_usr_id`, `b_buy_volume`, `b_buyname`) SELECT `u_usr_id`, `u_buy_volume`, `u_buyname`, FROM `usr_table` WHERE `u_usr_id`=ANY('1001','1004','1005') #1064 - You have an error in your SQL syntax; check the manual サブクエリなら簡単なんですが、このように「単純に文字が入っている場合の複数設定」はどう記載すればいいか教えてください。 事情があり()の中でユーザー名が複数カンマ区切りされている以外の設定は出来ない状況です。 宜しくお願い致します。 CentOS6.3 MySQL5.5です
どのように質問すれば、良いのか自体あまりわかっていないのですが、 今後システムの仕事をすることになり、現在、ＤＷＨの導入を検討しております。 ＤＷＨの導入を考えているのですが、インポートしたいテーブル数が500超えてしまい、「500は多すぎる、これでは処理時間に1日かかってしまう。」と言われてしまいました。 元のシステムでオラクルのＤＢを使用しており、そのデータをＤＷＨ用のオラクルＤＢに写し、ＤＷＨにデータを入れるようにしようと考えております。 出来れば、3時間から4時間くらいで、インポートしたい（エンドユーザーがデータを確認できるように）のですが、一般的に、ＤＷＨへのインポートできるテーブル数はどのくらいなのでしょうか？また、500くらいのテーブルを希望の時間でインポートしたい場合にやりようはないのでしょうか。 分かる方いらっしゃいいましたら、ご教授ください。
ステートメントベースのレプリケーションをしている時に、 UPDATE 文でLIMIT 句を使用すると以下の様な警告が出ます。 [Warning] Unsafe statement written to the binary log using statement format since BINLOG_FORMAT = STATEMENT. The statement is unsafe because it uses a LIMIT clause. This is unsafe because the set of rows included cannot be predicted. Statement: DELETE FROM `__TABLE__` WHERE `user_id` = 1234 LIMIT 1 データ更新時にRAND()を使ったりした場合、 ORDER BYの結果が異なってしまうのが理由だと思うのですが、 ORDER BYしていないQueryに対してもwarnが出ています。 それとも何かほかに理由があるのでしょうか？
「MySQL」「PHP」、何れでも出来るような処理はどちらでやる方が良いのでしょうか？ ■例1 … 取得データを正規表現で加工して利用したい場合 ・SQL重視 … 正規表現等を駆使したSQLで、後々利用しやすい形で取得 ・PHP重視 … 普通に取得して、PHPで正規表現を利用して加工 ■例2 … データ取得がヤヤコシイ場合 ・SQL重視 … (例えそれがどんなに長くなっても)SQL文をキチンと組み立て、一度にデータ取得 ・PHP重視 … 簡単なSQL文で一旦データ取得後、PHPのループ文内等処理で、再度DBアクセスしデータ取得 ・ちょっと例えが微妙かもしれないのですが、そもそもデータ取得する際、どのように考えるのが正しいのでしょうか？ 1.なるべく利用予定に近い形でデータを取得 2.後で色々加工するかもしれないので、取得時点ではあまり加工せず、そのまま取得 ※要は、頻繁にDBへアクセスしてデータ取得するより、「DBへアクセスするのは極力避け、取得したデータはなるべく使い回す」方が良いのでしょうか？ ・それとも、ここら辺はケースbyケースなので、一概には言えないのでしょうか？ ・あるいは、別にどっちでもいい？　あまり、気にしなくても良い？
PHPとデータベースを使い、 顧客の条件に合った物件をメールに記載して送る処理を行っています。 その際、物件を記載する処理[下記(1)]の部分で同じ物件が記載されてしまいます。 (顧客によっては記載されない) データベース上に重複する物件は存在しないので、なぜ二重に記載されてしまうのかわかりません。 どこを疑えば良いでしょうか。 メール記載例：物件１、物件２、物件３、物件１、物件４、物件２、物件１、物件３、物件３ (二重記載される際のパターンは見つかりません) コード(簡略化) ---------------------------------------------------------------------- データデース１：顧客リスト データベース２：物件リスト //顧客取得 $sql_user = SELECT 条件 FROM 顧客リスト $result_user = mysql_query($sql_user) for($i = 0; $i < mysql_num_rows($result_user); $i++){ 　　$arr_user= mysql_fetch_array($result_user); 　　//顧客の条件に合った物件を取得するSQL文 　　$sql_match = SELECT * FROM 物件情報リスト WHERE～条件～ 　　$result_match =mysql_query($sql__match); 　　for($i = 0; $i < mysql_num_rows($result_match); $i++){ 　　　　$arr_match= mysql_fetch_array($result_match); 　　　　[(1)]物件を記載する処理 　　} １ユーザー分のメールを送る処理 } ---------------------------------------------------------------------- うまく説明できていなかったらすみません。
Windows版のMySQL v5.5.27です。 電話帳アプリを考えていますが、氏名、ヒラガナ、電話番号などなどのフィールドがあります。 そこでヒラガナが「か」から始まるレコードを選択したいと思っていますが、SELECT文が思いつかないのでご教授願います。 特に「か」だけではなく　あ・か・さ・た・・・ というレコードを選択です。 単純に「あ」、「か」、「さ」・・・と選択して蓄積しても良いのですがスマートなSELECTを書きたいと思って質問しました。
こういうテーブル「tb」があるとします。 「tb」 bang　nama　tuki A103　佐藤　4 A102　高橋　5 A104　鈴木　4 A101　中川　4 A103　渡辺　5 A101　西沢　5 A102　中村　6 A104　田中　5 A103　村井　6 A107　吉田　6 A101　小林　4 これを、実行後に、 bang　4月　5月　6月 A101　中川　西沢　NULL A102　NULL　高橋　中村 A103　佐藤　渡辺　村井 A104　鈴木　田中　NULL A107　NULL　NULL　吉田 このように、共通するbangで並べ替えたいのです。 A101の4月は、「中川」と「小林」で重複していますが、 このときはひとりだけが選択されてほしいです。 SELECT CONCAT(CASE WHEN tuki='4' THEN name ELSE IFNULL(null,'') END) AS '4月', ~ GROUP BY bang ~ としても、 bang　4月　5月　6月 A101　中川　 　 　 となってしまい、5月と6月が上手く表示されません。 よろしくお願いします。
SELECTする際、特定カラムの特定文字列がある場合に、そのレコードを弾いた結果を取得したいのですが、 どうすれば良いでしょうか？ ■前提 ・「urlpathカラム」に、「/tokyo/officeedit/261」みたいなパスが1つ入っています ■知りたいこと ・SELECTする際、「urlpathカラム」の中で、指定パスを含むレコードは除く、という条件を付けたいのですが、どうすれば良いでしょうか？ ■弾きたいパス例 ・「/tokyo/officeedit/★★」 ・「/tokyo/houseedit/★★」 ・「/site/login」
はじめまして、よろしくお願いします。 職場環境がかわり、はじめてmySQLを使用しています。 ３つのテーブルから情報を検索したいのです。 [テーブル名: cast] name　　　　　　　　　　　　　// PRIMARY KEY age (例 なまえ１,　22 なまえ２,　28 なまえ３,　25 [テーブル名: photo] name order　　　　　　　　　　　　　// 写真表示順 (INT) url　　　　　　　　　　　　　　　// 写真格納先URL (例 なまえ１,　0,　http://なまえ１A.jpg なまえ１,　1,　http://なまえ１B.jpg なまえ１,　2,　http://なまえ１C.jpg なまえ３,　0,　http://なまえ３A.jpg [テーブル名: schedule] name workday　　　　　　　　　　　// 出勤日 (DATE) starttime　　　　　　　　　　// 出勤時間（TIME) finishtime　　　　　　　　　　// 退勤時間(TIME) (例 なまえ３,　2013-02-04,　 9:00,　17:00 なまえ２,　2013-02-05,　10:00,　18:00 なまえ２,　2013-02-06,　10:00,　18:00 なまえ２,　2013-02-07,　10:00,　18:00 キャスト情報(cast)とそのキャストの写真格納先URL(photo)とキャストの出勤時間(schedule)のテーブルです。 ※キャストは何枚でも写真を登録できます。登録していない場合もあります。 キャストのリストを表示したいです。 表示したい項目は cast.name,　cast.age,　photo.url,　schedule.starttime,　schedule.finishtime になります。 期待する結果は（２月５日の場合) なまえ１,　22,　なまえ１A.jpg,　NULL,　NULL なまえ２,　28,　NULL,　　　　　10:00,　18:00 なまえ３,　25,　なまえ３A.jpg,　NULL,　NULL すべてのキャストを表示します。 photo.urlはphoto.order=0のもの（photo.order=0の写真をサムネイル表示に使っています) ２月５日に出勤情報があれば表示 いろいろ考えたのですが、どうしても photo にデータがない（"なまえ２"）のところでつまづいてしまって、どうにも。。。 とりあえずPHPでそれぞれのテーブルの情報を取得して 自分で UNION、 USING('name') みたいな処理してますが、ソースがとっても恰好悪いです。 ズバッとしびれるSQL文をどうかご教示していただきたく、投稿しました。 よろしくお願いいたします＞＜
MySQLのMEMORYエンジンを使用したテーブルについて質問です。 varcharは可変長の認識だったのですが、MEMORYエンジンの場合、固定長として扱うのか・・・ InnoDBの時は2GB程のレコードだったのがMEMORYに変更したところmax_heap_table_size=7GBを超えてしまいました。 質問の内容は以下です (1)．varcharはMEMORYテーブルでは値の長さに関わらず領域を確保するのでしょうか (2)．MEMORYテーブルで可変長を扱う方法はあるのでしょうか MySQLのバージョンは5.5.28です。 難解な文章で申し訳ないですが、ご存知の方いらっしゃいましたらご教授のほどよろしくお願いいたします。
mysql php 超初心者です。 mysqlで連結先のテーブルのカウントを取得したいと思っています。 以下のような a_tblと b_tbl があり、 a_tbl の a_index と b_tbl の ab_no を 結合して b_tbl の ab_no のカウント数を 理想結果表に表示したいと思っています。 どう書いたら b_tbl の ab_no をGROUP(?) COUNTして 理想結果表の様にbテーブルのab_noのcount数を表示できるのでしょうか？ -a_tbl- a_index | a_data 1 |　りんご 2 |　信号 3 |　空 4 |　カラス -b_tbl- b_index | ab_no | b_data 1 |　 1 | 青 2 |　 1 | 赤 3 |　 2 | 青 4 |　 2 | 赤 5 |　 2 | 黄 6 |　 3 | 青 7 |　 3 | 白 8 |　 3 | 黒 9 |　 4 | 黒 -理想結果表- a_index |a_data 　　| bテーブルのab_noのcount数 1 | リンゴ 　　| 2 色 2 | 信号 　　| 3 色 3 | 空 　　| 3 色 4 | カラス　　| 1 色 私が見よう見まねで考えた式ですが、やはりこれでは表に2しか出ませんでした。 $sql = "SELECT Count(*) AS cnt FROM b_tbl LEFT JOIN a_tbl ON b_tbl.ab_no = a_tbl.a_index GROUP BY b_tbl.ab_no"; 質問の仕方もよくわからないのでわかりにくいかも知れませんが どうかご教授の程よろしくお願い致します。
SELECT a.num b.num FROM 　　サブクエリA(いろんな処理 WHERE a_id=ANY(サブクエリC(いろんな処理)) ) AS a, 　　サブクエリB(いろいろ処理 WHERE b_id=ANY(サブクエリD(いろんな処理)) ) AS b このような処理をしているのですが、サブクエリCとサブクエリＤは一字一句違わない全く同じ処理をしています。 ２回全く同じ処理をするのは処理コストが無駄にかかりますし、同じ内容を示す表記が２度出てくるのは保守性も悪くします。 サブクエリCとＤを共通化して一つにまとめる方法はありますでしょうか。
MYSQL講座を読んでいたら以下の様な表記を目にしました。 SELECT Name, Day FROM Customers LEFT JOIN Reservations ON Customers.CustomerId=Reservations.CustomerId; この「Customers.CustomerId」みたいに、 ドットをつけているのはどういう意味があるのでしょうか？ また、こういう表記について何か文法用語などはありますでしょうか？ （例：サブクエリとかビュー?とかなんかそれっぽい用語です）
お世話になります。 phpmyadminのSQLで、 ブックマークの変数を利用する形で、 select文を実行したいのですが、 その際、 select文内に対して、 どのように、ブックマークの変数を記述すればよいのでしょうか？ 以上になります。 よろしくお願いします。
最終的に1億行になるであろうテーブルを含むデータベースを作っています。 テスト環境はCentOS6.3 MySQL5.5 CPU QuadCore 2.4GHz 2GBメモリです。 テスト環境を作るために10万件づつのCSVファイルをインサートしていったところ最初の10万件は数秒でインサートできたのですが、だんだん重くなり、1000万件近くになると「10万件の登録に1分半」もの時間が掛かっています。 (1000万件のデータはinnoDB上で1.2GB) サーバーを公開した場合、最大で1分間に数万件のインサートが見込まれていますので、今の環境だとテーブル内データ1千万件が限界の感じであり、現在予想している1億行では使い物にならないと危惧しています。 そのような中、調査していくとディーエヌエーの松信氏の発言で http://www.slideshare.net/kaminashi/db-6636154 18. インメモリでINSERTを完結する 　　インメモリでのINSERT性能 InnoDBの場合秒間15000 insert/s超え という記載を発見しました。 しかし、インメモリでのインサートの方法というのが分かりません。 話の筋やInnoDBという単語から言って、松信氏の言う「インメモリでINSERTを完結する」と「インメモリー・データベース」とは違うと考えております。 実メモリの範囲内という考えなら、現在のテスト環境でも1.2GBのデータを2GBメモリのマシンで展開しているわけなので、「10万件の登録に1分半」かかる理由が分かりません。 秒間15000 insert/s超えを達成させる「インメモリでINSERTを完結」させる方法について具体的にご教授いただけませんでしょうか? 宜しくお願い致します。
＜HTML＞ DB＜A＞の処理 DB＜B＞の処理 DB＜A＞の処理 ＜/HTML＞ とした時に、まずAのDBに接続をします。 で、Bの処理をする際には今度はBに接続します。 で、またAのDBの処理をする際はまたAに接続しないと駄目でしょうか？
はじめまして。 voteというテーブルにcategory_id、individual_id、timeという３つのフィールドがあります。 (1)category_idは名前の通りカテゴリーのIDで、0～100まであります。 (2)individual_idはcategory_idごとに0～100まであます。 (3)timeは行が挿入された時間が記入されています。投票されるたびに行が挿入されます。 (4)category_idとindividual_idとdateでユニークキーを構成しています。 (5)category_idとindividual_idの２つで、個人が特定されます。 select categry_id, individual_id, count(*) from vote group by category_id, individual_id という命令文で、誰に何票voteされているかが分かります。 この先ですが、各カテゴリの中で最も多く投票されている3人ずつを表示したいのですが、どのようなSQLを書けばよいでしょうか。 似たような質問もあり、自分なりに四苦八苦して試してみたのですがうまくいきませんでした。 回答いただけると助かります。よろしくお願いいたします。
今、mac PCで　独自の認証局を作成し、自作の証明書発行をしようとしています。 今現在下記のサイトにて設定をしています。 ・http://homepage1.nifty.com/glass/tom_neko/web/web_ssl.html 「起動時のパスフレーズ要求をなくす。」まで設定が終わり、 「httpd.confの設定」ができません。 できない内容 #LoadModule ssl_module libexec/httpd/libssl.so　 （↑は９５行にあり、設定ができました。） #AddModule mod_ssl.c （↑検索をかけましたが、見当たらないため設定が出来ません。） #Port 80 （↑検索をかけましたが、記述がないので設定ができません。。） それ以降は、解決しないと進めないのでやっていません。 解決方法はありますでしょうか？ 開発環境 MacBook Air Mac OS X バージョン　10.7.5 MySQLを使用 宜しくお願い致します。
mysql初心者です。 phpmyadmin で検索と置換のクエリ文の書き方に関して質問させて頂きます、宜しくお願いいたします。 データベース: koneko_nyan テーブル: wp_postmeta フィールド：meta_id、post_id、meta_key(varchar(255))、meta_value(longtext) があります。 フィールドmeta_valueの中の"お魚"という文字列を"焼き魚"に置き換えたい。 ただし、meta_valueフィールド全体ではなくて、meta_keyフィールドに"koubutsu"という文字列が含まれている行のmeta_valueに対してだけ置き換えを実行したいと考えています。 この場合、どのようなクエリを送れば、うまく置換できるのでしょうか？ 詳しい方いらっしゃいましたら、ご教示頂きたく存じます。
MySQLのロックレベルはテーブルロックのようなのですが、行ロックに変更するって可能でしょうか バージョンは5.5です
sqlで insert into tb1 values('○○(番号)','○○(名前)',○○(歳))； と入力して作ったデータを select bang,name,tosi from tb2; で表示したのですが、 nameのところが「??」と表示されます。 入力方法が違うのでしょうか？ それとも設定を変えないといけないのでしょうか？ 回答をよろしくお願いします。
チューニングについて質問です。 1. SQLの純粋な実行速度を知るにはどうしたらよいか 2. SQLの叩かれる回数が多い場合にレスポンスが遅くなるのはどう対応すればよいか 1については、純粋に単体での実行時間が知りたいのですがSQLのキャッシュが残っているせいか、高速に処理されてしまうために、なかなか正確な時間が分かりません。 どのようにしたら単体での実行速度を計測できるのでしょうか。 2については、SQL単体ではなかなかの速度が出せているのに、そのSQLが短時間に大量に呼び出される場合に、サーバの負荷があがり、レスポンスが遅くなってしまう場合はどう対処すればよいのかを聞きたいです。 よろしくお願い致します。
教えてください。MySQL初心者です。MySQLサーバがインストールされているサーバのコンピュータ名を変更します。変更によって何か影響することがありますでしょうか？ mysql.userなどのテーブルにhostのデータがあるようなのですが。よろしくお願い致します。
みなさん初めまして。 SQLについて只今勉強中の者です。 EclipseとMySQLを接続したいのですが、どうしても接続できません。 利用環境 apache-tomcat-6.0.36 MｙSQL5.5 Windowsはｘｐです。 apache-tomcat-6.0.36を利用しており、JDBCドライバをダウンロード後、Tomcat内のcommon\lib内にmysql-connector-java-5.1.22-binを導入し、環境変数でパスを通しています。 TomcatとEclipseの接続は確認しています。 また、MySQLについては起動確認や、データベース作成は行えました。 原因のjava.lang.ClassNotFoundException: com.mysql.jdbc.Driverから、JDBCドライバにパスが通っていないため接続が出来ていないと考えております。 初歩的な質問かもしれませんが宜しくお願い致します。 以下は実行した際に表示された内容です。 HTTPステータス 500 - -------------------------------------------------------------------------------- type 例外レポート メッセージ 説明 The server encountered an internal error () that prevented it from fulfilling this request. 例外 org.apache.jasper.JasperException: javax.servlet.ServletException: java.lang.ClassNotFoundException: com.mysql.jdbc.Driver org.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServletWrapper.java:500) org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:410) org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313) org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260) javax.servlet.http.HttpServlet.service(HttpServlet.java:717) 原因 javax.servlet.ServletException: java.lang.ClassNotFoundException: com.mysql.jdbc.Driver org.apache.jasper.runtime.PageContextImpl.doHandlePageException(PageContextImpl.java:865) org.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:794) org.apache.jsp.admin_jsp._jspService(admin_jsp.java:108) org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70) javax.servlet.http.HttpServlet.service(HttpServlet.java:717) org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:386) org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313) org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260) javax.servlet.http.HttpServlet.service(HttpServlet.java:717) 原因 java.lang.ClassNotFoundException: com.mysql.jdbc.Driver org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1680) org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1526) org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java:128) org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java:66) java.lang.Class.forName0(Native Method) java.lang.Class.forName(Class.java:186) org.apache.jsp.admin_jsp._jspService(admin_jsp.java:66) org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70) javax.servlet.http.HttpServlet.service(HttpServlet.java:717) org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:386) org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313) org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260) javax.servlet.http.HttpServlet.service(HttpServlet.java:717) 注意 原因のすべてのスタックトレースは、Apache Tomcat/6.0.32のログに記録されています -------------------------------------------------------------------------------- Apache Tomcat/6.0.32 以上です、宜しくお願い致します。
以前、知り合いからデータベースのINT型の項目には出来ればNULLを許可しない（NOT NULL）方がいいと聞いたことがあるのですが、本当でしょうか？ 現在不動産の物件データを登録するためのシステムを作成しており、 データベースの設計を行なっている最中なのですが、 例えば金額や面積など数字しか入力されない項目はINT型にしたいと考えています。 ※データベースはMySQLになります。 ただし、 物件データ登録時に数字項目に何も入力されなければ「NULL」、 0以上の数値を入力されている場合にはそのままその数値をデータベースに登録したいと考えています。 ※0を入力されている場合には「0」をそのまま入れたいです。 INT型の項目にはNULLを入れるのを避けた方がいい場合には、0を入れるような仕様に変更しようと考えているのですが、その辺のことについて教えて頂けると助かります。 ざっくりとした質問で申し訳ございませんが、宜しくお願い致します。
正規化が分かりません。 冗長性を排除したい、という意図だけは分かるのですが… 例えば、リンク先で回答されているケースは、それぞれ第何正規化に該当するのでしょうか？ ＞個人IDがあり、住所情報を正規化するとしましょう ＞項目は「郵便番号」「都道府県」「市区町村」「番地」「電話番号」「メールアドレス」としますよ ＞個人IDを主キーとする「郵便番号テーブル」を作る ＞個人IDを主キーとする「都道府県テーブル」を作る ＞個人IDを主キーとする「市区町村テーブル」を作る ・これは第1正規化ですか？ ＞個人IDを主キーとする「番地テーブル」を作る ＞個人IDを主キーとする「電話番号テーブル」を作る ＞個人IDを主キーとする「メールアドレステーブル」を作る ・この内容は重複しないと思うのですが、分けると、正規化したことになるのでしょうか？ ・また、その場合は、第何正規化に該当するのでしょうか？ ▽DBの「非正規化」について 　 http://okwave.jp/qa/q5776795.html
顧客が要望する期間に望む個数だけ、担当者が商品を貸し出すような業務を記録するために、下記のようなテーブルをMySQLで作っています。 テーブル : t_lental +---+---+------------+------------+ |man|amt| start_date | end_date | +---+---+------------+------------+ | A | 3 | 2012-01-01 | 2012-01-09 | | B | 2 | 2012-01-01 | 2012-01-10 | | A | 3 | 2012-01-02 | 2012-01-08 | | B | 4 | 2012-01-02 | 2012-01-12 | | A | 1 | 2012-01-03 | 2012-01-13 | | A | 2 | 2012-01-06 | 2012-01-14 | | A | 1 | 2012-01-14 | 2012-01-22 | | A | 4 | 2012-01-15 | 2012-01-18 | | B | 3 | 2012-01-15 | 2012-01-25 | +---+---+------------+------------+ 　　man : 従業員 　　amt : 個数 　　start_date : 期間(自) 　　end_date : 期間(至) この時、月末締めをするため、その月内で最も要望が重なった期間に貸し出した個数の合計を、担当者毎に求めるにはどうしたらよいでしょうか? 上記テーブルの例では、担当者「A」の場合、2012-01-06から2012-01-08までの2日間が最も要望が重なっていることになります。 結果として得たいイメージは以下のようなものとなります。 +---+---+ |man|ans| +---+---+ | A | 9 | | B | 6 | +---+---+ よろしくお願いいたします。
以下のようなデータがあります。 id　顧客コード　日付　金額 1　A001　2012/12/25　100 2　B001　2012/12/24　200 3　A001　2012/12/24　100 4　C001　2012/12/23　500 5　A001　2012/12/23　300 6　B001　2012/12/23　100 このデータを、顧客毎に最新順で表示したいのです。 順番は、 １．最新の日付順に顧客がまず並ぶ ２．その顧客の並び順で、顧客毎に日付が新しい順に各データが並ぶ 説明が下手ですが、下の様に 1　A001　2012/12/25　100 3　A001　2012/12/24　100 5　A001　2012/12/23　300 2　B001　2012/12/24　200 6　B001　2012/12/23　100 4　C001　2012/12/23　500 A001、B001、C001の中で、最新の日付を持っているのがA001→B001→C001なので、その順で並ぶ。 （SELECT 顧客コード, MAX(日付) FROM tbl GROUP BY 顧客コード　かな？） さらに、その顧客の中で日付順にデータが並ぶ。 このように抽出するには、どのようなSQL文で行うのでしょうか。 サブクエリを使うのかなとは思うのですが、あまり理解できていないため思いつきません。 わかるかたよろしくお願いします。
mySQLでデータベース構築中です。 日にちとユーザーIDの組み合わせで、特定日のユーザーの行動を記録することを考えました。 CURDATE()を日にち表示にすると、201301120000という数値になるため、それにユーザーID　1014を足し算すると、201301121014とユニーク数値になり、ユーザー1014の2013年１月12日の行動が入力されることになります。 ユニーク数値に10000を足すと翌日の行動が分かるというSQLを組んだのですが、月や年が変わるとこの法則が通用しなくなります。 そこで、UNIXTIMEのような、特定日からの経過日だけを表す関数を探したのですが見当たりません。 ある数値を足していくだけで翌日や前日、30日前、1340日前が分かる関数というのはニーズが高いと思えるため、なんらかの方法があると思うのですが、見つけることができません。 当方のニーズに合う方法をご教授いただきたくお願い致します。 すると201301120000のような数値になります。当方はこの数値に10000を足して翌日表記をしていたのですが、
phpMyAdminで空のテーブルにCSVファイルをインポートをしているのですが、なぜか一行目だけしかインポートされずに困っています。 フィールド数は合っているのですが、なにか思い当たる原因があれば教えていただけますでしょうか。 こちらはチェックしていて、テキストエディタで開いてカンマの位置や数も合っているはずなのですが。 http://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q1132222936 ちなみにデータは、 フィールド名 a（varchar(20)）,b（float(6,4)） に対して 値 1,1.34 2,1.21 3,1.25 のような単純なデータです。 すでにテーブルとフィールドは作ってあり、CSVデータは 1,1.34 2,1.21 3,1.25 というデータのみです。 何度やっても、「1,1.34」の一行目だけしかインポートされません。
MySQLの初級者です。 下記のようなテーブル構造があります。 article_flag -------------　------------- 　aid　　　　display -------------　------------- 　1　　　　　1 -------------　------------- 　2　　　　　1 -------------　------------- 　3　　　　　1 -------------　------------- 　4　　　　　2 -------------　------------- ...Primary(aid)、INDEX(display) category -------------　------------- 　cid　　　　name -------------　------------- 　1　　　　　カテゴリ1 -------------　------------- 　2　　　　　カテゴリ2 -------------　------------- 　3　　　　　カテゴリ3 -------------　------------- 　4　　　　　カテゴリ4 -------------　------------- ...Primary(cid)、INDEX(name) article_category -------------　------------- 　aid　　　　cid -------------　------------- 　1　　　　　1 -------------　------------- 　1　　　　　4 -------------　------------- 　2　　　　　1 -------------　------------- 　2　　　　　2 -------------　------------- 　2　　　　　4 -------------　------------- 　4　　　　　1 -------------　------------- 　4　　　　　2 -------------　------------- ...INDEX（cid aid) このような構造の中で、 下記のような出力を行いたいのです。 カテゴリ1　【関連記事 2件】 カテゴリ2　【関連記事 1件】 カテゴリ4　【関連記事 2件】 非表示中の記事（display = 2）は関連記事に上がらず、 関連記事の存在しないカテゴリは出力しないという仕様です。 この場合、どのようなSQL文で対処すればよろしいでしょうか？ 現状では、 SELECT c.cid, c.name FROM category as c INNER JOIN article_category as ac ON c.cid = ac.cid INNER JOIN article_flag as af ON ac.aid = af.aid and af.display = '1' GROUP BY c.cid ORDER BY c.name ASC limit 10; というSQL文でまずは抽出してから、 抽出後のPHPのループ内で、 SELECT count(ac.cid) FROM article_category as ac INNER JOIN article_flag as af ON ac.aid = af.aid WHERE af.display = '1' and ac.cid = '{取得したcid}'; とカウントして関連記事数を出すという 回りくどいやり方しか思いついていません。 また例では件数が少ないですが、 実際には、article_flagが500件、categoryが200件あり、 一つの記事に平均で10個近いカテゴリが割り当てられているため、 article_categoryの件数は5000件近くあります。 そのため、最初のSQLクエリがとても遅く、 早くても10秒くらいかかります。 基本的にはlimit 10で10件限定の表示のため、 2番目のクエリは特に重さを感じません。 1つ目のクエリで一度に関連記事数まで取得できれば最善ですが、 難しい場合には、1つ目のクエリでは、 関連記事が存在するかどうかの判定だけでも良いので、 何とか良い方法をご教授の程お願いいたします。
MySQLを使っていて、下記条件で結果がemptyになります。 どうすれば正常に取得できるようになるでしょうか。 SELECT `hoge`, `fuga`, `piyo` FROM `table` WHERE `moge` = 'moge' ORDER BY `fuga` DESC LIMIT 0, 5 ・`moge`と`piyo`にはインデックスが貼られています。 ・DESCを消すと正常に取得できます。 ・WHERE句を消すと正常に取得できます。 ・LIMITの数値を大きくすると正常に取得できます。（'moge'によってどれくらい大きくすればいいかの数値は違う） ・LIMITのoffsetを1以上にすると正常に取得できます。 1ヶ月ほどはちゃんと動作していたのですが、`fuga`をUPDATEしたタイミングからこのような現象となりました。 環境 ・Ubuntu 12.04.1 LTS ・MySQL 5.5.28 ・エンジン mroonga ・groongaのバージョン2.0.9 足りない情報があれば補足致します。 宜しくお願い致します。
最終的には以下のような「FLG1」、「FLG2」というカラムを追加したいです。 先頭はカラム名で、Excel上だと 　FLG1には　=IF(MOD(A2,2)=0,1,0) 　FLG2には　=IF(A2>=20,"L",IF(A2>=10,"M","S")) という数式が入っています。 V1FLG1FLG2 121M 50S 290L 301L 150M MySQLのデータベース上には、元々「tbl1」というテーブルに「V1」のカラムだけがある。 その「tbl1」に対して、新たに「FLG1」と「FLG2」というカラム（フラグ列）を追加したい。 というのが目的です。 現状だと（まだMySQL初心者のため）「V1」をそのままコピーし、UPDATEを使って、1つずつ条件判定して値を上書きしていく方法しかわかっていません。。。 例えばFLG2については以下のように（汗） UPDATE tbl1 SET FLG2='L' WHERE V1>=20 UPDATE tbl1 SET FLG2='M' WHERE V1>=10 AND V1<20 UPDATE tbl1 SET FLG2='L' WHERE V1>=0 AND V1<10 たぶんいくつかの方法があると思うのですが、基本的なものから難しい（ちょっとテクを必要とする）ものまで幅広く教えていただけるとありがたいです。そうすれば、それを今後勉強していけるので。
MY SQLをダウンロードしょうと思いサイトへ行きました。 Download MySQL Community Server からインストール版（６４bit）版をインストールしようとしましたがzip版しかなく仕方なくzip版をダウンロードしました。そしてダウンロードをしましたがなかなかうまくインストールされません。 binホルダーに行きmysql.exeでインストールしましたが上手くいきません。 MySQL Community Server 5.5.29は今一番新しいバージョンですが、依然のようにはいきません。 どうすればインストールされるか教えてください。
macbook air の mountaion lion を使用しています。 csvファイルをmysqlのコマンドラインから呼び込もうとすると mysql> load data infile "file://localhost/Users/uekikouji/excel/t.csv" into table tb1N fields terminated by ','; ERROR 13 (HY000): Can't get stat of '/usr/local/var/mysql/file:/localhost/Users/uekikouji/excel/t.csv' (Errcode: 2) と表示されます。なにが原因でしょうか悩んでいます。よろしくお願いします。
こんにちは、 A,Bテーブルがあり、Aテーブル.ID = Bテーブル.IDの状態で ＩＤごとの最新の更新時間を一件づつ取得したいのですが SQLで抽出することは可能でしょうか？ 取得したい例------------------ ＩＤ、ＴＩＭＥ(タイムスタンプ) １、1356200000 ２、1356228139 Aテーブル---------- ＩＤ 1 2 Bテーブル---------- ＩＤ、ＴＩＭＥ(タイムスタンプ) １、1350000000 １、1356200000 １、1300000000 ２、1356228139 ２、1356000000
あるカテゴリーの商品詳細ページで前後詳細ページへのリンクを設けたいのですが、 後ろページの取得は上手くいきますが、前のページの取得がうまくいきません。 カテゴリーと商品は別テーブルで関連付けテーブルで紐づけさせてます。 PHP+MySQLで構築中です。 ・カテゴリー関連付けテーブル(catgory_term) --------------- | category_id | id | --------------- ・商品テーブルテーブル（items） ----------------------- | id | title | url | ・・・・・・・・・ ----------------------- SQL文は下記のような感じです。（並び順でもSQL内容は変わります.。下記の例は商品ID降順） SELECT items.title,items.id,items.url,MIN(items.id) FROM category_term Left JOIN items ON category_term.id = items.id WHERE category_term.category_id = 'カテゴリーID' AND items.status = 'publish' AND items.id > '商品ID' お手数をおかけしますがご教授いただける幸いです。
2つのテーブルのレコード数をカウントする方法を教えてください。 $sql = "SELECT * FROM テーブル1 and テーブル2"; $res = mysql_query($sql,$myLink); $num_k = mysql_num_rows($res); こんな感じでカウントできるかと思ったのですが出来ませんでした。 宜しくお願い致します。
こんにちは。 テーブルのカラム構成についてご相談させてください。 以下のようなカラム構成のテーブルで、 ------------------------- table name = favorite_items ------------------------- user_no int (11) favorite_item int (11) modified datetime ------------------------- 例えば、不特定多数のユーザーが利用するアプリで、ユーザーごとのお気に入りアイテムを記録するテーブルを作りたいとします。 user_noとfavorite_itemは重複しますが、それぞれの組み合わせでユニークとなるためuser_noとfavorite_itemでインデックスを作成します。 ここで疑問なのですが、このテーブルにはプライマリとなるカラムが存在しません。これは正常な設計なのでしょうか。それとも、例えばlist_noのようなプライマリとなるカラムを作るべきなのでしょうか。 また、コミットやロールバックを利用することは無いのですが、比較的更新や削除のあるテーブルなのでテーブルロックのあるmyisamよりは行ロックのinnodbの方が良いのか・・などと思ったのですが、このあたりはいかがでしょうか。 ご教授頂けますと幸いです。 宜しくお願い申し上げます。
MySQLのSET型のそれぞれの値に JOINする方法はありますでしょうか？ 内容は下記のような感じです。 < shohin > group(varchar) | item(SET) ------------------------------------- 果物群A | 1,3 ------------------------------------- 果物群B | 2,4 ------------------------------------- < kudamono > id(INT) | kudamono(varchar) -------------------------------- 1 | りんご -------------------------------- 2 | オレンジ -------------------------------- 3 | いちご -------------------------------- 4 | メロン -------------------------------- このような構造の中で 果物群A ... りんご, いちご 果物群B ... オレンジ, メロン とphpで出力したいという内容です。 現状ではshohinからselectでitemの値を呼び出し、 一度、explodeで配列化して、それをfor文でSELECTをかけて、 さらにそこから得られたkudamonoを再度implodeする という回りくどい方法しか考え付きません。 よろしくお願いいたします。
お世話になります。mysql初心者です。 MySQLでの文字コードをutf-8に設定したいのですが、やり方がわかりません。 ネットで調べてみましたが/bin/my.iniにそれらしき記述があるのはわかるのですが、実際の記述内容が異なっていてどこをどう変えていいやら・・・さっぱりです。 ちなみにバージョンはXAMPP1.8.1の MySQL 5.5.27です。 よろしくお願いします。
Mysqlで大文字と小文字を区別するように、特定のカラムにBINARYを設定しましたが、逆に、それを解除(削除)する方法はありますでしょうか？ BINARYの設定の方法は多くのサイトで見つけられましたが、削除の方法は分かりませんでした。 どなたかよろしくお願いします。
mysql初心者です。 検索語句（search）で部分一致するものを、名前(name）と更新日（update）でユニーク指定し、修正日(time)が最新のものだけを表示させたいのですが、望む結果が得られません…。 　SELECT * FROM db WHERE name LIKE \"%{$search}%\" GROUP BY name,update までは正しいと思うのですが、さらにtimeの最新を指定する方法を教えていただけませんか？ よろしくお願いします。 いろいろ探して試行錯誤し、以下に行きついたのですが、部分一致がうまく機能しない時があります。（情報不足などあればご指摘ください。） SELECT * FROM db where (time) in (SELECT MAX(time) FROM db WHERE name LIKE \"%{$search}%\" GROUP BY name,update) （中略・件数を取得しページャーに使っています） SELECT * FROM db where (time) in (SELECT MAX(time) FROM db WHERE name LIKE \"%{$search}%\" GROUP BY name,update) ORDER BY time DESC LIMIT $start,10 （中略・whileとmysql_fetch_arrayで表示させています）
selectで抽出したデータの特定カラムのデータを空にしたいのですが、どのような方法がありますでしょうか。 以下のようなofficeテーブルがありまして、データは1万件あったとします。 id　name　place　 1　浅谷　大阪 2　亀山 東京 3　武本 名古屋 placeカラムに東京を含むidが5000未満のデータを抽出し、そのデータのplaceカラムをすべて空に（削除）したいと思っています。 SELECT * FROM office WHERE place like '%東京%' and id < 5000 order by id asc; 上記のselect構文で希望データを抽出することはできたのですが、その抽出したデータのplaceカラムを空に（データを削除）する方法が分かりません。 アドバイス頂けると助かります。 よろしくお願いいたします。
はじめまして 皆様の知恵を貸してください mysqlでの質問なのですが、 簡潔にいうと日付が比較できません。 どういうことをしたいのかというとsqlからwhere文で今の日付より大きいもデータを抽出するということです データベースの構造は id int型 endtime datetime型 で構成されています endtimeには既にいくつかのdatetime型の値が入っています 例えば　2012-12-14 09:18:00 のように入っています でGETDATE()関数を使って今現在の時刻より未来のものだけ抽出するために convert関数を使って一度varchar型に変換することで比較しようとしました 色々インターネットで調べた結果次のような文なのではないかと考えました select id,endtime from [データベース名] where CONVERT(VARCHAR,endtime,121)>=CONVERT(VARCHAR,getdate(),121); しかし実行ができません 比較する方法を教えて欲しいです
下記条件を満たすSQL文を知りたいのですが、どう書けばよいでしょうか？ ■構成 Aテーブル ・「id」カラム ・「created_at」カラム … datetime型 ・「area」カラム Bテーブル ・「a_id」カラム ・「created_at」カラム … datetime型 ■前提 ・Aテーブルの1レコード(「id」カラム)に対して、0～複数のBテーブルレコード(「a_idカラム」)がある ・A.id = B.a_id ■欲しい内容 ・「Aテーブル」「Bテーブル」それぞれのカラム内容全部。※条件あり ▼条件1 Aテーブル「id」カラムに対応したBテーブルの「a_id」が複数ある場合には、該当Aテーブル内容＋ Bテーブル「created_at」カラムの値が一番新しいレコードを返す(取得レコード数は常に1) ▼条件2 Aテーブル「id」カラムに対応したBテーブルの「a_id」がなかった場合には、該当Aテーブル内容＋ Bテーブル側は何も返さない ▼条件3 ※同名カラムを取得する際には、カラム名先頭にそれぞれa、bを付与(「acreated_at」「bcreated_at」) ・後で、それぞれのテーブルカラムとして利用したいだけなので、それが出来れば形式にこだわりはありません
恐らくそれほど複雑なSQLではないと思いますが、中々SQLが作成できず困っています。 回答いただければ嬉しいです。 以下のテーブルがあったと仮定します。 テーブル名： 　売上げ明細 カラム： 　・商品ID　…　売上げ明細なので一意ではありません 　・単価　…　同じ商品IDでも、レコードによって単価は異なります 　・数量　…　1～5の整数のみとします 実際のデータは以下の通りです。 商品ID,単価,数量 1001,50,2 1001,60,5 1002,90,3 1003,60,5 1003,80,4 1003,90,1 1004,60,3 上記データを以下の通り抽出するには、どのようなSQLを組めばいいでしょうか？ １．まず各商品IDの中から単価が最大のレコードだけを取り出す 商品ID,単価,数量 1001,60,5 1002,90,3 1003,90,1 1004,60,3 ２．次に数量でgroup by して、件数をカウントする 数量,件数 1,1 3,2 5,1 １つのSQL文で２の結果が得られれば、途中の抽出条件は特に問いません。 ちなみにMySQL5を使っています。 よろしくお願いします。
グルーピング内で、あるカラムの最大値のレコードで絞り込む方法は、 以下のサイトで知ることができましたが。 http://www.yokablo.com/20120905717.html tb_score +-------+-------+-------+ | c_name | game | c_score | +-------+-------+-------+ | 山田 | 高飛び | 90 | +-------+-------+-------+ | 山田 | 徒競走 | 85 | +-------+-------+-------+ | 山田 | 玉入れ | 90 | +-------+-------+-------+ | 鈴木 | 徒競走 | 85 | +-------+-------+-------+ | 鈴木 | 騎馬戦 | 50 | +-------+-------+-------+ | 室伏 | 綱引き | 100 | +-------+-------+-------+ | 室伏 | 玉入れ | 10 | +-------+-------+-------+ SQL文： SELECT * FROM tb_score INNER JOIN ( SELECT c_name, MAX(c_score) AS MAXSCORE FROM tb_score GROUP BY c_name ) AS TBDUMMY1 USING (c_name) WHERE c_score = MAXSCORE 私の場合、t_score の親テーブル名`t_company`と、 子テーブル`t_items`がありまして、 以下のようなことをやりたかったのですが、エラーとなります。 上記SQL をサブクエリにします。 select * from ( SELECT * FROM tb_score INNER JOIN ( SELECT c_name, MAX( c_score ) AS MAXSCORE FROM tb_score GROUP BY c_name ) AS TBDUMMY1 USING ( c_name ) INNER JOIN t_company ON t_company.c_name = tb_score.c_name WHERE c_score = MAXSCORE ) as T1 , t_items where T1.id_score = t_items.id_score 結果エラーメッセージは、 #1060 - Duplicate column name 'c_name' でした。 エラー箇所が、 GROUP BY c_name　か、 USING ( c_name )　か、 INNER JOIN t_company ON t_company.c_name = tb_score.c_name なのか、分かりません。 SQL の規則としてやってはいけないことをやっていると想像してますが、 ご指摘・ご指導いただけると大変に助かります。 よろしくお願いします。
Mysqlの命令文作成で完全に詰まってしまって途方に暮れています。 添付画像にあるように、テーブルAのanwserの値とテーブルBのuser_answerの値が同じ場合に、テーブルBのanswer_flagを0から1に変更するというMYSQLの命令文を書きたいのですが、上手く行きません。。。 UPDATE tbl_quiz_log SET answer_flag = 1 WHERE user_answer = ANY( SELECT tbl_question.anwser FROM tbl_question INNER JOIN tbl_quiz_log ON tbl_quiz_log.question_id = tbl_question.question_id ) 何が間違っているのでしょうか？ どなたかお力をお貸し頂けませんでしょうか？ どうぞよろしくお願い致しますm(_ _)m ●補足 ※1 キャプチャー画像のカラムは一部のカラムのみ表示している状態です。 ※2 ちなみに、テーブルAのanswerがスペルミスなのは把握しております。
MySQL5.5.27, mysql-connector-java-5.1.12を用いて、DBにアクセスしています。 DBに登録されたテーブル名を取得しようと思い、以下の様なメソッドを作成しました(テーブル名は全て数字です)。 https://gist.github.com/4146754 しばらくは順調に動いていたのですが、DBに登録されたレコード数が25万を超えたあたりで、動かなくなってしまいました。 デバッグをして原因を調べたところ、 metadata.getTables(null, "%", "%", null); の実行時に、メソッドを呼び出したまま固まってしまっていることが分かりました。 同じコードを、別のDBに対して作用させたところ、問題なく動いたため、レコード数が多いのが原因ではないのかと考えたのですが、何かよい対処法はありますでしょうか？ よろしくお願い致します。
さくらサーバのMysql、phpMyadminを利用しています SQL文を勉強してSQL文で書けばいいのでしょうが phpMyadminlのマンマシンインターフェースが便利なのでいつもそれを 利用しています 今回、あるテーブルからある条件に合致するレコード約2000件を 一度に削除しようとしています phpMyadminの検索タブを利用してある条件を指定して、条件に合致する レコードは2000件表示されてきます その抽出された2000件のレコードを一挙に削除したいのですが・・・ phpMyadminでは抽出レコードの表示について、初期値では1画面、 30件毎に表示されるようになっています その画面毎に一番下にメニューがあり各レコードごとにチェックボックス があり、レコード毎にチェックして、チェックがついたレコードを削除 できるようになっていますが 1レコードずつ全部をしていくのは大変のため、画面下にある「すべてのレコード にチェック」をつけるメニューがあります 2000件のテータ消去をするためには 初期値の1画面30件の表示では、70回弱の操作が必要となるため大変です このため、1画面2000レコード表示に指定すると、表示はしてくるのですが 30表示の場合に一番下に出ていた、「すべてチェックする」表示が出て きません Sql文でなく、マンマシンインターフェースで簡単に抽出してきた2000件の レコードを削除する方法はないでしょうか あれば教えていただきたいのですが・・
書き込みさせて頂きます。 今までは、Dreamweaverを使用してhtmlを修正していました。 しかし、phpを使用しているページが出来てしまい、うまく表示できなくなりました。 そのため、XAMPPをインストールしてファイルを表示できるようにしたいです。 ※データベースは使いません。 ※修正後、ファイルをFTPソフトでアップロードします。 しかし、XAMPPのページを見ていると http://www.apachefriends.org/jp/xampp-windows.html#2784 セキュリティに深刻なリスクとなり得ます。等が書いてありますので インストールしようにも何だか怖くて躊躇しています。 上記のような使い方をする場合、セキュリティに何か問題が出てくるのでしょうか。 個人ではなく会社のサイトなので、心配で書き込みいたしました。 もし問題がある場合は、どのような問題があるものですか？ また、会社にはネットワーク管理者がいるのですが XAMPPをインストールする旨を伝えたほうが良いものでしょうか？ あまり交流のない部署なので…伝えなくても良いものであれば そのままインストールしたいのですが；； よろしくお願いします。
2度目の質問となり恐縮しております。 生徒の成績の得意不得意をあらわすSQLを考えています。(mySQL 5.5 centOS6.3) テストの成績をもとに 「kamedaの一番の得意科目(クラスでの相対順位が最上位)は英語で、クラス2位である」 「kamedaの二番の得意科目は数学で、クラス4位である」 「kamedaの三番の得意科目は国語で、クラス7位である」 ということが分かるようにする予定です。 当初私が考えた案ではlimit句を使った方法を考えており、limit後の値を変更することにより2位、3位を出す予定でしたが、私の方法ではうまくいかなかったためこのサイトで質問をさせて頂いたところ、minを使った方法を紹介れました。 (私の質問方法が「クラスの最上位を求める」というように省略して記載していたためmin句での回答を頂くことになりました) この回答をベースに当方で2番目を抽出出来るよう改造に着手しましたがうまく出来ません。 ●min句ベースではminから2番目というものをどうしても取ることが出来ませんでした。 ●このmin句ベースのものをlimit句のSQLに改造しようとトライしたのですがどうしても改造することが出来ませんでした。 何度もこの場をお借りして恐縮ですがお知恵を拝借したくお願い申し上げます。 **************************************************** ベースとなるデータ CREATE table seiseki2 (usr_id TEXT,kyoka_name TEXT,point INT); CREATE table point_rank (p_usr_id TEXT,1st_kyoka_name TEXT,1st_rank INT); INSERT INTO seiseki2 (usr_id,kyoka_name,point) values ('kameda','数学',85),('suzuki','数学',71),('kaneko','数学',32),('yosida','数学',61),('tanita','数学',70),('suyama','数学',80),('kisida','数学',61),('komine','数学',99),('tomita','数学',89),('sugita','数学',75),('kameda','国語',80),('suzuki','国語',46),('kaneko','国語',52),('yosida','国語',89),('tanita','国語',77),('suyama','国語',67),('kisida','国語',81),('komine','国語',89),('tomita','国語',69),('sugita','国語',70),('kameda','英語',94),('suzuki','英語',86),('kaneko','英語',50),('yosida','英語',59),('tanita','英語',48),('suyama','英語',97),('kisida','英語',74),('komine','英語',82),('tomita','英語',59),('sugita','英語',60); INSERT INTO point_rank (p_usr_id,1st_kyoka_name,1st_rank) values ('kameda','',''),('suzuki','',''),('kaneko','',''),('yosida','',''),('tanita','',''),('suyama','',''),('kisida','',''),('komine','',''),('tomita','',''),('sugita','',''); ***************************************************** この場で回答頂きましたSQL 下記はmin句を使用して最上位の教科を出すことが出来ます。 今回の質問は下記を改良し、2番目の教科、3番目の教科を出したいと考えています INSERT INTO point_rank (p_usr_id, 1st_rank, 1st_kyoka_name ) SELECT d1.id , min(d1.rank) AS top_rank , (select GROUP_CONCAT( kyoka ) from (SELECT t1.usr_id as id , t1.kyoka_name as kyoka ,( SELECT count( * ) +1 FROM seiseki2 AS t2 WHERE t2.point > t1.point AND t2.kyoka_name = t1.kyoka_name ) AS rank FROM seiseki2 AS t1 ) as d2 where d2.id=d1.id and d2.rank= min(d1.rank) group by d2.id ) AS kyoka FROM ( select t1.usr_id as id ,( SELECT count( * ) +1 FROM seiseki2 AS t2 WHERE t2.point > t1.point AND t2.kyoka_name = t1.kyoka_name ) AS rank FROM seiseki2 AS t1 ) as d1 group by d1.id ; ********************************************* ご参考 私が当初考えたSQL　順位は出ますが教科が出せません UPDATE point_rank SET 1st_rank= (SELECT ( SELECT count( * ) +1 FROM seiseki2 AS t2 WHERE 1 AND t2.point > t1.point AND t2.kyoka_name = t1.kyoka_name ) AS rank FROM seiseki2 AS t1 WHERE t1.usr_id = point_rank.p_usr_id ORDER BY rank ASC LIMIT 0 , 1)
サイト上のデータから構築したデータベースがあります。 サイト上のデータが更新された場合に、連動してデータベースが更新したいと思っています。 現状は、ChromeのPage　Monitorに更新が上がってきたら、目視で確認して、SQL文を叩いてinsertするという流れでやっています。 更新を少しでも自動化できればと思います。 とはいえ、当方はPHPとMySQLが少しできる程度の初心者なので、あまり複雑なことはできませんが。。。 初めにデータベースを構築した時は、Simple HTML DOM Parserを使ったので、これを使って更新を少しでも自動化できればと思いますが、勿論これを使わなくても構いません。 なお、サイト上のデータは、新しいものが下に来るとは限りません。 【更新前】 hoge1 hoge2 hoge3 【更新後】 hoge1 hoge4 New! hoge2 hoge3 上記のように追加されたものが途中に来る場合もあります。 一方、データベースの方では、ID管理しており、追加されたものは次のIDになるようにしたいです。 id　　　　　name 1　　　　　hoge1 2　　　　　hoge2 3　　　　　hoge3 4　　　　　hoge4 なお、マルチプライマリーキーを使っている関係で、idカラムにはauto_incrementは使っていません。 以上、情報が不足しているかもしれませんが、アドバイスいただければ幸いでございます。 （不足があればおっしゃってください。補足いたします。） また、サイト管理者には手間をかけない約束になっているので、APIで提供してもらうとかFTPで送ってもらうとか、そういうのはナシでお願いします。
カラムの合計数値を検索対象にしたいのですがどう記述すればいいでしょうか？ [TABLE_A] |ID|No1|No2|No3| |A |10 |10 |10 | |B |5 |15 |10 | |C |5 |5 |10 | |D |10 |5 |10 | |E |10 |5 |5 | 例えば上記の様なデータがある場合、No1,No2,No3の合計が30以上のレコードを抽出したい場合はどう記述すればいいでしょうか？ アドバイスよろしくお願いします。
お世話になります。 mysql 超初心者です。 Count( a) AS b FROM tblで aをCountするのはnull値以外で空白もCountしてしまいます。 これを空白もnull値と同じにCountしない方法はどうするのでしょうか？ または空白のみをCountする書き方等あるのでしょうか？ 色々調べてもググってもよくわかりませんでした。 初期値のnull値が一回書き込まれたデーターを削除すると 空白になってCount( a) でCountされて困っています。 初心者なのでなるべく具体的な回答をお待ちしています。 どうかよろしくお願いいたします。
phpMyadmin3.3.10を利用しています それを利用しての検索・削除について質問させてください あるテーブルを選択してそのデータを表示します そして表示されている画面の上にある「検索」メニュー を指定すると何のフィールドで検索するか聞いてきます 必要なフィールドに検索ワードを入れて(例えば「会社」=○○) 実行するとその検索に該当するデータが表示されます ここまではそれでいいのですが 例えば検索結果のデータが900件あったとした場合、現在は1画面に 30件ずつ表示されています 今回、この検索結果で表示された900件すべてを削除したい のですが、画面の下にある「すべてチェックする」という表示 をクリックすると、1画面(30件)しかチェックしないのでこれを チェックして削除にしても、30件しか削除できません。 このように1画面毎チェックして削除する操作となると30回の操作 をする必要があります 1画面100表示にしても、9回操作する必要があります 画面全部(表示されていない画面の分を含めて・・)をチェック して削除する方法はないでしょうか
よろしくお願いします。 会員サイトのマイページにて住所などの情報を更新するページを作成しておりますが、つまづいております。 情報の更新は住所や電話番号なのですが、住所のみを更新する際、電話番号の重複チェックで、 重複チェック用にデータをSELECTした時、自分自身のレコードが含まれているため、自分自身のレコードで重複となってしまい、先に進めません。 WHERE句をうまく利用すればできると思うのですが思いつきません。。。 どのようにSQLを書けばいいのかご伝授ください。
生徒の成績の得意不得意をあらわすSQLを考えています。 MySQL 5.5 CentOS6.3 どの教科がその生徒にとって一番得意科目であり、その教科はクラスで何位なのかを示すSQLです。 「クラスでの相対順位のもっとも高い教科とその順位」を表示します。 kamedaの一番の得意科目(クラスでの相対順位が最上位)は英語で、クラス2位である ということが分かるようにする予定です。 一度に名前と順位が入るようにするのが理想なのですが、その方法が分かりませんでしたので、別々にアップデートすることとしました。 アップデートには相対順位がもっとも高い教科を示す【順位SQL】とその教科を表示する【教科SQL】の2つを用意します。 【順位SQL】 「kamedaの一番の得意科目(クラスでの相対順位が最上位)は●●で、クラス2位」を表示する順位SQLは下記のSQLでうまくいきました。 【教科SQL】 次に、●●の部分を埋めるために、教科SQLを組みました。 しかしながら、 #1241 - Operand should contain 1 column(s) になってしまいます。 どこが適切ではないのか、ご教授頂けませんでしょうか? よろしくお願いいたします。 また、もし、2つのSQLに分けずに一回でアップデート可能な方法があれば、同時にお教え頂けましたら幸いです。よろしくお願いいたします。 **************************************************** ベースとなるデータ CREATE table seiseki2 (usr_id TEXT,kyoka_name TEXT,point INT); CREATE table point_rank (p_usr_id TEXT,1st_kyoka_name TEXT,1st_rank INT); INSERT INTO seiseki2 (usr_id,kyoka_name,point) values ('kameda','数学',85),('suzuki','数学',71),('kaneko','数学',32),('yosida','数学',61),('tanita','数学',70),('suyama','数学',80),('kisida','数学',61),('komine','数学',99),('tomita','数学',89),('sugita','数学',75),('kameda','国語',80),('suzuki','国語',46),('kaneko','国語',52),('yosida','国語',89),('tanita','国語',77),('suyama','国語',67),('kisida','国語',81),('komine','国語',89),('tomita','国語',69),('sugita','国語',70),('kameda','英語',94),('suzuki','英語',86),('kaneko','英語',50),('yosida','英語',59),('tanita','英語',48),('suyama','英語',97),('kisida','英語',74),('komine','英語',82),('tomita','英語',59),('sugita','英語',60); INSERT INTO point_rank (p_usr_id,1st_kyoka_name,1st_rank) values ('kameda','',''),('suzuki','',''),('kaneko','',''),('yosida','',''),('tanita','',''),('suyama','',''),('kisida','',''),('komine','',''),('tomita','',''),('sugita','',''); ************************************************ 【順位SQL(完成)】 UPDATE point_rank SET 1st_rank= (SELECT ( SELECT count( * ) +1 FROM seiseki2 AS t2 WHERE 1 AND t2.point > t1.point AND t2.kyoka_name = t1.kyoka_name ) AS rank FROM seiseki2 AS t1 WHERE t1.usr_id = point_rank.p_usr_id ORDER BY rank ASC LIMIT 0 , 1) 【教科SQL(未完成)】 UPDATE point_rank SET 1st_kyoka_name= kyoka_name WHERE (SELECT kyoka_name,( SELECT count( * ) +1 FROM seiseki2 AS t2 WHERE 1 AND t2.point > t1.point AND t2.kyoka_name = t1.kyoka_name ) AS rank FROM seiseki2 AS t1, point_rank AS p1 WHERE t1.usr_id = p1.p_usr_id ORDER BY rank ASC LIMIT 0 , 1) #1241 - Operand should contain 1 column(s)
「さくら」のレンタルサーバを利用しています そのサーバのデータベースはMySql　5.1を使っているようですが さくらが用意している管理ツール(phpMyadmin)を利用して データをCSVデータとしてエクスポートしたいのですが 日本語が文字化けします ダンプ表示には (1)CSV (2)MS Excel用のCSV (3)・Excel 97-2003 XLS workbook (4)Excel 2007 XLSX Workbook 等々の形式があるのですがいずれも文字化けします 一番下に文字コードを選択する項目があり ・non ・EUC ・SJIS のいずれもやってみたのですが結果は文字化けしてしまいます サーバ側の文字化けしないでエクスポートするためには どのように設定すればよいのでしょうか 教えていただければ幸いです
Wordpressで作られたサイトを まるごと別サーバーへお引越しする時に MySQLのデータをphpmyadminでエクスポートしています。 データベースのことはよく分からないのですが 下記サイトなどを見ながら、見よう見まねでやっています。 http://crushpow.com/archives/449.html http://memocarilog.info/wordpress/1268 http://word-express.net/wp-17#2 しかし、構造のところの 「IF NOT EXISTSを追加」 とデータのところの 「完全なINSERT文を作成する」 「長いINSERT 文を作成する」 という項目にチェックを付けている人と付いていない人がいます。 これは何が違うのでしょうか？ 自分の場合は、３箇所ともチェックを入れてエクスポートして 特にトラブルなく移行できているのですが、 とても気になりましたので、質問しました。 よろしくお願いします。
先ほど質問させていただいたものです． http://okwave.jp/qa/q7800181.html MySQLではwith rollupを使用して,希望の結果を得ることが可能だったのですが, 次に,Accessで同じSQLを実行したところ,エラーになってしまいました．(AccessにはWith Rollupがないようでした．) AccessでMySQLのWith Rollupの代わりになるような機能はありますでしょうか? 何度も申し訳ありませんが,宜しくお願い致します．
現在,MySQLを使用して,データベースを作成しています． 品番と,指定した期間以前のデータの数量を合計しようと思い,下記のようなSQLを実行してみました． select 品番,期間,sum(数量) as sumQuantity ftom 履歴 where 品番 = 'A' and 期間 <= '1302' group by 品番,期間 (期間は2013/02なら12/11になり,さらに / を除去した値です) 結果が添付図のようになりました． さらに,この結果のsumQuantityの合計を求めるにはどのようなSQLを記述すればよいでしょうか? サブクエリを使用するのかな?と思いましたが,うまく記述できませんでした． お分かりになられる方がいらっしゃいましたら,ご教授お願い致します．
東京都の学校別のランクを作っています。 現在、name school pointまでは記載されています。 この後、SQL構文で、rank欄に学校内順位を入れ、city欄にtokyoを入れたいと考えています。 完成形は下記のようなものです。 （同点2位が2人いたら、いずれも2とし、その次の人は4となる) table name__school__city___point___rank kameda__1高__tokyo___345____ 1 suzuki__2高__tokyo___341____ 1 kaneko__3高__tokyo___332____ 1 yosida__2高__tokyo___321____ 2 tanita__1高__tokyo___310____ 2 suyama__1高__tokyo___310____ 2 kisida__2高__tokyo___301____ 3 komine__1高__tokyo___299____ 4 tomita__2高__tokyo___289____ 4 sugita__1高__tokyo___275____ 5 下記のreplace文を考えたのですが、学校別の順位ではなく全体順位の入力となってしまいます。 REPLACE INTO table(rank,city) SELECT ( SELECT COUNT(t2.poit) FROM table t2 WHERE t2.poitn > t1.point AND t2.school = t1.school GROUP BY t2.school ) + 1 AS rank,tokyo FROM table t1; 学校別の順位を入力するためにはどのように改良すればいいでしょうか? SQLはmySQL5.5 CentOS6.3です。 よろしくお願いいたします。
Windows環境でのMySQLのデータベースバックアップで、以下のように文字コードを指定してバックアップが行われています。 mysqldump -uユーザ名 -pパスワード --default-character-set=sjis データベース名 > ****.sql バックアップからリストアするのですが、同じサーバ上で既存の同じデータベース(名)があるので 一度DROP DATABASE データベース名；してからCREATE DATABASE データベース名；を行うつもりです。 以下の２点について教えてください。 (1)create databaseする際に文字コードを指定する必要がありますでしょうか？ create database データベース名 CHARACTER SET sjis; (2)リストア実行時に文字コードを指定する必要がありますでしょうか？ mysqldump -uユーザ名 -pパスワード --default-character-set=sjis データベース名 < ****.sql 因みに ※my.iniには文字コードの指定で、sjis指定の表記がありました。 ※Moveble TypeでMySQLをデータベースとして使用しています。　 よろしくお願いします。
複数カラム検索をしたいと思い、リンク先の通り、 WHERE concat(field1,char(0),field2) LIKE "%検索語%" としたらうまくいったのですが、 そのページに書いてあることが気になるので、教えてください ▽MySQLで複数フィールドから同一語を検索するには・・・ - MySQL - 教えて！goo 　 http://oshiete.goo.ne.jp/qa/2634613.html ・char(0)て何でしょうか？ ＞%データ%は全件を検索するため効率うんぬんを論ずるような仕組みではない ・どういう意味でしょうか？ ・全件検索する際は、LIKE検索を使わないのでしょうか？ 全文検索エンジン(?)を利用するのでしょうか？ ・全件検索しなければ(例えば2カラムだけ)、LIKE検索を利用しても良いのでしょうか？ ・あるいは、データ規模が少なければ、LIKE検索を利用しても良いのでしょうか？ ＞本番ではこんなことはしませんがあくまでも遊びということで ・どういう意味でしょうか？ ・concatで LIKE 検索を普通はしない、ということでしょうか？ ・それとも、LIKE 検索で、char(0)などのセパレータを挟まない、ということでしょうか？ ・あるいは、全件検索でLIKE検索を普通は使わない、ということでしょうか？
table a ------ user_id ------ user1 user2 user3 user4 user5 ------ table b --------------- user_id role_id --------------- user1 role1 user2 role1 user3 role1 user2 role2 user4 role2 --------------- とします。 １つのＳＱＬ文で、a のすべてのユーザそれぞれが指定role_id に属しているかどうかを検索したいです。 例えば、すべてのユーザそれぞれが　role1 に属しているかどうかを検索します。 欲しい結果は以下の通りです。 ------------ user1 true user2 true user3 true user4 false user5 false ------------ ＬＥＦＴ　ＪＯＩＮ　だと思いますが、うまくいきません。 SELECT a.user_id, b.role_id FROM a LEFT JOIN b ON a.user_id = b.user_id WHERE b.role_id='role1'; 結果は以下になります。 ------------ user1 role1 user2 role1 user3 role1 ------------ ＃Ｗｈｅｒｅで絞って、当然の結果です ＳＱＬをどうかければよいでしょうか。 よろしくお願いします。
お世話になります。 スキーマが二つあります。db1とdb2です。 それぞれ、同じ構造のテーブルを持っていて、格納しているデータだけが違います。 db1にdb2をマージしようとしているのですが、上手くいきません。 手順としては、以下のとおりです。 （１）まず、db1のダンプを取りました。 　　（インポート先でテーブルをドロップしないようにオプションを付加） 　　　c:\>mysqldump -u root --add-drop-table=false -p db1>db1.sql （２）次に、db2に接続してダンプしたファイルをインポートしました。 　　　mysql>\. db1.sql インポートの前後で、テーブルの件数を見たのですが、 変わらないのでマージできていないようです。 以下は当方の使用環境です。 Windows7 Pro 64Bit MySQLServer 5.1（mysql-5[1].1.28-rc-win32） 他に必要な情報があればお聞かせください。 よろしくお願いします。
MySQLの公式サイトのリファレンスマニュアルに、そもそもの見方が説明されているページは用意されていますか？ 探したのですが、見当たらなかったので質問させていただきました。 特に斜体の部分が説明がなされているページがあれば大変助かります。 斜体の部分とは、例えば、以下のページのtable_references等です。 http://dev.mysql.com/doc/refman/5.1/ja/update.html 英語の意味からざっくり予想することはできるのですが、直訳してもよく分からないものもあるので。 ご教示のほど、なにとぞよろしくお願い申し上げます。
MySQL初心者です。 基本的な質問ですが、教えてください。 MYSQLデータベースのバックアップは、コマンドラインからmysqldumpでバックアップを行うと思います。 CMD>mysqldump -u(ユーザーグループ) -p(パスワード) (データベース名)　> (バックアップファイル名).sql バックアップSQLを使って再度リストアで入れなおす場合は、 drop database (データベース名);と create database (データベース名); を実行してから行う必要があるのでしょうか？ (バックアップファイル名).sqlの中身を見てみると、 CREATE TABLE '(テーブル名)' (・・・・ ・・・）の前に DROP TABLE IF EXISTS '(テーブル名)'; のようにテーブルのdropをしてからの処理はあるのですが。
MySQL5.5の準同期レプリケーションを使って、マスターサーバー(insert用)とスレーブサーバー(select用)を組み合わせたサイトを作る予定です。 マスター側のサイトはトリガーとイベントを多用しております。(トリガー13個、イベント8個) 当初、マスター側にもスレーブ側にもどちらにもトリガーとイベントを組み込んでいましたが、テストして分かったことは、イベントがエラーを起こすということでした。 マスター側でイベントが始まり結果をスレーブ側に送ることになるわけですが、同時間にスレーブ側のイベントも始まるわけなので、マスターの結果が送られてきたときにはスレーブのテーブルには計算後の数値が記載されており、結果エラーになってしまうことがわかりました。 そのため、スレーブ側のイベントは削除して構築しています。 問題はトリガーについてです。 マスター側にはAテーブルにインサートするとBテーブル、Cテーブル、Dテーブルが連鎖的に変更されるトリガを組んでおり、スレーブ側も同様のトリガを組んでいます。 幸い、いままでのテストでは、トリガーで計算した値が連鎖的に伝わってもエラーになっていません。 ただ、マスター側に高負荷が掛かり、マスターのトリガの計算よりもスレーブ側の計算のほうが早く終了した場合、イベントの時に起こったエラーが出ないか懸念しています。 テストで壊れるのはいいですが、実際に運用した後で壊れることは許されません。 質問としては、「実際にトリガーを使った高負荷サイトを構築されている方でスレーブサーバーを準同期で設定している方」から、どのように組めばよいかのアドバイスを頂きたいというものです。(こんな高負荷サイトで運用しているがトリガを組んでて問題ないなどという例があるとうれしいです) よろしくお願いいたします。 スレーブのトリガーを外すのが一番簡単な方法なのですが、万一マスターがハングアップした際にはスレーブを昇格させる予定ですので出来る限りトリガーはそのままにしたいと考えておりますが、スレーブ側にトリガを組んだままというのは常識的にあり得ないというアドバイスであればそれでも結構です。 これはお願いなのですが、「他のサイトを調べて回答する」という方は申し訳ございませんがご遠慮願います(私も簡単なテストは済ませており低負荷では問題が生じないことまでは分かっております。ブログに落ちているような経験値はこれと大差ありません。この程度ではアドバイスにならないと感じています。) 実際に運用経験があり、正確な知識をお持ちの方にアドバイス頂きたいと思います。 よろしくお願いいたします。 構成はCentOS 6.3 MySQL 5.5.28です。
スクリプト言語「PHP」とGUI 、 データベース言語「SQL」とCUI は無関係？
下記のようなカラムがある時、DBから取得した値を、引数(並べ替え順)に応じて、(同じカラムを)更新するSQL文を教えてください ●カラム id1　sex1　age1　id2　sex2　age2　id3　sex3　age3　id4　sex4　age4　 ●引数例 3 1 2 ※1番目が3、2番目が1、3番目が2 ・「1の数字が付いたカラムの値」を、「3の数字が付いたカラムの値」で更新したい ・「2の数字が付いたカラムの値」を、「1の数字が付いたカラムの値」で更新したい ●質問 ・MySQLだけで処理可能でしょうか？ UPDATE テーブル名 SET id1=(SELECT id3 FROM テーブル名 WHERE id1=id3値),sex2=(SELECT sex3 ……; ・それとも、一度、全ての値を取得して、PHP等で処理するのでしょうか？ UPDATE テーブル名 SET id1=id3値,sex1=sex3値,age1=age3値,id2=id1値 ……; ・他に何か良い方法はあるでしょうか(一旦別テーブル作成後、戻す等) ●環境 MySQL5.1
MySQL5.5でレプリケーション(準同期)を構築しています。 http://it.sifr.me/mysql-semi-synchronous-replication/ 上記のサイトを参考に、マスターサーバー(192.168.100.101)からスレーブサーバー(192.168.100.105)にレプリケーションの予定です。 上記サイトをもとに構築していたのですが、レプリケーションの前の段階の 「SFTPで/var/lib/mysql/に接続、PUT」するという単純なことが出来ません。 下記のように192.168.100.101にあるSQLをスレーブサーバー192.168.100.105にSFTPで接続してPUTするという作業をしたころ Couldn't get handle: Permission denied になってしまっています。 [root@sv1 ~]# cd /var/lib/mysqll　　　　　　//192.168.100.101のマスターサーバー上でcd [root@sv1 mysql]# sftp -oPort=22 replica@192.168.100.105　//スレーブに接続 Connecting to 192.168.100.105... replica@192.168.100.105's password: sftp> cd /var/lib/mysql　　　　　　//192.168.100.105のスレーブサーバー上でcd sftp> put master-mysql-data.tar.gz　　　//192.168.100.105のスレーブサーバーにput Uploading master-mysql-data.tar.gz to /var/lib/mysql/master-mysql-data.tar.gz Couldn't get handle: Permission denied　　//エラー sftp> 現在のユーザー設定は以下の通りです。 ユーザー名はいずれも　replica で 192.168.100.101(マスター) ●linuxユーザー(ユーザー名　replica) ●mySQLユーザー(ユーザー名　replica) 　　　ホスト192.168.100.105 スレーブレプリケーションの許可 192.168.100.105(スレーブ) ●linuxユーザー(ユーザー名　replica)(グループ　mysql) ●mySQLユーザー(ユーザー名　replica)　 　　　ホスト192.168.100.101 　　　スレーブレプリケーションの許可&クライアントレプリケーションの許可 と設定しています。 尚、PUT先の192.168.100.105　の/var/lib/mysql/の所有者はユーザー、グループともmysqlです。 mysqlユーザーで行えばput可能のでしょうが、どのサイトを見てもreplication専用ユーザーを作って対応することとなっており、安全上の面からも機能限定のユーザーでputしたく考えております。 対応方法についてご教授いただきたくお願いいたしします。
SQL文の文法エラーの原因が分からないので、ご教示ください。 ものは、掲示板になります。 PHPからSQLを実行しています。 テーブルの中身とSQL文とエラー文は以下の通りです。 【テーブル】 category_id | tinyint(3) unsigned shop_id | tinyint(3) unsigned id | int(10) unsigned name | varchar(255) 【SQL文】 $sql="insert into テーブル名 value(".$_SESSION['category_id'].",".$_SESSION['shop_id'].",".$_SESSION['thread_id'].",'".$_SESSION['name']."')"; 【エラー文】 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',testname)' at line 1 エラー文中の「testname」は、テストのために、カラム「name」のところにこちらで入れたものになります。 情報に不足があれば、補足するのでおっしゃってください。 以上、よろしくお願い申し上げます。
初めまして。PHP・MySQLの初心者で大変恐縮ではございますが、 ご質問させていただきます。 MySQLに画像を保存する際に、方法としてDBに 直接登録する方法（BLOB型）とディレクトリに画像を 格納する方法とがあると思うのですが、 画像を呼び出す際に、この二つの方法によって できる事やできない事、またメリットやデメリットというのもは どういったものなのでしょうか？ 当方の目的としましては、フリーワード等での検索や商品の比較、 買い物かごの制作等を今のところ視野に入れていますが、 この３つの目的以外にも、今後制作して行く上での 参考にできればと考えております。 お力を貸していただければ大変嬉しく思いますので、よろしくお願いいたします。
お世話になります。 ACCESS下記の通りにSQL又はVBAで文字を追加するにはどうすれば良いでしょうか。いい方法があればお手数ですが、教えてください。よろしくお願い致します。 あるテーブルのフィールドに県名があり、例えば青森、岩手、秋田、宮城など記入されている箇所の頭に"東北"と追加し、東京、埼玉、群馬などには"関東"と文字を一括で追加したいのですが、どうすれば良いでしょうか、条件により一括でという方法を調べていたのですが、中々良い方法が分かりませんでした。良い方法を知っている方いらっしゃいましたらよろしくお願い致します。
既にあるカラムをコピーして、新たなカラムを作成したいのですが、うまくいきません。 どうしたらいいでしょうか？ INSERT INTO `rtable`.`3_column` SELECT * FROM `rtable`.`2_column` 実行すると、下記エラーになります。 #1142 - INSERT command denied to user 'DBユーザー名'@'localhost' for table '3_column' 通常のINSERTなら出来るのですが、この場合のINSERTは、何か特別な実行権限になるのでしょうか？ 環境:レンタルサーバ ちなみに、テーブルをコピーして、新規テーブル作成するのは、下記で出来たのですが、 「テーブルコピー」と「カラムコピー」では、何が違うのでしょうか？ INSERT INTO `データベース名`.`newtable` SELECT * FROM `データベース名`.`oldtable` ;
テーブル作成後に複数のカラムを対象にしたプライマリーキー制約を設定することはできるのでしょうか。 テーブル作成時であれば、次の方法により設定することができます。 ※col_name1及びcol_name2に設定したい場合 CREATE TABLE tbl_name (col_name1 int NOT NULL, col_name2 int, col_name3 varchar(255), PRIMARY KEY(col_name1, col_name2)); しかし、一旦テーブルを作成した後に、プライマリーキー制約を設定し忘れたことに気が付き、設定したい場合は、いかなる方法によりできるのでしょうか。 次の方法にて試みたものの、エラーが生じました。 【SQL文】 ALTER TABLE tbl_name MODIFY col_name1 int, col_name2 int, PRIMARY KEY(col_name1, col_name2); 【エラー内容】 ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'col_name2 int, PRIMARY KEY(col_name1, col_name2)' at line 1 テーブルを削除し、再作成時にプライマリーキー制約を設定する方法によっても対応できますが、削除しなくてもこれを行える方法があるのか否かを知りたく、質問させていただきました。
以下のようなテーブルが3つある場合に2つのテーブルにあるポイントを合計して取得したいと思っています。 ただ、外部結合しているtable_cに条件を与えるとうまく取得できません。 table_cにcdがある場合は条件を指定し、 ない場合は条件を指定しないようにするにはどうすればいいのでしょうか。 【table_a】 id　　　　name ------------------ a1　　　　aaa a2　　　　bbb a3　　　　ccc 【table_b】 b_id　　　　 a_id　　　user_id　　　　point --------------------------------- b1　　　　　a1　　　　00001　　　　5 b2　　　　　a1　　　　00002　　　　2 b3　　　　　a3　　　　00007　　　　10 b4　　　　　a2　　　　00356　　　　10 【table_c】 c_id　　　　user_id　　　　cd　　　　　bonus_point ------------------------------------------------ c1　　　　　00001　　　　cd_1　　　　1 c2　　　　　00007　　　　cd_2　　　　1 c3　　　　　00356　　　　cd_1　　　　1 SELECT table_b.user_id as user_id , (ifnull(table_b.age_count) + ifnull(table_c.bonus_point, 0)) as total_point FROM table_a INNER JOIN table_b ON (table_b.a_id=table_a.a_id) 　　　LEFT JOIN table_c ON (table_c.user_id=table_b.user_id) WHERE table_c.cd = 'cd_1' ORDER BY total_point desc ■結果 user_id　　　　total_point ----------------------------- 00356　　　　　11 00001　　　　　 6 ■求めたい結果 user_id　　　　total_point ----------------------------- 00356　　　 　11 00001　　　 　 6 00002　　　　　2 よろしくお願いします。
PHPとMySQLでWEBアプリを作っています。 複数の人がログインしてデータの書き換えが発生するので、トランザクションを扱いたいと考えています。 サイトや書籍を見て基礎はとりあえず頭に入ったのですが、自分の作っているアプリで一般的にどうやればいいのかピンときていません。 そこでいくつか疑問があるのですが、今回的を一つに絞って質問します。 質問 「同じアカウントのユーザーが別々のブラウザから同時にアクセスしてきても問題が無いようにする一般的なトランザクション処理の方法が知りたい」 現在既に出来ているアプリの流れが以下です。（かなり簡略化しています） <?php 　始めにMySQLでユーザー情報の読み込み 　MySQLでいろんな情報の読み込み 　phpでいろんな処理 　MySQLでいろんな情報の書き込み 　（上記の一連の処理は何回も出てくる） 　最後にMySQLでユーザー情報の書き込み ?> 書籍やサイトに載っているトランザクションの例だと、読み込みと書き込みの一連の流れが連続しているので単純にSTART TRANSACTIONしてCOMMITしている場合が多いです。 しかしこのアプリの場合ユーザー情報の読み込みと書き込みに間が空いているので、この間をSTART TRANSACTIONとCOMMITで挟む、というのはかなりおかしい気もします。 このような場合に同一アカウントからの同時アクセスでも整合性を保つにはどうやるのが一般的なのでしょうか。 根本的にphpプログラムとしてデザインが間違っているのかもしれませんが、あくまでMySQLのトランザクション処理での解決を目指している（もうプログラムはほぼ完成している）ので、MySQLのカテゴリで質問しました。でもそういう指摘もしてもらえるとありがたいです。 (ちなみにこのようなことはあくまでそういうアクセスをしてくる人のまれな状況のための対処であり、頻度としては高くないと思っていますがまずは最初の疑問としてあげました)
WordPressには「テーブル接頭辞」の設定があるので１つのデータベースで複数使えるというのは理解したのですが、EC-cubeと使用する場合はどうでしょうか？どなたか実践されている方はいらっしゃいませんか？方法を教えて下さい。 ■状況： 契約しているロリポップサーバーにはデータベースが1つしか使えません。 現在、EC-Cubeがデータベースを使用しています。後からWordPressを一緒に使用したいのです。 ・使用できますか？ ・WordPressをインストールする際、「任意のテーブル接頭辞」にすれば大丈夫なのでしょうか？ ・どのようにすれば良いですか？ ・注意する点はありますか？ 何卒宜しくお願い致します。
データベースを用いたWEBサービス（趣味であり、商用でない）を作り始めたのですが、相談相手もいない素人が超初心者向けの本を片手に一人で作っているので、オリジナリティ溢れる珍妙な運用になっていないか相談させていただきたくお願い申し上げます。 以下、私の行っている運用の概略について記します。 レンタルサーバーを借りて、そこにPHPファイルやCSSファイルやHTMLファイルやデータベースを置いています。 私のPCにも同じものを置いています。 ローカルで更新して、問題がなさそうなら、レンタルサーバーの方も更新しています。 レンタルサーバーに置いてあるものは、WEB上で公開するためのものです。 ローカルがテスト用といった感じです。 PHPファイルや、CSSファイルはFileZillaを使ってアップロードしているのですが、データベースの方をどのように更新すれば、効率的かが分かりません。 これまで（といっても最近始めたばかりですが）は、レンタルサーバーの方のテーブルを削除して、ローカルでエクスポートしたSQLファイルを、レンタルサーバーにインポートしていました。 これは流石に非効率すぎだろということは、素人の私でも気が付くので、この度、相談させていただく次第でございます。 なお、レンタルサーバーは無限サーバーというところのものを使っています。 http://mugenserver.jp/ phpMyAdminが使える環境です。 それぞれのphpMyAdminバージョンは以下の通りでございます。 レンタルサーバー：3.4.10.1 ローカル：3.4.5 MySQLのバージョンは確認の仕方がよく分かりませんでした。 必要であれば、調べた後、補足欄に書き込みますのでご指示ください。 データベースについて、どのような運用を行うべきでしょうか？ 素人の私でも可能な現実的な運用をお示しいただければ大変助かります。 素人ですがやる気はありますので、よろしくお願いします。 その他、アドバイスに際して必要な情報があれば、お申し付けください。
教えてください。 DBサーバ(Windows2003)にログインし、コマンドプロンプトで >mysql -u(ユーザ）-p(パスワード) を実行し、mysqlモードに入ってから select * host,user from mysql.user; をしたところ、hostの一覧で"%"というマークが表示されています。 これはhostが特定されていないという意味でしょうか？
初めまして。もしお力を貸していただけるならと思い質問させていただきます。 この度、ジャンルは違うのですがこのような比較サイトを作りたいと考えています。 参考URL http://creditcard.zaitsu-labs.com/?r=aw12031400664031&gclid=CJrNopbj9rICFShKpgod8iMAww 希望としては、このような検索機能と、参考サイト左下部にある、チェックした項目の比較機能です。 このようなサイトを作成する場合はMysqlに画像データや表示すべき全ての値を格納して、 取得する必要があると思うのですが、一般的な方法としての制作の流れもしくは、すべき作業はどのようなものなのでしょうか？ 当方、PHPとMySQLの初心者参考書程度のごく初歩的な知識しかありませんので、実際に組むPHPのプログラムやMySQLの 操作方法等の具体的なものではなく、作業全体の流れを把握し、まず、自分が勉強すべきことを明らかにしていきたいと考えています。 また、この内容について説明のあるオススメの参考書やサイトがありましたら、併せて教えていただきたいです。 説明が不十分で申し訳ありません。もし快くお答えいただける方がいれば大変嬉しく思います。
3フィールド以上からなる zaikoテーブルに商品情報を登録しています。 このshohinフィールドのshohin ごとにkazu を取りだしたいのですが、 　　SELECT shohin, COUNT(*) AS kazu FROM zaiko GROUP BY shohin;　は +--------+------+ | shohin | kazu | +--------+------+ | A | 1 | | B | 3 | | C | 5 | | D | 7 | +--------+------+ と出ます。 　　SELECT COUNT(*) AS kazu FROM zaiko GROUP BY shohin; もデータが返りますが、A商品だけを取り出そうと 　 SELECT COUNT(*) AS kazu FROM zaiko GROUP BY shohin WHERE shohin='A'; とすると、ERROR 1064 (42000): が出てしまいます。 Aだけを取り出すsql 文はどのように書けばよいでしょうか？
■知りたいこと ブログカテゴリー(親・子) を取り扱う際、普通は「1テーブル」でいくのでしょうか、それとも、親と子の2テーブルを作成するのでしょうか？ ・それぞれのメリットデメリットは？ ・「ケースバイケースによるので一概には言えない？」or「どちらでも同じ？」 ・また、「2テーブル(親子)」に分けることを正規化というのでしょうか？ ■現状 ・1テーブルで運用(parent_idカラム利用) ・子カテゴリー数が多くなると、phpMyAdmin等で目視する際、カテゴリーテーブルから親カテゴリーIDを探しづらくなる(条件で抽出するので、大きな問題ではないですが)
次のような表があるとします。 科目　点数 英語　93 英語　96 英語　88 独語　95 独語　83 仏語　84 仏語　89 たとえば90点以上取った回数を調べたいだけなら、 select 科目,count(科目) as 回数 from テーブル where 点数>=90 group by 科目; とすればよいのですが、 科目、85点以上の回数、90点以上の回数、95点以上の回数 というふうにまとめたいとき、上記SQL文の数字を変えたものをjoinするしかないのでしょうか？ 簡単なやり方があったら教えてください。
以下のエラーが出ました。 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '?') + 1).split('&'); for(var i = 0; i < hashes.length; i++) { hash =' at line 1 ) You～nearまではいつもどおりなので分かるのですが、その後が何やらよく分からないので、見方を教えていただけないでしょうか？ なお、SQL文は以下の通りです。 select カラム名1 from テーブル名 where カラム名2=$i
以下のようなSQLがあるとき、「best」カラムだけ、後で利用する際、「セレクト１」「セレクト２」何れのカラムから(どちらのテーブルから)取得したか知りたいのですが、どうすれば良いでしょうか？ ＜SQL文例＞ SELECT id, tom, best, center, dragon 　FROM ( 　　SELECT m.id, m.tom, m.best1, m.center, u.dragon FROM main m　←セレクト１ 　　　LEFT JOIN usa u ON m.usa_id = u.id 　　UNION ALL 　　SELECT s.red_id, s.red_title, s.best2, s.center, u.dragon FROM sub s　←セレクト２ 　　　LEFT JOIN usa u ON s.usa_id = u.id 　) as PIYO ＜希望＞ 「id, tom, best, center, dragon」ではなく、 「id, tom, best1, center, dragon」＋「id, tom, best2, center, dragon」で取得したい ＜質問＞ ・SQL生成の方法がおかしいのでしょうか？ ・「セレクト１」「セレクト２」を2回実行して、どーにかして足せば良いのでしょうか？ ・そもそもSQL側で足す、という考えが間違っているのでしょうか？ この場合は2回実行して、スクリプト側で処理すべきなのでしょうか？ ＜最終的にやりたいこと＞ ・「main」「sub」テーブルよりLIKE検索を行い、それぞれでヒットした該当レコードを取得したい ※UNIONを利用し、検索結果を両テーブルより取得表示するとこまでは出来たのですが、「main」「sub」何れから取得したか判断出来ないため、そこからリンクが貼れず、再考しています
ｐｈｐＭｙＡｄｍｉｎでデータベースの照合順序を変更したいのですが、危険なのでしょうか？ 色々調べましたが、難しくてよくわかりません。 ワードプレスのプラグイン部分の文字化けを修正するため、 ・プラグインのテーブルの照合順序 ・プラグインのテーブルのカラムの照合順序 ・データベースの照合順序 を「utf8_general_ci」に変更しようとおもうのですが、 合っておりますでしょうか？不要なものはありますか？ データベースについてはバックアップをとる必要があるのでしょうか？ プラグイン自体の過去の登録内容は消えてもＯＫです。 詳しい方、ご意見をいただければと思います。
以下SQL文で、「hoge」「red」をそれぞれ、「h」「r」として、「h.id」「r.red_id」とかって書きたいのですが、 どう修正したら良いのでしょうか？ (コピペしているので、LEFT JOINの後にテーブル名が来ないとき、どうしたら良いか分かりません) SELECT id, century, tom, best, center, dragon 　FROM ( 　　SELECT hoge.id, c.century, hoge.tom, hoge.best, hoge.center, u.dragon FROM hoge　 　　　LEFT JOIN usa u ON hoge.usa_id = u.id 　　　LEFT JOIN century c ON hoge.century_id = c.century_id 　　UNION ALL 　　SELECT red.red_id, c.century, red.red_title, red.best, red.center, u.dragon FROM red 　　　LEFT JOIN usa u ON red.usa_id = u.id 　　　LEFT JOIN century c ON red.century_id = c.century_id 　) as PIYO
はじめまして、SQLもMYSQLも初心者です。　独学で、1，2か月といったところでしょうか MYSQL5.5.を使用しています。 早速ですが質問です。 自己結合のもとになるクエリが複雑？な場合どうすれば負荷の少ないクエリが組めるでしょうか？ 自己結合したいクエリが、相関サブクエリをつかっているためViewが作れないので 素人考えで、もととなるクエリをSQL中に何回も記述してみましたが、 メモリがオーバーフローしてしまいます。 複雑なクエリをスマートに自己結合する方法はないのでしょうか？ それとも、そもそも、最初に自己結合や外部結合でめいいっぱいデータを展開し、それを相関サブクエリ.etcで、漸次、絞り込んでいくほうが、SQLの手段としては正しいのでしょうか？ 他で上記のクエリのかなりの部分を使用するので、再利用できないかと思って組んでみましたが 行き詰まり、色々と自信がなくなってきました、アドバイスをお願いします。 以下やりたいことです 暇だったら見てください。 勉強も兼ね、カレンダーアプリで担当者ごとの抱えているプロジェクトと、忙しさ、割ける時間、効率性 を可視化することを目的としたソフトをつくろうと思っています。そこで、日にちごとに、不特定の時間帯から、時間の重複を許して、複数の時間帯を除した、あまりの時間を求めるクエリを組もうと思い、web上で勉強して、相関サブクエリと、自己結合とHAVING文などを組み合わせれば、実現可能なことがわかりました。そこで、相関図を書いて、実際に作って見たのですが、上記のようになった次第です。ぜひ、皆様のお知恵を拝借したいしだいです。よろしくお願いします。
複数テーブルからLIKE検索を行いたいのですが、うまくいかないので教えてください ■やりたいこと ・一つのキーワードで、MAINテーブル「hoge」カラムと、SUBテーブル「hoge」カラムを検索して、該当したレコードを表示したい ■テーブル構成 ・MAIN … 「id」「main1」「hoge」… ・SUB… 「sub_id」「main_id」「sub1」「hoge」… ・1つの「id」に対して、対応する「sub_id」が複数(「id」1は一つだけ。対応する「sub_id」1は複数あります) ■試したこと1 SELECT a.* , r.* FROM main a LEFT JOIN sub r ON a.id = r.main_id WHERE ( a.hoge LIKE '%キーワード%' OR r.hoge LIKE '%キーワード%' ) とやると、2件ヒットするはずなのに、1レコードしか取得できません(1レコードに「hoge」カラムが2つ入ります) ■試したこと2 SELECT a.* , r.hoge as rhoge FROM main a LEFT JOIN sub r ON a.id = r.main_id WHERE ( a.hoge LIKE '%キーワード%' OR r.hoge LIKE '%キーワード%' ) とやると、2件ヒットするはずなのに、1レコードしか取得できません(1レコードに「hoge」と「rhoge」カラムになります) ■試したこと3 FROMで2箇所指定するのかと思ったのですが、 SELECT a.* , r.* FROM (main a,sub r) LEFT JOIN r ON a.id = r.main_id WHERE ( a.hoge LIKE '%キーワード%' OR r.hoge LIKE '%キーワード%' ) 結果は、#1066 - Not unique table/alias: 'r'になります ■試したこと4 LEFT JOINがいらないのかと思い、削除したら、2件ヒットするはずなのに、たくさんヒットしてしまいます ■質問 欲しいのは、キーワード検索した際、該当カラムにヒットした数だけのレコードなのですが、どうすれば良いのでしょうか？ ■例 ・東京で検索 ・MAINテーブル「hoge」カラム(2レコード)で2ヒット ・SUBテーブル「hoge」カラム(3レコード)で3ヒット ・ヒットした該当5レコードを取得したい
PHPで以下のような構文でデータベースから読み出しています。 $sql = "SELECT * FROM table_name1 WHERE key = '111' "; $result = mysql_query($sql,$con); while($row = mysql_fetch_array($result,MYSQL_ASSOC)) { ～ } このtable_name1はMyISAMでインデックスが２つで主キーidとkeyを設定しています またこの主キーが昇順になっています。 （直接コマンドで同じクエリーをすると昇順で帰って来ます） つまり以下の様な結果が帰って来ます。 +-----+------+------+ | id | key | data | +-----+------+------+ | 1 | 111 | aaa | | 5 | 111 | bbb | | 7 | 111 | ccc | +-----+------+------+ しかし table_name1をMEMORYに変換した場合（ALTER TABLE `table_name1` ENGINE = MEMORY） 同じSQL分で +-----+------+------+ | id | key | data | +-----+------+------+ | 7 | 111 | ccc | | 5 | 111 | bbb | | 1 | 111 | aaa | +-----+------+------+ という結果になってしまいます、直接コマンドで同クエリーをうつと昇順のまま なのにPHPでの結果のみ逆になります、原因が良くわからないのですが 設定か仕様があるのでしょうか？ よろしくお願いします。
AccessとMysqlを用いてデータベースシステムを作成しています。 添付図の左の表から,右の表の品番と枝番が一致するデータを削除する場合(今回はaaaの2と6)は,どのようにSQL文を記述すればよいでしょうか? Do Untilで1行毎に比較して削除する方法では時間がかかり過ぎたため,SQL文で一度で処理できないかと考えたのですが,SQL文をどのように記述すればよいかわかりませんでした... お分かりになられる方がいらっしゃいましたら,ご教授宜しくお願い致します。
MySQL初心者です。よろしくお願いします。 以下のようなテーブルがあったとして、UPDATEでレコード1つだけnumberから特定の数をマイナスしたいのですが、どうもやり方がわかりません。 id | name | number 1 aaa 100 2 bbb 200 3 ccc 300 3 ccc 300 2 bbb 200 例えば、id=2のレコードの中から1つだけ、numberからマイナスするといった処理を行いたい場合、以下のSQL文だとidが2のものすべてから数がマイナスされてしまいます。 UPDATE table SET number = number-50 WHERE id=2; すべてのレコードからマイナスするのではなく、id=2のレコードの中から1つだけマイナスしたいんです。。。 これをid=2の中で1つ目のレコードからだけマイナスする、といったようにうまく1つのレコードからマイナスする方法をご教示いただけるとありがたいです。 つたない文章で恐縮ですが、どうぞよろしくお願いいたします。
Ｍｙｓｑｌを使ってwebアプリ開発を行っています。 ユーザ情報として趣味を最大5件（3件は必須）で入力できるようにしたいのですが、 その場合のデータの持たせ方を以下のように考えていますが問題ないでしょうか。 もっとよい方法などがあればご教示をお願いします。（下記は一部だけ抜粋したテーブル定義です） ■テーブルＡ（ユーザデータ） ・ユーザＩＤ ・ユーザ名 ・趣味ＩＤ１ ・趣味ＩＤ２ ・趣味ＩＤ３ ・趣味ＩＤ４ ・趣味ＩＤ５ ■テーブルＢ（趣味マスタ） ・趣味ＩＤ・・・テーブルＡの趣味ＩＤ１～５と紐づく ・趣味名 ■補足事項 ・ユーザは５つの入力ボックスに自由に入力できる。 ・値が入力されて登録ボタンが押された際に、入力値でテーブルＢを検索し検索がヒットすれば そのＩＤをテーブルＡに登録。検索がヒットしなければテーブルＢにその値を新規登録し、テーブルＡにもそのＩＤを登録。 またこのようなデータ構造にした場合、 データ（ユーザ名、趣味１～５の趣味名）を一覧表示する場合どのようなＳＥＬＥＣＴ文でデータを取得すればよいでしょうか？テーブルＡとテーブルＢをJOINで結合すればよいと思いますが、結合させたいカラムが複数ある場合にどのようなクエリにすればよいのかがいまいちわかりません。 よろしくお願いします。
質問失礼します。 下記のSQL文にて条件に合うものを表示しています。 select table.*, group_concat(table2.title separator '') as title1, table2.non from table2 join table on table.non = table2.non WHERE table.hiduke = '2012-09-21' AND table.genre LIKE '%ポップス%' group by table2.non すると、table.non　はあるが　table2.non　がない場合、表示されなくなります。 table2.nonはなくてもtable.nonを表示させたいのです。 ご教授お願い致します。
■質問1 PHPを使ってMySQLに接続しているのですが、 「AUTO_INCREMENT」指定しているIDの次の値を取得したいのですが、 どうすれば良いでしょうか？ 用途としては、レコードを挿入する際、画像ファイルにレコードID名を付与したパスをつけたいのです。 ＜やりたいこと＞ 1.AUTO_INCREMENT指定しているIDの次の値を取得 2.画像ファイル名に付与 3.レコード挿入 この1を、どうやるか知りたいです ■質問2 「AUTO_INCREMENT」指定はどこに保存されているのでしょうか？ 例えばレコードを削除した後、新たにデータ挿入する場合、 次の「AUTO_INCREMENT」値ではなく、削除した一番若い番号を利用することは可能でしょうか？ ■質問3 質問2に関連しているのですが、DUMPデータを移行した際など、次の「AUTO_INCREMENT」値も新しいDBへ引き継がれるのでしょうか？
テーブルのデータを抽出したいのですけど テーブルに idと対応するpassワードがあったとすると 入力フォームみたいのを作って 認証したいidとpassワードを入力してもらって それをテーブルにあるのか確認したい場合どうしたらいいでしょうか？ 入力フォームはこうなっています <html> <head> <title>ユーザ認証</title> </head> <body> ユーザ認証<br> <form action="ninsyou.php" method="post" name="form1"> ユーザ名： <input name="id" type="text" id="fUserName"> <br> パスワード： <input name="pass" type="password" id="fPassWd"> <input type="submit" name="Submit" value="認証"> <input type="reset" name="Submit2" value="クリア"> </form> </body> </html> わかりにくい質問ですみません。
郵便番号でマッチングしてLEFT JOINでテーブルを結合したいのですが ひとつのテーブルはハイフン付きでもうひとつはハイフン無しです それをハイフンを除いてマッチングしたいのですが可能でしょうか？ 方法をがあれば教えていただきたいのですが、お願いします。
始めたばかりの超初心者です。オープンソース等を利用して phpとmysqlでブラウザ上にデーターベースを作成中ですが my sql のデータ数が多くブラウザの検索待ち時間が気になります。 ３０万件以上のデーターを 検索する時の待ち時間に ちょうどこのOKWaveのロード待ち時間のような 「読み込み中です。」のような画面を作りたいのですが、 javascript になるのでしょうか？ どのよう方法で実装できるのか、また 簡単に実装できそうなオープンソース等あれば教えて下さい。 どうぞよろしくお願いいたします。
MySQLにてCOUNTした値を、更にCOUNTする事を1回のSQLにて実行する事は可能でしょうか？ ※2回のSQL、プログラミングを介する、EXCELで再集計する等でならCOUNTのCOUNTは求められるのですが…1回のSQLでの回答お願いします。 ユーザーIDと課金額のカラムからなる、以下のようなテーブルがあるとします。 buyテーブル user_id,coin 1,100 5,100 10,200 5,200 5,200 17,100 1,100 2,200 23,500 ユーザー毎の課金回数は下記にて求められますが、 SELECT user_id,COUNT(coin) FROM buy GROUP BY id user_id,count(coin) 1,2 2,1 5,3 10,1 17,1 23,1 count(coin)毎の人数というのはどのように求めればいいでしょうか？ いわば下記のような集計結果が理想です。 ※このような結果を1回のSQLにて出力するSQLをズバリ今回の例に沿って知りたいです。 count(coin),count(count(coin)) 1,4 2,1 3,1 ■環境 Apache2 MySQL5 PHP5 ご教授よろしくお願いします。
PHPを利用しテキストファイルのアップロード、その後ファイルを読込INSERT。 上記のような流れでデータベースに値を代入するスクリプトを作成中ですが タイトルの通り、代入すると文字化けが起こり、上手く代入する事が出来ません。。。 初歩的なご質問かと思いますが宜しくお願いします。 データベース ・phpMyAdmin さくらインターネット レンタルサーバー利用 ・全てUTF-8のカラム設定 PHP/HTMLファイル ・全てUTF-8フォーマットにて保存・アップロード INSERTに利用するファイル ・某サイトよりダウンロードしたSJISフォーマットのテキストファイル(タブ区切り) 実際の動作(1) 1.テキストファイルダウンロード 2.ブラウザよりテキストファイルアップロード 3.ブラウザよりテキストファイル読込・代入 【結果】文字化け発生 実際の動作(2) 1.テキストファイルダウンロード 2.一度テキストエディタで開きSJIS⇒UTF-8へ保存 3.FileZillaにてサーバーへアップロード 4.ブラウザよりテキストファイル読込・代入 【結果】正常 実際の動作(3) アップロードするPHPへ mb_convert_encoding($FILE,"UTF-8","AUTO") mb_convert_encoding($FILE,"UTF-8","SJIS") mb_convert_encoding($FILE,"UTF-8","SJIS-WIN") 等の記述を変更しながら実験 【結果】文字化け発生 Googleにて色々検索しマルチバイト関数を有効にとの情報があり http://manual.xwd.jp/ref.mbstring.html を参考に設定 (1)(2)(3)を実行するが文字化けは変わらず。 アップロード後の文字エンコード判定を実施 http://www.phppro.jp/qa/388 ・ダウンロードそのままをブラウザよりアップロード ・テキストダウンロード後、エディタにてUTF-8に保存したファイルをブラウザよりアップロード どちらもSJISと判定される。 記述方法も曖昧なまま setlocale(LC_ALL, 'ja_JP.UTF-8'); も実験しましたが無理でした。 SQL実行前に $test = mysql_query('SET NAMES utf8', $link) or die("文字コードを指定できませんでした。"); $test = mysql_query($sql, $link) or die("クエリの送信に失敗しました。"); の記述も問題なのでしょうか。 問題はアップロード時に問題、、、？ サーバー側の設定の問題、、、？ 正直お手上げです。（涙 どうかご教授お願いいたします。
テーブルmoney、テーブルmoney2にある金額の合計をテーブルmoney3に1日に1回、EVENTでインサートします。money、money2の金額は随時変わるため、最終結果をmoney3に毎日更新していきます。 CREATE table money(g_usr_id INT,g_money INT); CREATE table money2(n_usr_id INT,n_money INT); CREATE table money_all(o_usr_id INT PRIMARY KEY NOT NULL,g_money_all INT,n_money_all INT); 構文 DELIMITER // CREATE EVENT money ON SCHEDULE EVERY 1 DAY STARTS '2012-09-05 00:30:00' ENDS '2013-03-31 00:30:00' DO BEGIN INSERT INTO money_all(o_usr_id,g_money_all,n_money_all) SELECT o_usr_id,SUM(g_money),SUM(n_money) FROM (SELECT g_usr_id AS o_usr_id,g_money,0 AS n_money FROM money UNION ALL SELECT n_usr_id,0,n_money FROM money2) AS T GROUP BY o_usr_id; END; // DELIMITER ; これで初日目の分は無事インサート出来たのですが、翌日以降EVENTがアップデートしようとするとDUPLICATE KEYエラーが出て更新できていません。(当たり前ですが) そこで下記のようにON DUPLICATE KEY UPDATE を付けてみたのですが、エラーになってしまいました。 質問です。 集約関数のON DUPLICATE KEY UPDATE以降はどのように書けばいいか、下記の構文を修正いただけませんでしょうか DELIMITER // CREATE EVENT money ON SCHEDULE EVERY 1 DAY STARTS '2012-09-05 00:30:00' ENDS '2013-03-31 23:30:00' DO BEGIN INSERT INTO money_all(o_usr_id,g_money_all,n_money_all) SELECT o_usr_id,SUM(g_money),SUM(n_money) FROM (SELECT g_usr_id AS o_usr_id,g_money,0 AS n_money FROM money UNION ALL SELECT n_usr_id,0,n_money FROM money2) AS T GROUP BY o_usr_id ON DUPLICATE KEY UPDATE g_money_all=NEW.SUM(g_money),n_money_all=NEW.SUM(n_money) FROM (SELECT g_usr_id AS o_usr_id,g_money,0 AS n_money FROM money UNION ALL SELECT n_usr_id,0,n_money FROM money2) AS T GROUP BY o_usr_id; END; // DELIMITER ; よろしくお願いいたします。(MySQL 5.1です)
Table t1には t1code｜t1type ------------------ 花子｜1 太郎｜1 一郎｜2 次郎｜2 五郎｜2 Table t2には t2code｜date ----------------- 太郎｜2012-05-30 太郎｜2012-05-30 花子｜2012-05-10 花子｜2012-05-10 次郎｜2012-03-20 五郎｜2012-04-10 一郎｜2012-03-01 と登録されている場合に t1type毎に一番新しいdateをもつt2codeを抽出したいのです。 そこで、 select t2code,max(date) from t1 inner join t2 on t1code = t2code where (t2code,date) in (select t2code,max(date) as d from t2 group by t2code) group by t1type としたところ、 +--------+------------+ | t2code | max(date) | +--------+------------+ | 太郎 | 2012-05-30 | | 次郎 | 2012-04-10 | +--------+------------+ となります。 本来は、次郎→五郎になってほしいのですが、 どこが悪いのでしょうか？ よろしくお願いします。
MySqlには不慣れな者です。 来店table id|text_date |name 1 |20120101010101|山田 2 |20120222001227|鈴木 3 |20120309035932|福田 4 |20120309035932|館山 5 |20120713121211|大沢 6 |20120822120127|矢島 といったテーブルがあるとします。 カラムtext_dateはCHARで、日時データを持っています。 （ちょっと解り辛いサンプルで失敬） SELECT text_date, count(*) FROM 来店table WHERE text_date >= "20120101010101" GROUP BY text_date; とするとid 3・4の同日時のみカウント2として以外はカウント1で出ると思います。 希望ですが、カラムtext_dateの時間部（8・9番目の数字）でカウントを取りたいのですが。 GROUP BY の指定方法でそのような事はできるのでしょうか？ MySqlのリファレンスを色々探し回っているのですが、見つけることができません。 ご助力いただけると助かります。
下記の3つのテーブルがあります。 CREATE table money(g_usr_id INT,g_money INT); CREATE table money2(n_usr_id INT,n_money INT); CREATE table money_all(o_usr_id INT,g_money_all INT,n_money_all INT); moneyとmoney2の数値は下記の通りです。 テーブルmoney g_usr_id g_money 1　　　 100 2　　　 200 テーブルmoney2 n_usr_id n_money 1　　　 1000 2 　　　 2000 1 　　　10000 2 　　　20000 ユーザー1、ユーザー2の持っている金額の合計をテーブルmoney3に インサートする構文を考えました。 o_usr_id,g_money_all,n_money_all 1 　　　100 　　　　　11000 2 　　　200 　　　　　22000 となるのが理想です。 構文 INSERT INTO money_all(o_usr_id,g_money_all,n_money_all) SELECT money2.n_usr_id, SUM(money.g_money), SUM(money2.n_money) FROM `money`,`money2` WHERE money2.n_usr_id = money.g_usr_id; 結果 o_usr_id,g_money_all,n_money_all 1　　　　600 　　　　　33000 usr_idが最初の1番に纏められ、総合計を表示されます。 しかも、g_moneyに至っては、n_moneyが複数ある関係上、複数回合計されています。 私の希望するユーザーごとの合計を出すにはどこを変更すればよいでしょうか? よろしくお願いいたします。
はじめまして ER図の書き方でFK（外部キー）として記載できるもしくは そう呼べるのはinnodbでの環境に限るのでしょうか？ mysqlでmyisamにて構築しているのですが 例えば注文テーブルに商品IDや顧客ID、受注スタッフID、発注スタッフID等の カラムがあったとして、そらぞれのカラムは商品テーブル、顧客テーブル、 スタッフテーブルのプライマリーキーです。 この場合、商品IDは外部キーと呼べるのでしょうか。 また発注スタッフIDが必ず登録されているとは限らないのですがこれも外部キー と呼べるのでしょうか。 よろしくお願いします
提示版に投稿した各ユーザーの ユーザータイプを取得したいのですが分かりません。 以下のテーブルがあります。 「bbsTable」(投稿された提示版のデータを保存するテーブル) フィールド：postUserName, postTitle, postText, postTextIndex, postDate 「userTable」(会員ユーザーのデータを保存するテーブル) フィールド：userId, userName, userType, date 今までは以下の様に提示版の投稿データを「postDate」の降順で取得していました。 select postUserName, postTitle, postText, postDate from bbsTable order by postDate desc; ですが提示版に投稿した会員ユーザーのタイプ(userType)も 一緒に取得する必要が出てきたので select postUserName, postTitle, postText, postDate, '' as postUserType from bbsTable order by postDate desc; (このSQL文をどの様に変化させたらいいのか分かりません) の様に('' as postUserType)で擬似フィールドを作成し、 選択された各レコード中の postUserName(投稿ユーザー名：bbsTable)を元に userType(ユーザータイプ：userTable)をデータとして取得し、 その擬似フィールドの部分から参照して 他の提示版データ(postUserName, postTitle, postText, postDate)と 共に取得するにはどうすればいいのでしょうか？
Visual Studio (C++)で作成したモジュールの使用状況を収集するために、 アプリを起動する度に、サーバに接続し、そのサーバにログを残す という仕組みを作りたいと考えています。 (本屋で物色したのですが結局、該当する本はわかりませんでした) セキュリティや拡張性などを考えると おそらく実現の方法はいろいろあると思われますが、 まずは”動かす”を第一に考えています。 １．アプリからサーバにアクセスするのは、どういった仕組みを利用するのが ２．サーバ側はどのような構成になるのでしょうか。 ３．サーバ側で受け取った情報をDBに書き込むにはどのようにするのか ネットや書籍で調べてみると 　　サーバとDBとの接続は 「TomcatからJDBCを使用してデータベースMySQLにアクセスする」や 　　「PHPからMySQLにアクセスする方法...」 　　等々なんらかの情報があるのですが、 　　アプリからサーバへのアクセスの方法は、 　　自分にはどれがそうなのかわかりませんでした。 　　 　　的外れのことをいっているかもしれませんが、教えていただけますとありがたいです。
＜やりたいこと＞ ・(ブログの)エントリーデータを元に、「categoryテーブル」より、親カテゴリー内容と、子カテゴリー内容を抽出したい ＜テーブル構成＞ ■categoryテーブル ・category_idカラム ・parent_idカラム ・その他色々カラム ＜現状＞ 1.　SELECT * FROM category where category_id = :category_id 2.　1で抽出したデータのparent_idを取り出して、再度、SELECT 　　SELECT * FROM category where category_id = :parent_id ＜質問＞ ・2回SELECTしているのが冗長な気もするのですが、普通はどう書くのでしょうか？ ・もっと良いテーブル構成があれば教えてください ※内容 … ブログの「メイン」「サブ」カテゴリー。1つのメインカテゴリーにつき、サブカテゴリーが複数
var $user_details = array( 'id' => array('type' => 'string', 'null' => false, 'default' => NULL, 'length' => 36, 'key' => 'primary'), 'user_id' => array('type' => 'string', 'null' => false, 'default' => NULL, 'length' => 36), 'position' => array('type' => 'float', 'null' => false, 'default' => '1'), 'field' => array('type' => 'string', 'null' => false, 'default' => NULL, 'key' => 'index'), 'value' => array('type' => 'text', 'null' => true, 'default' => NULL), 'input' => array('type' => 'string', 'null' => false, 'default' => NULL, 'length' => 16), 'data_type' => array('type' => 'string', 'null' => false, 'default' => NULL, 'length' => 16), 'label' => array('type' => 'string', 'null' => false, 'length' => 128), 'created' => array('type' => 'datetime', 'null' => true, 'default' => NULL), 'modified' => array('type' => 'datetime', 'null' => true, 'default' => NULL), 'indexes' => array('PRIMARY' => array('column' => 'id', 'unique' => 1), 'UNIQUE_PROFILE_PROPERTY' => array('column' => array('field', 'user_id'), 'unique' => 1)) ); var $users = array( 'id' => array('type' => 'string', 'null' => false, 'default' => NULL, 'length' => 36, 'key' => 'primary'), 'username' => array('type' => 'string', 'null' => false, 'default' => NULL, 'key' => 'index'), 'slug' => array('type' => 'string', 'null' => false, 'default' => NULL), 'password' => array('type' => 'string', 'null' => true, 'default' => NULL, 'length' => 128), 'password_token' => array('type' => 'string', 'null' => true, 'default' => NULL, 'length' => 128), 'email' => array('type' => 'string', 'null' => true, 'default' => NULL, 'key' => 'index'), 'email_verified' => array('type' => 'boolean', 'null' => true, 'default' => '0'), 'email_token' => array('type' => 'string', 'null' => true, 'default' => NULL), 'email_token_expires' => array('type' => 'datetime', 'null' => true, 'default' => NULL), 'tos' => array('type' => 'boolean', 'null' => true, 'default' => '0'), 'active' => array('type' => 'boolean', 'null' => true, 'default' => '0'), 'last_login' => array('type' => 'datetime', 'null' => true, 'default' => NULL), 'last_action' => array('type' => 'datetime', 'null' => true, 'default' => NULL), 'is_admin' => array('type' => 'boolean', 'null' => true, 'default' => '0'), 'role' => array('type' => 'string', 'null' => true, 'default' => NULL), 'created' => array('type' => 'datetime', 'null' => true, 'default' => NULL), 'modified' => array('type' => 'datetime', 'null' => true, 'default' => NULL), 'indexes' => array('PRIMARY' => array('column' => 'id', 'unique' => 1), 'BY_USERNAME' => array('column' => array('username'), 'unique' => 0), 'BY_EMAIL' => array('column' => array('email'), 'unique' => 0)) ); } というスキーマ定義をしたところ、 user_detailsだけ、 user_details: SQLSTATE[42000]: Syntax error or access violation: 1071 Specified key was too long; max key length is 767 bytes というエラーが出てしまいます。キー長がオーバーしているらしいのですが、具体的にどこをどう修正すれば７６７バイト以下になるのかわかりません。 色々試して見たのですがわかりませんでした。 ご教示頂ければ幸いです。よろしくおねがいいたします。
VARCHAR型のカラムに「改行を含むテキスト」をデフォルト値に設定したいのですが、どうやればできるのでしょうか？
＜前提＞ ■oldテーブル ・idカラム ・createdカラム ・modifiedカラム ・その他色々カラム ■newテーブル ・idカラム ・createdカラム ・modifiedカラム ・その他色々カラム ＜やりたいこと＞ 両テーブルのidが一致するとき、 newテーブルの「created」「modified」カラムの値で、oldテーブルの同カラムを上書きしたい SQL文を教えてください
CentOS6.xのhttpdにphpMyAdminをセットアップし、別マシンにおいてあるMySQLに接続しようとしています。 外部マシンにtcpで接続するため、内部ソケットは使用しないと考えておりますが、アクセスしますと、なぜか#2002 Can't connect to local MySQL server ...というエラーメッセージが出ます。 お心あたりがあれば、ご教授ください。 ちなみに、別マシン上(CentOS5.x)で同様にphpmyadmin-2.11.11.3-2を稼動させておりますが、こちらは問題なく稼動しております。 要は、現在稼動しているphpmyadmin2をDBを含めphpMyAdmin3にマイグレーションしたいと考えているわけです。 (DBは現行稼動のものをバックアップして別マシンに再構築しています) 諸元値(関連あると思われるもの抜粋) OS=CentOS6.3 phpMyAdmin-3.5.2-1(EPELからyum) php-5.3.3-14(CentOS BASEよりyum) php-mysql-5.3.3(同上) mysql-5.1.61-4(同上) mysql-libs-5.1.61-4(同上) mysqlクライアントでは問題なくアクセスが可能です。 ※アクセスしたときのエビデンスは以下 # mysql -u root -h 10.9.1.7 -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \g. Your MySQL connection id is 74 Server version: 5.1.61 Source distribution Copyright (c) 2000, 2011, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\h' for help. Type '\c' to clear the current input statement. mysql> config.inc.phpには以下のように設定してあります。 /* Authentication type */ $cfg['Servers'][$i]['auth_type'] = 'cookie'; /* Server parameters */ $cfg['Servers'][$i]['host'] = '10.9.1.7'; $cfg['Servers'][$i]['connect_type'] = 'tcp'; $cfg['Servers'][$i]['compress'] = false; /* Select mysql if your server does not have mysqli */ $cfg['Servers'][$i]['extension'] = 'mysqli'; $cfg['Servers'][$i]['AllowNoPassword'] = false; ※ちなみにphpmyadmin2では、hostとextensionが異なるのみ /etc/httpd/conf.d/phpMyAdmin.confの内容は以下 Alias /mysql /usr/share/phpMyAdmin <Directory /mysql> Order deny,allow Deny from all Allow from all </Directory> ※現在はテスト中なのでInetから切断されたネットワーク環境においてあります /etc/my.conf [client] socket=/var/lib/mysql/mysql.sock port=3306 host=10.9.1.7 user=mysql -- この状態で、httpdを起動し、phpmyadminのフォルダをアクセスすると、userとpassword入力画面まで行きます。 そこで、先にmysqlクライアントで接続可能であったユーザとパスワードを指定すると、冒頭のエラーメッセージが表示されるという具合です。 ちなみに、phppgadminもセットアップしておりますが、こちらは良好に動作しております。 よろしくお願いします。
MAMPにてMYSQLを導入しています。 Mac os x snow leopard10.6.8 php5.3.6 mysql5.5.9 apache2.2.21 文字コードを確認すると最初はlatin1となっているため、ネットで調べ対処してみました。 対処した内容としては、以下になります。 (1)/MAMP/db/mysql/ にリネームしたmy.confを置く。 (2)[mysqld]に、character-set-server=utf8とskip-character-set-client-handshakeを追加。 (3)[mysql]に、default-character-set=utf8を追加。 その後再起動し、文字コードを確認してみたところ、以下の２つがどうしてもlatin1のままです。 character_set_database character_set_server 他にも対処してみたのですが、どうしてもこの２つだけがlatin1のままです。 どういった対処をすれば文字化けを解消できますか？ どうが、解消法をご教示戴けないでしょうか。 宜しくお願いします。
DB内データの<a>タグを、全て[url]タグへ変更したいのですが、どうすればよいでしょうか？ ＜経緯＞ ・ブログを移行したのですが、新しいブログでは、<a>タグを全てエスケープするので、該当データを[url]タグへ一括変換して、リンク表示させたい ＜変換したいこと＞ ・対象DB指定カラム(entry)内の、全ての「<a href="○○">△△</a>」を、「[url=○○]△△[/url]」へ変更したい ＜質問＞ ・どうやって、やるのでしょうか？ ・UPDATE文を利用して、正規表現とかでやるのでしょうか？ ・それとも、ＤＵＭＰデータを取得して、秀丸で正規表現とかでやるのでしょうか？ その場合は、どう書けば良いでしょうか？ ＜環境＞ ・MySQL
例えばこのようなサイト。 http://www.fimosw.com/ 左上にID（メールアドレス）パスワード その下に新規会員登録とありますが、 この、新規会員登録のシステムを自分で制作して、IDパスワードを入力して 自由にログインできるサイトを作りたいと思ってます。 ちなみに、CMSはWordPressを利用します。 私はhtml・css・phpは理解してますが、データベース(mysql)に 関しては疎く途方にくれてます... どなたか、作り方の概要だけでもいいので教えていただけ ないでしょうか・・・？ または、参考になるような書籍でも.... お願いします(。・ω・。)
PHPでログイン画面で入力されたIDからユーザーNOを割り出し、商品テーブルにあるユーザーNOが一致する商品だけを絞り出すSQLを組みたいです。 ユーザーテーブル ユーザーNO、ユーザーID、パスワード 商品テーブル 商品名、ユーザーNO、数量 商品テーブルのsqlのwhereの中に、もうひとつsplをいれるようなことできますか？ 例えばユーザーIDがyamadaの検索結果でたユーザーnoで商品テーブルのユーザーnoが一致するものを表示です よろしくお願いします
PerlとMysqlでWebアプリケーションを構築しています。 その中で銀行口座のような入金・出金・残高・日付・摘要のような項目があります。 実際はお金ではなく、ポイントなので 入ポイント・出ポイント・残高ポイント・摘要です。 （日付・摘要はここでは問題ではありません） そこで本題なのですが、こういったDBを設計する際にフィールドは 入ポイント・出ポイントの２つにして、残高は出力する際に計算するのがいいのか それとも 入ポイント・出ポイント・残高ポイントの3つにして、インサートするさいに 毎回前残高を取得して、計算後インサートするのがいいのでしょうか？ ※ちなみに会員用のシステムなのでその他にIDフィールドなどがあるのはここでは割愛しております。 不明な点や不足情報があればご指摘ください。 恐れ入りますがよろしくお願いいたします。
MySQLの事で質問です。 テーブル１～４を結合してフィールド「comment」を検索 する時にフィールド「postDate」の降順でソートしたい のですがエラーが出ました。 「SQLコマンド」 select text from table1 union all select comment from table2 union all select comment from table3 union all select comment from table4 where match(commentIndex) against("検索ワード" in boolean mode) order by postDate desc; 試しに union all select comment from table2 union all select comment from table3 union all select comment from table4 の部分を削除して実行してみた所、成功しました。 後、order by postDate desc;のみ削除した場合でも成功しました。 エラーの内容はこれです↓↓ Unknown column 'postDate' in 'order clause' フィールド「postDate」は存在します。 (varchar型何ですが、それがいけないと思い date型やdatetime型と変えてみましたがダメでした) 何とかソートしたいのですがどうすればいいのでしょうか？
xamppを自分のPCに入れて、MySqlを起動しようとしましたが、 「Start」を押して「Running」が一瞬アクティブになりますが、すぐに消えます。 対処方法をよろしくお願いします。 ■PCの環境 ・OSはwindowsXP。 ・Skypeはインストールしていない。 ・OSは最近リカバリーしており、日が経っていない。 ■xamppの環境 バージョン1.7.4を使用。 ■現在までに試みた事(結果、改善しませんでした)。 ・コマンドプロンプトで、「netstat -an -o」を実行して確認したが、 他に３３０６のポートを使用している形跡がない。 ・ファイヤーオール及びウイルスソフトを停止。 ・「Windwsファイヤーオール」画面の「例外」で、MySqlを追加。
お世話になります。 xamppでphpmyadminを利用していますがバグのせいか正常に動作しません。 どなたかxamppまたはphpmyadminのバグ情報が掲載されている（できれば日本語の）サイトを教えていただけないでしょうか。 どうか、よろしくお願いいたします。
